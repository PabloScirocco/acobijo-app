<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Grupo A Cobijo</title>
<meta name="description" content="App de experiencia del cliente: eventos, horarios y accesos rápidos a los alojamientos del Grupo A Cobijo.">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0ea5e9">
<link rel="icon" href="assets/logo_acobijo_white.png">
<style>
:root{--bg:#fff;--card:#f4f9ff;--accent:#0077cc;--muted:#6b7a8c;--text:#0a1a2a;--line:#dce7f5;--tint:#eaf4ff;--ink:#064e89}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:var(--text)}
.wrap{max-width:900px;margin:0 auto;padding:20px}
header{display:flex;align-items:center;gap:12px;margin:8px 0 20px;flex-wrap:wrap}
.logo{width:52px;height:52px;border-radius:12px;overflow:hidden;cursor:pointer}
.logo img{width:100%;height:100%;object-fit:contain}
h1{font-size:1.6rem;margin:0}
.tag{font-size:.9rem;color:var(--muted)}
.pill{padding:4px 12px;border-radius:20px;font-size:.85rem;border:1px solid var(--line);background:var(--tint);color:var(--ink)}
section-title{font-size:1.35rem;font-weight:700;margin-top:28px;display:block}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:14px;margin-top:12px}
.card{background:var(--card);border-radius:16px;padding:16px;border:1px solid var(--line)}
.btn{padding:10px 14px;border-radius:12px;border:1px solid var(--line);text-decoration:none;display:inline-block;background:var(--tint);font-weight:600;margin-right:6px;margin-bottom:6px;color:var(--ink)}
.btn:hover{background:rgba(0,119,204,.12)}

.event-card{padding:14px;border-radius:14px;background:var(--card);border:1px solid var(--line);margin-bottom:10px}
.event-title{font-weight:700;font-size:1.05rem;margin-bottom:4px}
.event-date{font-size:.9rem;color:var(--muted)}
.event-desc{font-size:.95rem;margin-top:6px;margin-bottom:4px}

/* Mapas */
.map{width:100%;aspect-ratio:16/10;border-radius:12px;overflow:hidden;border:1px solid var(--line);background:#fff}
.map iframe{width:100%;height:100%;border:0}

/* Panel Admin con scroll móvil */
#adminPanel{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(4px);display:none;max-height:90vh;overflow-y:auto;padding-bottom:60px}
#adminBox{max-width:560px;margin:40px auto;background:#fff;border:1px solid var(--line);border-radius:20px;padding:22px}
input,textarea,select{width:100%;padding:10px;margin:6px 0 14px;border-radius:10px;border:1px solid var(--line)}
textarea{height:90px}
.admin-btn{width:100%;padding:12px;background:var(--accent);color:#fff;border-radius:12px;margin-top:6px;font-weight:700;border:none}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid var(--line);text-align:left}
.muted{color:var(--muted);font-size:.9rem}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo" id="adminTrigger"><img src="assets/logo_acobijo_white.png" alt="Grupo A Cobijo"></div>
    <div><h1>Grupo A Cobijo</h1><div class="tag">Experiencia del cliente</div></div>
    <span class="pill" style="margin-left:auto">PWA • Offline</span>
  </header>

  <section-title>Eventos Grupo A Cobijo</section-title>
  <div id="eventsList"></div>

  <section-title>Horarios</section-title>
  <a class="btn" href="#">Ver horarios</a>

  <section-title>Campings</section-title>
  <div class="grid">
    <!-- Oyambre -->
    <article class="card">
      <h3>Camping Caravaning Playa de Oyambre</h3>
      <p class="muted">Todos los servicios · Frente al mar</p>
      <div class="row">
        <a class="btn" href="https://www.oyambre.com" target="_blank" rel="noopener">Web</a>
        <a class="btn" href="tel:+34942711461">Llamar</a>
        <a class="btn" href="https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre" target="_blank" rel="noopener">Cómo llegar</a>
        <a class="btn" href="https://wa.me/34675696212" target="_blank" rel="noopener">WhatsApp</a>
      </div>
      <div class="map"><iframe title="Mapa Oyambre" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps?q=Camping+Caravaning+Playa+de+Oyambre&output=embed"></iframe></div>
    </article>

    <!-- Ramales -->
    <article class="card">
      <h3>Camping Ramales</h3>
      <p class="muted">Cuevas · Montaña · Actividades</p>
      <div class="row">
        <a class="btn" href="https://www.campingramales.com" target="_blank" rel="noopener">Web</a>
        <a class="btn" href="tel:+34654463133">Llamar</a>
        <a class="btn" href="https://maps.google.com/?q=Camping+Ramales" target="_blank" rel="noopener">Cómo llegar</a>
        <a class="btn" href="https://wa.me/34654463133" target="_blank" rel="noopener">WhatsApp</a>
      </div>
      <div class="map"><iframe title="Mapa Ramales" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps?q=Camping+Ramales&output=embed"></iframe></div>
    </article>

    <!-- Ruiloba -->
    <article class="card">
      <h3>Camping El Helguero (Ruiloba)</h3>
      <p class="muted">Naturaleza · Familiar · Mascotas</p>
      <div class="row">
        <a class="btn" href="https://www.campingelhelguero.com" target="_blank" rel="noopener">Web</a>
        <a class="btn" href="tel:+34942722124">Llamar</a>
        <a class="btn" href="https://maps.google.com/?q=Camping+El+Helguero" target="_blank" rel="noopener">Cómo llegar</a>
        <a class="btn" href="https://wa.me/34652806564" target="_blank" rel="noopener">WhatsApp</a>
      </div>
      <div class="map"><iframe title="Mapa El Helguero" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps?q=Camping+El+Helguero&output=embed"></iframe></div>
    </article>
  </div>

  <section-title>Otros alojamientos del grupo</section-title>
  <div class="grid">
    <article class="card">
      <h3>Apartamentos / Taberna El Cardeo</h3>
      <p class="muted">Apartamentos + Taberna</p>
      <div class="row">
        <a class="btn" href="https://www.elcardeo.es" target="_blank" rel="noopener">Web</a>
        <a class="btn" href="tel:+34664686158">Llamar</a>
        <a class="btn" href="https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6" target="_blank" rel="noopener">Cómo llegar</a>
        <a class="btn" href="https://wa.me/34664686158" target="_blank" rel="noopener">WhatsApp</a>
      </div>
      <div class="map"><iframe title="Mapa El Cardeo" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps?q=Apartamentos+El+Cardeo&output=embed"></iframe></div>
    </article>
  </div>
</div>

<!-- PANEL ADMIN -->
<div id="adminPanel">
  <div id="adminBox">
    <button style="float:right" class="btn" onclick="document.getElementById('adminPanel').style.display='none'">✕</button>
    <h2>Panel de eventos</h2>

    <label>Título (ES)</label>
    <input id="titleES" placeholder="Ej: Concierto acústico">

    <label>Fecha y hora</label>
    <input id="fecha" type="datetime-local">

    <label>Alojamiento</label>
    <select id="campingSelect">
      <option value="oyambre">Oyambre</option>
      <option value="ramales">Ramales</option>
      <option value="ruiloba">Ruiloba</option>
      <option value="cardeo">El Cardeo</option>
    </select>

    <label>Lugar (ES)</label>
    <input id="lugarES" placeholder="Ej: Camping Ramales">

    <label>Descripción (ES)</label>
    <textarea id="descES" placeholder="Ej: Música en directo."></textarea>

    <button class="admin-btn" id="addEvent">Agregar a la lista</button>
    <button class="admin-btn" id="exportEvents">Descargar events.json</button>

    <h3 style="margin-top:18px">Eventos actuales</h3>
    <table>
      <thead><tr><th>ID</th><th>Fecha</th><th>Alojamiento</th><th>Título</th></tr></thead>
      <tbody id="eventTable"></tbody>
    </table>

    <hr>
    <h2>Config GitHub</h2>
    <label>Repositorio (owner/repo)</label>
    <input id="repo" placeholder="usuario/repositorio">
    <label>Branch</label>
    <input id="branch" value="main">
    <label>Token (solo se guarda en este dispositivo)</label>
    <input id="token" type="password" placeholder="github_pat_...">
    <button class="admin-btn" id="saveToGitHub">💾 Guardar en GitHub</button>
  </div>
</div>

<script>
// Activar panel admin tocando el logo 5 veces
let tap=0,timer=null;
document.getElementById("adminTrigger").onclick=()=>{tap++;clearTimeout(timer);timer=setTimeout(()=>tap=0,900);if(tap>=5){tap=0;document.getElementById("adminPanel").style.display="block";}};

// Cargar eventos (sin caché)
let ADMIN_EVENTS=[];
fetch("events.json?v="+Date.now(),{cache:'no-cache'}).then(r=>r.json()).then(data=>{ADMIN_EVENTS=Array.isArray(data)?data:[];renderEvents();});

// Render de eventos
function renderEvents(){
  const list=document.getElementById("eventsList");
  list.innerHTML="";
  ADMIN_EVENTS.sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));
  ADMIN_EVENTS.forEach(ev=>{
    const titulo = typeof ev.titulo==='string'?ev.titulo:(ev.titulo?.es||"");
    const desc   = typeof ev.descripcion==='string'?ev.descripcion:(ev.descripcion?.es||"");
    const lugar  = typeof ev.lugar==='string'?ev.lugar:(ev.lugar?.es||"");
    list.innerHTML += `
      <div class="event-card">
        <div class="event-title">${titulo}</div>
        <div class="event-date">${new Date(ev.fecha).toLocaleString()}</div>
        <div class="event-desc">${desc}</div>
        <small>${lugar}</small>
      </div>`;
  });

  document.getElementById("eventTable").innerHTML = ADMIN_EVENTS.map(ev=>{
    const titulo = ev.titulo?.es || ev.titulo || "";
    return `<tr><td>${ev.id}</td><td>${new Date(ev.fecha).toLocaleString()}</td><td>${ev.camping||""}</td><td>${titulo}</td></tr>`;
  }).join("");
}

// Añadir evento a la lista
document.getElementById("addEvent").onclick=()=>{
  const title=document.getElementById("titleES").value.trim();
  const fecha=document.getElementById("fecha").value;
  const camping=document.getElementById("campingSelect").value;
  const lugar=document.getElementById("lugarES").value.trim();
  const desc=document.getElementById("descES").value.trim();
  if(!title||!fecha||!camping){alert("Rellena título, fecha y alojamiento.");return;}
  const id=`ev-${camping}-${Date.now()}`;
  ADMIN_EVENTS.push({
    id, fecha, camping,
    titulo:{es:title},
    descripcion:{es:desc},
    lugar:{es:lugar||campingLabel(camping)}
  });
  // limpiar campos
  document.getElementById("titleES").value="";
  document.getElementById("fecha").value="";
  document.getElementById("lugarES").value="";
  document.getElementById("descES").value="";
  renderEvents();
};

function campingLabel(k){return k==='oyambre'?'Camping Caravaning Playa de Oyambre':k==='ramales'?'Camping Ramales':k==='ruiloba'?'Camping El Helguero (Ruiloba)':'Apartamentos El Cardeo';}

// Descargar JSON
document.getElementById("exportEvents").onclick=()=>{
  const blob=new Blob([JSON.stringify(ADMIN_EVENTS,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url;a.download="events.json";a.click();URL.revokeObjectURL(url);
};

// Guardar en GitHub (PUT contents API)
document.getElementById("saveToGitHub").onclick=async()=>{
  const repo=document.getElementById("repo").value.trim();
  const branch=document.getElementById("branch").value.trim()||"main";
  const token=document.getElementById("token").value.trim();
  if(!repo||!token){alert("Rellena repo y token.");return;}
  // obtener sha actual (si existe)
  const meta=await fetch(`https://api.github.com/repos/${repo}/contents/events.json?ref=${encodeURIComponent(branch)}`,{headers:{Authorization:`Bearer ${token}`}}).then(r=>r.json());
  const sha = meta && meta.sha ? meta.sha : undefined;
  const content=btoa(unescape(encodeURIComponent(JSON.stringify(ADMIN_EVENTS,null,2))));
  const res=await fetch(meta.url||`https://api.github.com/repos/${repo}/contents/events.json`,{
    method:"PUT",
    headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"},
    body:JSON.stringify({message:"update events.json via app",content,branch,sha})
  });
  if(res.ok){alert("✅ Subido a GitHub correctamente");} else {const t=await res.text(); alert("❌ Error: "+res.status+"\n"+t);}
};

// Registrar SW
if("serviceWorker" in navigator){navigator.serviceWorker.register("./service-worker.js");}
</script>
</body>
</html>
