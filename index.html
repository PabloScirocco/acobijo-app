<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Grupo A Cobijo</title>
<meta name="description" content="App de experiencia del cliente: eventos, horarios y accesos del Grupo A Cobijo.">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0ea5e9">
<link rel="icon" href="assets/icons/icon-192.png">
<link rel="apple-touch-icon" href="assets/icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
:root{
  --bg:#ffffff; --ink:#0a1a2a; --muted:#6b7280; --line:#e6eef7;
  --brand:#0ea5e9; --brand-ink:#063e63; --card:#f7fbff; --tint:#eef7ff;
  --wx1:#e9f6ff; --wx2:#d9efff; --wx3:#cce7ff; --wx4:#bfe0ff;
}
body.dark{
  --bg:#0b1220; --ink:#e8eef7; --muted:#8fa2bd; --line:#1e2a40;
  --brand:#22b2ff; --brand-ink:#bfe7ff; --card:#111a2a; --tint:#0f1a2b;
  --wx1:#0f1f35; --wx2:#102640; --wx3:#0f2b4a; --wx4:#0c3156;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink);background:var(--bg);transition:background-color .15s,color .15s}
img{max-width:100%;height:auto}
.hero img{height:64px;width:auto;max-width:160px}

/* Topbar */
.topbar{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#e6f6ff,#ffffff);
  border-bottom:1px solid var(--line);display:flex;align-items:center;gap:.75rem;padding:.7rem .9rem}
body.dark .topbar{background:linear-gradient(180deg,#0e1a2c,#0b1220)}
.topbar .burger{border:none;background:#fff;border:1px solid var(--line);border-radius:10px;padding:.45rem .55rem;cursor:pointer}
body.dark .topbar .burger{background:#0f1a2b}
.topbar .brand{display:flex;align-items:center;gap:.6rem}
.topbar img{height:40px;width:auto;object-fit:contain}
.topbar h1{font-size:1rem;margin:0}
.lang-btn,.theme-btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:.35rem .6rem;cursor:pointer}
body.dark .lang-btn, body.dark .theme-btn{background:#0f1a2b}

/* Drawer */
.drawer{position:fixed;inset:0;z-index:30;display:none}
.drawer.open{display:block}
.drawer .back{position:absolute;inset:0;background:rgba(0,0,0,.35)}
.drawer .panel{position:absolute;inset:0 auto 0 0;width:min(86vw,320px);background:#fff;border-right:1px solid var(--line);
  padding:14px;display:flex;flex-direction:column;gap:8px}
body.dark .drawer .panel{background:#0f1a2b}
.drawer .item{display:flex;gap:.6rem;align-items:center;border:1px solid var(--line);border-radius:12px;padding:.6rem .7rem;background:var(--tint);cursor:pointer}
.drawer .muted{color:var(--muted);font-size:.85rem}
.drawer .item.admin-btn{display:none !important;}
.admin-on .drawer .item.admin-btn{display:flex !important;}

/* Main, views */
main{padding:12px 12px 90px;max-width:980px;margin:0 auto}
.view{display:none;animation:fade .15s ease-out}
.view.active{display:block}
@keyframes fade{ from {opacity:.6; transform: translateY(4px);} to {opacity:1; transform:none;} }

/* Home */
.hero{position:relative;border:1px solid var(--line);border-radius:18px;overflow:hidden;background:
  radial-gradient(120% 80% at 100% 0%,#b7e6ff 0%,#e6f6ff 50%,#ffffff 100%)}
body.dark .hero{background:radial-gradient(120% 80% at 100% 0%,#143356 0%,#0f2239 50%,#0b1220 100%)}
.hero-inner{display:flex;align-items:center;gap:14px;padding:16px}
.hero h2{margin:0;font-size:1.3rem}
.badge{display:none}
.tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:12px}
.tile{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:6px;
  align-items:flex-start;cursor:pointer;box-shadow:0 8px 24px rgba(14,165,233,.06)}
.tile .big{font-size:1.6rem}
.tile .muted{color:var(--muted);font-size:.86rem}
.tile:active{transform:scale(.98)}
.hscroll{display:flex;gap:10px;overflow:auto;padding-bottom:6px;scrollbar-gutter:stable both-edges}
.card{min-width:260px;flex:0 0 auto;background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px}
body.dark .card{background:#0f1a2b}
.card img{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;border:1px solid var(--line);background:#f2f6fb}
.card .title{font-weight:700;margin-top:6px}
.card .meta{font-size:.85rem;color:var(--muted)}
.row{display:flex;flex-wrap:wrap;gap:6px}

/* Buttons */
.btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:10px;padding:.46rem .66rem;cursor:pointer;font-weight:600;color:var(--ink)}
body.dark .btn{background:#0f1a2b}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
.btn.sm{padding:.32rem .5rem;font-size:.82rem}
.btn.ghost{background:transparent;border-color:var(--line);color:var(--muted)}
body.dark .btn.ghost{background:transparent}

/* Grids */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}

/* Chips */
.chip{border-radius:999px}

/* Accordeon horarios */
.acc{display:flex;flex-direction:column;gap:8px}
.acc-item{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#fff}
body.dark .acc-item{background:#0f1a2b}
.acc-h{display:flex;justify-content:space-between;align-items:center;padding:.7rem .8rem;cursor:pointer;background:var(--tint)}
.acc-b{display:none;padding:.8rem}
.acc-item.open .acc-b{display:block}

/* Bottom nav */
.navbar{position:fixed;left:0;right:0;bottom:0;z-index:25;background:#fff;border-top:1px solid var(--line);display:grid;grid-template-columns:repeat(5,1fr)}
body.dark .navbar{background:#0f1a2b}
.navbtn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 4px;border:none;background:transparent;cursor:pointer;font-size:.8rem;color:var(--muted)}
.navbtn.active{color:var(--brand-ink);font-weight:700}
.navbtn .ico{font-size:1.1rem}

/* Modal base */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:1000}
.modal{width:min(92vw,920px);max-height:88vh;overflow:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;
  background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.2)}
body.dark .modal{background:#0f1a2b}
.close{background:transparent;border:none;color:var(--muted);font-weight:700;cursor:pointer;font-size:1.6rem;line-height:1;padding:.25rem .5rem;border-radius:10px;float:right}

/* Inputs */
.input,.select,.textarea{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff}
.textarea{min-height:96px}

/* Weather (Mi estancia) */
.wx{border:1px solid var(--line);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,var(--wx2),var(--wx1));padding:12px}
.wx-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.wx-today{display:grid;grid-template-columns:80px 1fr;gap:10px;align-items:center;background:linear-gradient(180deg,var(--wx4),var(--wx2));border:1px solid var(--line);border-radius:14px;padding:10px}
.wx-ico{font-size:2.2rem}
.wx-deg{font-size:2rem;font-weight:800}
.wx-minmax{font-size:.9rem;color:var(--muted)}
.wx-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.wx-day{border:1px solid var(--line);border-radius:12px;padding:8px;text-align:center;background:linear-gradient(180deg,var(--wx2),var(--wx1))}
.wx-day .d{font-weight:700}
.wx-day .t{font-size:.9rem}

/* MUSTS (Imprescindibles) */
.musts-head{display:flex;align-items:center;gap:8px;margin:8px 0}
.musts-head .muted{color:var(--muted)}
#mustsGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
.must-card{border:1px solid var(--line);border-radius:14px;background:#fff;overflow:hidden}
body.dark .must-card{background:#0f1a2b}
.must-cover{width:100%;aspect-ratio:16/9;object-fit:cover;background:#eef3f8;border-bottom:1px solid var(--line)}
.must-head{padding:10px 12px}
.must-title{font-weight:800}
.must-summary{color:var(--muted);font-size:.92rem;margin-top:4px}
.must-actions{display:flex;gap:8px;flex-wrap:wrap;padding:0 12px 12px}
.must-body{display:none;padding:0 12px 12px}
.must-card.open .must-body{display:block}
.must-gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:10px}
.must-gallery img{width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:8px;border:1px solid var(--line)}
.ext-img{background:#f1f5f9}
</style>
</head>
<body>

<!-- Topbar -->
<header class="topbar">
  <button id="menuBtn" class="burger" aria-label="Abrir menÃº">â˜°</button>
  <div class="brand">
    <img src="assets/logo.png" alt="Grupo A Cobijo" id="logoTap">
    <h1 id="t-app">Grupo A Cobijo</h1>
  </div>
  <div style="flex:1"></div>
  <button class="theme-btn" id="themeBtn" title="Tema" aria-label="Cambiar tema">ğŸŒ™</button>
  <button class="lang-btn" id="langBtn" aria-haspopup="dialog">ğŸŒ ES</button>
</header>

<!-- Drawer -->
<div class="drawer" id="drawer">
  <div class="back" id="drawerBack"></div>
  <aside class="panel" role="menu" aria-label="NavegaciÃ³n">
    <div class="item" data-nav="home">ğŸ  <strong id="d-home">Inicio</strong></div>
    <div class="item" data-nav="stay">ğŸ§³ <strong id="d-stay">Mi estancia</strong></div>
    <div class="item" data-nav="incidents">ğŸ†˜ <strong id="d-inc">Incidencias</strong></div>
    <div class="item" data-nav="events">ğŸ“… <strong id="d-ev">Eventos</strong></div>
    <div class="item" data-nav="musts">â­ <strong id="d-mu">Imprescindibles</strong></div>
    <div class="item" data-nav="places">ğŸ•ï¸ <strong id="d-pl">Campings</strong></div>
    <div class="item" data-nav="schedules">ğŸ•’ <strong id="d-sc">Horarios</strong></div>
    <div class="item admin-btn" id="openAdmin">ğŸ› ï¸ <strong>Admin</strong></div>
    <div class="muted" id="drawerHint">Elige secciÃ³n</div>
  </aside>
</div>

<main>
  <!-- HOME -->
  <section id="view-home" class="view active">
    <div class="hero">
      <div class="hero-inner">
        <img src="assets/logo.png" alt="A Cobijo">
        <div>
          <h2 id="t-hello">Â¡Bienvenido!</h2>
          <div class="badge" id="t-badge">PWA Â· Offline Â· Multidioma</div>
        </div>
      </div>
      <div class="tiles">
        <div class="tile" data-nav="events"><div class="big">ğŸ“…</div><div><strong id="t-ev">Eventos</strong><div class="muted" id="t-ev-sub">QuÃ© hay hoy</div></div></div>
        <div class="tile" data-nav="stay"><div class="big">ğŸ§³</div><div><strong id="t-stay">Mi estancia</strong><div class="muted" id="t-stay-sub">Contactos, clima, horarios</div></div></div>
        <div class="tile" data-nav="incidents"><div class="big">ğŸ†˜</div><div><strong id="t-inc">Incidencias</strong><div class="muted" id="t-inc-sub">WhatsApp/Email directos</div></div></div>
        <div class="tile" data-nav="musts"><div class="big">â­</div><div><strong id="t-mu">Imprescindibles</strong><div class="muted" id="t-mu-sub">QuÃ© ver en Cantabria</div></div></div>
        <div class="tile" data-nav="places"><div class="big">ğŸ•ï¸</div><div><strong id="t-pl">Campings</strong><div class="muted" id="t-pl-sub">Accesos rÃ¡pidos</div></div></div>
        <div class="tile" id="installTile"><div class="big">â¬‡ï¸</div><div><strong id="t-inst">Instalar</strong><div class="muted" id="t-inst-sub">AÃ±adir a inicio</div></div></div>
      </div>
    </div>

    <h3 style="margin:14px 4px 8px" id="t-next-events">PrÃ³ximos eventos</h3>
    <div id="homeEvents" class="hscroll"></div>
  </section>

  <!-- MI ESTANCIA -->
  <section id="view-stay" class="view">
    <h2 id="t-stay-title">Mi estancia</h2>
    <p class="muted" id="t-stay-hint">Guardamos tu elecciÃ³n en este dispositivo.</p>

    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(240px,1fr))">
      <div>
        <label for="stayPlace" style="font-weight:700" id="t-stay-which">Selecciona tu alojamiento</label>
        <select id="stayPlace" class="select">
          <option value="oyambre">Oyambre</option>
          <option value="ramales">Ramales</option>
          <option value="ruiloba">Ruiloba</option>
          <option value="cardeo">El Cardeo</option>
        </select>
      </div>
      <div class="row" style="align-items:flex-end">
        <button id="stayWeb" class="btn">Web</button>
        <a id="stayCall" class="btn" target="_blank" rel="noopener">Llamar</a>
        <a id="stayWA" class="btn" target="_blank" rel="noopener">WhatsApp</a>
        <a id="stayEmail" class="btn" target="_blank" rel="noopener">Email</a>
        <a id="stayDir" class="btn" target="_blank" rel="noopener">CÃ³mo llegar</a>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3 id="t-stay-hours">Horarios del alojamiento</h3>
      <div id="stayHours"></div>
    </div>

    <div class="wx" style="margin-top:12px" id="stayWeather">
      <div class="wx-h">
        <h3 id="t-weather-title" style="margin:0">Clima</h3>
        <div class="muted" id="wxPlaceLabel">â€”</div>
      </div>
      <div class="wx-today">
        <div class="wx-ico" id="wxIco">â˜€ï¸</div>
        <div>
          <div class="wx-deg"><span id="wxNow">--</span>Â°</div>
          <div class="wx-minmax"><span id="t-max">MÃ¡x</span>: <span id="wxMax">--</span>Â° Â· <span id="t-min">MÃ­n</span>: <span id="wxMin">--</span>Â°</div>
          <div class="muted" id="wxDesc">â€”</div>
        </div>
      </div>
      <div class="wx-3">
        <div class="wx-day"><div class="d" id="d1">â€”</div><div class="i" id="i1">â˜€ï¸</div><div class="t" id="t1">--/--Â°</div></div>
        <div class="wx-day"><div class="d" id="d2">â€”</div><div class="i" id="i2">â˜€ï¸</div><div class="t" id="t2">--/--Â°</div></div>
        <div class="wx-day"><div class="d" id="d3">â€”</div><div class="i" id="i3">â˜€ï¸</div><div class="t" id="t3">--/--Â°</div></div>
      </div>
    </div>
  </section>

  <!-- INCIDENCIAS -->
  <section id="view-incidents" class="view">
    <h2 id="i-title">Incidencias</h2>
    <p class="muted" id="i-hint">Se abre WhatsApp o tu app de correo con el mensaje preparado.</p>

    <div class="card" style="background:var(--tint)">
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
        <div>
          <label style="font-weight:700" for="incPlace" id="i-where">Â¿En quÃ© alojamiento estÃ¡s?</label>
          <select id="incPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700" for="incType" id="i-type">Tipo de incidencia</label>
          <select id="incType" class="select">
            <option value="Electricidad" data-i18n="incTypeElec">Electricidad</option>
            <option value="Agua" data-i18n="incTypeWater">Agua</option>
            <option value="Limpieza" data-i18n="incTypeClean">Limpieza</option>
            <option value="Ruido" data-i18n="incTypeNoise">Ruido</option>
            <option value="Otros" data-i18n="incTypeOther">Otros</option>
          </select>
        </div>
      </div>
      <div style="margin-top:10px">
        <label style="font-weight:700" for="incMsg" id="i-msg">Describe brevemente el problema</label>
        <textarea id="incMsg" class="textarea" placeholder="Ej.: Sin luz en la parcela 24, desde las 21:15..."></textarea>
      </div>
      <div class="row" style="margin-top:10px">
        <a id="incWA" class="btn primary" target="_blank" rel="noopener">WhatsApp</a>
        <a id="incEmail" class="btn" target="_blank" rel="noopener">Email</a>
      </div>
    </div>
  </section>

  <!-- EVENTOS -->
  <section id="view-events" class="view">
    <h2 id="t-events-title">Eventos</h2>
    <div class="row" style="gap:8px;margin:10px 0">
      <button class="btn chip on" data-filter="all" id="f-all">Todos</button>
      <button class="btn chip" data-filter="today" id="f-today">Hoy</button>
      <button class="btn chip" data-filter="tomorrow" id="f-tomorrow">MaÃ±ana</button>
      <button class="btn chip" data-filter="week" id="f-week">Esta semana</button>
      <button class="btn chip" data-filter="fav" id="f-fav">Favoritos</button>
    </div>
    <div class="row" style="gap:8px;margin:6px 0">
      <button class="btn chip on" data-camp="all" id="c-all">Todos los campings</button>
      <button class="btn chip" data-camp="oyambre" id="c-oy">Oyambre</button>
      <button class="btn chip" data-camp="ramales" id="c-ra">Ramales</button>
      <button class="btn chip" data-camp="ruiloba" id="c-he">Ruiloba</button>
      <button class="btn chip" data-camp="cardeo" id="c-ca">El Cardeo</button>
    </div>
    <div id="eventsGrid" class="grid"></div>
    <p class="muted" id="eventsEmpty" style="display:none">Sin eventos por ahora.</p>
  </section>

  <!-- IMPRESCINDIBLES -->
  <section id="view-musts" class="view">
    <div class="musts-head">
      <h2 id="t-musts-title" style="margin:0">Imprescindibles de Cantabria</h2>
      <div class="muted" id="t-musts-hint">Ideas para explorar</div>
    </div>
    <div id="mustsGrid"></div>
  </section>

  <!-- CAMPINGS -->
  <section id="view-places" class="view">
    <h2 id="t-campings-title">Nuestros campings</h2>
    <div class="grid">
      <article class="card" style="min-width:unset">
        <h3 id="t-oy-title">Camping Caravaning Playa de Oyambre</h3>
        <p class="muted" id="t-oy-hint">Todos los servicios Â· Frente al mar</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.oyambre.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942711461">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34675696212" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ra-title">Camping Ramales</h3>
        <p class="muted" id="t-ra-hint">Cuevas Â· MontaÃ±a Â· Actividades</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingramales.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34654463133">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Ramales" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34654463133" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-he-title">Camping El Helguero (Ruiloba)</h3>
        <p class="muted" id="t-he-hint">Naturaleza Â· Familiar Â· Mascotas</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingelhelguero.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942722124">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+El+Helguero" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34652806564" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ca-title">Apartamentos / Taberna El Cardeo</h3>
        <p class="muted" id="t-ca-hint">Apartamentos + Taberna</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.elcardeo.es" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34664686158">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34664686158" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>
    </div>
  </section>

  <!-- HORARIOS -->
  <section id="view-schedules" class="view">
    <h2 id="t-schedules-title">Horarios</h2>
    <div class="acc" id="acc">
      <div class="acc-item"><div class="acc-h" data-acc="oyambre">Oyambre <span>â–¼</span></div><div class="acc-b" id="acc-oyambre"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ramales">Ramales <span>â–¼</span></div><div class="acc-b" id="acc-ramales"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ruiloba">Ruiloba <span>â–¼</span></div><div class="acc-b" id="acc-ruiloba"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="cardeo">El Cardeo <span>â–¼</span></div><div class="acc-b" id="acc-cardeo"></div></div>
    </div>
    <p class="muted" id="schedNote">Info orientativa. Pregunta en recepciÃ³n para cambios de temporada.</p>
  </section>
</main>

<!-- Bottom nav -->
<nav class="navbar" role="navigation" aria-label="PestaÃ±as">
  <button class="navbtn active" data-nav="home"><div class="ico">ğŸ </div><div id="n-home">Inicio</div></button>
  <button class="navbtn" data-nav="stay"><div class="ico">ğŸ§³</div><div id="n-stay">Mi estancia</div></button>
  <button class="navbtn" data-nav="incidents"><div class="ico">ğŸ†˜</div><div id="n-inc">Incidencias</div></button>
  <button class="navbtn" data-nav="events"><div class="ico">ğŸ“…</div><div id="n-ev">Eventos</div></button>
  <button class="navbtn" data-nav="musts"><div class="ico">â­</div><div id="n-mu">Impresc.</div></button>
</nav>

<!-- Admin modal -->
<div class="backdrop" id="adminModal" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
  <div class="modal">
    <button class="close" id="closeAdmin" aria-label="Cerrar">âœ•</button>
    <h3 id="adminTitle">GestiÃ³n de eventos</h3>

    <div class="card" style="margin-top:8px">
      <h4 style="margin:0 0 8px">AÃ±adir evento</h4>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
        <div><label>TÃ­tulo (ES)</label><input id="evTitle" class="input" placeholder="Ej: Concierto acÃºstico"></div>
        <div><label>Fecha y hora</label><input id="evDate" type="datetime-local" class="input"></div>
        <div><label>Alojamiento</label>
          <select id="evPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div><label>Lugar (ES)</label><input id="evLugar" class="input" placeholder="Ej: Camping Ramales"></div>
        <div><label>Imagen (URL)</label><input id="evImg" class="input" placeholder="https://..."></div>
        <div style="grid-column:1/-1"><label>DescripciÃ³n (ES)</label><textarea id="evDesc" class="textarea" rows="3" placeholder="Ej: MÃºsica en directo."></textarea></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="addEventBtn" class="btn">Agregar</button>
        <button id="exportEventsBtn" class="btn">Descargar events.json</button>
        <label class="btn" for="importFile" style="cursor:pointer">Importar JSON</label>
        <input id="importFile" type="file" accept="application/json" style="display:none">
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4 style="margin:0 0 8px">Eventos actuales</h4>
      <div style="overflow:auto">
        <table class="table" id="eventsTable" style="width:100%;border-collapse:collapse">
          <thead><tr><th>ID</th><th>Fecha</th><th>Alojamiento</th><th>TÃ­tulo</th><th>Acciones</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4>GestiÃ³n de horarios (schedules.json)</h4>
      <textarea id="schedJsonArea" class="textarea" rows="8" placeholder='Pegue aquÃ­ su schedules.json'></textarea>
      <div class="row" style="margin-top:10px">
        <button id="schedApplyBtn" class="btn">Aplicar</button>
        <button id="exportSchedBtn" class="btn">Descargar schedules.json</button>
        <label class="btn" for="importSchedFile" style="cursor:pointer">Importar JSON</label>
        <input id="importSchedFile" type="file" accept="application/json" style="display:none">
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4>Config GitHub</h4>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
        <div><label>Repositorio</label><input id="ghRepo" class="input" placeholder="owner/repo"></div>
        <div><label>Branch</label><input id="ghBranch" class="input" placeholder="main" value="main"></div>
        <div style="grid-column:1/-1"><label>Token (se guarda en este dispositivo)</label><input id="ghToken" class="input" placeholder="github_pat_..." autocomplete="off"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="saveGhCfg" class="btn">Guardar configuraciÃ³n</button>
        <button id="pushEventsBtn" class="btn">ğŸ’¾ Subir events.json</button>
        <button id="pushSchedBtn" class="btn">ğŸ’¾ Subir schedules.json</button>
      </div>
    </div>
  </div>
</div>

<!-- Idiomas -->
<div class="backdrop" id="langModal">
  <div class="modal">
    <button id="closeLang" class="close" aria-label="Cerrar">âœ•</button>
    <h3 id="langTitle">Selecciona idioma</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px">
      <button class="btn lang-option" data-lang="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
      <button class="btn lang-option" data-lang="en">ğŸ‡¬ğŸ‡§ English</button>
      <button class="btn lang-option" data-lang="fr">ğŸ‡«ğŸ‡· FranÃ§ais</button>
      <button class="btn lang-option" data-lang="de">ğŸ‡©ğŸ‡ª Deutsch</button>
      <button class="btn lang-option" data-lang="nl">ğŸ‡³ğŸ‡± Nederlands</button>
    </div>
  </div>
</div>

<!-- Modal Instalar -->
<div class="backdrop" id="installModal">
  <div class="modal">
    <button id="closeInstall" class="close" aria-label="Cerrar">âœ•</button>
    <h3 id="instTitle">CÃ³mo aÃ±adir la app a tu inicio</h3>
    <p id="instIntro" class="muted">Sigue estos pasos segÃºn tu dispositivo:</p>
    <h4>iPhone / iPad (Safari)</h4>
    <ul style="margin:.2rem 0 .8rem; padding-left:1.2rem">
      <li>1) Pulsa <strong>Compartir</strong> (icono cuadrado con flecha).</li>
      <li>2) Elige <strong>AÃ±adir a pantalla de inicio</strong>.</li>
      <li>3) Confirma con <strong>AÃ±adir</strong>.</li>
    </ul>
    <h4>Android (Chrome)</h4>
    <ul style="margin:.2rem 0 .8rem; padding-left:1.2rem">
      <li>1) MenÃº â‹® (arriba derecha).</li>
      <li>2) Toca <strong>AÃ±adir a pantalla principal</strong>.</li>
      <li>3) Acepta los pasos del sistema.</li>
    </ul>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){

  /* ===== Helpers ===== */
  const $ = (sel,root=document)=>root.querySelector(sel);
  const qsa = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
  const on = (el,ev,fn)=>el&&el.addEventListener(ev,fn);
  const esc = s=>String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  const pad2 = n=>('0'+n).slice(-2);
  const safeUrl = u=>{const s=String(u||'').trim(); return /^https?:\/\//i.test(s)?s.replace(/"/g,'%22'):''};

  /* ===== Admin state + PIN ===== */
  localStorage.setItem('admin','0');
  document.body.classList.remove('admin-on');
  if(!localStorage.getItem('admin_pin')){ localStorage.setItem('admin_pin','311974'); }

  /* ===== Tema ===== */
  const applyTheme=(m)=>{ document.body.classList.toggle('dark', m==='dark');
    $('#themeBtn').textContent=m==='dark'?'â˜€ï¸':'ğŸŒ™';
    const meta=document.querySelector('meta[name="theme-color"]'); if(meta) meta.setAttribute('content', m==='dark' ? '#0b1220' : '#0ea5e9');
    localStorage.setItem('theme',m);
  };
  let THEME = localStorage.getItem('theme') || ((window.matchMedia && matchMedia('(prefers-color-scheme: dark)').matches)?'dark':'light');
  applyTheme(THEME);
  on($('#themeBtn'),'click', ()=>{ THEME = THEME==='dark'?'light':'dark'; applyTheme(THEME); });

  /* ===== I18N ===== */
  const I18N = {
    es:{app:"Grupo A Cobijo",hello:"Â¡Bienvenido!",badge:"PWA Â· Offline Â· Multidioma",
      ev:"Eventos", evSub:"QuÃ© hay hoy",
      pl:"Campings", plSub:"Accesos rÃ¡pidos",
      sc:"Horarios", scSub:"RecepciÃ³n Â· bar",
      inst:"Instalar", instSub:"AÃ±adir a inicio",
      eventsTitle:"Eventos", schedulesTitle:"Horarios", campingsTitle:"Nuestros campings",
      fAll:"Todos", fToday:"Hoy", fTomorrow:"MaÃ±ana", fWeek:"Esta semana", fFav:"Favoritos",
      cAll:"Todos los campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
      web:"Web", call:"Llamar", directions:"CÃ³mo llegar", whatsapp:"WhatsApp", email:"Email",
      addCal:"AÃ±adir al calendario", fav:"Favorito",
      oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Todos los servicios Â· Frente al mar",
      raTitle:"Camping Ramales", raHint:"Cuevas Â· MontaÃ±a Â· Actividades",
      heTitle:"Camping El Helguero (Ruiloba)", heHint:"Naturaleza Â· Familiar Â· Mascotas",
      caTitle:"Apartamentos / Taberna El Cardeo", caHint:"Apartamentos + Taberna",
      schedNote:"Los horarios pueden variar segÃºn la fecha. Confirma en recepciÃ³n.",
      nHome:"Inicio", nEv:"Eventos", nPl:"Campings", nSc:"Horarios", nMu:"Impresc.",
      dHome:"Inicio", dStay:"Mi estancia", dInc:"Incidencias", dEv:"Eventos", dMu:"Imprescindibles", dPl:"Campings", dSc:"Horarios", drawerHint:"Elige secciÃ³n",
      nextEvents:"PrÃ³ximos eventos",
      stay:"Mi estancia", staySub:"Contactos, clima, horarios",
      stayTitle:"Mi estancia", stayHint:"Guardamos tu elecciÃ³n en este dispositivo.", stayWhich:"Selecciona tu alojamiento",
      stayHours:"Horarios del alojamiento",
      weatherTitle:"Clima", max:"MÃ¡x", min:"MÃ­n",
      incTitle:"Incidencias", incWhere:"Â¿En quÃ© alojamiento estÃ¡s?", incContact:"Â¿CÃ³mo quieres contactar?",
      incHint:"Se abre WhatsApp o tu app de correo con el mensaje preparado.",
      incType:"Tipo de incidencia", incMsg:"Describe brevemente el problema",
      incBtnWA:"WhatsApp", incBtnEmail:"Email",
      incTypeElec:"Electricidad", incTypeWater:"Agua", incTypeClean:"Limpieza", incTypeNoise:"Ruido", incTypeOther:"Otros",
      mu:"Imprescindibles", muSub:"QuÃ© ver en Cantabria",
      mustsTitle:"Imprescindibles de Cantabria", mustsHint:"Ideas para explorar",
      seeMore:"Ver mÃ¡s", seeLess:"Ver menos", openMap:"Mapa", openSite:"Web oficial", openTickets:"Entradas"
    },
    en:{app:"Grupo A Cobijo",hello:"Welcome!",badge:"PWA Â· Offline Â· Multilingual",
      ev:"Events", evSub:"What's on today",
      pl:"Campsites", plSub:"Quick access",
      sc:"Schedules", scSub:"Reception Â· bar",
      inst:"Install", instSub:"Add to Home",
      eventsTitle:"Events", schedulesTitle:"Schedules", campingsTitle:"Our campsites",
      fAll:"All", fToday:"Today", fTomorrow:"Tomorrow", fWeek:"This week", fFav:"Favorites",
      cAll:"All campsites", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
      web:"Website", call:"Call", directions:"Directions", whatsapp:"WhatsApp", email:"Email",
      addCal:"Add to calendar", fav:"Favorite",
      oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"All services Â· By the sea",
      raTitle:"Camping Ramales", raHint:"Caves Â· Mountains Â· Activities",
      heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature Â· Family Â· Pets",
      caTitle:"El Cardeo Apartments / Tavern", caHint:"Apartments + Tavern",
      schedNote:"Hours may vary by date. Confirm at reception.",
      nHome:"Home", nEv:"Events", nPl:"Camps", nSc:"Schedules", nMu:"Highlights",
      dHome:"Home", dStay:"My stay", dInc:"Issues", dEv:"Events", dMu:"Highlights", dPl:"Camps", dSc:"Schedules", drawerHint:"Choose a section",
      nextEvents:"Upcoming events",
      stay:"My stay", staySub:"Contacts, weather, schedules",
      stayTitle:"My stay", stayHint:"We store your choice on this device.", stayWhich:"Choose your accommodation",
      stayHours:"Accommodation opening hours",
      weatherTitle:"Weather", max:"Max", min:"Min",
      incTitle:"Issues", incWhere:"Which accommodation are you in?", incContact:"How would you like to contact?",
      incHint:"We open WhatsApp or your email app with a prefilled message.",
      incType:"Type of issue", incMsg:"Briefly describe the problem",
      incBtnWA:"WhatsApp", incBtnEmail:"Email",
      incTypeElec:"Electricity", incTypeWater:"Water", incTypeClean:"Cleaning", incTypeNoise:"Noise", incTypeOther:"Other",
      mu:"Must-see", muSub:"What to see in Cantabria",
      mustsTitle:"Cantabria must-see", mustsHint:"Ideas to explore",
      seeMore:"See more", seeLess:"See less", openMap:"Map", openSite:"Official site", openTickets:"Tickets"
    },
    fr:{app:"Grupo A Cobijo",hello:"Bienvenue !",badge:"PWA Â· Hors ligne Â· Multilingue",
      ev:"Ã‰vÃ©nements", evSub:"Aujourdâ€™hui",
      pl:"Campings", plSub:"AccÃ¨s rapide",
      sc:"Horaires", scSub:"RÃ©ception Â· bar",
      inst:"Installer", instSub:"Ajouter Ã  lâ€™Ã©cran dâ€™accueil",
      eventsTitle:"Ã‰vÃ©nements", schedulesTitle:"Horaires", campingsTitle:"Nos campings",
      fAll:"Tous", fToday:"Aujourdâ€™hui", fTomorrow:"Demain", fWeek:"Cette semaine", fFav:"Favoris",
      cAll:"Tous les campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
      web:"Site web", call:"Appeler", directions:"ItinÃ©raire", whatsapp:"WhatsApp", email:"Email",
      addCal:"Ajouter au calendrier", fav:"Favori",
      oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Tous les services Â· Face Ã  la mer",
      raTitle:"Camping Ramales", raHint:"Grottes Â· Montagne Â· ActivitÃ©s",
      heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature Â· Familial Â· Animaux",
      caTitle:"Appartements / Taverne El Cardeo", caHint:"Appartements + Taverne",
      schedNote:"Les horaires peuvent varier selon la pÃ©riode. VÃ©rifiez Ã  la rÃ©ception.",
      nHome:"Accueil", nEv:"Ã‰vÃ©n.", nPl:"Campings", nSc:"Horaires", nMu:"Ã€ voir",
      dHome:"Accueil", dStay:"Mon sÃ©jour", dInc:"Incidents", dEv:"Ã‰vÃ©nements", dMu:"Incontournables", dPl:"Campings", dSc:"Horaires", drawerHint:"Choisissez une section",
      nextEvents:"Ã‰vÃ©nements Ã  venir",
      stay:"Mon sÃ©jour", staySub:"Contacts, mÃ©tÃ©o, horaires",
      stayTitle:"Mon sÃ©jour", stayHint:"Nous enregistrons votre choix sur cet appareil.", stayWhich:"Choisissez votre hÃ©bergement",
      stayHours:"Horaires de lâ€™hÃ©bergement",
      weatherTitle:"MÃ©tÃ©o", max:"Max", min:"Min",
      incTitle:"Incidents", incWhere:"Dans quel Ã©tablissement Ãªtes-vous ?", incContact:"Comment souhaitez-vous contacter ?",
      incHint:"On ouvre WhatsApp ou votre app email avec un message prÃ©rempli.",
      incType:"Type de problÃ¨me", incMsg:"DÃ©crivez briÃ¨vement le problÃ¨me",
      incBtnWA:"WhatsApp", incBtnEmail:"Email",
      incTypeElec:"Ã‰lectricitÃ©", incTypeWater:"Eau", incTypeClean:"MÃ©nage", incTypeNoise:"Bruit", incTypeOther:"Autres",
      mu:"Incontournables", muSub:"Que voir en Cantabrie",
      mustsTitle:"Incontournables de Cantabrie", mustsHint:"IdÃ©es pour explorer",
      seeMore:"Voir plus", seeLess:"Voir moins", openMap:"Carte", openSite:"Site officiel", openTickets:"Billets"
    },
    de:{app:"Grupo A Cobijo",hello:"Willkommen!",badge:"PWA Â· Offline Â· Mehrsprachig",
      ev:"Events", evSub:"Heute",
      pl:"CampingplÃ¤tze", plSub:"Schnellzugriff",
      sc:"Zeiten", scSub:"Rezeption Â· Bar",
      inst:"Installieren", instSub:"Zum Startbildschirm",
      eventsTitle:"Veranstaltungen", schedulesTitle:"Ã–ffnungszeiten", campingsTitle:"Unsere CampingplÃ¤tze",
      fAll:"Alle", fToday:"Heute", fTomorrow:"Morgen", fWeek:"Diese Woche", fFav:"Favoriten",
      cAll:"Alle CampingplÃ¤tze", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
      web:"Website", call:"Anrufen", directions:"Route", whatsapp:"WhatsApp", email:"E-Mail",
      addCal:"Zum Kalender hinzufÃ¼gen", fav:"Favorit",
      oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle Services Â· Am Meer",
      raTitle:"Camping Ramales", raHint:"HÃ¶hlen Â· Berge Â· AktivitÃ¤ten",
      heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natur Â· Familie Â· Haustiere",
      caTitle:"Apartments / Taverne El Cardeo", caHint:"Apartments + Taverne",
      schedNote:"Zeiten kÃ¶nnen je nach Datum variieren. Bitte an der Rezeption bestÃ¤tigen.",
      nHome:"Start", nEv:"Events", nPl:"Camping", nSc:"Zeiten", nMu:"Highlights",
      dHome:"Start", dStay:"Mein Aufenthalt", dInc:"StÃ¶rungen", dEv:"Events", dMu:"Highlights", dPl:"Camping", dSc:"Zeiten", drawerHint:"Bereich wÃ¤hlen",
      nextEvents:"Kommende Events",
      stay:"Mein Aufenthalt", staySub:"Kontakte, Wetter, Zeiten",
      stayTitle:"Mein Aufenthalt", stayHint:"Wir speichern die Auswahl lokal.", stayWhich:"Unterkunft wÃ¤hlen",
      stayHours:"Ã–ffnungszeiten der Unterkunft",
      weatherTitle:"Wetter", max:"Max", min:"Min",
      incTitle:"StÃ¶rungen", incWhere:"Welche Unterkunft?", incContact:"Wie mÃ¶chtest du Kontakt aufnehmen?",
      incHint:"Wir Ã¶ffnen WhatsApp oder deine E-Mail-App mit vorbefÃ¼llter Nachricht.",
      incType:"Art der StÃ¶rung", incMsg:"Problem kurz beschreiben",
      incBtnWA:"WhatsApp", incBtnEmail:"E-Mail",
      incTypeElec:"Strom", incTypeWater:"Wasser", incTypeClean:"Reinigung", incTypeNoise:"LÃ¤rm", incTypeOther:"Sonstige",
      mu:"Highlights", muSub:"Sehenswertes in Kantabrien",
      mustsTitle:"Highlights in Kantabrien", mustsHint:"Ideen zum Entdecken",
      seeMore:"Mehr anzeigen", seeLess:"Weniger anzeigen", openMap:"Karte", openSite:"Offizielle Seite", openTickets:"Tickets"
    },
    nl:{app:"Grupo A Cobijo",hello:"Welkom!",badge:"PWA Â· Offline Â· Meertalig",
      ev:"Evenementen", evSub:"Vandaag",
      pl:"Campings", plSub:"Snelle toegang",
      sc:"Openingstijden", scSub:"Receptie Â· bar",
      inst:"Installeren", instSub:"Toevoegen aan beginscherm",
      eventsTitle:"Evenementen", schedulesTitle:"Openingstijden", campingsTitle:"Onze campings",
      fAll:"Alles", fToday:"Vandaag", fTomorrow:"Morgen", fWeek:"Deze week", fFav:"Favorieten",
      cAll:"Alle campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
      web:"Website", call:"Bellen", directions:"Route", whatsapp:"WhatsApp", email:"E-mail",
      addCal:"Aan agenda toevoegen", fav:"Favoriet",
      oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle services Â· Aan zee",
      raTitle:"Camping Ramales", raHint:"Grotten Â· Bergen Â· Activiteiten",
      heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natuur Â· Familie Â· Huisdieren",
      caTitle:"Appartementen / Taverne El Cardeo", caHint:"Appartementen + Taverne",
      schedNote:"Tijden kunnen per datum verschillen. Informeer bij de receptie.",
      nHome:"Start", nEv:"Even.", nPl:"Campings", nSc:"Tijden", nMu:"Highlights",
      dHome:"Start", dStay:"Mijn verblijf", dInc:"Incidenten", dEv:"Evenementen", dMu:"Highlights", dPl:"Campings", dSc:"Tijden", drawerHint:"Kies een sectie",
      nextEvents:"Aankomende evenementen",
      stay:"Mijn verblijf", staySub:"Contacten, weer, tijden",
      stayTitle:"Mijn verblijf", stayHint:"We slaan je keuze lokaal op.", stayWhich:"Kies je accommodatie",
      stayHours:"Openingstijden van de accommodatie",
      weatherTitle:"Weer", max:"Max", min:"Min",
      incTitle:"Incidenten", incWhere:"In welke accommodatie ben je?", incContact:"Hoe wil je contact opnemen?",
      incHint:"We openen WhatsApp of je e-mailapp met een ingevuld bericht.",
      incType:"Type incident", incMsg:"Beschrijf kort het probleem",
      incBtnWA:"WhatsApp", incBtnEmail:"E-mail",
      incTypeElec:"Elektriciteit", incTypeWater:"Water", incTypeClean:"Schoonmaak", incTypeNoise:"Lawaai", incTypeOther:"Overig",
      mu:"Highlights", muSub:"Wat te zien in CantabriÃ«",
      mustsTitle:"Highlights van CantabriÃ«", mustsHint:"IdeeÃ«n om te ontdekken",
      seeMore:"Meer weergeven", seeLess:"Minder weergeven", openMap:"Kaart", openSite:"OfficiÃ«le site", openTickets:"Tickets"
    }
  };

  function detectLang(){ const saved=localStorage.getItem('lang'); if(saved) return saved;
    const n=(navigator.language||'es').slice(0,2).toLowerCase(); return I18N[n]?n:'es';
  }
  let LANG = detectLang();

  const t = (k)=> (I18N[LANG]&&I18N[LANG][k]) || (I18N.es&&I18N.es[k]) || k;

  function applyLang(){
    const L=I18N[LANG]||I18N.es;
    $('#t-app').textContent=t('app'); $('#t-hello').textContent=t('hello');
    $('#t-ev').textContent=t('ev'); $('#t-ev-sub').textContent=t('evSub');
    $('#t-pl').textContent=t('pl'); $('#t-pl-sub').textContent=t('plSub');
    $('#t-sc').textContent=t('sc'); $('#t-sc-sub').textContent=t('scSub');
    $('#t-inst').textContent=t('inst'); $('#t-inst-sub').textContent=t('instSub');
    $('#t-next-events').textContent=t('nextEvents');

    $('#t-stay').textContent=t('stay'); $('#t-stay-sub').textContent=t('staySub');
    $('#t-stay-title').textContent=t('stayTitle'); $('#t-stay-hint').textContent=t('stayHint'); $('#t-stay-which').textContent=t('stayWhich');
    $('#t-stay-hours').textContent=t('stayHours'); $('#t-weather-title').textContent=t('weatherTitle'); $('#t-max').textContent=t('max'); $('#t-min').textContent=t('min');

    $('#i-title').textContent=t('incTitle'); $('#i-hint').textContent=t('incHint'); $('#i-where').textContent=t('incWhere'); $('#i-type').textContent=t('incType'); $('#i-msg').textContent=t('incMsg');
    $('#incWA').textContent=t('incBtnWA'); $('#incEmail').textContent=t('incBtnEmail');

    // Incidencias: traducir opciones
    const incSel = $('#incType');
    qsa('option[data-i18n]', incSel).forEach(opt=>{
      const key = opt.getAttribute('data-i18n');
      opt.textContent = t(key);
    });

    $('#t-events-title').textContent=t('eventsTitle'); $('#t-schedules-title').textContent=t('schedulesTitle'); $('#t-campings-title').textContent=t('campingsTitle');
    $('#schedNote').textContent=t('schedNote');

    $('#d-home').textContent=t('dHome'); $('#d-stay').textContent=t('dStay'); $('#d-inc').textContent=t('dInc'); $('#d-ev').textContent=t('dEv'); $('#d-mu').textContent=t('dMu'); $('#d-pl').textContent=t('dPl'); $('#d-sc').textContent=t('dSc'); $('#drawerHint').textContent=t('drawerHint');
    $('#n-home').textContent=t('nHome'); $('#n-ev').textContent=t('nEv'); $('#n-mu').textContent=t('nMu');
    $('#langBtn').textContent = 'ğŸŒ '+LANG.toUpperCase();

    // Musts: cabecera
    $('#t-musts-title').textContent=t('mustsTitle');
    $('#t-musts-hint').textContent=t('mustsHint');
  }
  applyLang();

  on($('#langBtn'),'click', ()=>{$('#langModal').style.display='flex';});
  on($('#closeLang'),'click',(e)=>{e.preventDefault(); $('#langModal').style.display='none';});
  qsa('.lang-option').forEach(b=>on(b,'click', ()=>{
    LANG=b.dataset.lang; localStorage.setItem('lang',LANG);
    applyLang(); renderAcc(); updateStayUI(); updateIncUI(); renderMusts(); $('#langModal').style.display='none';
  }));

  /* ===== NavegaciÃ³n ===== */
  function showView(name){
    qsa('.view').forEach(v=>v.classList.remove('active'));
    const target = document.getElementById('view-'+name);
    if(target) target.classList.add('active');
    qsa('.navbtn').forEach(b=>b.classList.toggle('active', b.dataset.nav===name));
    $('#drawer').classList.remove('open');
  }
  qsa('[data-nav]').forEach(el=>on(el,'click', ()=>showView(el.dataset.nav)));
  on($('#menuBtn'),'click', ()=>{$('#drawer').classList.add('open');});
  on($('#drawerBack'),'click', ()=>{$('#drawer').classList.remove('open');});

  /* ===== Datos comunes ===== */
  const PLACE_LABEL={oyambre:"Oyambre",ramales:"Ramales",ruiloba:"Ruiloba",cardeo:"El Cardeo"};
  const PLACE_LINK={oyambre:"https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre",ramales:"https://maps.google.com/?q=Camping+Ramales",ruiloba:"https://maps.google.com/?q=Camping+El+Helguero",cardeo:"https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6"};
  const WHATSAPP={oyambre:"34675696212",ramales:"34654463133",ruiloba:"34652806564",cardeo:"34664686158"};
  const PHONES={oyambre:"+34942711461",ramales:"+34654463133",ruiloba:"+34942722124",cardeo:"+34664686158"};
  const WEB={oyambre:"https://www.oyambre.com",ramales:"https://www.campingramales.com",ruiloba:"https://www.campingelhelguero.com",cardeo:"https://www.elcardeo.es"};
  const EMAILS={oyambre:"camping@oyambre.com",ramales:"info@campingramales.com",ruiloba:"info@campingelhelguero.com",cardeo:"info@elcardeo.es"};

  /* ===== Eventos ===== */
  let EVENTS=[], DATE_FILTER='all', CAMP_FILTER='all';
  const FAV_SET = new Set(JSON.parse(localStorage.getItem('fav_events')||'[]'));
  const saveFavs=()=>localStorage.setItem('fav_events', JSON.stringify([...FAV_SET]));
  const isFav=id=>FAV_SET.has(id);
  const toggleFav=id=>{ isFav(id)?FAV_SET.delete(id):FAV_SET.add(id); saveFavs(); renderHomeSlider(); renderEventsGrid(); };
  const whenFmt = d=>{ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short',day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'}).format(new Date(d)); } catch(e){ return d; } };
  const categoryFor = dateStr=>{
    const d=new Date(dateStr), now=new Date();
    const startToday=new Date(now.getFullYear(),now.getMonth(),now.getDate());
    const startTomorrow=new Date(startToday); startTomorrow.setDate(startToday.getDate()+1);
    const endOfWeek=new Date(startToday); endOfWeek.setDate(startToday.getDate()+(7-startToday.getDay()));
    if(d>=startToday && d<startTomorrow) return 'today';
    if(d>=startTomorrow && d< new Date(startTomorrow.getFullYear(),startTomorrow.getMonth(),startTomorrow.getDate()+1)) return 'tomorrow';
    if(d>=startToday && d<endOfWeek) return 'week';
    return 'all';
  };
  const waLink=(camping,message)=>{ const n=WHATSAPP[String(camping||'').toLowerCase()]; return n?('https://wa.me/'+n+'?text='+encodeURIComponent(message||'')):null; };

  function dtToICS(dt){ const d=new Date(dt);
    return d.getUTCFullYear()+pad2(d.getUTCMonth()+1)+pad2(d.getUTCDate())+'T'+pad2(d.getUTCHours())+pad2(d.getUTCMinutes())+pad2(d.getUTCSeconds())+'Z';
  }
  function icsEscape(s){ return String(s||'').replace(/\\/g,'\\\\').replace(/;/g,'\\;').replace(/,/g,'\\,').replace(/\n/g,'\\n'); }
  function downloadICS(ev){
    try{
      const title= (typeof ev.titulo==='string'?ev.titulo:((ev.titulo&&ev.titulo.es)||'Evento'));
      const desc= (typeof ev.descripcion==='string'?ev.descripcion:((ev.descripcion&&ev.descripcion.es)||''));
      const loc = (typeof ev.lugar==='string'?ev.lugar:((ev.lugar&&ev.lugar.es)||PLACE_LABEL[ev.camping]||''));
      const start=new Date(ev.fecha), end=new Date(start.getTime()+90*60000);
      const uid=(ev.id||('ev-'+Date.now()))+'@acobijo.app', now=new Date();
      const ics=[
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Grupo A Cobijo//Customer App//ES','CALSCALE:GREGORIAN','METHOD:PUBLISH',
        'BEGIN:VEVENT','UID:'+icsEscape(uid),'DTSTAMP:'+dtToICS(now),'DTSTART:'+dtToICS(start),'DTEND:'+dtToICS(end),
        'SUMMARY:'+icsEscape(title),'DESCRIPTION:'+icsEscape(desc),'LOCATION:'+icsEscape(loc),'END:VEVENT','END:VCALENDAR'
      ].join('\r\n');
      const blob=new Blob([ics],{type:'text/calendar;charset=utf-8'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
      a.download=('evento-'+(ev.id||'acobijo')+'.ics').replace(/[^a-z0-9._-]+/gi,'_'); document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href),1000);
    }catch(e){ alert('No se pudo generar el calendario.'); }
  }

  function bindEventActionButtons(scope){
    qsa('.fav-btn',scope).forEach(btn=>on(btn,'click', ()=>toggleFav(btn.dataset.id)));
    qsa('.ics-btn',scope).forEach(btn=>on(btn,'click', ()=>{ const ev=EVENTS.find(e=>e.id===btn.dataset.id); if(ev) downloadICS(ev); }));
  }

  function renderHomeSlider(){
    const wrap=$('#homeEvents'); if(!wrap) return;
    const next=EVENTS.slice().sort((a,b)=>new Date(a.fecha)-new Date(b.fecha)).slice(0,6);
    if(!next.length){ wrap.innerHTML='<div class="muted">'+t('fAll')+': 0</div>'; return; }
    wrap.innerHTML = next.map(ev=>{
      const rawTitle=(typeof ev.titulo==='string'?ev.titulo:((ev.titulo&&ev.titulo.es)||'(sin tÃ­tulo)'));
      const rawPlace=(typeof ev.lugar==='string'?ev.lugar:((ev.lugar&&ev.lugar.es)||PLACE_LABEL[ev.camping]||''));
      const img=safeUrl(ev.imagen||ev.image||'');
      const wa=waLink(ev.camping,'Hola, consulta sobre â€œ'+rawTitle+'â€ en '+rawPlace+'.');
      const favStar = isFav(ev.id) ? 'â˜…' : 'â˜†';
      const dir = PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#';
      return `<div class="card">
        ${img?`<img referrerpolicy="no-referrer" src="${img}" alt="${esc(rawTitle)}" loading="lazy" onerror="this.src='https://placehold.co/800x450?text=Evento'">`:''}
        <div class="title">${esc(rawTitle)}</div>
        <div class="meta">${whenFmt(ev.fecha)} Â· ${esc(rawPlace)}</div>
        <div class="row" style="margin-top:6px">
          <button class="btn fav-btn" data-id="${esc(ev.id)}" title="${esc(t('fav'))}">${favStar} ${t('fav')}</button>
          <button class="btn ics-btn" data-id="${esc(ev.id)}">ğŸ“† ${t('addCal')}</button>
          ${wa?`<a class="btn ghost sm" href="${esc(wa)}" target="_blank" rel="noopener">${t('whatsapp')}</a>`:''}
          <a class="btn ghost sm" href="${esc(dir)}" target="_blank" rel="noopener">${t('directions')}</a>
        </div></div>`;
    }).join('');
    bindEventActionButtons(wrap);
  }

  function renderEventsGrid(){
    const grid=$('#eventsGrid'), empty=$('#eventsEmpty'); if(!grid) return;
    const filtered = EVENTS.filter(ev=>{
      const byCamp = CAMP_FILTER==='all' ? true : (String(ev.camping||'').toLowerCase()===CAMP_FILTER);
      if(DATE_FILTER==='fav'){ return byCamp && isFav(ev.id); }
      const byDate = DATE_FILTER==='all' ? true : categoryFor(ev.fecha)===DATE_FILTER;
      return byDate && byCamp;
    }).sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));
    if(!filtered.length){ grid.innerHTML=''; empty.style.display='block'; return; }
    empty.style.display='none';
    grid.innerHTML = filtered.map(ev=>{
      const rawTitle=(typeof ev.titulo==='string'?ev.titulo:((ev.titulo&&ev.titulo.es)||'(sin tÃ­tulo)'));
      const rawPlace=(typeof ev.lugar==='string'?ev.lugar:((ev.lugar&&ev.lugar.es)||PLACE_LABEL[ev.camping]||''));
      const img=safeUrl(ev.imagen||ev.image||'');
      const wa=waLink(ev.camping,'Hola, consulta sobre â€œ'+rawTitle+'â€ en '+rawPlace+'.');
      const favStar = isFav(ev.id) ? 'â˜…' : 'â˜†';
      return `<div class="card" style="min-width:unset">
        ${img?`<img referrerpolicy="no-referrer" src="${img}" alt="${esc(rawTitle)}" loading="lazy" onerror="this.src='https://placehold.co/800x450?text=Evento'">`:''}
        <div class="title">${esc(rawTitle)}</div>
        <div class="meta">${whenFmt(ev.fecha)} Â· ${esc(rawPlace)}</div>
        <div class="row" style="margin-top:6px">
          <button class="btn fav-btn" data-id="${esc(ev.id)}" title="${esc(t('fav'))}">${favStar} ${t('fav')}</button>
          <button class="btn ics-btn" data-id="${esc(ev.id)}">ğŸ“† ${t('addCal')}</button>
          ${wa?`<a class="btn" href="${esc(wa)}" target="_blank" rel="noopener">${t('whatsapp')}</a>`:''}
          <a class="btn" href="${esc(PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#')}" target="_blank" rel="noopener">${t('directions')}</a>
        </div></div>`;
    }).join('');
    bindEventActionButtons(grid);
  }

  function loadEvents(){
    fetch('./events.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>r.ok?r.json():Promise.reject())
      .then(data=>{ EVENTS = Array.isArray(data)?data:[]; })
      .catch(()=>{ // fallback demo
        EVENTS = [{
          id:'demo-'+Date.now(),
          fecha:new Date(Date.now()+3600*1000).toISOString(),
          camping:'oyambre',
          titulo:{es:'Demo: MÃºsica en la terraza'},
          lugar:{es:'Camping Oyambre â€” Terraza'},
          descripcion:{es:'Evento de ejemplo para comprobar la app.'},
          imagen:'https://placehold.co/800x450?text=Concierto'
        }];
      })
      .finally(()=>{ renderHomeSlider(); renderEventsGrid(); });
  }

  qsa('[data-filter]').forEach(ch=>on(ch,'click', ()=>{
    qsa('[data-filter]').forEach(x=>x.classList.remove('on'));
    ch.classList.add('on'); DATE_FILTER=ch.dataset.filter||'all'; renderEventsGrid();
  }));
  qsa('[data-camp]').forEach(ch=>on(ch,'click', ()=>{
    qsa('[data-camp]').forEach(x=>x.classList.remove('on'));
    ch.classList.add('on'); CAMP_FILTER=ch.dataset.camp||'all'; renderEventsGrid();
  }));

  /* ===== Horarios (reales con nota) ===== */
  const SCHEDULES={
    oyambre:{ es:"<b>RecepciÃ³n</b>: 8:30â€“22:00<br><b>Bar</b>: 8:30â€“23:00<br><b>Restaurante</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Piscinas (toda la temporada)</b>: 9:00â€“21:00<br><b>Gimnasio</b>: 9:00â€“21:00<br><b>LavanderÃ­a</b>: 24 horas<br><b>Tienda</b>: 8:30â€“13:00 / 17:00â€“20:00<br><b>Barrera de entrada</b>: 8:00â€“23:59 (circulaciÃ³n prohibida 00:00â€“8:00)<br><b>Check-in parcelas</b>: 13:00 Â· <b>Check-in alojamientos</b>: 17:00 Â· <b>Check-out</b>: 12:00<br><i>"+esc(I18N.es.schedNote)+"</i>"},
    ramales:{ es:"<b>RecepciÃ³n</b>: 9:00â€“21:00<br><b>CafeterÃ­a</b>: Lunâ€“Vie 17:00â€“22:00 Â· SÃ¡bâ€“Dom 8:30â€“22:00<br><b>Restaurante</b>: Lunâ€“Vie 19:00â€“22:00 Â· SÃ¡bâ€“Dom 13:30â€“15:00 / 19:00â€“22:00<br><b>Piscina</b>: 9:30â€“20:30<br><b>Check-in parcelas</b>: 12:00 Â· <b>Check-in alojamientos</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Barrera</b>: 8:00â€“23:59 (prohibida circulaciÃ³n 00:00â€“8:00)<br><i>"+esc(I18N.es.schedNote)+"</i>"},
    ruiloba:{ es:"<b>RecepciÃ³n</b>: 8:30â€“22:00<br><b>Piscinas (toda la temporada)</b>: 9:00â€“21:00<br><b>CafeterÃ­a</b>: 8:30â€“23:00<br><b>Restaurante</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>LavanderÃ­a</b>: 24 horas<br><b>Barrera</b>: 8:00â€“23:59 (circulaciÃ³n prohibida 00:00â€“8:00)<br><b>Tienda</b>: consultar en cafeterÃ­a<br><b>Check-in parcelas</b>: 13:00 Â· <b>Check-in alojamientos</b>: 17:00 Â· <b>Check-out</b>: 12:00<br><i>"+esc(I18N.es.schedNote)+"</i>"},
    cardeo:{ es:"<b>Check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Taberna</b>: 8:30â€“23:00<br><b>Restaurante (fines de semana)</b>: 13:30â€“15:30 / 20:00â€“22:30<br><i>"+esc(I18N.es.schedNote)+"</i>"}
  };
  function renderAcc(){ ['oyambre','ramales','ruiloba','cardeo'].forEach(k=>{ const el=$('#acc-'+k); if(el) el.innerHTML=(SCHEDULES[k]&&SCHEDULES[k].es)||''; }); }
  qsa('.acc-h').forEach(h=>on(h,'click', ()=>{ h.parentElement.classList.toggle('open'); }));

  /* ===== Mi estancia ===== */
  let STAY = localStorage.getItem('stay_place') || 'oyambre';
  const COORDS={ oyambre:{lat:43.393, lon:-4.352}, ramales:{lat:43.263, lon:-3.465}, ruiloba:{lat:43.387, lon:-4.264}, cardeo:{lat:43.391, lon:-4.274} };
  function setStayPlace(v){ STAY=String(v||'oyambre').toLowerCase(); localStorage.setItem('stay_place',STAY); updateStayUI(); updateIncUI(); }
  function renderStayContacts(){
    $('#stayPlace').value=STAY;
    $('#stayWeb').textContent=t('web'); $('#stayWeb').onclick=()=>location.href=WEB[STAY];
    $('#stayCall').textContent=t('call'); $('#stayCall').href='tel:'+PHONES[STAY];
    $('#stayWA').textContent=t('whatsapp'); $('#stayWA').href='https://wa.me/'+WHATSAPP[STAY]+'?text='+encodeURIComponent('Hola, soy cliente alojado en '+PLACE_LABEL[STAY]+'.');
    $('#stayEmail').textContent=t('email'); $('#stayEmail').href='mailto:'+EMAILS[STAY]+'?subject='+encodeURIComponent('Consulta - '+PLACE_LABEL[STAY])+'&body='+encodeURIComponent('Hola,\n\nSoy cliente alojado en '+PLACE_LABEL[STAY]+'.\n\nGracias.');
    $('#stayDir').textContent=t('directions'); $('#stayDir').href=PLACE_LINK[STAY];
    $('#wxPlaceLabel').textContent=PLACE_LABEL[STAY];
  }
  function renderStayHours(){ $('#stayHours').innerHTML=(SCHEDULES[STAY]&&SCHEDULES[STAY].es)||''; }
  function codeToEmoji(code){ if([0].includes(code)) return 'â˜€ï¸'; if([1,2].includes(code)) return 'ğŸŒ¤ï¸'; if([3].includes(code)) return 'â˜ï¸'; if([45,48].includes(code)) return 'ğŸŒ«ï¸'; if([51,53,55,56,57].includes(code)) return 'ğŸŒ¦ï¸'; if([61,63,65,80,81,82].includes(code)) return 'ğŸŒ§ï¸'; if([66,67,71,73,75,77,85,86].includes(code)) return 'â„ï¸'; if([95,96,99].includes(code)) return 'â›ˆï¸'; return 'ğŸŒ¡ï¸'; }
  const wd = d=>{ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short'}).format(new Date(d)); }catch(e){ return d; } };
  function renderWeather(data){
    if(!data) return;
    $('#wxIco').textContent=codeToEmoji(data.current.weather_code);
    $('#wxNow').textContent=Math.round(data.current.temperature_2m);
    $('#wxMax').textContent=Math.round(data.daily.temperature_2m_max[0]);
    $('#wxMin').textContent=Math.round(data.daily.temperature_2m_min[0]);
    $('#wxDesc').textContent=wd(data.daily.time[0]);
    for(let i=1;i<=3;i++){
      $('#d'+i).textContent=wd(data.daily.time[i]);
      $('#i'+i).textContent=codeToEmoji(data.daily.weather_code[i]);
      $('#t'+i).textContent=Math.round(data.daily.temperature_2m_max[i])+'/'+Math.round(data.daily.temperature_2m_min[i])+'Â°';
    }
  }
  function fetchWeather(place){
    const c=COORDS[place]||COORDS.oyambre;
    const url='https://api.open-meteo.com/v1/forecast?latitude='+c.lat+'&longitude='+c.lon+'&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=4';
    fetch(url).then(r=>r.json()).then(renderWeather).catch(()=>{});
  }
  function updateStayUI(){ renderStayContacts(); renderStayHours(); fetchWeather(STAY); }
  on($('#stayPlace'),'change', (e)=>setStayPlace(e.target.value));

  /* ===== Incidencias ===== */
  function buildIncMsg(){
    const type=$('#incType').options[$('#incType').selectedIndex].textContent||t('incTypeOther');
    const msg=$('#incMsg').value||'';
    const stamp=new Date().toLocaleString();
    const header='['+t('incTitle')+'] '+type+' Â· '+PLACE_LABEL[STAY];
    const body='Hola,\n\nTengo una incidencia: '+type+'.\n\nDetalle: '+msg+'\n\nAlojamiento: '+PLACE_LABEL[STAY]+'\nFecha/hora: '+stamp+'\n\nGracias.';
    return {subject:header, body:body};
  }
  function updateIncUI(){
    $('#incPlace').value=STAY;
    const mail=EMAILS[STAY], wa=WHATSAPP[STAY];
    const m=buildIncMsg();
    $('#incWA').href='https://wa.me/'+wa+'?text='+encodeURIComponent(m.body);
    $('#incEmail').href='mailto:'+mail+'?subject='+encodeURIComponent(m.subject)+'&body='+encodeURIComponent(m.body);
  }
  on($('#incPlace'),'change', (e)=>setStayPlace(e.target.value));
  on($('#incType'),'change', updateIncUI);
  on($('#incMsg'),'input', updateIncUI);

  /* ===== Instalar (modal) ===== */
  let deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; });
  on($('#installTile'),'click', ()=>{$('#installModal').style.display='flex';});
  on($('#closeInstall'),'click', (e)=>{ e.preventDefault(); $('#installModal').style.display='none'; });

  /* ===== MUSTS (ImÃ¡genes externas + I18N completo) ===== */
  const IMG_BASE = ''; // si usas CDN: 'https://cdn.tu-dominio.com/musts'
  const ext = (path, fallbackText)=> IMG_BASE
    ? (IMG_BASE.replace(/\/$/,'') + '/' + path.replace(/^\//,''))
    : ('https://placehold.co/800x450?text='+encodeURIComponent(fallbackText||'Cantabria'));
  const tr = (obj)=> (obj && (obj[LANG] || obj.es)) || '';

  const MUSTS = [
    { id:'comillas',
      title:{es:'Comillas', en:'Comillas', fr:'Comillas', de:'Comillas', nl:'Comillas'},
      summary:{es:'Modernismo, palacios y playa.', en:'Modernism, palaces and beach.', fr:'Modernisme, palais et plage.', de:'Modernismus, PalÃ¤ste und Strand.', nl:'Modernisme, paleizen en strand.'},
      cover: ext('comillas/cover.jpg','Comillas'),
      map:'https://maps.app.goo.gl/6Ewz1b7g9Jp9g8nz8',
      highlights:[
        {t:{es:'El Capricho de GaudÃ­', en:'GaudÃ­â€™s El Capricho', fr:'El Capricho de GaudÃ­', de:'GaudÃ­s El Capricho', nl:'El Capricho van GaudÃ­'}, d:{es:'Icono modernista con visita interior.', en:'Modernist icon with interior visit.', fr:'IcÃ´ne moderniste avec visite intÃ©rieure.', de:'Modernistische Ikone mit Innenbesichtigung.', nl:'Modernistisch icoon met binnenbezoek.'}},
        {t:{es:'Palacio de Sobrellano', en:'Sobrellano Palace', fr:'Palais de Sobrellano', de:'Palast Sobrellano', nl:'Paleis Sobrellano'}, d:{es:'Palacio neogÃ³tico y capilla-panteÃ³n.', en:'Neo-Gothic palace and chapel-pantheon.', fr:'Palais nÃ©o-gothique et chapelle-panthÃ©on.', de:'Neogotischer Palast mit Kapelle-Pantheon.', nl:'Neogotisch paleis met kapel-pantheon.'}},
        {t:{es:'Universidad Pontificia', en:'Pontifical University', fr:'UniversitÃ© pontificale', de:'PÃ¤pstliche UniversitÃ¤t', nl:'Pontificale Universiteit'}, d:{es:'Conjunto monumental con vistas.', en:'Monumental complex with views.', fr:'Ensemble monumental avec vues.', de:'Monumentaler Komplex mit Aussicht.', nl:'Monumentaal complex met uitzicht.'}},
        {t:{es:'Playa de Comillas & Oyambre', en:'Comillas & Oyambre Beach', fr:'Plages de Comillas & Oyambre', de:'StrÃ¤nde Comillas & Oyambre', nl:'Stranden Comillas & Oyambre'}, d:{es:'Arenales abiertos junto al parque natural.', en:'Open beaches by the natural park.', fr:'Grandes plages prÃ¨s du parc naturel.', de:'Weite StrÃ¤nde am Naturpark.', nl:'Brede stranden bij het natuurpark.'}}
      ],
      gallery:[ ext('comillas/img1.jpg','Comillas'), ext('comillas/img2.jpg','Comillas'), ext('comillas/img3.jpg','Comillas') ]
    },
    { id:'san-vicente',
      title:{es:'San Vicente de la Barquera', en:'San Vicente de la Barquera', fr:'San Vicente de la Barquera', de:'San Vicente de la Barquera', nl:'San Vicente de la Barquera'},
      summary:{es:'Villa marinera con marismas y puentes.', en:'Seaside town with marshes and bridges.', fr:'Ville maritime, marais et ponts.', de:'KÃ¼stenstadt mit Marschen und BrÃ¼cken.', nl:'Kustplaats met moerassen en bruggen.'},
      cover: ext('san-vicente/cover.jpg','San Vicente de la Barquera'),
      map:'https://maps.app.goo.gl/9xZfJbG5jZ4tWb2w7',
      highlights:[
        {t:{es:'Puente de la Maza', en:'La Maza Bridge', fr:'Pont de la Maza', de:'BrÃ¼cke La Maza', nl:'La Maza-brug'}, d:{es:'HistÃ³rico acceso a la villa.', en:'Historic access to the town.', fr:'AccÃ¨s historique Ã  la ville.', de:'Historischer Zugang zur Stadt.', nl:'Historische toegang tot de stad.'}},
        {t:{es:'Santuario de la Barquera', en:'La Barquera Sanctuary', fr:'Sanctuaire de la Barquera', de:'Heiligtum La Barquera', nl:'Heiligdom La Barquera'}, d:{es:'TradiciÃ³n marinera.', en:'Seafaring tradition.', fr:'Tradition maritime.', de:'Seefahrertradition.', nl:'Zeevaarttraditie.'}},
        {t:{es:'Casco histÃ³rico', en:'Old town', fr:'Centre historique', de:'Altstadt', nl:'Historisch centrum'}, d:{es:'Soportales, torre y muralla.', en:'Arcades, tower and walls.', fr:'Arcades, tour et remparts.', de:'Arkaden, Turm und Mauern.', nl:'Arcades, toren en muren.'}}
      ],
      gallery:[ ext('san-vicente/img1.jpg','San Vicente'), ext('san-vicente/img2.jpg','San Vicente'), ext('san-vicente/img3.jpg','San Vicente') ]
    },
    { id:'potes-liebana',
      title:{es:'Potes & LiÃ©bana', en:'Potes & LiÃ©bana', fr:'Potes & LiÃ©bana', de:'Potes & LiÃ©bana', nl:'Potes & LiÃ©bana'},
      summary:{es:'Puerta a Picos de Europa.', en:'Gateway to Picos de Europa.', fr:'Porte des Picos de Europa.', de:'Tor zu den Picos de Europa.', nl:'Toegang tot Picos de Europa.'},
      cover: ext('potes/cover.jpg','Potes & LiÃ©bana'),
      map:'https://maps.app.goo.gl/WyC7bJQ3wT5k1RrG9',
      highlights:[
        {t:{es:'TelefÃ©rico de Fuente DÃ©', en:'Fuente DÃ© Cable Car', fr:'TÃ©lÃ©phÃ©rique de Fuente DÃ©', de:'Seilbahn Fuente DÃ©', nl:'Kabelbaan Fuente DÃ©'}, d:{es:'Vistas alpinas en minutos.', en:'Alpine views in minutes.', fr:'Vues alpines en quelques minutes.', de:'Alpenpanorama in Minuten.', nl:'Alpenuitzicht in enkele minuten.'}},
        {t:{es:'Torre del Infantado', en:'Infantado Tower', fr:'Tour de lâ€™Infantado', de:'Turm des Infantado', nl:'Toren van Infantado'}, d:{es:'Museo y mirador.', en:'Museum and viewpoint.', fr:'MusÃ©e et belvÃ©dÃ¨re.', de:'Museum und Aussichtspunkt.', nl:'Museum en uitkijkpunt.'}},
        {t:{es:'Santo Toribio de LiÃ©bana', en:'Santo Toribio Monastery', fr:'MonastÃ¨re de Santo Toribio', de:'Kloster Santo Toribio', nl:'Klooster Santo Toribio'}, d:{es:'Ruta jubilar y Lignum Crucis.', en:'Jubilee route & Lignum Crucis.', fr:'Route jubilaire & Lignum Crucis.', de:'Pilgerroute & Lignum Crucis.', nl:'Jubileumroute & Lignum Crucis.'}}
      ],
      gallery:[ ext('potes/img1.jpg','Potes'), ext('potes/img2.jpg','Potes'), ext('potes/img3.jpg','Potes') ]
    },
    { id:'cabarceno',
      title:{es:'Parque de la Naturaleza de CabÃ¡rceno', en:'CabÃ¡rceno Nature Park', fr:'Parc de la nature de CabÃ¡rceno', de:'Naturpark CabÃ¡rceno', nl:'Natuurpark CabÃ¡rceno'},
      summary:{es:'Fauna en semilibertad en antigua mina.', en:'Semi-free wildlife in a former mine.', fr:'Faune semi-libre dans une ancienne mine.', de:'Halbfreilebende Fauna im ehemaligen Bergwerk.', nl:'Halfvrij wildpark in een oude mijn.'},
      cover: ext('cabarceno/cover.jpg','CabÃ¡rceno'),
      map:'https://maps.app.goo.gl/D3m8c1Fq9tX1C2qP8',
      site:'https://parquedecabarceno.com/',
      tickets:'https://parquedecabarceno.com/entradas',
      highlights:[
        {t:{es:'Telecabina', en:'Cable car', fr:'TÃ©lÃ©cabine', de:'Gondelbahn', nl:'Gondelbaan'}, d:{es:'Vistas y conexiÃ³n entre Ã¡reas.', en:'Views and area connection.', fr:'Vues et connexion des zones.', de:'Aussichten & Verbindung der Bereiche.', nl:'Uitzichten en verbinding.'}},
        {t:{es:'ExhibiciÃ³n de aves', en:'Birds of prey show', fr:'Spectacle dâ€™oiseaux', de:'Greifvogelschau', nl:'Roofvogelshow'}, d:{es:'Incluida en la entrada.', en:'Included in ticket.', fr:'Incluse dans le billet.', de:'Im Ticket enthalten.', nl:'Inbegrepen in ticket.'}}
      ],
      gallery:[ ext('cabarceno/img1.jpg','CabÃ¡rceno'), ext('cabarceno/img2.jpg','CabÃ¡rceno'), ext('cabarceno/img3.jpg','CabÃ¡rceno') ]
    },
    { id:'alto-ason',
      title:{es:'Comarca del Alto AsÃ³n', en:'Alto AsÃ³n Region', fr:'RÃ©gion de lâ€™Alto AsÃ³n', de:'Region Alto AsÃ³n', nl:'Regio Alto AsÃ³n'},
      summary:{es:'Cuevas, cascadas y karst.', en:'Caves, waterfalls and karst.', fr:'Grottes, cascades et karst.', de:'HÃ¶hlen, WasserfÃ¤lle, Karst.', nl:'Grotten, watervallen en karst.'},
      cover: ext('alto-ason/cover.jpg','Alto AsÃ³n'),
      map:'https://maps.app.goo.gl/8mNmkQ4g7r1mS9jN7',
      highlights:[
        {t:{es:'Cascada del AsÃ³n', en:'AsÃ³n Waterfall', fr:'Cascade de lâ€™AsÃ³n', de:'AsÃ³n-Wasserfall', nl:'AsÃ³n-waterval'}, d:{es:'Salto espectacular en primavera.', en:'Spectacular in spring.', fr:'Spectaculaire au printemps.', de:'SpektakulÃ¤r im FrÃ¼hjahr.', nl:'Spectaculair in het voorjaar.'}},
        {t:{es:'Cueva Coventosa', en:'Coventosa Cave', fr:'Grotte Coventosa', de:'HÃ¶hle Coventosa', nl:'Grot Coventosa'}, d:{es:'EspeleologÃ­a para expertos.', en:'Caving for experts.', fr:'SpÃ©lÃ©ologie pour experts.', de:'HÃ¶hlenforschung fÃ¼r GeÃ¼bte.', nl:'Speleologie voor gevorderden.'}}
      ],
      gallery:[ ext('alto-ason/img1.jpg','Alto AsÃ³n'), ext('alto-ason/img2.jpg','Alto AsÃ³n'), ext('alto-ason/img3.jpg','Alto AsÃ³n') ]
    },
    { id:'cabuerniga',
      title:{es:'Valle de CabuÃ©rniga', en:'CabuÃ©rniga Valley', fr:'VallÃ©e de CabuÃ©rniga', de:'Tal CabuÃ©rniga', nl:'Vallei van CabuÃ©rniga'},
      summary:{es:'Pueblos cÃ¡ntabros y hayedos.', en:'Cantabrian villages and beech forests.', fr:'Villages cantabres et hÃªtraies.', de:'Kantabrische DÃ¶rfer & BuchenwÃ¤lder.', nl:'Dorpen en beukenbossen.'},
      cover: ext('cabuerniga/cover.jpg','CabuÃ©rniga'),
      map:'https://maps.app.goo.gl/Z2k2Fh9f1jKj3p5c8',
      highlights:[
        {t:{es:'BÃ¡rcena Mayor', en:'BÃ¡rcena Mayor', fr:'BÃ¡rcena Mayor', de:'BÃ¡rcena Mayor', nl:'BÃ¡rcena Mayor'}, d:{es:'Conjunto histÃ³rico tradicional.', en:'Traditional historic village.', fr:'Village historique traditionnel.', de:'Traditionelles historisches Dorf.', nl:'Historisch traditioneel dorp.'}},
        {t:{es:'Hayedo de Saja', en:'Saja Beech Forest', fr:'HÃªtraie de Saja', de:'Buchenwald Saja', nl:'Beukenbos Saja'}, d:{es:'Rutas y otoÃ±o espectacular.', en:'Trails and stunning autumn.', fr:'Sentiers et automne superbe.', de:'Wege & grandioser Herbst.', nl:'Paden en schitterende herfst.'}}
      ],
      gallery:[ ext('cabuerniga/img1.jpg','CabuÃ©rniga'), ext('cabuerniga/img2.jpg','CabuÃ©rniga'), ext('cabuerniga/img3.jpg','CabuÃ©rniga') ]
    },
    { id:'santander',
      title:{es:'Santander', en:'Santander', fr:'Santander', de:'Santander', nl:'Santander'},
      summary:{es:'BahÃ­a, palacio y playas urbanas.', en:'Bay, palace and city beaches.', fr:'Baie, palais et plages urbaines.', de:'Bucht, Palast & StadtstrÃ¤nde.', nl:'Baai, paleis en stadsstranden.'},
      cover: ext('santander/cover.jpg','Santander'),
      map:'https://maps.app.goo.gl/1o6o3n5rC4oXj2o58',
      highlights:[
        {t:{es:'Palacio de La Magdalena', en:'La Magdalena Palace', fr:'Palais de la Magdalena', de:'Palast La Magdalena', nl:'Paleis La Magdalena'}, d:{es:'Residencia real de verano.', en:'Royal summer residence.', fr:'RÃ©sidence dâ€™Ã©tÃ© royale.', de:'KÃ¶nigliche Sommerresidenz.', nl:'Koninklijke zomerresidentie.'}},
        {t:{es:'Centro BotÃ­n', en:'BotÃ­n Centre', fr:'Centre BotÃ­n', de:'Zentrum BotÃ­n', nl:'BotÃ­n-centrum'}, d:{es:'Arte y miradores a la bahÃ­a.', en:'Art & bay viewpoints.', fr:'Art & points de vue.', de:'Kunst & Blicke auf die Bucht.', nl:'Kunst & uitzichten op de baai.'}}
      ],
      gallery:[ ext('santander/img1.jpg','Santander'), ext('santander/img2.jpg','Santander'), ext('santander/img3.jpg','Santander') ]
    },
    { id:'santillana',
      title:{es:'Santillana del Mar', en:'Santillana del Mar', fr:'Santillana del Mar', de:'Santillana del Mar', nl:'Santillana del Mar'},
      summary:{es:'Villa medieval y Altamira cerca.', en:'Medieval town; Altamira nearby.', fr:'Bourg mÃ©diÃ©val; Altamira Ã  proximitÃ©.', de:'Mittelalterlicher Ort; Altamira nah.', nl:'Middeleeuws stadje; Altamira nabij.'},
      cover: ext('santillana/cover.jpg','Santillana del Mar'),
      map:'https://maps.app.goo.gl/Vm5h5X8YFQ9a1o6z7',
      highlights:[
        {t:{es:'Colegiata de Santa Juliana', en:'Collegiate Church of Santa Juliana', fr:'CollÃ©giale Sainte-Julienne', de:'Stiftskirche Santa Juliana', nl:'Collegiale Santa Juliana'}, d:{es:'RomÃ¡nico del siglo XII.', en:'12th-century Romanesque.', fr:'Roman du XIIe siÃ¨cle.', de:'Romanik aus dem 12. Jh.', nl:'Romaans, 12e eeuw.'}},
        {t:{es:'Museo de Altamira', en:'Altamira Museum', fr:'MusÃ©e dâ€™Altamira', de:'Museum Altamira', nl:'Altamira-museum'}, d:{es:'Neocueva & arte rupestre.', en:'Neo-cave & rock art.', fr:'NÃ©o-grotte & art rupestre.', de:'NeohÃ¶hle & Felskunst.', nl:'Neogrot & rotskunst.'}}
      ],
      gallery:[ ext('santillana/img1.jpg','Santillana'), ext('santillana/img2.jpg','Santillana'), ext('santillana/img3.jpg','Santillana') ]
    },
    { id:'suances',
      title:{es:'Suances', en:'Suances', fr:'Suances', de:'Suances', nl:'Suances'},
      summary:{es:'Playas y acantilados con surf.', en:'Beaches and cliffs with surf.', fr:'Plages et falaises, surf.', de:'StrÃ¤nde & Klippen, Surfen.', nl:'Stranden en kliffen, surf.'},
      cover: ext('suances/cover.jpg','Suances'),
      map:'https://maps.app.goo.gl/TE1h1pQm9hQHUheH8',
      highlights:[
        {t:{es:'Playa de Los Locos', en:'Los Locos Beach', fr:'Plage de Los Locos', de:'Strand Los Locos', nl:'Playa de Los Locos'}, d:{es:'Spot surfero y puestas de sol.', en:'Surf spot & sunsets.', fr:'Spot de surf & couchers de soleil.', de:'Surfspot & SonnenuntergÃ¤nge.', nl:'Surfspot & zonsondergangen.'}},
        {t:{es:'Faro de Suances', en:'Suances Lighthouse', fr:'Phare de Suances', de:'Leuchtturm Suances', nl:'Vuurtoren van Suances'}, d:{es:'Mirador al CantÃ¡brico.', en:'Viewpoint over the Cantabrian.', fr:'BelvÃ©dÃ¨re sur la mer Cantabrique.', de:'Aussichtspunkt auf die Biskaya.', nl:'Uitzicht op de Cantabrische Zee.'}}
      ],
      gallery:[ ext('suances/img1.jpg','Suances'), ext('suances/img2.jpg','Suances'), ext('suances/img3.jpg','Suances') ]
    },
    { id:'hermida',
      title:{es:'Desfiladero de La Hermida', en:'La Hermida Gorge', fr:'DÃ©filÃ© de La Hermida', de:'Schlucht La Hermida', nl:'La Hermida-kloof'},
      summary:{es:'CaÃ±Ã³n que une costa y LiÃ©bana.', en:'Gorge linking coast and LiÃ©bana.', fr:'Canyon entre cÃ´te et LiÃ©bana.', de:'Schlucht zwischen KÃ¼ste & LiÃ©bana.', nl:'Kloof tussen kust en LiÃ©bana.'},
      cover: ext('hermida/cover.jpg','La Hermida'),
      map:'https://maps.app.goo.gl/YyHk7G3yU2o7Wz3QA',
      highlights:[
        {t:{es:'Termas de La Hermida', en:'La Hermida Spa', fr:'Thermes de La Hermida', de:'Thermalbad La Hermida', nl:'Thermen La Hermida'}, d:{es:'Balneario histÃ³rico.', en:'Historic spa.', fr:'Thermes historiques.', de:'Historisches Thermalbad.', nl:'Historisch kuuroord.'}},
        {t:{es:'Miradores', en:'Viewpoints', fr:'BelvÃ©dÃ¨res', de:'Aussichtspunkte', nl:'Uitzichtpunten'}, d:{es:'Paredes calizas verticales.', en:'Vertical limestone walls.', fr:'Falaises calcaires verticales.', de:'Senkrechte KalkwÃ¤nde.', nl:'Verticale kalksteenwanden.'}}
      ],
      gallery:[ ext('hermida/img1.jpg','La Hermida'), ext('hermida/img2.jpg','La Hermida'), ext('hermida/img3.jpg','La Hermida') ]
    },
    { id:'el-soplao',
      title:{es:'Cueva El Soplao', en:'El Soplao Cave', fr:'Grotte El Soplao', de:'HÃ¶hle El Soplao', nl:'Grot El Soplao'},
      summary:{es:'Formaciones excÃ©ntricas Ãºnicas.', en:'Unique eccentric formations.', fr:'Formations excentriques uniques.', de:'Einzigartige exzentrische Formationen.', nl:'Unieke excentrische formaties.'},
      cover: ext('el-soplao/cover.jpg','El Soplao'),
      map:'https://maps.app.goo.gl/kqB7y7a6T9Kf1U9y5',
      site:'https://www.elsoplao.es/',
      tickets:'https://www.elsoplao.es/visitas/',
      highlights:[
        {t:{es:'Ruta turÃ­stica', en:'Tourist route', fr:'Parcours touristique', de:'Touristenroute', nl:'Toeristische route'}, d:{es:'Visita guiada clÃ¡sica.', en:'Classic guided tour.', fr:'Visite guidÃ©e classique.', de:'Klassische FÃ¼hrung.', nl:'Klassieke rondleiding.'}},
        {t:{es:'Plan minero', en:'Mining plan', fr:'Parcours minier', de:'Bergwerks-Route', nl:'Mijnroute'}, d:{es:'Tren minero y galerÃ­as.', en:'Mine train & galleries.', fr:'Petit train & galeries.', de:'Grubenbahn & Stollen.', nl:'Mijn-trein & galerijen.'}}
      ],
      gallery:[ ext('el-soplao/img1.jpg','El Soplao'), ext('el-soplao/img2.jpg','El Soplao'), ext('el-soplao/img3.jpg','El Soplao') ]
    },
    { id:'isla-noja-santona',
      title:{es:'Isla Â· Noja Â· SantoÃ±a', en:'Isla Â· Noja Â· SantoÃ±a', fr:'Isla Â· Noja Â· SantoÃ±a', de:'Isla Â· Noja Â· SantoÃ±a', nl:'Isla Â· Noja Â· SantoÃ±a'},
      summary:{es:'Playas, marismas y anchoas.', en:'Beaches, marshes and anchovies.', fr:'Plages, marais et anchois.', de:'StrÃ¤nde, Marschen & Sardellen.', nl:'Stranden, moerassen en ansjovis.'},
      cover: ext('isla-noja-santona/cover.jpg','Isla Â· Noja Â· SantoÃ±a'),
      map:'https://maps.app.goo.gl/q8Xqj3F3yZ9w4i7B9',
      highlights:[
        {t:{es:'Marismas de SantoÃ±a', en:'SantoÃ±a Marshes', fr:'Marais de SantoÃ±a', de:'SantoÃ±a-Marsch', nl:'Moerassen van SantoÃ±a'}, d:{es:'Aves migratorias y paseos.', en:'Migratory birds & walks.', fr:'Oiseaux migrateurs & balades.', de:'ZugvÃ¶gel & Spazierwege.', nl:'Trekvogels & wandelingen.'}},
        {t:{es:'Playa de TrengandÃ­n', en:'TrengandÃ­n Beach', fr:'Plage de TrengandÃ­n', de:'Strand TrengandÃ­n', nl:'Strand TrengandÃ­n'}, d:{es:'Larga y familiar.', en:'Long and family-friendly.', fr:'Longue et familiale.', de:'Lang & familienfreundlich.', nl:'Lang en gezinsvriendelijk.'}}
      ],
      gallery:[ ext('isla-noja-santona/img1.jpg','Isla-Noja-SantoÃ±a'), ext('isla-noja-santona/img2.jpg','Isla-Noja-SantoÃ±a'), ext('isla-noja-santona/img3.jpg','Isla-Noja-SantoÃ±a') ]
    }
  ];

  function renderMusts(){
    const grid=$('#mustsGrid'); if(!grid) return;
    const L = I18N[LANG]||I18N.es;
    grid.innerHTML = MUSTS.map(m=>{
      const title=tr(m.title), summary=tr(m.summary);
      const details=(m.highlights||[]).map(h=>`<li><strong>${esc(tr(h.t))}</strong>: ${esc(tr(h.d))}</li>`).join('');
      const gallery=(m.gallery||[]).map((u,i)=>`<img class="ext-img" referrerpolicy="no-referrer" src="${safeUrl(u)||'https://placehold.co/400x400?text='+encodeURIComponent(title)}" alt="${esc(title)} ${i+1}" loading="lazy" onerror="this.src='https://placehold.co/400x400?text=${encodeURIComponent(title)}'">`).join('');
      return `<article class="must-card" data-id="${esc(m.id)}">
        <img class="must-cover ext-img" referrerpolicy="no-referrer" src="${safeUrl(m.cover)||'https://placehold.co/800x450?text='+encodeURIComponent(title)}" alt="${esc(title)}" loading="lazy" onerror="this.src='https://placehold.co/800x450?text=${encodeURIComponent(title)}'">
        <div class="must-head"><div class="must-title">${esc(title)}</div><div class="must-summary">${esc(summary)}</div></div>
        <div class="must-actions">
          ${m.map?`<a class="btn" href="${esc(m.map)}" target="_blank" rel="noopener">ğŸ—ºï¸ ${esc(L.openMap)}</a>`:''}
          ${m.site?`<a class="btn" href="${esc(m.site)}" target="_blank" rel="noopener">ğŸŒ ${esc(L.openSite)}</a>`:''}
          ${m.tickets?`<a class="btn primary" href="${esc(m.tickets)}" target="_blank" rel="noopener">ğŸŸï¸ ${esc(L.openTickets)}</a>`:''}
          <button class="btn ghost sm toggle-more">${esc(L.seeMore)}</button>
        </div>
        <div class="must-body">
          <ul style="margin:8px 0 0;padding-left:18px">${details}</ul>
          <div class="must-gallery">${gallery}</div>
          <div style="margin-top:8px"><button class="btn ghost sm toggle-less">${esc(L.seeLess)}</button></div>
        </div>
      </article>`;
    }).join('');
    qsa('.must-card',grid).forEach(card=>{
      on(card.querySelector('.toggle-more'),'click', ()=>card.classList.add('open'));
      on(card.querySelector('.toggle-less'),'click', ()=>card.classList.remove('open'));
    });
  }

  /* ===== Admin (activar con 5 toques en el logo) ===== */
  (function adminActivator(){
    const logo=$('#logoTap'); let taps=0,timer=null;
    function askForPin(){
      const stored = localStorage.getItem('admin_pin') || '311974';
      const entered = window.prompt('Introduce la contraseÃ±a de admin:','');
      if(entered===null) return false;
      if(entered===stored) return true;
      alert('ContraseÃ±a incorrecta'); return false;
    }
    on(logo,'click', function(){
      taps++; clearTimeout(timer); timer=setTimeout(function(){taps=0},1000);
      if(taps>=5){
        taps=0;
        if(document.body.classList.contains('admin-on')){
          localStorage.setItem('admin','0'); document.body.classList.remove('admin-on'); alert('Modo admin desactivado');
        }else{
          if(!askForPin()) return;
          localStorage.setItem('admin','1'); document.body.classList.add('admin-on');
          openAdminModal(); loadEventsAdmin(); loadSchedulesAdmin(); alert('Modo admin activado');
        }
      }
    });
  })();

  function openAdminModal(){ const m=$('#adminModal'); if(m){ m.style.display='flex'; document.body.classList.add('modal-open'); } }
  function closeAdminModal(){ const m=$('#adminModal'); if(m){ m.style.display='none'; document.body.classList.remove('modal-open'); } }
  on($('#closeAdmin'),'click', function(e){ e.preventDefault(); closeAdminModal(); });
  on($('#adminModal'),'click', function(e){ if(e.target && e.target.id==='adminModal'){ closeAdminModal(); } });
  document.addEventListener('keydown', function(e){ if(e.key==='Escape'){ closeAdminModal(); } });
  on($('#openAdmin'),'click', function(){ if(!document.body.classList.contains('admin-on')) return; openAdminModal(); loadEventsAdmin(); loadSchedulesAdmin(); });

  let ADMIN_EVENTS=[];
  const slug=s=>String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'').slice(0,60);
  const isoFromLocal=(dt)=>{ const d=new Date(dt); if(isNaN(d.getTime())) return dt; const tz=-d.getTimezoneOffset(),sign=tz>=0?'+':'-'; const p=n=>('0'+n).slice(-2); return d.getFullYear()+'-'+p(d.getMonth()+1)+'-'+p(d.getDate())+'T'+p(d.getHours())+':'+p(d.getMinutes())+':'+p(d.getSeconds())+sign+p(Math.floor(Math.abs(tz)/60))+':'+p(Math.abs(tz)%60); };

  function loadEventsAdmin(){
    fetch('./events.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>r.json()).then(data=>{ ADMIN_EVENTS = Array.isArray(data)?data:[]; renderAdminTable(); })
      .catch(()=>{ ADMIN_EVENTS=[]; renderAdminTable(); });
    loadGhCfgToForm();
  }
  function renderAdminTable(){
    const tbody = $('#eventsTable tbody'); if(!tbody) return;
    tbody.innerHTML = ADMIN_EVENTS.slice().sort((a,b)=>new Date(a.fecha)-new Date(b.fecha)).map(ev=>{
      const titleES=(typeof ev.titulo==='string'?ev.titulo:((ev.titulo&&ev.titulo.es)||''))||'';
      const lugarES=(typeof ev.lugar==='string'?ev.lugar:((ev.lugar&&ev.lugar.es)||''))||'';
      const dt=new Date(ev.fecha);
      const val = dt.getFullYear()+'-'+pad2(dt.getMonth()+1)+'-'+pad2(dt.getDate())+'T'+pad2(dt.getHours())+':'+pad2(dt.getMinutes());
      return `<tr data-id="${ev.id}">
        <td class="muted" style="white-space:nowrap">${esc(ev.id)}</td>
        <td><input class="input dt" type="datetime-local" value="${val}"><div class="muted">${esc(dt.toLocaleString())}</div></td>
        <td><select class="select camp">
            <option value="oyambre" ${ev.camping==='oyambre'?'selected':''}>oyambre</option>
            <option value="ramales" ${ev.camping==='ramales'?'selected':''}>ramales</option>
            <option value="ruiloba" ${ev.camping==='ruiloba'?'selected':''}>ruiloba</option>
            <option value="cardeo" ${ev.camping==='cardeo'?'selected':''}>cardeo</option>
          </select>
          <input class="input lugar" style="margin-top:6px" placeholder="Lugar (ES)" value="${esc(lugarES)}"></td>
        <td><input class="input titulo" placeholder="TÃ­tulo (ES)" value="${esc(titleES)}">
          <textarea class="textarea desc" rows="2" placeholder="DescripciÃ³n (ES)" style="margin-top:6px">${esc(((ev.descripcion&&ev.descripcion.es)||''))}</textarea>
          <input class="input img" placeholder="Imagen (URL)" value="${esc((ev.imagen||ev.image||''))}" style="margin-top:6px"></td>
        <td style="min-width:220px"><button class="btn act-save">Guardar</button> <button class="btn act-dup">Duplicar</button> <button class="btn act-del">Borrar</button></td>
      </tr>`;
    }).join('');
    qsa('#eventsTable tbody tr').forEach(tr=>{
      const id = tr.getAttribute('data-id');
      on(tr.querySelector('.act-save'),'click', function(){ saveRow(tr,id); });
      on(tr.querySelector('.act-dup'),'click', function(){ duplicateRow(id); });
      on(tr.querySelector('.act-del'),'click', function(){ deleteRow(id); });
    });
  }
  function getRowValues(tr){
    return {
      dateLocal: tr.querySelector('.dt').value,
      camping: tr.querySelector('.camp').value,
      lugar: (tr.querySelector('.lugar').value||'').trim(),
      titulo: (tr.querySelector('.titulo').value||'').trim(),
      desc: (tr.querySelector('.desc').value||'').trim(),
      img: (tr.querySelector('.img').value||'').trim()
    };
  }
  function defaultLugar(p){ if(p==='oyambre')return 'Camping Caravaning Playa de Oyambre'; if(p==='ramales')return 'Camping Ramales'; if(p==='ruiloba')return 'Camping El Helguero'; if(p==='cardeo')return 'Apartamentos El Cardeo'; return ''; }
  function saveRow(tr,id){
    const v=getRowValues(tr); if(!v.titulo||!v.dateLocal||!v.camping){alert('Rellena tÃ­tulo, fecha y alojamiento.');return;}
    const idx=ADMIN_EVENTS.findIndex(e=>e.id===id); if(idx<0) return;
    ADMIN_EVENTS[idx].fecha=isoFromLocal(v.dateLocal);
    ADMIN_EVENTS[idx].camping=v.camping;
    ADMIN_EVENTS[idx].titulo={es:v.titulo};
    ADMIN_EVENTS[idx].lugar={es:v.lugar||defaultLugar(v.camping)};
    ADMIN_EVENTS[idx].descripcion={es:v.desc||''};
    if(v.img) ADMIN_EVENTS[idx].imagen=v.img; else delete ADMIN_EVENTS[idx].imagen;
    renderAdminTable();
  }
  function duplicateRow(id){
    const o=ADMIN_EVENTS.find(e=>e.id===id); if(!o) return;
    const titleES=(o.titulo&&o.titulo.es)||''; const newId='ev-'+slug(titleES)+'-'+o.camping+'-'+Date.now().toString().slice(-8);
    const copy=JSON.parse(JSON.stringify(o)); copy.id=newId; ADMIN_EVENTS.push(copy); renderAdminTable();
  }
  function deleteRow(id){ if(!confirm('Â¿Borrar este evento?')) return; ADMIN_EVENTS = ADMIN_EVENTS.filter(e=>e.id!==id); renderAdminTable(); }

  // Schedules admin
  function loadSchedulesAdmin(){ const a=$('#schedJsonArea'); if(!a) return; try{ a.value=JSON.stringify(SCHEDULES,null,2); }catch(e){ a.value='{}'; } }
  on($('#schedApplyBtn'),'click', function(){ const a=$('#schedJsonArea'); try{ const obj=JSON.parse(a.value); if(!obj||typeof obj!=='object') throw 0; Object.assign(SCHEDULES,obj); renderAcc(); renderStayHours(); alert('Horarios aplicados.'); }catch(e){ alert('JSON invÃ¡lido.'); } });
  on($('#exportSchedBtn'),'click', function(){ const blob=new Blob([JSON.stringify(SCHEDULES,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='schedules.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
  on($('#importSchedFile'),'change', function(e){ const f=e.target.files && e.target.files[0]; if(!f) return; f.text().then(function(txt){ const data=JSON.parse(txt); if(!data||typeof data!=='object') throw 0; Object.assign(SCHEDULES,data); renderAcc(); loadSchedulesAdmin(); renderStayHours(); }).catch(function(){ alert('No se pudo leer schedules.json'); }).finally(function(){ e.target.value=''; }); });

  // GitHub minimal
  const GH_KEYS={repo:'ghRepo',branch:'ghBranch',token:'ghToken'};
  function loadGhCfgToForm(){ $('#ghRepo').value=localStorage.getItem(GH_KEYS.repo)||''; $('#ghBranch').value=localStorage.getItem(GH_KEYS.branch)||'main'; $('#ghToken').value=localStorage.getItem(GH_KEYS.token)||''; }
  function saveGhCfgFromForm(){ localStorage.setItem(GH_KEYS.repo,($('#ghRepo').value||'').trim()); localStorage.setItem(GH_KEYS.branch,($('#ghBranch').value||'').trim()||'main'); const t=($('#ghToken').value||'').trim(); if(t) localStorage.setItem(GH_KEYS.token,t); alert('ConfiguraciÃ³n guardada.'); }
  function ghGet(path, token){ const repo=localStorage.getItem(GH_KEYS.repo), branch=localStorage.getItem(GH_KEYS.branch)||'main'; const url='https://api.github.com/repos/'+repo+'/contents/'+encodeURIComponent(path)+'?ref='+encodeURIComponent(branch); return fetch(url,{headers:{'Authorization':'token '+(token||'').trim(),'Accept':'application/vnd.github+json','X-GitHub-Api-Version':'2022-11-28','User-Agent':'acobijo-app'}}); }
  function ghPut(path, contentBase64, message, sha, token){ const repo=localStorage.getItem(GH_KEYS.repo), branch=localStorage.getItem(GH_KEYS.branch)||'main'; const url='https://api.github.com/repos/'+repo+'/contents/'+encodeURIComponent(path); const body={message:message,content:contentBase64,branch:branch}; if(sha) body.sha=sha; return fetch(url,{method:'PUT',headers:{'Authorization':'token '+(token||'').trim(),'Accept':'application/vnd.github+json','X-GitHub-Api-Version':'2022-11-28','Content-Type':'application/json','User-Agent':'acobijo-app'},body:JSON.stringify(body)}); }
  const toB64 = (str)=> btoa(unescape(encodeURIComponent(str)));
  on($('#saveGhCfg'),'click', saveGhCfgFromForm);
  on($('#pushEventsBtn'),'click', function(){
    try{
      if(!ADMIN_EVENTS.length){ alert('No hay eventos.'); return; }
      const token=(localStorage.getItem(GH_KEYS.token)||'').trim(); if(!token){alert('Configura el token.');return;}
      let sha=null;
      ghGet('events.json', token).then(function(res){ if(res.status===200){ return res.json().then(d=>{sha=d.sha;}); } });
      const jsonStr=JSON.stringify(ADMIN_EVENTS,null,2);
      const content64=toB64(jsonStr);
      const now=new Date().toISOString().slice(0,19).replace('T',' ');
      ghPut('events.json',content64,'Update events.json via in-app admin ('+now+')',sha,token).then(function(res){ if(res.ok){ alert('âœ… events.json subido.'); } else { res.text().then(txt=>alert('âŒ Error '+res.status+'\n'+txt)); }});
    }catch(err){ alert('âŒ '+err.message); }
  });
  on($('#pushSchedBtn'),'click', function(){
    try{
      const token=(localStorage.getItem(GH_KEYS.token)||'').trim(); if(!token){alert('Configura el token.');return;}
      let sha=null;
      ghGet('schedules.json', token).then(function(res){ if(res.status===200){ return res.json().then(d=>{sha=d.sha;}); } });
      const jsonStr=JSON.stringify(SCHEDULES,null,2);
      const content64=toB64(jsonStr);
      const now=new Date().toISOString().slice(0,19).replace('T',' ');
      ghPut('schedules.json',content64,'Update schedules.json via in-app admin ('+now+')',sha,token).then(function(res){ if(res.ok){ alert('âœ… schedules.json subido.'); } else { res.text().then(txt=>alert('âŒ Error '+res.status+'\n'+txt)); }});
    }catch(err){ alert('âŒ '+err.message); }
  });

  /* ===== Init ===== */
  // textos por defecto â€œMi estanciaâ€
  $('#stayWeb').textContent=t('web'); $('#stayCall').textContent=t('call'); $('#stayWA').textContent=t('whatsapp'); $('#stayEmail').textContent=t('email'); $('#stayDir').textContent=t('directions');
  $('#stayPlace').value=STAY; $('#incPlace').value=STAY;

  // abrir secciones
  renderAcc();
  updateStayUI();
  updateIncUI();
  renderMusts();
  loadEvents();

  // modales: cerrar con backdrop/Esc
  const closeOnBackdrop = (id)=>{ const el=$(id); if(!el) return; on(el,'click', (e)=>{ if(e.target===el) el.style.display='none'; }); };
  closeOnBackdrop('#langModal'); closeOnBackdrop('#installModal');
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ ['langModal','installModal'].forEach(id=>{ const el=$('#'+id); if(el) el.style.display='none'; }); } });

  /* ===== Service Worker ===== */
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
  }

}); // DOMContentLoaded
</script>
</body>
</html>
