<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Grupo A Cobijo</title>
<meta name="description" content="App de experiencia del cliente: eventos, horarios y accesos del Grupo A Cobijo.">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0ea5e9">
<link rel="icon" href="assets/icons/icon-192.png">
<link rel="apple-touch-icon" href="assets/icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
:root{
  --bg:#ffffff; --ink:#0a1a2a; --muted:#6b7280; --line:#e6eef7;
  --brand:#0ea5e9; --brand-ink:#063e63; --card:#f7fbff; --tint:#eef7ff;
  --wx1:#e9f6ff; --wx2:#d9efff; --wx3:#cce7ff; --wx4:#bfe0ff;
}
body.dark{
  --bg:#0b1220; --ink:#e8eef7; --muted:#8fa2bd; --line:#1e2a40;
  --brand:#22b2ff; --brand-ink:#bfe7ff; --card:#111a2a; --tint:#0f1a2b;
  --wx1:#0f1f35; --wx2:#102640; --wx3:#0f2b4a; --wx4:#0c3156;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink);background:var(--bg);transition:background-color .15s,color .15s}
img{max-width:100%;height:auto}
.hero img{height:64px;width:auto;max-width:160px}

/* Topbar */
.topbar{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#e6f6ff,#ffffff);
  border-bottom:1px solid var(--line);display:flex;align-items:center;gap:.75rem;padding:.7rem .9rem}
body.dark .topbar{background:linear-gradient(180deg,#0e1a2c,#0b1220)}
.topbar .burger{border:none;background:#fff;border:1px solid var(--line);border-radius:10px;padding:.45rem .55rem;cursor:pointer}
body.dark .topbar .burger{background:#0f1a2b}
.topbar .brand{display:flex;align-items:center;gap:.6rem}
.topbar img{height:40px;width:auto;object-fit:contain}
.topbar h1{font-size:1rem;margin:0}
.lang-btn,.theme-btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:.35rem .6rem;cursor:pointer}
body.dark .lang-btn, body.dark .theme-btn{background:#0f1a2b}

/* Drawer */
.drawer{position:fixed;inset:0;z-index:30;display:none}
.drawer.open{display:block}
.drawer .back{position:absolute;inset:0;background:rgba(0,0,0,.35)}
.drawer .panel{position:absolute;inset:0 auto 0 0;width:min(86vw,340px);background:#fff;border-right:1px solid var(--line);
  padding:14px;display:flex;flex-direction:column;gap:8px}
body.dark .drawer .panel{background:#0f1a2b}
.drawer .item{display:flex;gap:.6rem;align-items:center;border:1px solid var(--line);border-radius:12px;padding:.6rem .7rem;background:var(--tint);cursor:pointer}
.drawer .muted{color:var(--muted);font-size:.85rem}
.drawer .item.admin-btn{display:none !important;}
.admin-on .drawer .item.admin-btn{display:flex !important;}

/* Main, views */
main{padding:12px 12px 76px;max-width:980px;margin:0 auto}
.view{display:none;animation:fade .15s ease-out}
.view.active{display:block}
@keyframes fade{from{opacity:.6;transform:translateY(4px)}to{opacity:1;transform:none}}

/* Home */
.hero{position:relative;border:1px solid var(--line);border-radius:18px;overflow:hidden;background:
  radial-gradient(120% 80% at 100% 0%,#b7e6ff 0%,#e6f6ff 50%,#ffffff 100%)}
body.dark .hero{background:radial-gradient(120% 80% at 100% 0%,#143356 0%,#0f2239 50%,#0b1220 100%)}
.hero-inner{display:flex;align-items:center;gap:14px;padding:16px}
.hero h2{margin:0;font-size:1.3rem}
.badge{display:none} /* Oculto por petici√≥n */
.tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:12px}
.tile{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:6px;
  align-items:flex-start;cursor:pointer;box-shadow:0 8px 24px rgba(14,165,233,.06)}
.tile .big{font-size:1.6rem}
.tile .muted{color:var(--muted);font-size:.86rem}
.tile:active{transform:scale(.98)}

.hscroll{display:flex;gap:10px;overflow:auto;padding-bottom:6px;scrollbar-gutter:stable both-edges}
.card{min-width:260px;flex:0 0 auto;background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px}
body.dark .card{background:#0f1a2b}
.card img{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;border:1px solid var(--line);background:#f2f6fb}
.card .title{font-weight:700;margin-top:6px}
.card .meta{font-size:.85rem;color:var(--muted)}
.row{display:flex;flex-wrap:wrap;gap:6px}

/* Buttons */
.btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:10px;padding:.46rem .66rem;cursor:pointer;font-weight:600;color:var(--ink)}
body.dark .btn{background:#0f1a2b}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
.btn.sm{padding:.32rem .5rem;font-size:.82rem}
.btn.ghost{background:transparent;border-color:var(--line);color:var(--muted)}
body.dark .btn.ghost{background:transparent}

/* Grids */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}

/* Chips */
.chip{border-radius:999px}

/* Accordions */
.acc{display:flex;flex-direction:column;gap:8px}
.acc-item{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#fff}
body.dark .acc-item{background:#0f1a2b}
.acc-h{display:flex;justify-content:space-between;align-items:center;padding:.7rem .8rem;cursor:pointer;background:var(--tint)}
.acc-b{display:none;padding:.8rem}
.acc-item.open .acc-b{display:block}

/* Bottom nav */
.navbar{position:fixed;left:0;right:0;bottom:0;z-index:25;background:#fff;border-top:1px solid var(--line);display:grid;grid-template-columns:repeat(4,1fr)}
body.dark .navbar{background:#0f1a2b}
.navbtn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 4px;border:none;background:transparent;cursor:pointer;font-size:.8rem;color:var(--muted)}
.navbtn.active{color:var(--brand-ink);font-weight:700}
.navbtn .ico{font-size:1.1rem}

/* Modal base */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:1000}
.modal{width:min(92vw,920px);max-height:88vh;overflow:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;
  background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.2)}
body.dark .modal{background:#0f1a2b}
.close{background:transparent;border:none;color:var(--muted);font-weight:700;cursor:pointer;font-size:1.6rem;line-height:1;padding:.25rem .5rem;border-radius:10px;float:right}
.close:active{transform:scale(.95)}
body.modal-open{overflow:hidden}

/* Inputs */
.input,.select,.textarea{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff}
.textarea{min-height:96px}

/* Weather (Mi estancia) */
.wx{border:1px solid var(--line);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,var(--wx2),var(--wx1));padding:12px}
.wx-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.wx-today{display:grid;grid-template-columns:80px 1fr;gap:10px;align-items:center;background:linear-gradient(180deg,var(--wx4),var(--wx2));border:1px solid var(--line);border-radius:14px;padding:10px}
.wx-ico{font-size:2.2rem}
.wx-deg{font-size:2rem;font-weight:800}
.wx-minmax{font-size:.9rem;color:var(--muted)}
.wx-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.wx-day{border:1px solid var(--line);border-radius:12px;padding:8px;text-align:center;background:linear-gradient(180deg,var(--wx2),var(--wx1))}
.wx-day .d{font-weight:700}
.wx-day .t{font-size:.9rem}

/* Pills */
.pill{display:inline-flex;gap:.35rem;align-items:center;border:1px solid var(--line);border-radius:999px;padding:.25rem .55rem;font-size:.85rem;background:#fff}
body.dark .pill{background:#0f1a2b}

/* Helper */
.muted{color:var(--muted)}
</style>
</head>
<body>

<!-- Topbar -->
<header class="topbar">
  <button id="menuBtn" class="burger" aria-label="Abrir men√∫">‚ò∞</button>
  <div class="brand">
    <img src="assets/logo.png" alt="Grupo A Cobijo" id="logoTap">
    <h1 id="t-app">Grupo A Cobijo</h1>
  </div>
  <div style="flex:1"></div>
  <button class="theme-btn" id="themeBtn" title="Tema" aria-label="Cambiar tema">üåô</button>
  <button class="lang-btn" id="langBtn" aria-haspopup="dialog">üåê ES</button>
</header>

<!-- Drawer -->
<div class="drawer" id="drawer">
  <div class="back" id="drawerBack"></div>
  <aside class="panel" role="menu" aria-label="Navegaci√≥n">
    <div class="item" data-nav="home">üè† <strong id="d-home">Inicio</strong></div>
    <div class="item" data-nav="stay">üß≥ <strong id="d-stay">Mi estancia</strong></div>
    <div class="item" data-nav="incidents">üÜò <strong id="d-inc">Incidencias</strong></div>
    <div class="item" data-nav="events">üìÖ <strong id="d-ev">Eventos</strong></div>
    <div class="item" data-nav="places">üèïÔ∏è <strong id="d-pl">Campings</strong></div>
    <div class="item" data-nav="schedules">üïí <strong id="d-sc">Horarios</strong></div>
    <div class="item" data-nav="musts">‚≠ê <strong id="d-musts">Imprescindibles</strong></div>
    <div class="item" data-nav="food">üçΩÔ∏è <strong id="d-food">Gastronom√≠a</strong></div>
    <div class="item" data-nav="precheck">üßæ <strong id="d-pre">Pre-checkin</strong></div>
    <div class="item" data-nav="favs">üåü <strong id="d-favs">Favoritos del equipo</strong></div>
    <div class="item" data-nav="suggestions">üí° <strong id="d-sug">Sugerencias</strong></div>
    <div class="item admin-btn" id="openAdmin">üõ†Ô∏è <strong>Admin</strong></div>
    <div class="muted" id="drawerHint">Elige secci√≥n</div>
  </aside>
</div>

<main>
  <!-- HOME -->
  <section id="view-home" class="view active">
    <div class="hero">
      <div class="hero-inner">
        <img src="assets/logo.png" alt="A Cobijo">
        <div>
          <h2 id="t-hello">¬°Bienvenido!</h2>
          <div class="badge" id="t-badge">PWA ¬∑ Offline ¬∑ Multidioma</div>
        </div>
      </div>
      <div class="tiles">
        <div class="tile" data-nav="events"><div class="big">üìÖ</div><div><strong id="t-ev">Eventos</strong><div class="muted" id="t-ev-sub">Qu√© hay hoy</div></div></div>
        <div class="tile" data-nav="stay"><div class="big">üß≥</div><div><strong id="t-stay">Mi estancia</strong><div class="muted" id="t-stay-sub">Contactos, clima, horarios</div></div></div>
        <div class="tile" data-nav="incidents"><div class="big">üÜò</div><div><strong id="t-inc">Incidencias</strong><div class="muted" id="t-inc-sub">WhatsApp/Email directos</div></div></div>
        <div class="tile" data-nav="musts"><div class="big">‚≠ê</div><div><strong id="t-musts">Imprescindibles</strong><div class="muted" id="t-musts-sub">Qu√© ver en Cantabria</div></div></div>
        <div class="tile" data-nav="food"><div class="big">üçΩÔ∏è</div><div><strong id="t-food">Gastronom√≠a</strong><div class="muted" id="t-food-sub">Sabores c√°ntabros</div></div></div>
        <div class="tile" data-nav="precheck"><div class="big">üßæ</div><div><strong id="t-pre">Pre-checkin</strong><div class="muted" id="t-pre-sub">Ahorra tiempo al llegar</div></div></div>
        <div class="tile" data-nav="favs"><div class="big">üåü</div><div><strong id="t-favs">Favoritos del equipo</strong><div class="muted" id="t-favs-sub">Recomendados por nosotros</div></div></div>
        <div class="tile" id="installTile"><div class="big">‚¨áÔ∏è</div><div><strong id="t-inst">Instalar</strong><div class="muted" id="t-inst-sub">A√±adir a inicio</div></div></div>
      </div>
    </div>

    <h3 style="margin:14px 4px 8px" id="t-next-events">Pr√≥ximos eventos</h3>
    <div id="homeEvents" class="hscroll"></div>
  </section>

  <!-- MI ESTANCIA -->
  <section id="view-stay" class="view">
    <h2 id="t-stay-title">Mi estancia</h2>
    <p class="muted" id="t-stay-hint">Guardamos tu elecci√≥n en este dispositivo.</p>

    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(240px,1fr))">
      <div>
        <label for="stayPlace" style="font-weight:700" id="t-stay-which">Selecciona tu alojamiento</label>
        <select id="stayPlace" class="select">
          <option value="oyambre">Oyambre</option>
          <option value="ramales">Ramales</option>
          <option value="ruiloba">Ruiloba</option>
          <option value="cardeo">El Cardeo</option>
        </select>
      </div>
      <div class="row" style="align-items:flex-end">
        <button id="stayWeb" class="btn">Web</button>
        <a id="stayCall" class="btn" target="_blank" rel="noopener">Llamar</a>
        <a id="stayWA" class="btn" target="_blank" rel="noopener">WhatsApp</a>
        <a id="stayEmail" class="btn" target="_blank" rel="noopener">Email</a>
        <a id="stayDir" class="btn" target="_blank" rel="noopener">C√≥mo llegar</a>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3 id="t-stay-hours">Horarios del alojamiento</h3>
      <div id="stayHours"></div>
    </div>

    <div class="wx" style="margin-top:12px" id="stayWeather">
      <div class="wx-h">
        <h3 id="t-weather-title" style="margin:0">Clima</h3>
        <div class="muted" id="wxPlaceLabel">‚Äî</div>
      </div>
      <div class="wx-today">
        <div class="wx-ico" id="wxIco">‚òÄÔ∏è</div>
        <div>
          <div class="wx-deg"><span id="wxNow">--</span>¬∞</div>
          <div class="wx-minmax"><span id="t-max">M√°x</span>: <span id="wxMax">--</span>¬∞ ¬∑ <span id="t-min">M√≠n</span>: <span id="wxMin">--</span>¬∞</div>
          <div class="muted" id="wxDesc">‚Äî</div>
        </div>
      </div>
      <div class="wx-3">
        <div class="wx-day"><div class="d" id="d1">‚Äî</div><div class="i" id="i1">‚òÄÔ∏è</div><div class="t" id="t1">--/--¬∞</div></div>
        <div class="wx-day"><div class="d" id="d2">‚Äî</div><div class="i" id="i2">‚òÄÔ∏è</div><div class="t" id="t2">--/--¬∞</div></div>
        <div class="wx-day"><div class="d" id="d3">‚Äî</div><div class="i" id="i3">‚òÄÔ∏è</div><div class="t" id="t3">--/--¬∞</div></div>
      </div>
    </div>
  </section>

  <!-- INCIDENCIAS -->
  <section id="view-incidents" class="view">
    <h2 id="i-title">Incidencias</h2>
    <p class="muted" id="i-hint">Se abre WhatsApp o tu app de correo con el mensaje preparado.</p>

    <div class="card" style="background:var(--tint)">
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
        <div>
          <label style="font-weight:700" for="incPlace" id="i-where">¬øEn qu√© alojamiento est√°s?</label>
          <select id="incPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700" for="incType" id="i-type">Tipo de incidencia</label>
          <select id="incType" class="select"></select>
        </div>
      </div>
      <div style="margin-top:10px">
        <label style="font-weight:700" for="incMsg" id="i-msg">Describe brevemente el problema</label>
        <textarea id="incMsg" class="textarea" placeholder="Ej.: Sin luz en la parcela 24, desde las 21:15..."></textarea>
      </div>
      <div class="row" style="margin-top:10px">
        <a id="incWA" class="btn primary" target="_blank" rel="noopener">WhatsApp</a>
        <a id="incEmail" class="btn" target="_blank" rel="noopener">Email</a>
      </div>
    </div>
  </section>

  <!-- EVENTOS -->
  <section id="view-events" class="view">
    <h2 id="t-events-title">Eventos</h2>
    <div class="row" style="gap:8px;margin:10px 0">
      <button class="btn chip on" data-filter="all" id="f-all">Todos</button>
      <button class="btn chip" data-filter="today" id="f-today">Hoy</button>
      <button class="btn chip" data-filter="tomorrow" id="f-tomorrow">Ma√±ana</button>
      <button class="btn chip" data-filter="week" id="f-week">Esta semana</button>
      <button class="btn chip" data-filter="fav" id="f-fav">Favoritos</button>
    </div>
    <div class="row" style="gap:8px;margin:6px 0">
      <button class="btn chip on" data-camp="all" id="c-all">Todos los campings</button>
      <button class="btn chip" data-camp="oyambre" id="c-oy">Oyambre</button>
      <button class="btn chip" data-camp="ramales" id="c-ra">Ramales</button>
      <button class="btn chip" data-camp="ruiloba" id="c-he">Ruiloba</button>
      <button class="btn chip" data-camp="cardeo" id="c-ca">El Cardeo</button>
    </div>
    <div id="eventsGrid" class="grid"></div>
    <p class="muted" id="eventsEmpty" style="display:none">Sin eventos por ahora.</p>
  </section>

  <!-- CAMPINGS -->
  <section id="view-places" class="view">
    <h2 id="t-campings-title">Nuestros campings</h2>
    <div class="grid">
      <article class="card" style="min-width:unset">
        <h3 id="t-oy-title">Camping Caravaning Playa de Oyambre</h3>
        <p class="muted" id="t-oy-hint">Todos los servicios ¬∑ Frente al mar</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.oyambre.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942711461">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre" target="_blank" rel="noopener">C√≥mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34675696212" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ra-title">Camping Ramales</h3>
        <p class="muted" id="t-ra-hint">Cuevas ¬∑ Monta√±a ¬∑ Actividades</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingramales.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34654463133">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Ramales" target="_blank" rel="noopener">C√≥mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34654463133" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-he-title">Camping El Helguero (Ruiloba)</h3>
        <p class="muted" id="t-he-hint">Naturaleza ¬∑ Familiar ¬∑ Mascotas</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingelhelguero.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942722124">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+El+Helguero" target="_blank" rel="noopener">C√≥mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34652806564" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ca-title">Apartamentos / Taberna El Cardeo</h3>
        <p class="muted" id="t-ca-hint">Apartamentos + Taberna</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.elcardeo.es" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34664686158">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6" target="_blank" rel="noopener">C√≥mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34664686158" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>
    </div>
  </section>

  <!-- HORARIOS -->
  <section id="view-schedules" class="view">
    <h2 id="t-schedules-title">Horarios</h2>
    <div class="acc" id="acc">
      <div class="acc-item"><div class="acc-h" data-acc="oyambre">Oyambre <span>‚ñº</span></div><div class="acc-b" id="acc-oyambre"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ramales">Ramales <span>‚ñº</span></div><div class="acc-b" id="acc-ramales"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ruiloba">Ruiloba <span>‚ñº</span></div><div class="acc-b" id="acc-ruiloba"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="cardeo">El Cardeo <span>‚ñº</span></div><div class="acc-b" id="acc-cardeo"></div></div>
    </div>
    <p class="muted" id="schedNote">Info orientativa. Pregunta en recepci√≥n para cambios de temporada. Los horarios pueden variar seg√∫n la fecha.</p>
  </section>

  <!-- IMPRESCINDIBLES -->
  <section id="view-musts" class="view">
    <h2 id="musts-title">Imprescindibles de Cantabria</h2>
    <p class="muted" id="musts-hint">Abre cada apartado para ver descripci√≥n, qu√© ver, mapa e im√°genes. Mostramos distancia desde tu ubicaci√≥n si la permites.</p>
    <div id="mustsAcc" class="acc"></div>
  </section>

  <!-- GASTRONOM√çA -->
  <section id="view-food" class="view">
    <h2 id="food-title">Gastronom√≠a c√°ntabra</h2>
    <p class="muted" id="food-hint">Productos t√≠picos y platos que deber√≠as probar.</p>
    <div id="foodAcc" class="acc"></div>
  </section>

  <!-- PRE-CHECKIN -->
  <section id="view-precheck" class="view">
    <h2 id="pre-title">Pre-checkin</h2>
    <p class="muted" id="pre-legal">‚ö†Ô∏è Seg√∫n la ley de viajeros espa√±ola, le solicitaremos en recepci√≥n a la llegada: <b>Documento Nacional de Identidad o Pasaporte v√°lido</b> de todos los viajeros <b>mayores de 14 a√±os</b>.</p>

    <div class="card" style="margin-top:8px">
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
        <div>
          <label style="font-weight:700" for="prePlace" id="pre-where">Alojamiento</label>
          <select id="prePlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div><label style="font-weight:700" for="preName">Nombre</label><input id="preName" class="input"></div>
        <div><label style="font-weight:700" for="preSurname">Apellidos</label><input id="preSurname" class="input"></div>
        <div><label style="font-weight:700" for="preDoc">DNI o Pasaporte</label><input id="preDoc" class="input"></div>
        <div><label style="font-weight:700" for="preBirth">Fecha nacimiento</label><input id="preBirth" class="input" type="date"></div>
        <div><label style="font-weight:700" for="prePlate">Matr√≠cula veh√≠culo</label><input id="prePlate" class="input" placeholder="1234-ABC"></div>
      </div>

      <div style="margin-top:10px">
        <label style="font-weight:700" for="preComp">Acompa√±antes (nombre, fecha nacimiento, documento)</label>
        <textarea id="preComp" class="textarea" placeholder="Ej.: Ana P√©rez ¬∑ 2008-06-12 ¬∑ DNI 00000000Z&#10;Luis L√≥pez ¬∑ 2010-02-03 ¬∑ Pasaporte X123..."></textarea>
      </div>

      <div class="row" style="margin-top:10px">
        <a id="preEmailBtn" class="btn primary" target="_blank" rel="noopener">‚úâÔ∏è Enviar</a>
        <button id="preClearBtn" class="btn ghost">üóëÔ∏è Vaciar</button>
      </div>
    </div>
  </section>

  <!-- FAVORITOS DEL EQUIPO -->
  <section id="view-favs" class="view">
    <h2 id="favs-title">Favoritos del equipo</h2>
    <p class="muted" id="favs-hint">Recomendaciones reales de nuestro equipo. Calculamos distancia desde tu ubicaci√≥n (si la autorizas). Los restaurantes pueden mostrar valoraci√≥n en vivo con Google Places si se configura.</p>
    <div id="favsAcc" class="acc"></div>
  </section>

</main>

<!-- Bottom nav -->
<nav class="navbar" role="navigation" aria-label="Pesta√±as">
  <button class="navbtn active" data-nav="home"><div class="ico">üè†</div><div id="n-home">Inicio</div></button>
  <button class="navbtn" data-nav="stay"><div class="ico">üß≥</div><div id="n-stay">Mi estancia</div></button>
  <button class="navbtn" data-nav="incidents"><div class="ico">üÜò</div><div id="n-inc">Incidencias</div></button>
  <button class="navbtn" data-nav="events"><div class="ico">üìÖ</div><div id="n-ev">Eventos</div></button>
</nav>

<!-- Admin modal -->
<div class="backdrop" id="adminModal" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
  <div class="modal">
    <button class="close" id="closeAdmin" aria-label="Cerrar">‚úï</button>
    <h3 id="adminTitle">Gesti√≥n interna</h3>

    <div class="card" style="margin-top:8px">
      <h4 style="margin:0 0 8px">A√±adir evento</h4>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
        <div><label>T√≠tulo (ES)</label><input id="evTitle" class="input" placeholder="Ej: Concierto ac√∫stico"></div>
        <div><label>Fecha y hora</label><input id="evDate" type="datetime-local" class="input"></div>
        <div><label>Alojamiento</label>
          <select id="evPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div><label>Lugar (ES)</label><input id="evLugar" class="input" placeholder="Ej: Camping Ramales"></div>
        <div><label>Imagen (URL)</label><input id="evImg" class="input" placeholder="https://..."></div>
        <div style="grid-column:1/-1"><label>Descripci√≥n (ES)</label><textarea id="evDesc" class="textarea" rows="3" placeholder="Ej: M√∫sica en directo."></textarea></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="addEventBtn" class="btn">Agregar</button>
        <button id="exportEventsBtn" class="btn">Descargar events.json</button>
        <label class="btn" for="importFile" style="cursor:pointer">Importar JSON</label>
        <input id="importFile" type="file" accept="application/json" style="display:none">
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4 style="margin:0 0 8px">Eventos actuales</h4>
      <div style="overflow:auto">
        <table class="table" id="eventsTable" style="width:100%;border-collapse:collapse">
          <thead><tr><th>ID</th><th>Fecha</th><th>Alojamiento</th><th>T√≠tulo</th><th>Acciones</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4>Gesti√≥n de horarios (schedules.json)</h4>
      <textarea id="schedJsonArea" class="textarea" rows="8" placeholder='Pegue aqu√≠ su schedules.json'></textarea>
      <div class="row" style="margin-top:10px">
        <button id="schedApplyBtn" class="btn">Aplicar</button>
        <button id="exportSchedBtn" class="btn">Descargar schedules.json</button>
        <label class="btn" for="importSchedFile" style="cursor:pointer">Importar JSON</label>
        <input id="importSchedFile" type="file" accept="application/json" style="display:none">
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4>Integraciones</h4>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
        <div><label>Google Maps API Key (opcional)</label><input id="gmapsKey" class="input" placeholder="AIza..."></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="saveIntegrations" class="btn">Guardar</button>
        <button id="reloadMaps" class="btn">Recargar Maps</button>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4>Contenido: Favoritos (JSON)</h4>
      <textarea id="favsJsonArea" class="textarea" rows="10" placeholder='Pegue aqu√≠ su JSON de favoritos'></textarea>
      <div class="row" style="margin-top:10px">
        <button id="favsApplyBtn" class="btn">Aplicar</button>
        <button id="exportFavsBtn" class="btn">Descargar favoritos.json</button>
        <label class="btn" for="importFavsFile" style="cursor:pointer">Importar JSON</label>
        <input id="importFavsFile" type="file" accept="application/json" style="display:none">
      </div>
      <p class="muted" style="margin-top:6px">Consejo: puedes a√±adir <code>"placeId":"XXXX"</code> a cada restaurante para ratings en vivo precisos.</p>
    </div>

    <div class="card" style="margin-top:12px">
      <h4>Config GitHub</h4>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
        <div><label>Repositorio</label><input id="ghRepo" class="input" placeholder="owner/repo"></div>
        <div><label>Branch</label><input id="ghBranch" class="input" placeholder="main" value="main"></div>
        <div style="grid-column:1/-1"><label>Token (se guarda en este dispositivo)</label><input id="ghToken" class="input" placeholder="github_pat_..." autocomplete="off"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="saveGhCfg" class="btn">Guardar configuraci√≥n</button>
        <button id="pushEventsBtn" class="btn">üíæ Subir events.json</button>
        <button id="pushSchedBtn" class="btn">üíæ Subir schedules.json</button>
      </div>
    </div>
  </div>
</div>

<!-- Idiomas -->
<div class="backdrop" id="langModal">
  <div class="modal">
    <button id="closeLang" class="close" aria-label="Cerrar">‚úï</button>
    <h3 id="langTitle">Selecciona idioma</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px">
      <button class="btn lang-option" data-lang="es">üá™üá∏ Espa√±ol</button>
      <button class="btn lang-option" data-lang="en">üá¨üáß English</button>
      <button class="btn lang-option" data-lang="fr">üá´üá∑ Fran√ßais</button>
      <button class="btn lang-option" data-lang="de">üá©üá™ Deutsch</button>
      <button class="btn lang-option" data-lang="nl">üá≥üá± Nederlands</button>
    </div>
  </div>
</div>

<!-- Modal instalar -->
<div class="backdrop" id="installModal">
  <div class="modal">
    <button id="closeInstall" class="close" aria-label="Cerrar">‚úï</button>
    <h3 id="instTitle">Instalar app</h3>
    <div id="instBody"></div>
    <div class="row" style="margin-top:10px">
      <button id="instNow" class="btn primary">Instalar ahora</button>
    </div>
  </div>
</div>

<!-- JSZip (opcional) -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function(){

  /* ===== Estado admin + PIN ===== */
  localStorage.setItem('admin','0');
  document.body.classList.remove('admin-on');
  if(!localStorage.getItem('admin_pin')){ localStorage.setItem('admin_pin','311974'); }

  /* ===== Utils ===== */
  function $(sel){return document.querySelector(sel);}
  function $all(sel,scope){ return Array.prototype.slice.call((scope||document).querySelectorAll(sel)); }
  function on(el,ev,fn){ if(el) el.addEventListener(ev,fn); }
  function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
  function safeUrl(u){var s=String(u||'').trim(); return (/^https?:\/\//i.test(s) || /^\/|^\.\.?\//.test(s) || /^data:image\//i.test(s)) ? s.replace(/"/g,'%22') : ''; }
  function pad2(n){return ('0'+n).slice(-2);}
  function km(d){ return (d>=1)? (d.toFixed(1)+' km') : Math.round(d*1000)+' m'; }
  function haversine(a,b){ // a,b = {lat,lon}
    var R=6371, dLat=(b.lat-a.lat)*Math.PI/180, dLon=(b.lon-a.lon)*Math.PI/180;
    var sa=Math.sin(dLat/2), sb=Math.sin(dLon/2);
    var A=sa*sa+Math.cos(a.lat*Math.PI/180)*Math.cos(b.lat*Math.PI/180)*sb*sb;
    return 2*R*Math.asin(Math.sqrt(A));
  }
  function distanceFromUserTo(coords){ if(!coords || !GEO) return null; return haversine({lat:GEO.lat,lon:GEO.lon}, coords); }

  /* ===== Tema ===== */
  function detectTheme(){ var s=localStorage.getItem('theme'); if(s) return s; try{ if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark'; }catch(e){} return 'light'; }
  function applyTheme(m){ document.body.classList.toggle('dark', m==='dark'); var b=$('#themeBtn'); if(b) b.textContent=m==='dark'?'‚òÄÔ∏è':'üåô'; localStorage.setItem('theme',m); var meta=document.querySelector('meta[name="theme-color"]'); if(meta) meta.setAttribute('content', m==='dark' ? '#0b1220' : '#0ea5e9');}
  var THEME=detectTheme(); applyTheme(THEME);
  on($('#themeBtn'),'click', function(){ THEME=(THEME==='dark')?'light':'dark'; applyTheme(THEME); });

  /* ===== I18N ===== */
  var I18N = {
    es:{app:"Grupo A Cobijo",hello:"¬°Bienvenido!",badge:"PWA ¬∑ Offline ¬∑ Multidioma",
        ev:"Eventos", evSub:"Qu√© hay hoy",
        pl:"Campings", plSub:"Accesos r√°pidos",
        sc:"Horarios", scSub:"Recepci√≥n ¬∑ bar",
        inst:"Instalar", instSub:"A√±adir a inicio",
        eventsTitle:"Eventos", schedulesTitle:"Horarios", campingsTitle:"Nuestros campings",
        fAll:"Todos", fToday:"Hoy", fTomorrow:"Ma√±ana", fWeek:"Esta semana", fFav:"Favoritos",
        cAll:"Todos los campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Web", call:"Llamar", directions:"C√≥mo llegar", whatsapp:"WhatsApp", email:"Email",
        addCal:"A√±adir al calendario", fav:"Favorito",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Todos los servicios ¬∑ Frente al mar",
        raTitle:"Camping Ramales", raHint:"Cuevas ¬∑ Monta√±a ¬∑ Actividades",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Naturaleza ¬∑ Familiar ¬∑ Mascotas",
        caTitle:"Apartamentos / Taberna El Cardeo", caHint:"Apartamentos + Taberna",
        schedNote:"Info orientativa. Pregunta en recepci√≥n para cambios de temporada. Los horarios pueden variar seg√∫n la fecha.",
        nHome:"Inicio", nEv:"Eventos", nPl:"Campings", nSc:"Horarios",
        dHome:"Inicio", dStay:"Mi estancia", dInc:"Incidencias", dEv:"Eventos", dPl:"Campings", dSc:"Horarios",
        nextEvents:"Pr√≥ximos eventos",
        stay:"Mi estancia", staySub:"Contactos, clima, horarios",
        stayTitle:"Mi estancia", stayHint:"Guardamos tu elecci√≥n en este dispositivo.", stayWhich:"Selecciona tu alojamiento",
        stayHours:"Horarios del alojamiento",
        weatherTitle:"Clima", max:"M√°x", min:"M√≠n",
        incTitle:"Incidencias", incWhere:"¬øEn qu√© alojamiento est√°s?",
        incHint:"Se abre WhatsApp o tu app de correo con el mensaje preparado.",
        incType:"Tipo de incidencia", incMsg:"Describe brevemente el problema",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        // Incidencias opciones
        incTypes:[
          {key:'electricity', label:"Electricidad"},
          {key:'water', label:"Agua"},
          {key:'cleaning', label:"Limpieza"},
          {key:'noise', label:"Ruido"},
          {key:'other', label:"Otros"}
        ],
        // Musts / Food
        mustsTitle:"Imprescindibles de Cantabria", mustsHint:"Abre cada apartado para ver descripci√≥n, qu√© ver, mapa e im√°genes.",
        see:"Qu√© ver", images:"Im√°genes", map:"Mapa", tickets:"Entradas", more:"M√°s info", distance:"Distancia",
        foodTitle:"Gastronom√≠a c√°ntabra", foodHint:"Productos y platos t√≠picos que deber√≠as probar.",
        // Precheck
        pre:"Pre-checkin", preSub:"Ahorra tiempo al llegar",
        preTitle:"Pre-checkin",
        preLegal:"‚ö†Ô∏è Seg√∫n la ley de viajeros espa√±ola, le solicitaremos en recepci√≥n a la llegada: Documento Nacional de Identidad o Pasaporte v√°lido de todos los viajeros mayores de 14 a√±os.",
        preWhere:"Alojamiento",
        // Favs
        favs:"Favoritos del equipo", favsSub:"Recomendados por nosotros",
        favsTitle:"Favoritos del equipo", favsHint:"Recomendaciones reales del equipo. Si autorizas ubicaci√≥n, mostramos distancia.",
        // Suggestions
        sugTitle:"Buz√≥n de sugerencias", sugHint:"Tu opini√≥n nos ayuda a mejorar. Puedes enviarlo por email o WhatsApp. Guardamos un historial en este dispositivo.",
        sugWhere:"Alojamiento", sugName:"Nombre (opcional)", sugEmail:"Email (opcional)", sugPhone:"Tel√©fono (opcional)",
        sugType:"Tema", sugMsg:"Mensaje", sugHistory:"Tus env√≠os",
        sug:"Sugerencias", sugSub:"Cu√©ntanos c√≥mo mejorar"
    },
    en:{app:"Grupo A Cobijo",hello:"Welcome!",badge:"PWA ¬∑ Offline ¬∑ Multilingual",
        ev:"Events", evSub:"What's on today",
        pl:"Campsites", plSub:"Quick access",
        sc:"Schedules", scSub:"Reception ¬∑ bar",
        inst:"Install", instSub:"Add to Home",
        eventsTitle:"Events", schedulesTitle:"Schedules", campingsTitle:"Our campsites",
        fAll:"All", fToday:"Today", fTomorrow:"Tomorrow", fWeek:"This week", fFav:"Favorites",
        cAll:"All campsites", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Website", call:"Call", directions:"Directions", whatsapp:"WhatsApp", email:"Email",
        addCal:"Add to calendar", fav:"Favorite",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"All services ¬∑ By the sea",
        raTitle:"Camping Ramales", raHint:"Caves ¬∑ Mountains ¬∑ Activities",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature ¬∑ Family ¬∑ Pets",
        caTitle:"El Cardeo Apartments / Tavern", caHint:"Apartments + Tavern",
        schedNote:"Indicative info. Check reception for seasonal changes. Opening hours may vary by date.",
        nHome:"Home", nEv:"Events", nPl:"Camps", nSc:"Schedules",
        dHome:"Home", dStay:"My stay", dInc:"Issues", dEv:"Events", dPl:"Camps", dSc:"Schedules",
        nextEvents:"Upcoming events",
        stay:"My stay", staySub:"Contacts, weather, schedules",
        stayTitle:"My stay", stayHint:"We store your choice on this device.", stayWhich:"Choose your accommodation",
        stayHours:"Accommodation opening hours",
        weatherTitle:"Weather", max:"Max", min:"Min",
        incTitle:"Issues", incWhere:"Which accommodation are you in?",
        incHint:"We open WhatsApp or your email app with a prefilled message.",
        incType:"Issue type", incMsg:"Briefly describe the problem",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        mustsTitle:"Cantabria essentials", mustsHint:"Open each to see description, highlights, map and images.",
        see:"Highlights", images:"Images", map:"Map", tickets:"Tickets", more:"More info", distance:"Distance",
        foodTitle:"Cantabrian gastronomy", foodHint:"Typical products and dishes to try.",
        pre:"Pre-checkin", preSub:"Save time on arrival",
        preTitle:"Pre-checkin",
        preLegal:"‚ö†Ô∏è Under Spanish traveller regulations, we will request a valid ID or Passport at reception for all guests over 14.",
        preWhere:"Accommodation",
        favs:"Team favorites", favsSub:"Recommended by us",
        favsTitle:"Team favorites", favsHint:"Real staff picks. If you allow location, we show distance.",
        sugTitle:"Suggestion box", sugHint:"Your feedback helps us improve. Send by email or WhatsApp. History is stored locally.",
        sugWhere:"Accommodation", sugName:"Name (optional)", sugEmail:"Email (optional)", sugPhone:"Phone (optional)",
        sugType:"Topic", sugMsg:"Message", sugHistory:"Your submissions",
        sug:"Suggestions", sugSub:"Tell us how to improve"
    },
    fr:{app:"Grupo A Cobijo",hello:"Bienvenue !",badge:"PWA ¬∑ Hors ligne ¬∑ Multilingue",
        ev:"√âv√©nements", evSub:"Aujourd‚Äôhui",
        pl:"Campings", plSub:"Acc√®s rapide",
        sc:"Horaires", scSub:"R√©ception ¬∑ bar",
        inst:"Installer", instSub:"Ajouter √† l‚Äô√©cran d‚Äôaccueil",
        eventsTitle:"√âv√©nements", schedulesTitle:"Horaires", campingsTitle:"Nos campings",
        fAll:"Tous", fToday:"Aujourd‚Äôhui", fTomorrow:"Demain", fWeek:"Cette semaine", fFav:"Favoris",
        cAll:"Tous les campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Site web", call:"Appeler", directions:"Itin√©raire", whatsapp:"WhatsApp", email:"Email",
        addCal:"Ajouter au calendrier", fav:"Favori",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Tous les services ¬∑ Face √† la mer",
        raTitle:"Camping Ramales", raHint:"Grottes ¬∑ Montagne ¬∑ Activit√©s",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature ¬∑ Familial ¬∑ Animaux",
        caTitle:"Appartements / Taverne El Cardeo", caHint:"Appartements + Taverne",
        schedNote:"Infos indicatives. V√©rifiez √† la r√©ception. Les horaires peuvent varier selon la date.",
        nHome:"Accueil", nEv:"√âv√©n.", nPl:"Campings", nSc:"Horaires",
        dHome:"Accueil", dStay:"Mon s√©jour", dInc:"Incidents", dEv:"√âv√©nements", dPl:"Campings", dSc:"Horaires",
        nextEvents:"√âv√©nements √† venir",
        stay:"Mon s√©jour", staySub:"Contacts, m√©t√©o, horaires",
        stayTitle:"Mon s√©jour", stayHint:"Nous enregistrons votre choix sur cet appareil.", stayWhich:"Choisissez votre h√©bergement",
        stayHours:"Horaires de l‚Äôh√©bergement",
        weatherTitle:"M√©t√©o", max:"Max", min:"Min",
        incTitle:"Incidents", incWhere:"Dans quel √©tablissement √™tes-vous ?",
        incHint:"On ouvre WhatsApp ou votre app email avec un message pr√©rempli.",
        incType:"Type de probl√®me", incMsg:"D√©crivez bri√®vement le probl√®me",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        mustsTitle:"Incontournables de Cantabrie", mustsHint:"Ouvrez chaque section : description, lieux, carte et images.",
        see:"√Ä voir", images:"Images", map:"Carte", tickets:"Billets", more:"Plus d‚Äôinfos", distance:"Distance",
        foodTitle:"Gastronomie cantabrique", foodHint:"Produits et plats typiques √† go√ªter.",
        pre:"Pr√©-checkin", preSub:"Gagnez du temps √† l‚Äôarriv√©e",
        preTitle:"Pr√©-checkin",
        preLegal:"‚ö†Ô∏è Conform√©ment √† la loi espagnole, nous demanderons √† la r√©ception une pi√®ce d‚Äôidentit√© ou un passeport valide pour tous les voyageurs de plus de 14 ans.",
        preWhere:"H√©bergement",
        favs:"Coup de c≈ìur de l‚Äô√©quipe", favsSub:"Recommand√© par nous",
        favsTitle:"Coup de c≈ìur de l‚Äô√©quipe", favsHint:"Nos vraies recommandations. Distance affich√©e si vous autorisez la localisation.",
        sugTitle:"Bo√Æte √† id√©es", sugHint:"Vos avis nous aident √† am√©liorer. Envoi par email ou WhatsApp. Historique local.",
        sugWhere:"H√©bergement", sugName:"Nom (optionnel)", sugEmail:"Email (optionnel)", sugPhone:"T√©l√©phone (optionnel)",
        sugType:"Sujet", sugMsg:"Message", sugHistory:"Vos envois",
        sug:"Suggestions", sugSub:"Dites-nous comment am√©liorer"
    },
    de:{app:"Grupo A Cobijo",hello:"Willkommen!",badge:"PWA ¬∑ Offline ¬∑ Mehrsprachig",
        ev:"Events", evSub:"Heute",
        pl:"Campingpl√§tze", plSub:"Schnellzugriff",
        sc:"Zeiten", scSub:"Rezeption ¬∑ Bar",
        inst:"Installieren", instSub:"Zum Startbildschirm",
        eventsTitle:"Veranstaltungen", schedulesTitle:"√ñffnungszeiten", campingsTitle:"Unsere Campingpl√§tze",
        fAll:"Alle", fToday:"Heute", fTomorrow:"Morgen", fWeek:"Diese Woche", fFav:"Favoriten",
        cAll:"Alle Campingpl√§tze", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Website", call:"Anrufen", directions:"Route", whatsapp:"WhatsApp", email:"E-Mail",
        addCal:"Zum Kalender hinzuf√ºgen", fav:"Favorit",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle Services ¬∑ Am Meer",
        raTitle:"Camping Ramales", raHint:"H√∂hlen ¬∑ Berge ¬∑ Aktivit√§ten",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natur ¬∑ Familie ¬∑ Haustiere",
        caTitle:"Apartments / Taverne El Cardeo", caHint:"Apartments + Taverne",
        schedNote:"Unverbindliche Infos. √Ñnderungen m√∂glich ‚Äì bitte an der Rezeption nachfragen.",
        nHome:"Start", nEv:"Events", nPl:"Camping", nSc:"Zeiten",
        dHome:"Start", dStay:"Mein Aufenthalt", dInc:"St√∂rungen", dEv:"Events", dPl:"Camping", dSc:"Zeiten",
        nextEvents:"Kommende Events",
        stay:"Mein Aufenthalt", staySub:"Kontakte, Wetter, Zeiten",
        stayTitle:"Mein Aufenthalt", stayHint:"Wir speichern die Auswahl lokal.", stayWhich:"Unterkunft w√§hlen",
        stayHours:"√ñffnungszeiten der Unterkunft",
        weatherTitle:"Wetter", max:"Max", min:"Min",
        incTitle:"St√∂rungen", incWhere:"Welche Unterkunft?",
        incHint:"Wir √∂ffnen WhatsApp oder deine E-Mail-App mit vorbef√ºllter Nachricht.",
        incType:"St√∂rungstyp", incMsg:"Problem kurz beschreiben",
        incBtnWA:"WhatsApp", incBtnEmail:"E-Mail",
        mustsTitle:"Cantabria-Highlights", mustsHint:"Aufklappen f√ºr Beschreibung, Highlights, Karte und Bilder.",
        see:"Sehenswert", images:"Bilder", map:"Karte", tickets:"Tickets", more:"Mehr Infos", distance:"Entfernung",
        foodTitle:"Kantabrische K√ºche", foodHint:"Typische Produkte und Gerichte.",
        pre:"Pre-Check-in", preSub:"Zeit sparen bei Ankunft",
        preTitle:"Pre-Check-in",
        preLegal:"‚ö†Ô∏è Gem√§√ü span. Reiserecht ben√∂tigen wir an der Rezeption einen g√ºltigen Ausweis/Pass f√ºr alle G√§ste √ºber 14.",
        preWhere:"Unterkunft",
        favs:"Favoriten des Teams", favsSub:"Von uns empfohlen",
        favsTitle:"Favoriten des Teams", favsHint:"Echte Tipps unseres Teams. Entfernung wird mit Standortfreigabe angezeigt.",
        sugTitle:"Vorschlagsbox", sugHint:"Ihr Feedback hilft uns. Versand per E-Mail oder WhatsApp. Lokal gespeichert.",
        sugWhere:"Unterkunft", sugName:"Name (optional)", sugEmail:"E-Mail (optional)", sugPhone:"Telefon (optional)",
        sugType:"Thema", sugMsg:"Nachricht", sugHistory:"Ihre Einsendungen",
        sug:"Vorschl√§ge", sugSub:"Sagen Sie uns, wie wir besser werden"
    },
    nl:{app:"Grupo A Cobijo",hello:"Welkom!",badge:"PWA ¬∑ Offline ¬∑ Meertalig",
        ev:"Evenementen", evSub:"Vandaag",
        pl:"Campings", plSub:"Snelle toegang",
        sc:"Openingstijden", scSub:"Receptie ¬∑ bar",
        inst:"Installeren", instSub:"Toevoegen aan beginscherm",
        eventsTitle:"Evenementen", schedulesTitle:"Openingstijden", campingsTitle:"Onze campings",
        fAll:"Alles", fToday:"Vandaag", fTomorrow:"Morgen", fWeek:"Deze week", fFav:"Favorieten",
        cAll:"Alle campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Website", call:"Bellen", directions:"Route", whatsapp:"WhatsApp", email:"E-mail",
        addCal:"Aan agenda toevoegen", fav:"Favoriet",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle services ¬∑ Aan zee",
        raTitle:"Camping Ramales", raHint:"Grotten ¬∑ Bergen ¬∑ Activiteiten",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natuur ¬∑ Familie ¬∑ Huisdieren",
        caTitle:"El Cardeo Appartementen / Taverne", caHint:"Appartementen + Taverne",
        schedNote:"Indicatieve info. Tijden kunnen per datum verschillen.",
        nHome:"Start", nEv:"Even.", nPl:"Campings", nSc:"Tijden",
        dHome:"Start", dStay:"Mijn verblijf", dInc:"Incidenten", dEv:"Evenementen", dPl:"Campings", dSc:"Tijden",
        nextEvents:"Aankomende evenementen",
        stay:"Mijn verblijf", staySub:"Contacten, weer, tijden",
        stayTitle:"Mijn verblijf", stayHint:"We slaan je keuze lokaal op.", stayWhich:"Kies je accommodatie",
        stayHours:"Openingstijden van de accommodatie",
        weatherTitle:"Weer", max:"Max", min:"Min",
        incTitle:"Incidenten", incWhere:"In welke accommodatie ben je?",
        incHint:"We openen WhatsApp of je e-mailapp met een bericht.",
        incType:"Type incident", incMsg:"Beschrijf kort het probleem",
        incBtnWA:"WhatsApp", incBtnEmail:"E-mail",
        mustsTitle:"Must-sees in Cantabri√´", mustsHint:"Open elke sectie: beschrijving, wat te zien, kaart en beelden.",
        see:"Wat te zien", images:"Beelden", map:"Kaart", tickets:"Tickets", more:"Meer info", distance:"Afstand",
        foodTitle:"Cantabrische gastronomie", foodHint:"Typische producten en gerechten.",
        pre:"Pre-check-in", preSub:"Bespaart tijd bij aankomst",
        preTitle:"Pre-check-in",
        preLegal:"‚ö†Ô∏è Volgens Spaanse regelgeving vragen we bij aankomst een geldig ID of paspoort voor alle gasten ouder dan 14.",
        preWhere:"Accommodatie",
        favs:"Favorieten van ons team", favsSub:"Door ons aanbevolen",
        favsTitle:"Favorieten van ons team", favsHint:"Echte tips van het team. Afstand wordt getoond met locatie-toestemming.",
        sugTitle:"Suggestiedoos", sugHint:"Jouw feedback helpt ons. Verstuur per e-mail of WhatsApp. Lokaal opgeslagen.",
        sugWhere:"Accommodatie", sugName:"Naam (optioneel)", sugEmail:"E-mail (optioneel)", sugPhone:"Telefoon (optioneel)",
        sugType:"Onderwerp", sugMsg:"Bericht", sugHistory:"Je inzendingen",
        sug:"Suggesties", sugSub:"Vertel ons hoe we verbeteren"
    }
  };

  function detectLang(){ var s=localStorage.getItem('lang'); if(s) return s; var n=(navigator.language||'es').slice(0,2).toLowerCase(); return I18N[n]?n:'es'; }
  var LANG = detectLang();
  function t(id,v){ var el=document.getElementById(id); if(el) el.textContent=v; }
  function applyLang(){
    var T=I18N[LANG];
    t("t-app",T.app); t("t-hello",T.hello); t("t-badge",T.badge);
    t("t-ev",T.ev); t("t-ev-sub",T.evSub);
    t("t-pl",T.pl); t("t-pl-sub",T.plSub);
    t("t-sc",T.sc); t("t-sc-sub",T.scSub);
    t("t-inst",T.inst); t("t-inst-sub",T.instSub);
    t("t-events-title",T.eventsTitle); t("t-schedules-title",T.schedulesTitle); t("t-campings-title",T.campingsTitle);
    t("f-all",T.fAll); t("f-today",T.fToday); t("f-tomorrow",T.fTomorrow); t("f-week",T.fWeek); var ff=document.getElementById('f-fav'); if(ff) ff.textContent=T.fFav;
    t("c-all",T.cAll); t("c-oy",T.cOy); t("c-ra",T.cRa); t("c-he",T.cHe); t("c-ca",T.cCa);
    t("t-oy-title",T.oyTitle); t("t-oy-hint",T.oyHint); t("t-ra-title",T.raTitle); t("t-ra-hint",T.raHint);
    t("t-he-title",T.heTitle); t("t-he-hint",T.heHint); t("t-ca-title",T.caTitle); t("t-ca-hint",T.caHint);
    t("schedNote",T.schedNote); t("n-home",T.nHome||'Inicio'); t("n-ev",T.nEv||'Eventos');
    // Drawer + home extras
    t("d-home",T.dHome||'Inicio'); t("d-stay",T.dStay||'Mi estancia'); t("d-inc",T.dInc||'Incidencias'); t("d-ev",T.dEv||'Eventos'); t("d-pl",T.dPl||'Campings'); t("d-sc",T.dSc||'Horarios'); t("drawerHint",T.drawerHint||'Elige secci√≥n');
    t("t-stay",T.stay); t("t-stay-sub",T.staySub); t("t-musts",T.mustsTitle); t("t-musts-sub",T.mustsHint); t("t-food",T.foodTitle); t("t-food-sub",T.foodHint);
    // Precheck & favs & sug
    t("t-pre",T.pre); t("t-pre-sub",T.preSub); t("d-pre",T.pre||'Pre-checkin'); t("pre-title",T.preTitle||'Pre-checkin'); t("pre-where",T.preWhere||'Alojamiento'); t("pre-legal",T.preLegal||'');
    t("t-favs",T.favs); t("t-favs-sub",T.favsSub); t("d-favs",T.favs||'Favoritos del equipo'); t("favs-title",T.favsTitle||'Favoritos del equipo'); t("favs-hint",T.favsHint||'');
    t("d-sug", T.sug||"Sugerencias"); t("t-sug", T.sug||"Sugerencias"); t("t-sug-sub", T.sugSub||"Cu√©ntanos c√≥mo mejorar");
    t("sug-title", T.sugTitle||"Buz√≥n de sugerencias"); t("sug-hint",T.sugHint||""); t("sug-where",T.sugWhere||"Alojamiento"); t("sug-name",T.sugName||"Nombre (opcional)"); t("sug-email",T.sugEmail||"Email (opcional)"); t("sug-phone",T.sugPhone||"Tel√©fono (opcional)"); t("sug-type",T.sugType||"Tema"); t("sug-msg",T.sugMsg||"Mensaje"); t("sug-history",T.sugHistory||"Tus env√≠os");
    // Musts & Food titles
    t("musts-title",T.mustsTitle); t("musts-hint",T.mustsHint);
    t("food-title",T.foodTitle); t("food-hint",T.foodHint);
    fillIncTypes(); // reconstruye el select traducido
  }
  applyLang();

  on($('#langBtn'),'click', function(){ $('#langModal').style.display='flex'; });
  on($('#closeLang'),'click', function(e){ e.preventDefault(); $('#langModal').style.display='none'; });
  $all('.lang-option').forEach(function(b){
    on(b,'click', function(){ LANG=b.getAttribute('data-lang'); localStorage.setItem('lang',LANG); applyLang(); renderAcc(); loadEvents(); updateStayUI(); updateIncUI(); renderMusts(); renderFood(); renderFavs(); $('#langModal').style.display='none'; });
  });

  /* ===== Navegaci√≥n ===== */
  function showView(id){
    $all('.view').forEach(v=>v.classList.remove('active'));
    var target=document.getElementById('view-'+id); if(target) target.classList.add('active');
    $all('.navbtn').forEach(b=>b.classList.toggle('active', b.getAttribute('data-nav')===id));
    $('#drawer').classList.remove('open');
  }
  $all('[data-nav]').forEach(el=>on(el,'click', function(){ showView(el.getAttribute('data-nav')); }));
  on($('#menuBtn'),'click', function(){ $('#drawer').classList.add('open'); });
  on($('#drawerBack'),'click', function(){ $('#drawer').classList.remove('open'); });

  /* ===== Datos comunes ===== */
  var PLACE_LINK={oyambre:"https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre",ramales:"https://maps.google.com/?q=Camping+Ramales",ruiloba:"https://maps.google.com/?q=Camping+El+Helguero",cardeo:"https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6"};
  var PLACE_LABEL={oyambre:"Oyambre",ramales:"Ramales",ruiloba:"Ruiloba",cardeo:"El Cardeo"};
  var WHATSAPP={oyambre:"34675696212",ramales:"34654463133",ruiloba:"34652806564",cardeo:"34664686158"};
  var PHONES={oyambre:"+34942711461",ramales:"+34654463133",ruiloba:"+34942722124",cardeo:"+34664686158"};
  var WEB={oyambre:"https://www.oyambre.com",ramales:"https://www.campingramales.com",ruiloba:"https://www.campingelhelguero.com",cardeo:"https://www.elcardeo.es"};
  var EMAILS={oyambre:"camping@oyambre.com",ramales:"info@campingramales.com",ruiloba:"info@campingelhelguero.com",cardeo:"info@elcardeo.es"};

  /* ===== Eventos (+ Favoritos + .ics) ===== */
  var EVENTS=[], DATE_FILTER='all', CAMP_FILTER='all';
  var FAV_SET = new Set(JSON.parse(localStorage.getItem('fav_events')||'[]'));
  function saveFavs(){ localStorage.setItem('fav_events', JSON.stringify(Array.from(FAV_SET))); }
  function isFav(id){ return FAV_SET.has(id); }
  function toggleFav(id){ if(FAV_SET.has(id)) FAV_SET.delete(id); else FAV_SET.add(id); saveFavs(); renderHomeSlider(); renderEventsGrid(); }

  function whenFmt(d){ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short',day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'}).format(new Date(d)); }catch(e){ return d; } }
  function categoryFor(dateStr){
    var d=new Date(dateStr), now=new Date();
    var startToday=new Date(now.getFullYear(),now.getMonth(),now.getDate());
    var startTomorrow=new Date(startToday); startTomorrow.setDate(startToday.getDate()+1);
    var endOfWeek=new Date(startToday); endOfWeek.setDate(startToday.getDate()+(7-startToday.getDay()));
    if(d>=startToday && d<startTomorrow) return 'today';
    if(d>=startTomorrow && d< new Date(startTomorrow.getFullYear(),startTomorrow.getMonth(),startTomorrow.getDate()+1)) return 'tomorrow';
    if(d>=startToday && d<endOfWeek) return 'week';
    return 'all';
  }
  function i18nField(v){return typeof v==="string"?v:((v&&v[LANG])|| (v&&v.es) || "");}
  function waLink(camping,message){var n=WHATSAPP[String(camping||'').toLowerCase()]; return n?('https://wa.me/'+n+'?text='+encodeURIComponent(message||'')):null;}

  // ICS helpers
  function dtToICS(dt){ var d=new Date(dt);
    return d.getUTCFullYear()+pad2(d.getUTCMonth()+1)+pad2(d.getUTCDate())+'T'+pad2(d.getUTCHours())+pad2(d.getUTCMinutes())+pad2(d.getUTCSeconds())+'Z';
  }
  function icsEscape(s){ return String(s||'').replace(/\\/g,'\\\\').replace(/;/g,'\\;').replace(/,/g,'\\,').replace(/\n/g,'\\n'); }
  function downloadICS(ev){
    try{
      var title=i18nField(ev.titulo)||'Evento';
      var desc=i18nField(ev.descripcion)||'';
      var loc=i18nField(ev.lugar)|| (PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'');
      var start=new Date(ev.fecha);
      var end=new Date(start.getTime()+90*60000);
      var uid=(ev.id||('ev-'+Date.now()))+'@acobijo.app';
      var now=new Date();
      var ics = ['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Grupo A Cobijo//Customer App//ES','CALSCALE:GREGORIAN','METHOD:PUBLISH','BEGIN:VEVENT',
        'UID:'+icsEscape(uid),'DTSTAMP:'+dtToICS(now),'DTSTART:'+dtToICS(start),'DTEND:'+dtToICS(end),
        'SUMMARY:'+icsEscape(title),'DESCRIPTION:'+icsEscape(desc),'LOCATION:'+icsEscape(loc),'END:VEVENT','END:VCALENDAR'].join('\r\n');
      var blob=new Blob([ics],{type:'text/calendar;charset=utf-8'});
      var a=document.createElement('a'); a.href=URL.createObjectURL(blob);
      var fname=('evento-'+(ev.id||'acobijo')+'.ics').replace(/[^a-z0-9._-]+/gi,'_');
      a.download=fname; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
    }catch(e){ alert('No se pudo generar el calendario.'); }
  }

  // HOME slider
  function renderHomeSlider(){
    var wrap=$('#homeEvents'); if(!wrap) return;
    var next=EVENTS.slice().sort((a,b)=>new Date(a.fecha)-new Date(b.fecha)).slice(0,6);
    if(!next.length){ wrap.innerHTML='<div class="muted">'+I18N[LANG].nextEvents+': ‚Äî</div>'; return; }
    wrap.innerHTML = next.map(function(ev){
      var rawTitle=i18nField(ev.titulo)||'(sin t√≠tulo)';
      var rawPlace=i18nField(ev.lugar)||PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'';
      var title=esc(rawTitle), place=esc(rawPlace);
      var img=safeUrl(ev.imagen||ev.image||'');
      var wa=waLink(ev.camping,'Hola, consulta sobre ‚Äú'+rawTitle+'‚Äù en '+rawPlace+'.');
      var favStar = isFav(ev.id) ? '‚òÖ' : '‚òÜ';
      var dir = PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#';
      return '<div class="card">'
        + (img?'<img src="'+img+'" alt="'+title+'" loading="lazy" onerror="this.style.display=\'none\'">':'')
        + '<div class="title">'+title+'</div>'
        + '<div class="meta">'+whenFmt(ev.fecha)+' ¬∑ '+place+'</div>'
        + '<div class="row" style="margin-top:6px">'
          + '<button class="btn fav-btn" data-id="'+esc(ev.id)+'" title="'+esc(I18N[LANG].fav)+'">'+favStar+' '+I18N[LANG].fav+'</button>'
          + '<button class="btn ics-btn" data-id="'+esc(ev.id)+'">üìÜ '+I18N[LANG].addCal+'</button>'
          + (wa?'<a class="btn ghost sm" href="'+esc(wa)+'" target="_blank" rel="noopener">'+I18N[LANG].whatsapp+'</a>':'')
          + '<a class="btn ghost sm" href="'+esc(dir)+'" target="_blank" rel="noopener">'+I18N[LANG].directions+'</a>'
        + '</div></div>';
    }).join('');
    bindEventActionButtons(wrap);
  }

  function renderEventsGrid(){
    var grid=$('#eventsGrid'), empty=$('#eventsEmpty'); if(!grid) return;
    var filtered = EVENTS.filter(function(ev){
      var byCamp = CAMP_FILTER==='all' ? true : (String(ev.camping||'').toLowerCase()===CAMP_FILTER);
      if(DATE_FILTER==='fav'){ return byCamp && isFav(ev.id); }
      var byDate = DATE_FILTER==='all' ? true : categoryFor(ev.fecha)===DATE_FILTER;
      return byDate && byCamp;
    }).sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));
    if(!filtered.length){ grid.innerHTML=''; if(empty) empty.style.display='block'; return; }
    if(empty) empty.style.display='none';
    grid.innerHTML = filtered.map(function(ev){
      var rawTitle=i18nField(ev.titulo)||'(sin t√≠tulo)';
      var rawPlace=i18nField(ev.lugar)||PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'';
      var title=esc(rawTitle), place=esc(rawPlace);
      var img=safeUrl(ev.imagen||ev.image||'');
      var wa=waLink(ev.camping,'Hola, consulta sobre ‚Äú'+rawTitle+'‚Äù en '+rawPlace+'.');
      var favStar = isFav(ev.id) ? '‚òÖ' : '‚òÜ';
      return '<div class="card" style="min-width:unset">'
        + (img?'<img src="'+img+'" alt="'+title+'" loading="lazy" onerror="this.style.display=\'none\'">':'')
        + '<div class="title">'+title+'</div>'
        + '<div class="meta">'+whenFmt(ev.fecha)+' ¬∑ '+place+'</div>'
        + '<div class="row" style="margin-top:6px">'
          + '<button class="btn fav-btn" data-id="'+esc(ev.id)+'" title="'+esc(I18N[LANG].fav)+'">'+favStar+' '+I18N[LANG].fav+'</button>'
          + '<button class="btn ics-btn" data-id="'+esc(ev.id)+'">üìÜ '+I18N[LANG].addCal+'</button>'
          + (wa?'<a class="btn" href="'+esc(wa)+'" target="_blank" rel="noopener">'+I18N[LANG].whatsapp+'</a>':'')
          + '<a class="btn" href="'+esc(PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#')+'" target="_blank" rel="noopener">'+I18N[LANG].directions+'</a>'
        + '</div></div>';
    }).join('');
    bindEventActionButtons(grid);
  }

  function bindEventActionButtons(scope){
    $all('.fav-btn', scope).forEach(function(btn){
      on(btn,'click', function(){ var id=btn.getAttribute('data-id'); toggleFav(id); });
    });
    $all('.ics-btn', scope).forEach(function(btn){
      on(btn,'click', function(){ var id=btn.getAttribute('data-id'); var ev = EVENTS.find(e=>e.id===id); if(ev) downloadICS(ev); });
    });
  }

  function loadEvents(){
    fetch('./events.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>r.json()).then(data=>{ EVENTS = Array.isArray(data)?data:[]; renderHomeSlider(); renderEventsGrid(); })
      .catch(()=>{ EVENTS=[]; renderHomeSlider(); renderEventsGrid(); });
  }

  // Filtros
  $all('[data-filter]').forEach(ch=>on(ch,'click', function(){
    $all('[data-filter]').forEach(x=>x.classList.remove('on'));
    ch.classList.add('on'); DATE_FILTER=ch.getAttribute('data-filter')||'all'; renderEventsGrid();
  }));
  $all('[data-camp]').forEach(ch=>on(ch,'click', function(){
    $all('[data-camp]').forEach(x=>x.classList.remove('on'));
    ch.classList.add('on'); CAMP_FILTER=ch.getAttribute('data-camp')||'all'; renderEventsGrid();
  }));

  /* ===== Horarios ===== */
  var SCHEDULES_DEFAULT={
    oyambre:{
      es:"<b>Recepci√≥n</b>: 8:30‚Äì22:00<br><b>Bar</b>: 8:30‚Äì23:00<br><b>Restaurante</b>: 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Piscinas (toda la temporada)</b>: 9:00‚Äì21:00<br><b>Gimnasio</b>: 9:00‚Äì21:00<br><b>Lavander√≠a</b>: 24 horas<br><b>Tienda</b>: 8:30‚Äì13:00 / 17:00‚Äì20:00<br><b>Barrera de entrada</b>: 8:00‚Äì23:59 (circulaci√≥n prohibida 00:00‚Äì8:00)<br><b>Check-in parcelas</b>: 13:00 ¬∑ <b>Check-in alojamientos</b>: 17:00 ¬∑ <b>Check-out</b>: 12:00<br><i>Los horarios pueden variar seg√∫n la fecha.</i>",
      en:"<b>Reception</b>: 08:30‚Äì22:00<br><b>Bar</b>: 08:30‚Äì23:00<br><b>Restaurant</b>: 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Pools (all season)</b>: 09:00‚Äì21:00<br><b>Gym</b>: 09:00‚Äì21:00<br><b>Laundry</b>: 24h<br><b>Shop</b>: 08:30‚Äì13:00 / 17:00‚Äì20:00<br><b>Entry gate</b>: 08:00‚Äì23:59 (no driving 00:00‚Äì08:00)<br><b>Pitch check-in</b>: 13:00 ¬∑ <b>Lodging check-in</b>: 17:00 ¬∑ <b>Check-out</b>: 12:00<br><i>Hours may vary by date.</i>",
      fr:"<b>R√©ception</b> : 8:30‚Äì22:00<br><b>Bar</b> : 8:30‚Äì23:00<br><b>Restaurant</b> : 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Piscines (toute la saison)</b> : 9:00‚Äì21:00<br><b>Gym</b> : 9:00‚Äì21:00<br><b>Blanchisserie</b> : 24h<br><b>Boutique</b> : 8:30‚Äì13:00 / 17:00‚Äì20:00<br><b>Barri√®re d‚Äôentr√©e</b> : 8:00‚Äì23:59 (circulation interdite 00:00‚Äì8:00)<br><b>Arriv√©e emplacements</b> : 13:00 ¬∑ <b>Arriv√©e logements</b> : 17:00 ¬∑ <b>D√©part</b> : 12:00<br><i>Horaires susceptibles de varier.</i>",
      de:"<b>Rezeption</b>: 8:30‚Äì22:00<br><b>Bar</b>: 8:30‚Äì23:00<br><b>Restaurant</b>: 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Schwimmb√§der (Saison)</b>: 9:00‚Äì21:00<br><b>Fitness</b>: 9:00‚Äì21:00<br><b>Waschsalon</b>: 24h<br><b>Shop</b>: 8:30‚Äì13:00 / 17:00‚Äì20:00<br><b>Schranke</b>: 8:00‚Äì23:59 (keine Fahrten 00:00‚Äì8:00)<br><b>Check-in Stellpl√§tze</b>: 13:00 ¬∑ <b>Check-in Unterk√ºnfte</b>: 17:00 ¬∑ <b>Check-out</b>: 12:00<br><i>Zeiten k√∂nnen variieren.</i>",
      nl:"<b>Receptie</b>: 8:30‚Äì22:00<br><b>Bar</b>: 8:30‚Äì23:00<br><b>Restaurant</b>: 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Zwembaden (seizoen)</b>: 9:00‚Äì21:00<br><b>Gym</b>: 9:00‚Äì21:00<br><b>Wasserette</b>: 24 u<br><b>Winkel</b>: 8:30‚Äì13:00 / 17:00‚Äì20:00<br><b>Toegangshek</b>: 8:00‚Äì23:59 (geen verkeer 00:00‚Äì8:00)<br><b>Inchecken plaatsen</b>: 13:00 ¬∑ <b>Inchecken logies</b>: 17:00 ¬∑ <b>Uitchecken</b>: 12:00<br><i>Tijden kunnen vari√´ren.</i>"
    },
    ramales:{
      es:"<b>Recepci√≥n</b>: 9:00‚Äì21:00<br><b>Cafeter√≠a</b>: L‚ÄìV 17:00‚Äì22:00 ¬∑ S‚ÄìD 8:30‚Äì22:00<br><b>Restaurante</b>: L‚ÄìV 19:00‚Äì22:00 ¬∑ S‚ÄìD 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Piscina</b>: 9:30‚Äì20:30<br><b>Check-in parcelas</b>: 12:00 ¬∑ <b>Check-in alojamientos</b>: 16:00 ¬∑ <b>Check-out</b>: 12:00<br><b>Barrera</b>: 8:00‚Äì23:59 (prohibida circulaci√≥n 00:00‚Äì8:00)<br><i>Los horarios pueden variar seg√∫n la fecha.</i>",
      en:"<b>Reception</b>: 09:00‚Äì21:00<br><b>Caf√©</b>: Mon‚ÄìFri 17:00‚Äì22:00 ¬∑ Sat‚ÄìSun 08:30‚Äì22:00<br><b>Restaurant</b>: Mon‚ÄìFri 19:00‚Äì22:00 ¬∑ Sat‚ÄìSun 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Pool</b>: 09:30‚Äì20:30<br><b>Pitches check-in</b>: 12:00 ¬∑ <b>Lodgings check-in</b>: 16:00 ¬∑ <b>Check-out</b>: 12:00<br><b>Gate</b>: 08:00‚Äì23:59 (no driving 00:00‚Äì08:00)<br><i>Hours may vary by date.</i>",
      fr:"<b>R√©ception</b> : 9:00‚Äì21:00<br><b>Caf√©</b> : L‚ÄìV 17:00‚Äì22:00 ¬∑ S‚ÄìD 8:30‚Äì22:00<br><b>Restaurant</b> : L‚ÄìV 19:00‚Äì22:00 ¬∑ S‚ÄìD 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Piscine</b> : 9:30‚Äì20:30<br><b>Arriv√©e emplacements</b> : 12:00 ¬∑ <b>Arriv√©e logements</b> : 16:00 ¬∑ <b>D√©part</b> : 12:00<br><b>Barri√®re</b> : 8:00‚Äì23:59 (pas de circulation 00:00‚Äì8:00)<br><i>Horaires susceptibles de varier.</i>",
      de:"<b>Rezeption</b>: 9:00‚Äì21:00<br><b>Caf√©</b>: Mo‚ÄìFr 17:00‚Äì22:00 ¬∑ Sa‚ÄìSo 8:30‚Äì22:00<br><b>Restaurant</b>: Mo‚ÄìFr 19:00‚Äì22:00 ¬∑ Sa‚ÄìSo 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Pool</b>: 9:30‚Äì20:30<br><b>Check-in Stellpl√§tze</b>: 12:00 ¬∑ <b>Check-in Unterk√ºnfte</b>: 16:00 ¬∑ <b>Check-out</b>: 12:00<br><b>Schranke</b>: 8:00‚Äì23:59 (keine Fahrten 00:00‚Äì8:00)<br><i>Zeiten k√∂nnen variieren.</i>",
      nl:"<b>Receptie</b>: 9:00‚Äì21:00<br><b>Caf√©</b>: ma‚Äìvr 17:00‚Äì22:00 ¬∑ za‚Äìzo 8:30‚Äì22:00<br><b>Restaurant</b>: ma‚Äìvr 19:00‚Äì22:00 ¬∑ za‚Äìzo 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Zwembad</b>: 9:30‚Äì20:30<br><b>Inchecken plaatsen</b>: 12:00 ¬∑ <b>Inchecken logies</b>: 16:00 ¬∑ <b>Uitchecken</b>: 12:00<br><b>Toegangshek</b>: 8:00‚Äì23:59 (geen verkeer 00:00‚Äì8:00)<br><i>Tijden kunnen vari√´ren.</i>"
    },
    ruiloba:{
      es:"<b>Recepci√≥n</b>: 8:30‚Äì22:00<br><b>Piscinas (toda la temporada)</b>: 9:00‚Äì21:00<br><b>Cafeter√≠a</b>: 8:30‚Äì23:00<br><b>Restaurante</b>: 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Lavander√≠a</b>: 24 h<br><b>Barrera</b>: 8:00‚Äì23:59 (prohibida circulaci√≥n 00:00‚Äì8:00)<br><b>Tienda</b>: consultar en Cafeter√≠a<br><b>Check-in parcelas</b>: 13:00 ¬∑ <b>Check-in alojamientos</b>: 17:00 ¬∑ <b>Check-out</b>: 12:00<br><i>Los horarios pueden variar seg√∫n la fecha.</i>",
      en:"<b>Reception</b>: 08:30‚Äì22:00<br><b>Pools (all season)</b>: 09:00‚Äì21:00<br><b>Caf√©</b>: 08:30‚Äì23:00<br><b>Restaurant</b>: 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Laundry</b>: 24 h<br><b>Gate</b>: 08:00‚Äì23:59 (no driving 00:00‚Äì08:00)<br><b>Shop</b>: ask at Caf√©<br><b>Pitches check-in</b>: 13:00 ¬∑ <b>Lodgings check-in</b>: 17:00 ¬∑ <b>Check-out</b>: 12:00<br><i>Hours may vary by date.</i>",
      fr:"<b>R√©ception</b> : 8:30‚Äì22:00<br><b>Piscines (toute la saison)</b> : 9:00‚Äì21:00<br><b>Caf√©</b> : 8:30‚Äì23:00<br><b>Restaurant</b> : 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Blanchisserie</b> : 24 h<br><b>Barri√®re</b> : 8:00‚Äì23:59 (pas de circulation 00:00‚Äì8:00)<br><b>Boutique</b> : √† demander au Caf√©<br><b>Arriv√©e emplacements</b> : 13:00 ¬∑ <b>Arriv√©e logements</b> : 17:00 ¬∑ <b>D√©part</b> : 12:00<br><i>Horaires susceptibles de varier.</i>",
      de:"<b>Rezeption</b>: 8:30‚Äì22:00<br><b>Schwimmb√§der (Saison)</b>: 9:00‚Äì21:00<br><b>Caf√©</b>: 8:30‚Äì23:00<br><b>Restaurant</b>: 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Waschsalon</b>: 24 h<br><b>Schranke</b>: 8:00‚Äì23:59 (keine Fahrten 00:00‚Äì8:00)<br><b>Laden</b>: an der Cafeteria erfragen<br><b>Check-in Stellpl√§tze</b>: 13:00 ¬∑ <b>Check-in Unterk√ºnfte</b>: 17:00 ¬∑ <b>Check-out</b>: 12:00<br><i>Zeiten k√∂nnen variieren.</i>",
      nl:"<b>Receptie</b>: 8:30‚Äì22:00<br><b>Zwembaden (seizoen)</b>: 9:00‚Äì21:00<br><b>Caf√©</b>: 8:30‚Äì23:00<br><b>Restaurant</b>: 13:30‚Äì15:00 / 19:00‚Äì22:00<br><b>Wasserette</b>: 24 u<br><b>Toegangshek</b>: 8:00‚Äì23:59 (geen verkeer 00:00‚Äì8:00)<br><b>Winkel</b>: vraag bij het caf√©<br><b>Inchecken plaatsen</b>: 13:00 ¬∑ <b>Inchecken logies</b>: 17:00 ¬∑ <b>Uitchecken</b>: 12:00<br><i>Tijden kunnen vari√´ren.</i>"
    },
    cardeo:{
      es:"<b>Check-in</b>: 16:00 ¬∑ <b>Check-out</b>: 12:00<br><b>Taberna</b>: 8:30‚Äì23:00<br><b>Restaurante (fines de semana)</b>: 13:30‚Äì15:30 / 20:00‚Äì22:30<br><i>Los horarios pueden variar seg√∫n la fecha.</i>",
      en:"<b>Check-in</b>: 16:00 ¬∑ <b>Check-out</b>: 12:00<br><b>Tavern</b>: 08:30‚Äì23:00<br><b>Restaurant (weekends)</b>: 13:30‚Äì15:30 / 20:00‚Äì22:30<br><i>Hours may vary by date.</i>",
      fr:"<b>Arriv√©e</b> : 16:00 ¬∑ <b>D√©part</b> : 12:00<br><b>Taverne</b> : 8:30‚Äì23:00<br><b>Restaurant (week-ends)</b> : 13:30‚Äì15:30 / 20:00‚Äì22:30<br><i>Horaires susceptibles de varier.</i>",
      de:"<b>Check-in</b>: 16:00 ¬∑ <b>Check-out</b>: 12:00<br><b>Taverne</b>: 8:30‚Äì23:00<br><b>Restaurant (Wochenende)</b>: 13:30‚Äì15:30 / 20:00‚Äì22:30<br><i>Zeiten k√∂nnen variieren.</i>",
      nl:"<b>Check-in</b>: 16:00 ¬∑ <b>Check-out</b>: 12:00<br><b>Herberg</b>: 8:30‚Äì23:00<br><b>Restaurant (weekend)</b>: 13:30‚Äì15:30 / 20:00‚Äì22:30<br><i>Tijden kunnen vari√´ren.</i>"
    }
  };
  var SCHEDULES = JSON.parse(JSON.stringify(SCHEDULES_DEFAULT));
  function renderAcc(){
    ['oyambre','ramales','ruiloba','cardeo'].forEach(function(k){
      var el=document.getElementById('acc-'+k);
      if(!el) return;
      var item=SCHEDULES[k]||SCHEDULES_DEFAULT[k]||{};
      el.innerHTML = item[LANG] || item.es || '';
    });
  }
  function loadSchedules(){
    fetch('./schedules.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>{ if(!r.ok) throw 0; return r.json(); })
      .then(json=>{ if(json && typeof json==='object'){ SCHEDULES=json; renderAcc(); renderStayHours(); }})
      .catch(()=>{ SCHEDULES=JSON.parse(JSON.stringify(SCHEDULES_DEFAULT)); renderAcc(); renderStayHours(); });
  }
  $all('.acc-h').forEach(h=>on(h,'click', function(){ h.parentElement.classList.toggle('open'); }));

  /* ===== Mi estancia (contactos + horarios + clima) ===== */
  var STAY = localStorage.getItem('stay_place') || 'oyambre';
  var COORDS = {
    oyambre:{lat:43.393, lon:-4.352},
    ramales:{lat:43.263, lon:-3.465},
    ruiloba:{lat:43.387, lon:-4.264},
    cardeo:{lat:43.391, lon:-4.274}
  };
  function setStayPlace(v){ STAY=String(v||'oyambre').toLowerCase(); localStorage.setItem('stay_place',STAY); updateStayUI(); updateIncUI(); }
  function renderStayContacts(){
    var T=I18N[LANG], place=STAY;
    $('#stayPlace').value=place;
    var web=WEB[place], tel=PHONES[place], wa=WHATSAPP[place], mail=EMAILS[place], dir=PLACE_LINK[place];
    $('#stayWeb').textContent=T.web; $('#stayWeb').onclick=function(){ location.href=web; };
    var call=$('#stayCall'); call.textContent=T.call; call.href='tel:'+tel;
    var waBtn=$('#stayWA'); waBtn.textContent=T.whatsapp; waBtn.href='https://wa.me/'+wa+'?text='+encodeURIComponent('Hola, soy cliente alojado en '+PLACE_LABEL[place]+'.');
    var em=$('#stayEmail'); em.textContent=T.email; em.href='mailto:'+mail+'?subject='+encodeURIComponent('Consulta - '+PLACE_LABEL[place])+'&body='+encodeURIComponent('Hola,\n\nSoy cliente alojado en '+PLACE_LABEL[place]+'.\n\nGracias.');
    var dr=$('#stayDir'); dr.textContent=T.directions; dr.href=dir;
    $('#wxPlaceLabel').textContent=PLACE_LABEL[place];
  }
  function renderStayHours(){
    var cont=$('#stayHours'); if(!cont) return;
    var item=(SCHEDULES[STAY]||SCHEDULES_DEFAULT[STAY]||{});
    cont.innerHTML = item[LANG] || item.es || '';
  }

  // Weather
  function codeToEmoji(code){
    if([0].includes(code)) return '‚òÄÔ∏è';
    if([1,2].includes(code)) return 'üå§Ô∏è';
    if([3].includes(code)) return '‚òÅÔ∏è';
    if([45,48].includes(code)) return 'üå´Ô∏è';
    if([51,53,55,56,57].includes(code)) return 'üå¶Ô∏è';
    if([61,63,65,80,81,82].includes(code)) return 'üåßÔ∏è';
    if([66,67,71,73,75,77,85,86].includes(code)) return '‚ùÑÔ∏è';
    if([95,96,99].includes(code)) return '‚õàÔ∏è';
    return 'üå°Ô∏è';
  }
  function wd(d){ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short'}).format(new Date(d)); }catch(e){ return d; } }
  function renderWeather(data){
    if(!data) return;
    $('#wxIco').textContent = codeToEmoji(data.current.weather_code);
    $('#wxNow').textContent = Math.round(data.current.temperature_2m);
    $('#wxMax').textContent = Math.round(data.daily.temperature_2m_max[0]);
    $('#wxMin').textContent = Math.round(data.daily.temperature_2m_min[0]);
    $('#wxDesc').textContent = wd(data.daily.time[0]);
    for(var i=1;i<=3;i++){
      $('#d'+i).textContent = wd(data.daily.time[i]);
      $('#i'+i).textContent = codeToEmoji(data.daily.weather_code[i]);
      $('#t'+i).textContent = Math.round(data.daily.temperature_2m_max[i])+'/'+Math.round(data.daily.temperature_2m_min[i])+'¬∞';
    }
  }
  function fetchWeather(place){
    var c=COORDS[place]||COORDS.oyambre;
    var url = 'https://api.open-meteo.com/v1/forecast?latitude='+c.lat+'&longitude='+c.lon+'&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=4';
    fetch(url).then(r=>r.json()).then(renderWeather).catch(function(){});
  }
  function updateStayUI(){ renderStayContacts(); renderStayHours(); fetchWeather(STAY); }
  on($('#stayPlace'),'change', function(e){ setStayPlace(e.target.value); });

  /* ===== Incidencias ===== */
  function fillIncTypes(){
    var sel=$('#incType'); if(!sel) return;
    var opts=I18N[LANG].incTypes||I18N.es.incTypes;
    sel.innerHTML = opts.map(function(o){ return '<option value="'+o.key+'">'+esc(o.label)+'</option>'; }).join('');
  }
  function buildIncMsg(){
    var T=I18N[LANG], typeOpt=$('#incType'); var typeTxt = typeOpt && typeOpt.options[typeOpt.selectedIndex]? typeOpt.options[typeOpt.selectedIndex].textContent : 'Otros';
    var msg=$('#incMsg').value||'';
    var now=new Date(); var stamp = now.toLocaleString();
    var header = '['+T.incTitle+'] '+typeTxt+' ¬∑ '+PLACE_LABEL[STAY];
    var body = 'Hola,\n\nTengo una incidencia: '+typeTxt+'.\n\nDetalle: '+msg+'\n\nAlojamiento: '+PLACE_LABEL[STAY]+'\nFecha/hora: '+stamp+'\n\nGracias.';
    return {subject:header, body:body};
  }
  function updateIncUI(){
    $('#incPlace').value=STAY;
    var mail=EMAILS[STAY], wa=WHATSAPP[STAY];
    var m=buildIncMsg();
    $('#incWA').href='https://wa.me/'+wa+'?text='+encodeURIComponent(m.body);
    $('#incEmail').href='mailto:'+mail+'?subject='+encodeURIComponent(m.subject)+'&body='+encodeURIComponent(m.body);
  }
  on($('#incPlace'),'change', function(e){ setStayPlace(e.target.value); });
  on($('#incType'),'change', updateIncUI);
  on($('#incMsg'),'input', updateIncUI);

  /* ===== Imprescindibles (datos) ===== */
  function gglImages(q){ return 'https://www.google.com/search?tbm=isch&q='+encodeURIComponent(q); }
  function gglMaps(q){ return 'https://www.google.com/maps/search/'+encodeURIComponent(q); }

  // Cada "see" puede llevar coords para calcular distancia
  var MUSTS=[
    {
      slug:'comillas',
      name:{es:'Comillas', en:'Comillas', fr:'Comillas', de:'Comillas', nl:'Comillas'},
      desc:{
        es:'Villa se√±orial con arquitectura modernista (Gaud√≠, Dom√®nech), playa y ambiente tranquilo. Perfecta para combinar patrimonio, paseo y costa.',
        en:'Elegant seaside town with Modernista architecture (Gaud√≠, Dom√®nech), beach and a relaxed vibe.',
        fr:'Bourg √©l√©gant en bord de mer, architecture moderniste (Gaud√≠, Dom√®nech), plage et ambiance paisible.',
        de:'Elegante K√ºstenstadt mit modernistischer Architektur (Gaud√≠, Dom√®nech), Strand und entspanntem Flair.',
        nl:'Elegante kustplaats met modernistische architectuur (Gaud√≠, Dom√®nech), strand en relaxte sfeer.'
      },
      see:[
        {name:{es:'El Capricho de Gaud√≠',en:'Gaud√≠‚Äôs El Capricho',fr:'El Capricho de Gaud√≠',de:'El Capricho von Gaud√≠',nl:'El Capricho van Gaud√≠'},
         desc:{es:'Pabell√≥n modernista del genio catal√°n, icono de Comillas.',en:'Gaud√≠‚Äôs whimsical pavilion and town icon.'},
         map: gglMaps('El Capricho de Gaud√≠ Comillas'), images: gglImages('El Capricho de Gaud√≠ Comillas'),
         coords:{lat:43.38777,lon:-4.29220}},
        {name:{es:'Universidad Pontificia',en:'Pontifical University',fr:'Universit√© pontificale',de:'P√§pstliche Universit√§t',nl:'Pauselijke Universiteit'},
         desc:{es:'Imponente conjunto neog√≥tico con vistas.',en:'Stunning neo-Gothic complex overlooking the town.'},
         map: gglMaps('Universidad Pontificia Comillas'), images: gglImages('Universidad Pontificia Comillas'),
         coords:{lat:43.39103,lon:-4.29364}},
        {name:{es:'Palacio de Sobrellano y Capilla-Pante√≥n',en:'Sobrellano Palace & Chapel',fr:'Palais de Sobrellano',de:'Palast Sobrellano',nl:'Paleis Sobrellano'},
         desc:{es:'Residencia marquesal y capilla modernista.',en:'Marquis‚Äô residence and Modernista chapel.'},
         map: gglMaps('Palacio de Sobrellano Comillas'), images: gglImages('Palacio de Sobrellano Comillas'),
         coords:{lat:43.38876,lon:-4.29526}}
      ]
    },
    { slug:'santander',
      name:{es:'Santander', en:'Santander', fr:'Santander', de:'Santander', nl:'Santander'},
      desc:{es:'Capital abierta a la bah√≠a, playas urbanas, Magdalena y una escena cultural viva.',
            en:'Capital on a beautiful bay, urban beaches, Magdalena Palace and a lively cultural scene.',
            fr:'Capitale ouverte sur la baie, plages urbaines, Magdalena et sc√®ne culturelle dynamique.',
            de:'Hauptstadt an einer sch√∂nen Bucht, Stadtstr√§nde, Magdalena und lebendige Kulturszene.',
            nl:'Hoofdstad aan een prachtige baai, stadsstranden, Magdalena en levendige cultuur.'},
      see:[
        {name:{es:'Palacio de la Magdalena',en:'Magdalena Palace'}, desc:{es:'Residencia real con parque peninsular.',en:'Royal residence on a scenic peninsula.'}, map:gglMaps('Palacio de la Magdalena Santander'), images:gglImages('Palacio de la Magdalena Santander'), coords:{lat:43.4696,lon:-3.7660}},
        {name:{es:'Centro Bot√≠n',en:'Centro Bot√≠n'}, desc:{es:'Arte contempor√°neo en el muelle.',en:'Harborfront contemporary art center.'}, map:gglMaps('Centro Bot√≠n'), images:gglImages('Centro Bot√≠n Santander'), coords:{lat:43.4617,lon:-3.7940}},
        {name:{es:'Plaza de Ca√±ad√≠o',en:'Plaza de Ca√±ad√≠o'}, desc:{es:'Ambiente nocturno y tapas.',en:'Nightlife and tapas hub.'}, map:gglMaps('Plaza de Ca√±ad√≠o'), images:gglImages('Plaza de Ca√±ad√≠o Santander'), coords:{lat:43.4625,lon:-3.8003}},
        {name:{es:'Diques de Gamazo',en:'Gamazo docks'}, desc:{es:'Paseo junto al mar y eventos.',en:'Seafront promenade and events.'}, map:gglMaps('Diques de Gamazo Santander'), images:gglImages('Diques de Gamazo Santander'), coords:{lat:43.4655,lon:-3.7791}},
        {name:{es:'Palacio de Festivales',en:'Festival Palace'}, desc:{es:'S√≠mbolo cultural de la ciudad.',en:'Cultural landmark of the city.'}, map:gglMaps('Palacio de Festivales Santander'), images:gglImages('Palacio de Festivales Santander'), coords:{lat:43.4647,lon:-3.7800}},
        {name:{es:'Parque de Las Llamas',en:'Las Llamas Park'}, desc:{es:'Humedal urbano con anillo verde.',en:'Urban wetland and green ring.'}, map:gglMaps('Parque de las Llamas Santander'), images:gglImages('Parque de Las Llamas Santander'), coords:{lat:43.4726,lon:-3.8055}},
        {name:{es:'Senda de Matale√±as',en:'Matale√±as coastal path'}, desc:{es:'Acantilados y faro con vistas.',en:'Clifftop walk to the lighthouse.'}, map:gglMaps('Senda de Matale√±as Santander'), images:gglImages('Senda de Matale√±as Santander'), coords:{lat:43.4837,lon:-3.7898}},
        {name:{es:'Mercado del Este',en:'Mercado del Este'}, desc:{es:'Gastronom√≠a y compras con encanto.',en:'Food and shopping arcade.'}, map:gglMaps('Mercado del Este Santander'), images:gglImages('Mercado del Este Santander'), coords:{lat:43.4621,lon:-3.8070}}
      ]
    },
    { slug:'san-vicente',
      name:{es:'San Vicente de la Barquera', en:'San Vicente de la Barquera', fr:'San Vicente de la Barquera', de:'San Vicente de la Barquera', nl:'San Vicente de la Barquera'},
      desc:{es:'Villa marinera con puentes medievales, marismas y vistas a los Picos de Europa.',
            en:'Fishing town with medieval bridges and marshes facing the Picos de Europa.',
            fr:'Ville de p√™cheurs avec ponts m√©di√©vaux et marais face aux Pics d‚ÄôEurope.',
            de:'Fischerort mit mittelalterlichen Br√ºcken und Marschen vor den Picos de Europa.',
            nl:'Vissersplaats met middeleeuwse bruggen en moerassen met zicht op de Picos de Europa.'},
      see:[
        {name:{es:'Puente de la Maza',en:'Puente de la Maza'}, desc:{es:'Emblem√°tico puente medieval.',en:'Iconic medieval bridge.'},
         map:gglMaps('Puente de la Maza'), images:gglImages('Puente de la Maza San Vicente'), coords:{lat:43.3878,lon:-4.3932}},
        {name:{es:'Castillo del Rey',en:'King‚Äôs Castle'}, desc:{es:'Fortaleza con miradores.',en:'Castle with viewpoints.'},
         map:gglMaps('Castillo del Rey San Vicente'), images:gglImages('Castillo del Rey San Vicente'), coords:{lat:43.3868,lon:-4.3990}}
      ]
    },
    { slug:'santillana',
      name:{es:'Santillana del Mar', en:'Santillana del Mar', fr:'Santillana del Mar', de:'Santillana del Mar', nl:'Santillana del Mar'},
      desc:{es:'Conjunto hist√≥rico medieval cercano a Altamira; calles empedradas, casonas y arte rom√°nico.',
            en:'Medieval jewel near Altamira; cobbled streets, manor houses and Romanesque art.',
            fr:'Jewel m√©di√©val pr√®s d‚ÄôAltamira; rues pav√©es, demeures et art roman.',
            de:'Mittelalterliches Kleinod nahe Altamira; Kopfsteinpflaster und romanische Kunst.',
            nl:'Middeleeuws juweel nabij Altamira; kasseien en romaans erfgoed.'},
      see:[
        {name:{es:'Colegiata de Santa Juliana',en:'Collegiate Church'}, desc:{es:'Rom√°nico c√°ntabro esencial.',en:'Key Romanesque monument.'},
         map:gglMaps('Colegiata Santa Juliana'), images:gglImages('Colegiata Santa Juliana'), coords:{lat:43.3915,lon:-4.1073}},
        {name:{es:'Museo de Altamira (Neocueva)',en:'Altamira Museum'}, desc:{es:'R√©plica de las pinturas paleol√≠ticas.',en:'Replica of Paleolithic cave art.'},
         map:gglMaps('Museo de Altamira'), images:gglImages('Museo de Altamira'),
         tickets:'https://www.cultura.gob.es/mnaltamira/visita/compra-entradas.html', coords:{lat:43.3773,lon:-4.1198}}
      ]
    },
    { slug:'suances',
      name:{es:'Suances', en:'Suances', fr:'Suances', de:'Suances', nl:'Suances'},
      desc:{es:'Playas abiertas al Cant√°brico y atardeceres en La Tabl√≠a. Buen destino surfero.',
            en:'Open Atlantic beaches and epic sunsets at La Tabl√≠a. Surf vibe.',
            fr:'Plages ouvertes sur l‚ÄôAtlantique et couchers de soleil √† La Tabl√≠a.',
            de:'Offene Atlantikstr√§nde und Sonnenunterg√§nge an La Tabl√≠a. Surfspot.',
            nl:'Open Atlantische stranden en zonsondergang bij La Tabl√≠a.'},
      see:[
        {name:{es:'Playa de Los Locos',en:'Los Locos Beach'}, desc:{es:'Famosa por el surf.',en:'Surf hotspot.'},
         map:gglMaps('Playa de Los Locos Suances'), images:gglImages('Playa de Los Locos Suances'), coords:{lat:43.4427,lon:-4.0441}}
      ]
    },
    { slug:'potes-liebana',
      name:{es:'Potes & Li√©bana', en:'Potes & Li√©bana', fr:'Potes & Li√©bana', de:'Potes & Li√©bana', nl:'Potes & Li√©bana'},
      desc:{es:'Puerta occidental de los Picos de Europa: villas con torres, gastronom√≠a de monta√±a y orujo.',
            en:'Western gateway to Picos de Europa: towered villages, mountain cuisine and orujo.',
            fr:'Porte ouest des Pics d‚ÄôEurope : villages, cuisine montagnarde et orujo.',
            de:'Westtor zu den Picos de Europa: T√ºrme, Bergk√ºche und Orujo.',
            nl:'Westelijke toegang tot Picos de Europa: torens, bergkeuken en orujo.'},
      see:[
        {name:{es:'Telef√©rico de Fuente D√©',en:'Fuente D√© Cable Car'}, desc:{es:'Vistas a 1.823 m.',en:'Views at 1,823 m.'},
         map:gglMaps('Telef√©rico Fuente D√©'), images:gglImages('Telef√©rico Fuente D√©'), tickets:'https://www.cantur.com/',
         coords:{lat:43.1444,lon:-4.8146}}
      ]
    },
    { slug:'alto-ason',
      name:{es:'Comarca del Alto As√≥n', en:'Alto As√≥n Area', fr:'R√©gion de l‚ÄôAs√≥n', de:'Region Alto As√≥n', nl:'Regio Alto As√≥n'},
      desc:{es:'Cuevas (Covalanas, Cullalvera), cascadas y paisajes k√°rsticos en Ramales y Soba.',
            en:'Caves (Covalanas, Cullalvera), waterfalls and karst landscapes around Ramales and Soba.',
            fr:'Grottes (Covalanas, Cullalvera), cascades et paysages karstiques.',
            de:'H√∂hlen (Covalanas, Cullalvera), Wasserf√§lle und Karstlandschaften.',
            nl:'Grotten (Covalanas, Cullalvera), watervallen en karstlandschap.'},
      see:[
        {name:{es:'Cueva Cullalvera',en:'Cullalvera Cave'}, desc:{es:'Espectacular boca de entrada.',en:'Huge cave entrance.'},
         map:gglMaps('Cueva Cullalvera'), images:gglImages('Cueva Cullalvera'), coords:{lat:43.2654,lon:-3.4689}},
        {name:{es:'Cueva Covalanas',en:'Covalanas Cave'}, desc:{es:'Arte rupestre en rojo.',en:'Red Paleolithic art.'},
         map:gglMaps('Cueva Covalanas'), images:gglImages('Cueva Covalanas'), coords:{lat:43.2659,lon:-3.4616}}
      ]
    },
    { slug:'valle-cabuerniga',
      name:{es:'Valle de Cabu√©rniga', en:'Cabu√©rniga Valley', fr:'Vall√©e de Cabu√©rniga', de:'Tal Cabu√©rniga', nl:'Vallei Cabu√©rniga'},
      desc:{es:'Valle tradicional con pueblos de arquitectura popular pasiega y robledales.',
            en:'Traditional valley with Pasiego rural architecture and oak forests.',
            fr:'Vall√©e traditionnelle, architecture rurale pasiega et ch√™nes.',
            de:'Traditionelles Tal mit pasiegischer Baukunst und Eichenw√§ldern.',
            nl:'Traditionele vallei met Pasiego-architectuur en eikenbossen.'},
      see:[
        {name:{es:'Ruente',en:'Ruente'}, desc:{es:'La Fuentona y casonas.',en:'La Fuentona spring and manor houses.'},
         map:gglMaps('Ruente Cantabria'), images:gglImages('Ruente Cantabria'), coords:{lat:43.2638,lon:-4.3057}},
        {name:{es:'Cascadas de Lami√±a',en:'Lami√±a Waterfalls'}, desc:{es:'Senda entre bosques atl√°nticos.',en:'Woodland trail to small cascades.'},
         map:gglMaps('Cascadas de Lami√±a'), images:gglImages('Cascadas de Lami√±a'), coords:{lat:43.2659,lon:-4.2589}},
        {name:{es:'Los Tojos',en:'Los Tojos'}, desc:{es:'Pueblo de monta√±a y miradores.',en:'Mountain village with viewpoints.'},
         map:gglMaps('Los Tojos Cantabria'), images:gglImages('Los Tojos Cantabria'), coords:{lat:43.1462,lon:-4.2428}}
      ]
    },
    { slug:'hermida',
      name:{es:'Desfiladero de la Hermida', en:'Hermida Gorge', fr:'D√©fil√© de la Hermida', de:'Hermida-Schlucht', nl:'Hermida-kloof'},
      desc:{es:'Ca√±√≥n fluvial que conduce a Li√©bana, con termas y miradores espectaculares.',
            en:'River gorge leading to Li√©bana, with hot springs and lookouts.',
            fr:'Gorge fluviale vers la Li√©bana, thermes et belv√©d√®res.',
            de:'Flussschlucht Richtung Li√©bana mit Thermen und Aussichtspunkten.',
            nl:'Rivierkloof richting Li√©bana met warmwaterbronnen en uitzichtpunten.'},
      see:[
        {name:{es:'Mirador de Santa Catalina',en:'Santa Catalina Viewpoint'}, desc:{es:'Balc√≥n sobre el desfiladero.',en:'Balcony over the gorge.'},
         map:gglMaps('Mirador de Santa Catalina'), images:gglImages('Mirador de Santa Catalina'), coords:{lat:43.2575,lon:-4.5551}}
      ]
    },
    { slug:'soplao',
      name:{es:'Cueva El Soplao', en:'El Soplao Cave', fr:'Grotte El Soplao', de:'H√∂hle El Soplao', nl:'Grot El Soplao'},
      desc:{es:'Cueva √∫nica por sus exc√©ntricas (helictitas) y galer√≠as mineras.',
            en:'Spectacular cave famed for helictites and mining galleries.',
            fr:'Grotte c√©l√®bre pour ses excentriques (h√©lictites) et ses galeries mini√®res.',
            de:'H√∂hle mit Heliktiten und Bergbaugalerien.',
            nl:'Grot beroemd om helictieten en mijn galerijen.'},
      see:[
        {name:{es:'Visita tur√≠stica',en:'Tour visit'}, desc:{es:'Recorrido acondicionado de la cueva.',en:'Prepared tourist route.'},
         map:gglMaps('Cueva El Soplao'), images:gglImages('Cueva El Soplao'), tickets:'https://www.elsoplao.es/', coords:{lat:43.3082,lon:-4.4127}},
        {name:{es:'Visita aventura',en:'Adventure tour'}, desc:{es:'Tramo espeleol√≥gico con equipo.',en:'Caving style section with gear.'},
         map:gglMaps('Cueva El Soplao aventura'), images:gglImages('Cueva El Soplao aventura'), coords:{lat:43.3082,lon:-4.4127}},
        {name:{es:'Mirador de El Soplao',en:'El Soplao viewpoint'}, desc:{es:'Vistas sobre la costa occidental.',en:'Western coast vistas.'},
         map:gglMaps('Mirador El Soplao'), images:gglImages('Mirador El Soplao'), coords:{lat:43.3139,lon:-4.4082}}
      ]
    },
    { slug:'isla-noja-santona',
      name:{es:'Isla ¬∑ Noja ¬∑ Santo√±a', en:'Isla ¬∑ Noja ¬∑ Santo√±a', fr:'Isla ¬∑ Noja ¬∑ Santo√±a', de:'Isla ¬∑ Noja ¬∑ Santo√±a', nl:'Isla ¬∑ Noja ¬∑ Santo√±a'},
      desc:{es:'Playas y marismas; anchoas de Santo√±a con sello propio.',
            en:'Beaches and marshes; Santo√±a anchovies with their own prestige.',
            fr:'Plages et marais; anchois de Santo√±a r√©put√©s.',
            de:'Str√§nde und Marschen; ber√ºhmte Sardellen aus Santo√±a.',
            nl:'Stranden en moerassen; beroemde ansjovis uit Santo√±a.'},
      see:[
        {name:{es:'Playa del Joyel (Noja)',en:'Joyel Beach (Noja)'}, desc:{es:'Sistema dunar y marisma.',en:'Dunes and marsh system.'},
         map:gglMaps('Playa del Joyel Noja'), images:gglImages('Playa del Joyel Noja'), coords:{lat:43.4917,lon:-3.5046}},
        {name:{es:'Playa de Isla',en:'Isla Beach'}, desc:{es:'Calas y aguas tranquilas.',en:'Coves and calm waters.'},
         map:gglMaps('Playa de Isla Cantabria'), images:gglImages('Playa de Isla Cantabria'), coords:{lat:43.4855,lon:-3.5156}}
      ]
    },
    { slug:'cabarceno',
      name:{es:'Parque de la Naturaleza de Cab√°rceno', en:'Cab√°rceno Nature Park', fr:'Parc de Cab√°rceno', de:'Naturpark Cab√°rceno', nl:'Natuurpark Cab√°rceno'},
      desc:{es:'Fauna en semilibertad en una antigua mina a cielo abierto, con telecabina y recintos extensos.',
            en:'Semi-free wildlife in a former open-pit mine, with gondolas and large enclosures.',
            fr:'Faune en semi-libert√© dans une ancienne mine √† ciel ouvert.',
            de:'Halbfreie Tierwelt in einem ehemaligen Tagebau.',
            nl:'Halfvrije fauna in een voormalige dagbouwmijn.'},
      see:[
        {name:{es:'Telecabina y recintos',en:'Cable car & enclosures'}, desc:{es:'Vistas y animales.',en:'Views and animals.'},
         map:gglMaps('Cab√°rceno'), images:gglImages('Cab√°rceno'), tickets:'https://entradas.parquedecabarceno.com/', coords:{lat:43.3459,lon:-3.8837}}
      ]
    }
  ];

  /* ===== Gastronom√≠a (datos) ===== */
  var FOOD=[
    {name:{es:'Anchoas de Santo√±a',en:'Santo√±a Anchovies',fr:'Anchois de Santo√±a',de:'Sardellen aus Santo√±a',nl:'Ansjovis uit Santo√±a'},
     desc:{es:'Filetes en salaz√≥n y aceite, producto estrella del litoral oriental.', en:'Salt-cured fillets in olive oil; a regional star product.', fr:'Filets sal√©s √† l‚Äôhuile d‚Äôolive, produit phare.', de:'In √ñl eingelegte Salzsardellen ‚Äì Starprodukt.', nl:'Gezouten filets in olijfolie, streekproduct.'}},
    {name:{es:'Sobaos pasiegos',en:'Sobaos Pasiegos',fr:'Sobaos pasiegos',de:'Sobaos Pasiegos',nl:'Sobaos Pasiegos'},
     desc:{es:'Bizcocho de mantequilla con IGP de los Valles Pasiegos.', en:'Buttery sponge cake with PGI from Pasiegos Valleys.', fr:'G√¢teau au beurre IGP des Vall√©es Pasiegas.', de:'Buttriger Biskuit mit g.g.A.', nl:'Boterige cake met BGA.'}},
    {name:{es:'Quesada pasiega',en:'Quesada Pasiega',fr:'Quesada pasiega',de:'Quesada Pasiega',nl:'Quesada Pasiega'},
     desc:{es:'Postre horneado de leche y queso fresco.', en:'Baked dessert with milk and fresh cheese.', fr:'Dessert au lait et fromage frais.', de:'Gebackenes Dessert aus Milch und Frischk√§se.', nl:'Gebakken dessert met melk en verse kaas.'}},
    {name:{es:'Cocido monta√±√©s',en:'Cocido Monta√±√©s',fr:'Cocido monta√±√©s',de:'Cocido Monta√±√©s',nl:'Cocido Monta√±√©s'},
     desc:{es:'Puchero de alubia blanca y berza; contundente y tradicional.', en:'Hearty white-bean and greens stew.', fr:'Rago√ªt roboratif de haricots blancs et choux.', de:'Kr√§ftiger Eintopf aus wei√üen Bohnen und Kohl.', nl:'Stevige stoofpot met witte bonen en kool.'}},
    {name:{es:'Queso Pic√≥n Bejes-Tresviso',en:'Pic√≥n Bejes-Tresviso cheese',fr:'Fromage Pic√≥n Bejes-Tresviso',de:'K√§se Pic√≥n Bejes-Tresviso',nl:'Kaas Pic√≥n Bejes-Tresviso'},
     desc:{es:'Azul con DOP, afinado en cuevas de Li√©bana.', en:'Blue cheese (PDO) matured in Li√©bana caves.', fr:'Bleu AOP affin√© en grottes.', de:'Blauschimmelk√§se g.U., in H√∂hlen gereift.', nl:'Blauwe kaas (BOB) gerijpt in grotten.'}},
    {name:{es:'Rabas',en:'Rabas (fried squid)',fr:'Rabas (calamar frit)',de:'Rabas (frittierter Tintenfisch)',nl:'Rabas (gefrituurde inktvis)'},
     desc:{es:'Tiras de calamar rebozadas, icono del aperitivo santanderino.', en:'Battered squid strips; an iconic Santander aperitivo.', fr:'B√¢tonnets de calamar en beignet, ic√¥ne locale.', de:'Panierte Tintenfischstreifen ‚Äì Kult-Tapa.', nl:'Gefrituurde inktvisreepjes, iconische tapa.'}},
    {name:{es:'Orujo de Li√©bana',en:'Orujo from Li√©bana',fr:'Orujo de Li√©bana',de:'Orujo aus Li√©bana',nl:'Orujo uit Li√©bana'},
     desc:{es:'Aguardiente tradicional con destiler√≠as artesanas.', en:'Traditional pomace brandy from mountain valleys.', fr:'Eau-de-vie traditionnelle.', de:'Tresterbrand aus den Bergen.', nl:'Traditionele marc-brandewijn.'}},
    {name:{es:'Bonito del Norte & marmita',en:'Albacore & ‚Äúmarmita‚Äù',fr:'Thon blanc & marmite',de:'Wei√üer Thun & Marmita',nl:'Witte tonijn & marmita'},
     desc:{es:'Temporada veraniega; guiso marinero con patata.', en:'Summer albacore; sailor‚Äôs stew with potatoes.', fr:'Thon blanc d‚Äô√©t√© ; rago√ªt marinier.', de:'Sommerlicher Wei√üer Thun; Seemanns-Eintopf.', nl:'Zomerse witte tonijn; stoofpot.'}},
    {name:{es:'Corbatas de Unquera',en:'Unquera ‚ÄúCorbatas‚Äù',fr:'Corbatas d‚ÄôUnquera',de:'Corbatas aus Unquera',nl:'Corbatas uit Unquera'},
     desc:{es:'Hojaldre glaseado en forma de pajarita.', en:'Glazed puff-pastry ‚Äúbow ties‚Äù.', fr:'Feuillet√© glac√© en n≈ìud.', de:'Glasiertes Bl√§tterteiggeb√§ck.', nl:'Glazuur-bladerdeeg in strikvorm.'}},
    {name:{es:'Leche frita',en:'Fried milk dessert',fr:'Lait frit',de:'Frittierte Milch',nl:'Gebakken melk'},
     desc:{es:'Dulce cremoso, rebozado con az√∫car y canela.', en:'Creamy dessert coated with sugar and cinnamon.', fr:'Cr√®me frite sucr√©e √† la cannelle.', de:'Cremiges Dessert mit Zucker & Zimt.', nl:'Romig dessert met suiker en kaneel.'}},
    {name:{es:'Percebes & marisco del Cant√°brico',en:'Goose barnacles & seafood',fr:'Pousse-pieds & fruits de mer',de:'Entenmuscheln & Meeresfr√ºchte',nl:'Eendenmosselen & zeevruchten'},
     desc:{es:'Producto de costa brava y aguas fr√≠as: sabor puro a mar.', en:'From the cold, rough Cantabrian sea: pure ocean flavor.', fr:'Saveur iod√©e de la mer Cantabrique.', de:'Intensiver Meeresgeschmack aus kalten Gew√§ssern.', nl:'Pure zeesmaak uit de Cantabrische zee.'}}
  ];

  /* ===== Render Musts & Food ===== */
  function i18nTxt(obj){ return (obj && (obj[LANG]||obj.es||''))||''; }

  function renderMusts(){
    var wrap=$('#mustsAcc'); if(!wrap) return;
    var T=I18N[LANG];
    wrap.innerHTML = MUSTS.map(function(m){
      var head = esc(i18nTxt(m.name));
      var desc = esc(i18nTxt(m.desc));
      var body = '<p class="muted">'+desc+'</p>';
      if(m.see && m.see.length){
        body+='<div class="pill">‚≠ê '+esc(T.see||'Qu√© ver')+'</div>';
        body+='<div class="acc" style="margin-top:8px">'+ m.see.map(function(s){
          var sName=esc(i18nTxt(s.name)); var sDesc=esc(i18nTxt(s.desc));
          var mapBtn = s.map?('<a class="btn sm" href="'+esc(s.map)+'" target="_blank" rel="noopener">'+esc(T.map)+'</a>'):'';
          var imgsBtn= s.images?('<a class="btn sm" href="'+esc(s.images)+'" target="_blank" rel="noopener">'+esc(T.images)+'</a>'):'';
          var tixBtn = s.tickets?('<a class="btn sm" href="'+esc(s.tickets)+'" target="_blank" rel="noopener">'+esc(T.tickets)+'</a>'):'';
          var distSpan = (s.coords?'<span class="muted" data-dist="'+esc(m.slug+'-'+sName)+'"></span>':'');
          return '<div class="acc-item"><div class="acc-h">'+sName+' <span>‚ñº</span></div><div class="acc-b">'
                 + '<p>'+sDesc+' '+distSpan+'</p><div class="row">'+mapBtn+imgsBtn+tixBtn+'</div></div></div>';
        }).join('') + '</div>';
      }
      return '<div class="acc-item"><div class="acc-h" data-m="'+esc(m.slug)+'">'+head+' <span>‚ñº</span></div><div class="acc-b">'+body+'</div></div>';
    }).join('');
    // activar toggles internos
    $all('#mustsAcc .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });
    updateAllMustsDistances();
  }

  function renderFood(){
    var wrap=$('#foodAcc'); if(!wrap) return;
    wrap.innerHTML = FOOD.map(function(f){
      var name=esc(i18nTxt(f.name)); var desc=esc(i18nTxt(f.desc));
      var imgLink=gglImages(name+' Cantabria');
      return '<div class="acc-item"><div class="acc-h">'+name+' <span>‚ñº</span></div>'
        + '<div class="acc-b"><p>'+desc+'</p><div class="row">'
        + '<a class="btn sm" href="'+esc(imgLink)+'" target="_blank" rel="noopener">'+esc(I18N[LANG].images)+'</a>'
        + '</div></div></div>';
    }).join('');
    $all('#foodAcc .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });
  }

  /* ===== Distancias (geolocalizaci√≥n) ===== */
  var GEO=null;
  function requestGeo(){
    try{
      if(!navigator.geolocation) return;
      navigator.geolocation.getCurrentPosition(function(pos){
        GEO={lat:pos.coords.latitude, lon:pos.coords.longitude};
        updateAllMustsDistances(); updateFavsDistances();
      }, function(){}, {enableHighAccuracy:true, maximumAge:600000, timeout:8000});
    }catch(e){}
  }
  function setDistanceSpan(key, kmValue){
    var spans = $all('[data-dist="'+key+'"]');
    spans.forEach(function(sp){ sp.textContent = ' ¬∑ '+(I18N[LANG].distance||'Distancia')+': '+ kmValue; });
  }
  function updateAllMustsDistances(){
    if(!GEO) return;
    MUSTS.forEach(function(m){
      (m.see||[]).forEach(function(s){
        if(s.coords){
          var d = distanceFromUserTo(s.coords);
          if(d!=null) setDistanceSpan(m.slug+'-'+esc(i18nTxt(s.name)), km(d));
        }
      });
    });
  }

  /* ===== Pre-checkin ===== */
  function buildPreMail(){
    var place=$('#prePlace').value;
    var to = EMAILS[place] || EMAILS.oyambre;
    var subject = 'Pre-checkin v√≠a app';
    var lines=[];
    lines.push('Pre-checkin ‚Äî '+(PLACE_LABEL[place]||place));
    lines.push('');
    lines.push('Titular: '+($('#preName').value||'')+' '+($('#preSurname').value||''));
    lines.push('Documento: '+($('#preDoc').value||''));
    lines.push('Fecha nacimiento: '+($('#preBirth').value||''));
    lines.push('Matr√≠cula: '+($('#prePlate').value||''));
    lines.push('');
    lines.push('Acompa√±antes:');
    lines.push($('#preComp').value||'(sin datos)');
    lines.push('');
    lines.push('Enviado desde la app.');
    return {to:to, subject:subject, body:lines.join('\n')};
  }
  function updatePreLinks(){
    var mail = buildPreMail();
    $('#preEmailBtn').href='mailto:'+mail.to+'?subject='+encodeURIComponent(mail.subject)+'&body='+encodeURIComponent(mail.body);
  }
  ['prePlace','preName','preSurname','preDoc','preBirth','prePlate','preComp'].forEach(function(id){
    on($('#'+id),'input',updatePreLinks); on($('#'+id),'change',updatePreLinks);
  });
  on($('#preClearBtn'),'click', function(){
    ['preName','preSurname','preDoc','preBirth','prePlate','preComp'].forEach(id=>$('#'+id).value='');
    $('#prePlace').value=STAY; updatePreLinks();
  });

  /* ===== Favoritos del equipo ===== */
  // Bloques: Pueblos, Actividades, Playas, Restaurantes, Miradores
  // En restaurantes se puede incluir placeId para rating en vivo.
  var FAVS = [
    {cat:'Restaurantes', items:[
      {name:'Taberna El Cardeo (del equipo)', town:'Ruiloba', desc:'Nuestra taberna: cocina casera, desayunos y raciones con producto local.', coords:{lat:43.391,lon:-4.274}, placeId:null, g:'Taberna El Cardeo Ruiloba'},
      {name:'Restaurante Camping Ramales (del equipo)', town:'Ramales', desc:'Restaurante del camping, ambiente familiar, brasa y platos de temporada.', coords:{lat:43.263,lon:-3.465}, placeId:null, g:'Camping Ramales restaurante'},
      {name:'Restaurante Camping El Helguero (del equipo)', town:'Ruiloba', desc:'Cocina de camping con vistas al entorno rural y carta variada.', coords:{lat:43.387,lon:-4.264}, placeId:null, g:'Camping El Helguero restaurante'},
      {name:'Restaurante El Remedio', town:'Ruiloba', desc:'Propuesta gastron√≥mica con vistas al Cant√°brico; ideal para ocasi√≥n especial.', coords:{lat:43.398,lon:-4.274}, placeId:null, g:'Restaurante El Remedio Ruiloba'},
      {name:'Bodega de Miradorio', town:'Ruiloba', desc:'Bodega local con vinos atl√°nticos; visita y cata (seg√∫n temporada).', coords:{lat:43.383,lon:-4.294}, placeId:null, g:'Bodega Miradorio Ruiloba'},
      {name:'Restaurante Las Redes', town:'San Vicente de la Barquera', desc:'Pescado y marisco cl√°sico en la villa marinera.', coords:{lat:43.385,lon:-4.398}, placeId:null, g:'Restaurante Las Redes San Vicente de la Barquera'},
      {name:'Restaurante Boga-Boga', town:'San Vicente de la Barquera', desc:'Arroces y marisco al lado del puerto.', coords:{lat:43.384,lon:-4.395}, placeId:null, g:'Restaurante Boga-Boga San Vicente'},
      {name:'Casa Cofi√±o', town:'Cabu√©rniga', desc:'Cl√°sico de cocina monta√±esa: guisos, carne y postres caseros.', coords:{lat:43.257,lon:-4.287}, placeId:null, g:'Casa Cofi√±o'},
      {name:'La Ostrer√≠a', town:'Santander', desc:'Mariscos y ostras en la capital, ambiente informal.', coords:{lat:43.463,lon:-3.806}, placeId:null, g:'La Ostreria Santander'},
      {name:'Hotel-Restaurante Astuy', town:'Isla', desc:'Producto del Cant√°brico; muy conocido por el marisco y su entorno.', coords:{lat:43.486,lon:-3.517}, placeId:null, g:'Hotel Restaurante Astuy Isla'},
      {name:'Parrilla La Piscina', town:'Isla', desc:'Parrilla popular junto a Astuy; carnes y pescados a la brasa.', coords:{lat:43.4866,lon:-3.5178}, placeId:null, g:'Parrilla La Piscina Isla Cantabria'},
      {name:'La Vinoteca', town:'Santander', desc:'Vinos y cocina de mercado en el centro de Santander.', coords:{lat:43.462,lon:-3.807}, placeId:null, g:'La Vinoteca Santander'},
      {name:'El Molino de Cabu√©rniga', town:'Cabu√©rniga', desc:'Restaurante con encanto junto al r√≠o; cocina c√°ntabra cuidada.', coords:{lat:43.252,lon:-4.288}, placeId:null, g:'El Molino de Cabuerniga'},
      {name:'La Bombi', town:'Santander', desc:'Cl√°sico santanderino de marisco y pescado.', coords:{lat:43.463,lon:-3.800}, placeId:null, g:'La Bombi Santander'},
      {name:'La Capitana', town:'Santander', desc:'Restaurante de cocina marinera-creativa cerca del centro.', coords:{lat:43.463,lon:-3.801}, placeId:null, g:'Restaurante La Capitana Santander'},
      {name:'Restaurante Juan de la Cosa', town:'Santander', desc:'Hist√≥rico restaurante de cocina tradicional marina.', coords:{lat:43.462,lon:-3.800}, placeId:null, g:'Restaurante Juan de la Cosa Santander'}
    ]},
    {cat:'Pueblos', items:[
      {name:'Santander', coords:{lat:43.4623,lon:-3.8099}, desc:'Capital frente a la bah√≠a.'},
      {name:'Comillas', coords:{lat:43.3869,lon:-4.2871}, desc:'Modernismo, playa y palacios.'},
      {name:'San Vicente de la Barquera', coords:{lat:43.3852,lon:-4.3983}, desc:'Puentes, marismas y puerto.'},
      {name:'Ruente', coords:{lat:43.2638,lon:-4.3057}, desc:'La Fuentona y casonas.'},
      {name:'Isla', coords:{lat:43.4862,lon:-3.5157}, desc:'Playas y gastronom√≠a marinera.'},
      {name:'Santillana del Mar', coords:{lat:43.3906,lon:-4.1080}, desc:'Medieval y cercana a Altamira.'},
      {name:'Soba', coords:{lat:43.2144,lon:-3.6360}, desc:'Valle de alta monta√±a.'},
      {name:'Arredondo', coords:{lat:43.2650,lon:-3.6001}, desc:'La ‚Äúcapital del mundo‚Äù, cuevas y monta√±a.'},
      {name:'Ramales de la Victoria', coords:{lat:43.2630,lon:-3.4651}, desc:'Cuevas prehist√≥ricas y aventura.'},
      {name:'Castro Urdiales', coords:{lat:43.3843,lon:-3.2204}, desc:'Villa marinera y g√≥tica junto al mar.'}
    ]},
    {cat:'Actividades', items:[
      {name:'Parque de la Naturaleza de Cab√°rceno', coords:{lat:43.3459,lon:-3.8837}, desc:'Fauna en semilibertad y telecabina.', link:'https://entradas.parquedecabarceno.com/'},
      {name:'Cueva El Soplao', coords:{lat:43.3082,lon:-4.4127}, desc:'Cueva con exc√©ntricas y ruta aventura.', link:'https://www.elsoplao.es/'},
      {name:'Nacimiento del r√≠o As√≥n', coords:{lat:43.2405,lon:-3.6008}, desc:'Espectacular cascada del As√≥n.'},
      {name:'Ruta de los acantilados (San Vicente)', coords:{lat:43.3992,lon:-4.4087}, desc:'Sendero costero con vistas.'},
      {name:'Ruta de la Dama Roja (interior)', coords:{lat:43.2514,lon:-4.4140}, desc:'Senda de interior hacia miradores y bosque.'},
      {name:'Ruta de la Cascada de Lami√±a', coords:{lat:43.2659,lon:-4.2589}, desc:'Paseo entre bosque atl√°ntico a peque√±as cascadas.'}
    ]},
    {cat:'Playas', items:[
      {name:'Playa de Gerra y Mer√≥n', coords:{lat:43.3944,lon:-4.3826}, desc:'Gran arenal abierto; surf y atardeceres.'},
      {name:'Playa de Oyambre', coords:{lat:43.3915,lon:-4.3555}, desc:'Parque natural y dunas protegidas.'},
      {name:'Playa de Matale√±as', coords:{lat:43.4845,lon:-3.7923}, desc:'Cala urbana con acceso por escaleras.'},
      {name:'Playa de Liencres', coords:{lat:43.4502,lon:-3.9637}, desc:'Sistema dunar y olas potentes.'},
      {name:'El Puntal (Somo)', coords:{lat:43.4556,lon:-3.7696}, desc:'Lengua de arena frente a Santander.'},
      {name:'Playa de la Salv√© (Laredo)', coords:{lat:43.4138,lon:-3.4150}, desc:'Kil√≥metros de arena fina.'},
      {name:'Playa de Gulpiyuri', coords:{lat:43.4489,lon:-4.9637}, desc:'Playa interior (Asturias, cerca).'}
    ]},
    {cat:'Miradores', items:[
      {name:'Mirador de la G√°ndara (Soba)', coords:{lat:43.2197,lon:-3.6213}, desc:'Vistas sobre el valle de Soba.'},
      {name:'Mirador del r√≠o As√≥n', coords:{lat:43.2397,lon:-3.6010}, desc:'Cascada y desfiladero del As√≥n.'},
      {name:'La Picota (Liencres)', coords:{lat:43.4386,lon:-3.9636}, desc:'Panor√°mica de costa y r√≠as.'},
      {name:'Cabo de Oyambre', coords:{lat:43.3984,lon:-4.3908}, desc:'Acantilados y farallones.'},
      {name:'Mirador El Remedio', coords:{lat:43.4003,lon:-4.2751}, desc:'Vistas al Cant√°brico.'},
      {name:'Mirador de Santa Catalina', coords:{lat:43.2575,lon:-4.5551}, desc:'Balc√≥n sobre La Hermida.'},
      {name:'Estaci√≥n telef√©rico Fuente D√©', coords:{lat:43.1444,lon:-4.8146}, desc:'Acceso a alta monta√±a.'},
      {name:'Puerto de Lunada', coords:{lat:43.1206,lon:-3.5737}, desc:'Paso de monta√±a entre Cantabria y Burgos.'}
    ]}
  ];

  // Soporte de override desde Admin
  var FAVS_STORE_KEY = 'favs_json';
  function loadFavsOverride(){ try{ var txt=localStorage.getItem(FAVS_STORE_KEY); if(!txt) return null; var obj=JSON.parse(txt); return Array.isArray(obj)?obj:null; }catch(e){return null;} }
  function setFavsFromOverrideIfAny(){ var ov=loadFavsOverride(); if(ov) FAVS=ov; }
  setFavsFromOverrideIfAny();

  function renderFavs(){
    var wrap=$('#favsAcc'); if(!wrap) return;
    var T=I18N[LANG];
    wrap.innerHTML = FAVS.map(function(block){
      var itemsHtml = (block.items||[]).map(function(it){
        var id = slug(it.name+'-'+(it.town||''));
        var distSpan = it.coords?('<span class="muted" data-fdist="'+esc(id)+'"></span>'):'';
        var link = it.link?('<a class="btn sm" href="'+esc(it.link)+'" target="_blank" rel="noopener">üåê</a>'):'';
        var maps = it.coords?('<a class="btn sm" href="'+esc(gglMaps(it.name+' '+(it.town||'Cantabria')))+'" target="_blank" rel="noopener">'+esc(I18N[LANG].map)+'</a>'):'';
        var rating = '<span class="muted" id="rate-'+esc(id)+'"></span>';
        return '<div class="acc-item"><div class="acc-h">'+esc(it.name)+(it.town?(' ¬∑ '+esc(it.town)):'')+' <span>‚ñº</span></div>'
             + '<div class="acc-b"><p>'+esc(it.desc||'')+' '+distSpan+' '+rating+'</p><div class="row">'+maps+link+'</div></div></div>';
      }).join('');
      return '<div class="acc-item"><div class="acc-h">'+esc(block.cat)+' <span>‚ñº</span></div><div class="acc-b">'+itemsHtml+'</div></div>';
    }).join('');
    $all('#favsAcc .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });
    updateFavsDistances();
  }

  function slug(s){return String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'').slice(0,80);}
  function updateFavsDistances(){
    if(!GEO) return;
    FAVS.forEach(function(b){
      (b.items||[]).forEach(function(it){
        if(it.coords){
          var d = distanceFromUserTo(it.coords);
          var id = slug(it.name+'-'+(it.town||''));
          var spans = $all('[data-fdist="'+id+'"]');
          spans.forEach(function(sp){ sp.textContent = ' ¬∑ '+(I18N[LANG].distance||'Distancia')+': '+km(d); });
        }
      });
    });
  }

  /* ===== Sugerencias ===== */
  var SUG_KEY = 'suggestions_history_v1';
  function sugCollect(){
    return {
      place: $('#sugPlace').value,
      name: $('#sugName').value.trim(),
      email: $('#sugEmail').value.trim(),
      phone: $('#sugPhone').value.trim(),
      type: $('#sugType').value,
      msg: $('#sugMsg').value.trim(),
      ts: Date.now()
    };
  }
  function sugBuildMail(d){
    var place = PLACE_LABEL[d.place] || d.place || '‚Äî';
    var subject = 'Sugerencia desde la app';
    var lines = [];
    lines.push('Sugerencia ‚Äî '+place);
    lines.push('');
    if(d.name) lines.push('Nombre: '+d.name);
    if(d.email) lines.push('Email: '+d.email);
    if(d.phone) lines.push('Tel√©fono: '+d.phone);
    lines.push('Tema: '+d.type);
    lines.push('');
    lines.push('Mensaje:');
    lines.push(d.msg || '(vac√≠o)');
    lines.push('');
    lines.push('‚Äî');
    lines.push(new Date(d.ts).toLocaleString());
    return {subject, body: lines.join('\n')};
  }
  function sugApplyLinks(){
    var d = sugCollect();
    var mailTo = EMAILS[d.place] || EMAILS.oyambre;
    var built = sugBuildMail(d);
    $('#sugEmailBtn').href = 'mailto:'+mailTo+'?subject=' + encodeURIComponent(built.subject) + '&body=' + encodeURIComponent(built.body);
    var wa = WHATSAPP[d.place] || WHATSAPP.oyambre;
    $('#sugWABtn').href = 'https://wa.me/'+wa+'?text=' + encodeURIComponent(built.body);
  }
  ['sugPlace','sugName','sugEmail','sugPhone','sugType','sugMsg'].forEach(id=>{
    on($('#'+id),'input', sugApplyLinks); on($('#'+id),'change', sugApplyLinks);
  });
  function sugLoad(){ try{ return JSON.parse(localStorage.getItem(SUG_KEY)||'[]'); }catch(e){ return []; } }
  function sugSaveAll(arr){ localStorage.setItem(SUG_KEY, JSON.stringify(arr)); }
  function sugSaveOne(){
    var d=sugCollect();
    if(!d.msg){ alert('Escribe tu sugerencia antes de guardar o enviar.'); return; }
    var all=sugLoad(); all.unshift(d); sugSaveAll(all); renderSugList(); alert('Guardado en el historial de este dispositivo.');
  }
  function renderSugList(){
    var list = sugLoad();
    var wrap = $('#sugList');
    if(!wrap) return;
    if(!list.length){ wrap.innerHTML = '<div class="muted">No hay sugerencias guardadas.</div>'; return; }
    wrap.innerHTML = list.map(function(it,idx){
      var when = new Date(it.ts).toLocaleString();
      var title = (PLACE_LABEL[it.place]||it.place)+' ¬∑ '+(it.type||'');
      var body = (it.msg||'').replace(/</g,'&lt;');
      return '<div class="acc-item"><div class="acc-h">'+title+' <span class="muted">'+when+'</span> <span>‚ñº</span></div>'
           + '<div class="acc-b"><p>'+body+'</p><div class="row">'
           + '<button class="btn sm" data-idx="'+idx+'" data-act="mail">‚úâÔ∏è Email</button>'
           + '<button class="btn sm" data-idx="'+idx+'" data-act="wa">üü¢ WhatsApp</button>'
           + '<button class="btn sm ghost" data-idx="'+idx+'" data-act="del">üóëÔ∏è Borrar</button>'
           + '</div></div></div>';
    }).join('');
    $all('#sugList [data-act]').forEach(function(b){
      on(b,'click', function(){
        var idx = parseInt(b.getAttribute('data-idx'),10);
        var all = sugLoad(); var it=all[idx]; if(!it) return;
        var built = sugBuildMail(it);
        if(b.getAttribute('data-act')==='del'){ all.splice(idx,1); sugSaveAll(all); renderSugList(); return; }
        if(b.getAttribute('data-act')==='mail'){
          var to = EMAILS[it.place]||EMAILS.oyambre;
          window.open('mailto:'+to+'?subject='+encodeURIComponent(built.subject)+'&body='+encodeURIComponent(built.body),'_blank');
        }else{
          var wa = WHATSAPP[it.place]||WHATSAPP.oyambre;
          window.open('https://wa.me/'+wa+'?text='+encodeURIComponent(built.body),'_blank');
        }
      });
    });
  }
  on($('#sugSaveBtn'),'click', sugSaveOne);
  on($('#sugClearBtn'),'click', function(){
    ['sugName','sugEmail','sugPhone','sugMsg'].forEach(id=>$('#'+id).value='');
    $('#sugType').value='mejora'; $('#sugPlace').value=STAY; sugApplyLinks();
  });

  /* ===== Admin (activar con 5 toques en el logo) ===== */
  (function adminActivator(){
    var logo=$('#logoTap'); var taps=0,timer=null;
    function askForPin(){
      var stored = localStorage.getItem('admin_pin') || '311974';
      var entered = window.prompt('Introduce la contrase√±a de admin:','');
      if(entered===null) return false;
      if(entered===stored) return true;
      alert('Contrase√±a incorrecta'); return false;
    }
    on(logo,'click', function(){
      taps++; clearTimeout(timer); timer=setTimeout(function(){taps=0},1000);
      if(taps>=5){
        taps=0;
        if(document.body.classList.contains('admin-on')){
          localStorage.setItem('admin','0'); document.body.classList.remove('admin-on'); alert('Modo admin desactivado');
        }else{
          if(!askForPin()) return;
          localStorage.setItem('admin','1'); document.body.classList.add('admin-on');
          openAdminModal();
        }
      }
    });
  })();

  function openAdminModal(){
    var m=$('#adminModal'); if(m){ m.style.display='flex'; document.body.classList.add('modal-open'); }
    loadEventsAdmin(); loadSchedulesAdmin(); loadIntegrationsCfgToForm(); loadFavsAdmin();
  }
  function closeAdminModal(){ var m=$('#adminModal'); if(m){ m.style.display='none'; document.body.classList.remove('modal-open'); } }
  on($('#closeAdmin'),'click', function(e){ e.preventDefault(); closeAdminModal(); });
  on($('#adminModal'),'click', function(e){ if(e.target && e.target.id==='adminModal'){ closeAdminModal(); } });
  document.addEventListener('keydown', function(e){ if(e.key==='Escape'){ closeAdminModal(); } });
  on($('#openAdmin'),'click', function(){ if(!document.body.classList.contains('admin-on')) return; openAdminModal(); });

  var ADMIN_EVENTS=[];
  function isoFromLocal(dt){ var d=new Date(dt); if(isNaN(d.getTime())) return dt; var tz=-d.getTimezoneOffset(),sign=tz>=0?'+':'-'; function p(n){return ('0'+n).slice(-2);} return d.getFullYear()+'-'+p(d.getMonth()+1)+'-'+p(d.getDate())+'T'+p(d.getHours())+':'+p(d.getMinutes())+':'+p(d.getSeconds())+sign+p(Math.floor(Math.abs(tz)/60))+':'+p(Math.abs(tz)%60); }

  function loadEventsAdmin(){
    fetch('./events.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>r.json()).then(data=>{ ADMIN_EVENTS = Array.isArray(data)?data:[]; renderAdminTable(); })
      .catch(()=>{ ADMIN_EVENTS=[]; renderAdminTable(); });
  }
  function renderAdminTable(){
    var tbody = $('#eventsTable tbody'); if(!tbody) return;
    tbody.innerHTML = ADMIN_EVENTS.slice().sort((a,b)=>new Date(a.fecha)-new Date(b.fecha)).map(function(ev){
      var titleES=(typeof ev.titulo==='string'?ev.titulo:((ev.titulo&&ev.titulo.es)||''))||'';
      var lugarES=(typeof ev.lugar==='string'?ev.lugar:((ev.lugar&&ev.lugar.es)||''))||'';
      var dt=new Date(ev.fecha);
      var val = dt.getFullYear()+'-'+pad2(dt.getMonth()+1)+'-'+pad2(dt.getDate())+'T'+pad2(dt.getHours())+':'+pad2(dt.getMinutes());
      return '<tr data-id="'+ev.id+'">'
        + '<td class="muted" style="white-space:nowrap">'+esc(ev.id)+'</td>'
        + '<td><input class="input dt" type="datetime-local" value="'+val+'"><div class="muted">'+esc(dt.toLocaleString())+'</div></td>'
        + '<td><select class="select camp"><option value="oyambre" '+(ev.camping==='oyambre'?'selected':'')+'>oyambre</option><option value="ramales" '+(ev.camping==='ramales'?'selected':'')+'>ramales</option><option value="ruiloba" '+(ev.camping==='ruiloba'?'selected':'')+'>ruiloba</option><option value="cardeo" '+(ev.camping==='cardeo'?'selected':'')+'>cardeo</option></select>'
        + '<input class="input lugar" style="margin-top:6px" placeholder="Lugar (ES)" value="'+esc(lugarES)+'"></td>'
        + '<td><input class="input titulo" placeholder="T√≠tulo (ES)" value="'+esc(titleES)+'">'
        + '<textarea class="textarea desc" rows="2" placeholder="Descripci√≥n (ES)" style="margin-top:6px">'+esc(((ev.descripcion&&ev.descripcion.es)||''))+'</textarea>'
        + '<input class="input img" placeholder="Imagen (URL)" value="'+esc((ev.imagen||ev.image||''))+'" style="margin-top:6px"></td>'
        + '<td style="min-width:220px"><button class="btn act-save">Guardar</button> <button class="btn act-dup">Duplicar</button> <button class="btn act-del">Borrar</button></td>'
      + '</tr>';
    }).join('');
    $all('#eventsTable tbody tr').forEach(function(tr){
      var id = tr.getAttribute('data-id');
      on(tr.querySelector('.act-save'),'click', function(){ saveRow(tr,id); });
      on(tr.querySelector('.act-dup'),'click', function(){ duplicateRow(id); });
      on(tr.querySelector('.act-del'),'click', function(){ deleteRow(id); });
    });
  }
  function getRowValues(tr){
    return {
      dateLocal: tr.querySelector('.dt').value,
      camping: tr.querySelector('.camp').value,
      lugar: (tr.querySelector('.lugar').value||'').trim(),
      titulo: (tr.querySelector('.titulo').value||'').trim(),
      desc: (tr.querySelector('.desc').value||'').trim(),
      img: (tr.querySelector('.img').value||'').trim()
    };
  }
  function defaultLugar(p){ if(p==='oyambre')return 'Camping Caravaning Playa de Oyambre'; if(p==='ramales')return 'Camping Ramales'; if(p==='ruiloba')return 'Camping El Helguero'; if(p==='cardeo')return 'Apartamentos El Cardeo'; return ''; }
  function saveRow(tr,id){
    var v=getRowValues(tr); if(!v.titulo||!v.dateLocal||!v.camping){alert('Rellena t√≠tulo, fecha y alojamiento.');return;}
    var idx=ADMIN_EVENTS.findIndex(e=>e.id===id); if(idx<0) return;
    ADMIN_EVENTS[idx].fecha=isoFromLocal(v.dateLocal);
    ADMIN_EVENTS[idx].camping=v.camping;
    ADMIN_EVENTS[idx].titulo={es:v.titulo};
    ADMIN_EVENTS[idx].lugar={es:v.lugar||defaultLugar(v.camping)};
    ADMIN_EVENTS[idx].descripcion={es:v.desc||''};
    if(v.img) ADMIN_EVENTS[idx].imagen=v.img; else delete ADMIN_EVENTS[idx].imagen;
    renderAdminTable();
  }
  function duplicateRow(id){
    var o=ADMIN_EVENTS.find(e=>e.id===id); if(!o) return;
    var titleES=(o.titulo&&o.titulo.es)||''; var newId='ev-'+slug(titleES)+'-'+o.camping+'-'+Date.now().toString().slice(-8);
    var copy=JSON.parse(JSON.stringify(o)); copy.id=newId; ADMIN_EVENTS.push(copy); renderAdminTable();
  }
  function deleteRow(id){ if(!confirm('¬øBorrar este evento?')) return; ADMIN_EVENTS = ADMIN_EVENTS.filter(e=>e.id!==id); renderAdminTable(); }

  /* Schedules admin */
  function loadSchedulesAdmin(){ var a=$('#schedJsonArea'); if(!a) return; try{ a.value=JSON.stringify(SCHEDULES,null,2); }catch(e){ a.value='{}'; } }
  on($('#schedApplyBtn'),'click', function(){ var a=$('#schedJsonArea'); try{ var obj=JSON.parse(a.value); if(!obj||typeof obj!=='object') throw 0; SCHEDULES=obj; renderAcc(); renderStayHours(); alert('Horarios aplicados.'); }catch(e){ alert('JSON inv√°lido.'); } });
  on($('#exportSchedBtn'),'click', function(){ var blob=new Blob([JSON.stringify(SCHEDULES,null,2)],{type:'application/json'}); var url=URL.createObjectURL(blob); var a=document.createElement('a'); a.href=url; a.download='schedules.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
  on($('#importSchedFile'),'change', function(e){ var f=e.target.files && e.target.files[0]; if(!f) return; f.text().then(function(txt){ var data=JSON.parse(txt); if(!data||typeof data!=='object') throw 0; SCHEDULES=data; renderAcc(); loadSchedulesAdmin(); renderStayHours(); }).catch(function(){ alert('No se pudo leer schedules.json'); }).finally(function(){ e.target.value=''; }); });

  /* Integraciones: Google Maps API Key */
  var INTEGRATIONS_KEY='integrations_cfg';
  function loadIntegrationsCfgToForm(){
    var cfg = JSON.parse(localStorage.getItem(INTEGRATIONS_KEY)||'{}');
    $('#gmapsKey').value = cfg.gmapsKey||'';
  }
  on($('#saveIntegrations'),'click', function(){
    var cfg={gmapsKey:($('#gmapsKey').value||'').trim()};
    localStorage.setItem(INTEGRATIONS_KEY, JSON.stringify(cfg));
    alert('Integraciones guardadas');
  });
  on($('#reloadMaps'),'click', function(){ loadGoogleMapsIfKey(); });

  /* Favoritos admin */
  function loadFavsAdmin(){ var a=$('#favsJsonArea'); if(!a) return; try{ a.value=JSON.stringify(FAVS,null,2); }catch(e){ a.value='[]'; } }
  on($('#favsApplyBtn'),'click', function(){
    var a=$('#favsJsonArea'); try{
      var obj=JSON.parse(a.value);
      if(!Array.isArray(obj)) throw 0;
      localStorage.setItem(FAVS_STORE_KEY, JSON.stringify(obj));
      FAVS = obj;
      renderFavs();
      alert('Favoritos aplicados.');
    }catch(e){ alert('JSON inv√°lido.'); }
  });
  on($('#exportFavsBtn'),'click', function(){
    var blob=new Blob([JSON.stringify(FAVS,null,2)],{type:'application/json'});
    var url=URL.createObjectURL(blob);
    var a=document.createElement('a'); a.href=url; a.download='favoritos.json';
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });
  on($('#importFavsFile'),'change', function(e){
    var f=e.target.files && e.target.files[0]; if(!f) return;
    f.text().then(function(txt){
      var data=JSON.parse(txt); if(!Array.isArray(data)) throw 0;
      localStorage.setItem(FAVS_STORE_KEY, JSON.stringify(data));
      FAVS=data; renderFavs(); loadFavsAdmin();
    }).catch(function(){ alert('No se pudo leer favoritos.json'); }).finally(function(){ e.target.value=''; });
  });

  /* ===== Google Maps / Places (opcional) ===== */
  var GMAPS_READY=false, PLACES=null;
  function loadGoogleMapsIfKey(){
    var cfg = JSON.parse(localStorage.getItem(INTEGRATIONS_KEY)||'{}');
    if(!cfg.gmapsKey){ GMAPS_READY=false; PLACES=null; return; }
    if(window.google && window.google.maps){ GMAPS_READY=true; PLACES=new google.maps.places.PlacesService(document.createElement('div')); fetchLiveRatings(); return; }
    var s=document.createElement('script');
    s.src='https://maps.googleapis.com/maps/api/js?key='+encodeURIComponent(cfg.gmapsKey)+'&libraries=places';
    s.async=true; s.defer=true;
    s.onload=function(){ GMAPS_READY=true; try{ PLACES=new google.maps.places.PlacesService(document.createElement('div')); fetchLiveRatings(); }catch(e){} };
    document.head.appendChild(s);
  }
  function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
  function updateRestaurantRatingDOM(id, rating, total){
    var el=$('#rate-'+id); if(!el) return;
    if(rating!=null){ el.textContent=' ¬∑ ‚≠ê '+rating.toFixed(1)+' ('+(total||0)+')'; }
  }
  async function fetchLiveRatings(){
    if(!GMAPS_READY || !PLACES) return;
    var restBlock = (FAVS.find(b=>b.cat==='Restaurantes')||{}).items||[];
    for(let i=0;i<restBlock.length;i++){
      let it=restBlock[i];
      let id = slug(it.name+'-'+(it.town||''));
      // Preferir Place ID si est√°
      if(it.placeId){
        try{
          PLACES.getDetails({placeId: it.placeId, fields:['rating','user_ratings_total','url','name']}, function(det,st){
            if(st===google.maps.places.PlacesServiceStatus.OK && det){
              updateRestaurantRatingDOM(id, det.rating, det.user_ratings_total);
            }
          });
        }catch(e){}
        await sleep(120);
        continue;
      }
      // Fallback por texto
      let q = (it.g || (it.name+' '+(it.town||'Cantabria')));
      let req = { query:q };
      if(it.coords){ req.location = new google.maps.LatLng(it.coords.lat, it.coords.lon); req.radius=10000; }
      PLACES.textSearch(req, function(results,status){
        if(status===google.maps.places.PlacesServiceStatus.OK && results && results[0]){
          var cand = results[0];
          PLACES.getDetails({placeId:cand.place_id, fields:['rating','user_ratings_total','url','name']}, function(det,st2){
            if(st2===google.maps.places.PlacesServiceStatus.OK && det){
              updateRestaurantRatingDOM(id, det.rating, det.user_ratings_total);
            }
          });
        }
      });
      await sleep(150);
    }
  }

  /* ===== PWA install: modal con gu√≠a ===== */
  var deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); deferredPrompt=e; });
  function platformGuide(){
    var ua=navigator.userAgent||''; var isIOS=/iP(ad|hone|od)/.test(ua); var isAndroid=/Android/i.test(ua);
    if(isIOS){
      return '<ol><li>Abre en <b>Safari</b>.</li><li>Toca <b>Compartir</b> (icono cuadrado con flecha).</li><li>Elige <b>A√±adir a pantalla de inicio</b>.</li><li>Confirma con <b>A√±adir</b>.</li></ol>';
    }else if(isAndroid){
      return '<ol><li>Abre en <b>Chrome</b>.</li><li>Toca <b>‚ãÆ</b> > <b>A√±adir a pantalla de inicio</b>.</li><li>Sigue las instrucciones.</li></ol>';
    }else{
      return '<p>En escritorio, busca <b>Instalar app</b> en la barra de direcciones o el men√∫ del navegador.</p>';
    }
  }
  function openInstallModal(){
    $('#instBody').innerHTML = platformGuide();
    $('#installModal').style.display='flex'; document.body.classList.add('modal-open');
  }
  on($('#installTile'),'click', openInstallModal);
  on($('#closeInstall'),'click', function(e){ e.preventDefault(); $('#installModal').style.display='none'; document.body.classList.remove('modal-open'); });
  on($('#instNow'),'click', function(){
    if(deferredPrompt){ try{ deferredPrompt.prompt(); deferredPrompt.userChoice && deferredPrompt.userChoice.then(function(){}); }catch(e){} deferredPrompt=null; }
    else alert('Si no aparece el di√°logo, usa los pasos indicados arriba.');
  });

  /* ===== Init ===== */
  function initIncTypesAndUI(){
    fillIncTypes();
    $('#incPlace').value=STAY;
    updateIncUI();
  }

  // Iniciales de UI
  $('#stayWeb').textContent=I18N[LANG].web;
  $('#stayCall').textContent=I18N[LANG].call;
  $('#stayWA').textContent=I18N[LANG].whatsapp;
  $('#stayEmail').textContent=I18N[LANG].email;
  $('#stayDir').textContent=I18N[LANG].directions;

  $('#stayPlace').value=STAY;
  $('#incPlace').value=STAY;
  $('#prePlace').value=STAY;

  loadSchedules();
  loadEvents();
  renderAcc();
  updateStayUI();
  initIncTypesAndUI();
  renderMusts();
  renderFood();
  renderFavs();
  renderSugList();
  sugApplyLinks();
  updatePreLinks();
  requestGeo();
  loadGoogleMapsIfKey();

  /* ===== Service Worker ===== */
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('./service-worker.js');
    navigator.serviceWorker.addEventListener('message', (e) => {
      if (e.data && e.data.type === 'SW_ACTIVE') {
        console.log('PWA actualizada a', e.data.version);
      }
    });
  }

}); // DOMContentLoaded
</script>
</body>
</html>
