<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Grupo A Cobijo</title>

  <meta name="description" content="Tu guía en el camping: eventos, horarios, mapas y contacto del Grupo A Cobijo.">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0ea5e9">
  <link rel="icon" href="assets/icons/icon-192.png">

  <!-- iOS modo App + status bar -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">

  <!-- Splash iPhone (PORTRAIT) -->
  <link rel="apple-touch-startup-image" href="assets/splash/iphone-15pm-portrait.png?v=5" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="assets/splash/iphone-15p-portrait.png?v=5"  media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="assets/splash/iphone-14-15-plus-portrait.png?v=5" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="assets/splash/iphone-12pm-portrait.png?v=5" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="assets/splash/iphone-12-14-portrait.png?v=5" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="assets/splash/iphone-x-11pro-portrait.png?v=5" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="assets/splash/ipad-pro-11-portrait.png?v=5"    media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="assets/splash/ipad-pro-12-9-portrait.png?v=5" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <style>
    :root{
      --bg:#ffffff; --card:#f4f9ff; --accent:#0077cc; --muted:#6b7a8c;
      --text:#0a1a2a; --line:#dce7f5; --tint:#eaf4ff; --accent-ink:#064e89;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:#fff;color:var(--text)}
    .wrap{max-width:900px;margin:0 auto;padding:24px}

    /* Pre-splash interno */
    .app-splash{position:fixed;inset:0;background:#fff;display:grid;place-items:center;z-index:9999}
    .app-splash img{width:180px;height:auto;opacity:.95}

    header{display:flex;align-items:center;gap:16px;margin:8px 0 12px;flex-wrap:wrap}
    .logo-img{height:80px;width:auto;object-fit:contain}
    .tag{font-size:.85rem;color:var(--muted)}
    .spacer{flex:1}
    .pill{border:1px solid var(--line);background:var(--tint);padding:4px 10px;border-radius:999px;font-size:.8rem}

    .lang-btn{appearance:none;border:1px solid var(--line);background:#fff;color:var(--accent-ink);
      padding:6px 12px;border-radius:12px;font-weight:700;display:flex;align-items:center;gap:6px}

    .hero{margin:8px 0 18px;background:linear-gradient(180deg,#f8fbff,#eef5ff);
      border:1px solid var(--line);border-radius:16px;padding:16px}
    .hero h2{margin:0 0 4px;font-size:1.2rem}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin:16px 0 28px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);display:flex;flex-direction:column;gap:12px}

    .row{display:flex;flex-wrap:wrap;gap:8px}
    .btn{appearance:none;border:1px solid var(--line);background:rgba(0,119,204,.08);
      color:var(--accent-ink);padding:10px 12px;border-radius:12px;text-decoration:none;
      display:flex;align-items:center;justify-content:center;font-weight:600;
      flex:1;min-width:120px}
    .btn.small{padding:6px 10px}

    .map{width:100%;aspect-ratio:16/10;border-radius:12px;overflow:hidden;border:1px solid var(--line)}
    .map iframe{width:100%;height:100%;border:0}

    .event-card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px}
    .event-title{font-weight:600}
    .event-meta{font-size:.85rem;color:var(--muted)}

    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;
      align-items:center;justify-content:center;z-index:10001}
    .modal{width:min(92vw,900px);background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.2)}
    .modal .close{background:transparent;border:none;color:var(--muted);font-weight:700;float:right}

    footer{margin-top:12px;font-size:.9rem;opacity:.85}
    .ok{color:#21a653}
    .install{display:none}

    /* Admin panel */
    .admin-btn{display:none; margin:8px 0 0}
    .admin-on .admin-btn{display:inline-flex}
    .table{width:100%; border-collapse: collapse; font-size:.9rem}
    .table th,.table td{border:1px solid var(--line); padding:6px 8px; text-align:left; vertical-align:top}
    .table th{background:var(--tint)}
    .input, .select, .textarea{ width:100%; padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:#fff }
    .muted{color:var(--muted); font-size:.85rem}
  </style>
</head>

<body>
<div class="app-splash" id="appSplash"><img src="assets/logo.png" alt="A Cobijo"></div>

<div class="wrap">
<header>
  <img src="assets/logo.png" class="logo-img" alt="Grupo A Cobijo">
  <div>
    <h1 id="t-app">Grupo A Cobijo</h1>
    <div class="tag" id="t-subtitle">Tu estancia con nosotros · Oyambre · Ramales · Ruiloba</div>
  </div>
  <div class="spacer"></div>
  <button class="lang-btn" id="langBtn">🌐 ES</button>
  <span class="pill" id="t-pwa">PWA • Offline</span>
</header>

<!-- Modal idiomas -->
<div class="modal-backdrop" id="langModal" style="display:none">
  <div class="modal">
    <button id="closeLang" class="close" aria-label="Cerrar">✕</button>
    <h3 id="langTitle">Selecciona idioma</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px">
      <button class="btn lang-option" data-lang="es">🇪🇸 Español</button>
      <button class="btn lang-option" data-lang="en">🇬🇧 English</button>
      <button class="btn lang-option" data-lang="fr">🇫🇷 Français</button>
      <button class="btn lang-option" data-lang="de">🇩🇪 Deutsch</button>
      <button class="btn lang-option" data-lang="nl">🇳🇱 Nederlands</button>
    </div>
  </div>
</div>

<section class="hero">
  <h2 id="t-hero-title">Tu guía en el camping</h2>
  <p id="t-hero-desc">Eventos, horarios, cómo llegar y contacto — todo en tu móvil, también sin cobertura.</p>
</section>

<!-- Botón admin (oculto hasta activar modo admin) -->
<div>
  <button id="openAdmin" class="btn admin-btn">➕ Añadir / editar eventos</button>
</div>

<!-- EVENTOS -->
<section>
  <h2 id="t-events-title">Eventos Grupo A Cobijo</h2>
  <div id="events" class="grid"></div>
</section>

<!-- HORARIOS -->
<section class="card">
  <h2 id="t-schedules-title">Horarios</h2>
  <p class="hint" id="t-schedules-hint">Recepción, restaurante, piscina... elige tu camping.</p>
  <div class="row">
    <button class="btn" id="h-oy">Ver horarios Oyambre</button>
    <button class="btn" id="h-ra">Ver horarios Ramales</button>
    <button class="btn" id="h-he">Ver horarios Ruiloba</button>
  </div>
</section>

<!-- CAMPINGS -->
<section style="margin-top:24px">
  <h2 id="t-campings-title">Nuestros campings</h2>
  <div class="grid">

    <!-- Oyambre -->
    <article class="card">
      <h2 id="t-oy-title">Camping Caravaning Playa de Oyambre</h2>
      <p class="hint" id="t-oy-hint">Todos los servicios · Frente al mar</p>
      <div class="row">
        <a class="btn" data-i18n-web href="https://www.oyambre.com" target="_blank" rel="noopener">Web</a>
        <a class="btn" data-i18n-call href="tel:+34942711461">Llamar</a>
        <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre" target="_blank" rel="noopener">Cómo llegar</a>
        <a class="btn" data-i18n-whatsapp href="https://wa.me/34675696212" target="_blank" rel="noopener">WhatsApp</a>
      </div>
      <div class="map"><iframe src="https://www.google.com/maps?q=Camping+Caravaning+Playa+de+Oyambre&output=embed" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div>
    </article>

    <!-- Ramales -->
    <article class="card">
      <h2 id="t-ra-title">Camping Ramales</h2>
      <p class="hint" id="t-ra-hint">Cuevas · Montaña · Actividades</p>
      <div class="row">
        <a class="btn" data-i18n-web href="https://www.campingramales.com" target="_blank" rel="noopener">Web</a>
        <a class="btn" data-i18n-call href="tel:+34654463133">Llamar</a>
        <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Ramales" target="_blank" rel="noopener">Cómo llegar</a>
        <a class="btn" data-i18n-whatsapp href="https://wa.me/34654463133" target="_blank" rel="noopener">WhatsApp</a>
      </div>
      <div class="map"><iframe src="https://www.google.com/maps?q=Camping+Ramales&output=embed" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div>
    </article>

    <!-- Ruiloba -->
    <article class="card">
      <h2 id="t-he-title">Camping El Helguero (Ruiloba)</h2>
      <p class="hint" id="t-he-hint">Naturaleza · Familiar · Mascotas</p>
      <div class="row">
        <a class="btn" data-i18n-web href="https://www.campingelhelguero.com" target="_blank" rel="noopener">Web</a>
        <a class="btn" data-i18n-call href="tel:+34942722124">Llamar</a>
        <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+El+Helguero" target="_blank" rel="noopener">Cómo llegar</a>
        <a class="btn" data-i18n-whatsapp href="https://wa.me/34652806564" target="_blank" rel="noopener">WhatsApp</a>
      </div>
      <div class="map"><iframe src="https://www.google.com/maps?q=Camping+El+Helguero&output=embed" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div>
    </article>

  </div>
</section>

<!-- NUEVA SECCIÓN: OTROS ALOJAMIENTOS -->
<section style="margin-top:24px">
  <h2 id="t-others-title">Otros alojamientos del grupo</h2>

  <div class="grid">
    <article class="card">
      <h2 id="t-ca-title">Apartamentos El Cardeo</h2>
      <p class="hint" id="t-ca-hint">Apartamentos + Taberna</p>

      <div class="row">
        <a class="btn" data-i18n-web href="https://www.elcardeo.es" target="_blank" rel="noopener">Web</a>
        <a class="btn" data-i18n-call href="tel:+34664686158">Llamar</a>
        <a class="btn" data-i18n-directions href="https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6" target="_blank" rel="noopener">Cómo llegar</a>
        <a class="btn" data-i18n-whatsapp href="https://wa.me/34664686158" target="_blank" rel="noopener">WhatsApp</a>
      </div>

      <div class="map"><iframe src="https://www.google.com/maps?q=Apartamentos+El+Cardeo&output=embed" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div>
    </article>
  </div>
</section>

<!-- INSTALAR APP -->
<section class="card">
  <h2 id="t-install-title">Instálame como app</h2>
  <p class="hint" id="t-install-hint">Android: ⋮ → Instalar app. iOS: Compartir → Añadir a pantalla de inicio.</p>
  <button id="installBtn" class="btn install">Instalar ahora</button>
  <p id="pwaStatus" class="hint"></p>
</section>

<footer>
  © <span id="year"></span> Grupo A Cobijo · <span class="ok" id="t-offline">Funciona sin conexión</span> ●
</footer>
</div>

<!-- MODAL ADMIN eventos -->
<div class="modal-backdrop" id="adminModal" style="display:none" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
  <div class="modal">
    <button class="close" id="closeAdmin" aria-label="Cerrar">✕</button>
    <h3 id="adminTitle">Gestión de eventos</h3>

    <div class="card" style="margin-top:8px">
      <h4 style="margin:0 0 8px">Añadir evento</h4>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
        <div>
          <label>Título (ES)</label>
          <input id="evTitle" class="input" placeholder="Ej: Concierto acústico" />
        </div>
        <div>
          <label>Fecha y hora</label>
          <input id="evDate" type="datetime-local" class="input" />
        </div>
        <div>
          <label>Alojamiento</label>
          <select id="evPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div>
          <label>Lugar (ES)</label>
          <input id="evLugar" class="input" placeholder="Ej: Camping Ramales" />
        </div>
        <div style="grid-column:1 / -1">
          <label>Descripción (ES)</label>
          <textarea id="evDesc" class="textarea" rows="3" placeholder="Ej: Música en directo y chocolate caliente. Entrada libre."></textarea>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="addEventBtn" class="btn">Agregar a la lista</button>
        <button id="exportEventsBtn" class="btn">Descargar events.json</button>
        <label class="btn" for="importFile" style="cursor:pointer">Importar JSON</label>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
      <p class="hint">Consejo: escribe solo en español; la app traduce automáticamente a EN/FR/DE/NL.</p>
    </div>

    <div class="card" style="margin-top:12px">
      <h4 style="margin:0 0 8px">Eventos actuales</h4>
      <div style="overflow:auto">
        <table class="table" id="eventsTable">
          <thead>
            <tr><th>ID</th><th>Fecha</th><th>Alojamiento</th><th>Título</th><th>Acciones</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="hint">Pulsa “Descargar events.json” y súbelo a GitHub (reemplaza el archivo).</p>
    </div>
  </div>
</div>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

/* ─────────────────────────────────────────────
   I18N (incluye nuevo título de eventos)
────────────────────────────────────────────── */
const I18N = {
  es: {
    app: "Grupo A Cobijo",
    subtitle: "Tu estancia con nosotros · Oyambre · Ramales · Ruiloba",
    heroTitle: "Tu guía en el camping",
    heroDesc: "Eventos, horarios, cómo llegar y contacto — todo en tu móvil, también sin cobertura.",
    eventsTitle: "Eventos Grupo A Cobijo",
    schedulesTitle: "Horarios",
    schedulesHint: "Recepción, restaurante, piscina... elige tu camping.",
    campingsTitle: "Nuestros campings",
    othersTitle: "Otros alojamientos del grupo",
    installTitle: "Instálame como app",
    installHint: "Android: ⋮ → Instalar app. iOS: Compartir → Añadir a pantalla de inicio.",
    offline: "Funciona sin conexión",
    hOy: "Ver horarios Oyambre", hRa: "Ver horarios Ramales", hHe: "Ver horarios Ruiloba",
    web:"Web", call:"Llamar", directions:"Cómo llegar", whatsapp:"WhatsApp",
    oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Todos los servicios · Frente al mar",
    raTitle:"Camping Ramales", raHint:"Cuevas · Montaña · Actividades",
    heTitle:"Camping El Helguero (Ruiloba)", heHint:"Naturaleza · Familiar · Mascotas",
    caTitle:"Apartamentos El Cardeo", caHint:"Apartamentos + Taberna",
    langTitle:"Selecciona idioma", pwa:"PWA • Offline"
  },
  en: {
    app:"Grupo A Cobijo",
    subtitle:"Your stay with us · Oyambre · Ramales · Ruiloba",
    heroTitle:"Your on-site guide",
    heroDesc:"Events, schedules, directions and contact — right on your phone, even offline.",
    eventsTitle:"Grupo A Cobijo Events",
    schedulesTitle:"Schedules",
    schedulesHint:"Reception, restaurant, pool... choose your campsite.",
    campingsTitle:"Our campsites",
    othersTitle:"Other accommodations of the group",
    installTitle:"Install me as an app",
    installHint:"Android: ⋮ → Install app. iOS: Share → Add to Home Screen.",
    offline:"Works offline",
    hOy:"View schedules Oyambre", hRa:"View schedules Ramales", hHe:"View schedules Ruiloba",
    web:"Website", call:"Call", directions:"Directions", whatsapp:"WhatsApp",
    oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"All services · By the sea",
    raTitle:"Camping Ramales", raHint:"Caves · Mountains · Activities",
    heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature · Family · Pets",
    caTitle:"El Cardeo Apartments", caHint:"Apartments + Tavern",
    langTitle:"Choose language", pwa:"PWA • Offline"
  },
  fr: {
    app:"Groupe A Cobijo",
    subtitle:"Votre séjour avec nous · Oyambre · Ramales · Ruiloba",
    heroTitle:"Votre guide sur place",
    heroDesc:"Événements, horaires, itinéraires et contacts — sur votre mobile, même hors ligne.",
    eventsTitle:"Événements Groupe A Cobijo",
    schedulesTitle:"Horaires",
    schedulesHint:"Réception, restaurant, piscine... choisissez votre camping.",
    campingsTitle:"Nos campings",
    othersTitle:"Autres hébergements du groupe",
    installTitle:"Installe-moi comme application",
    installHint:"Android : ⋮ → Installer l’app. iOS : Partager → Sur l’écran d’accueil.",
    offline:"Fonctionne hors ligne",
    hOy:"Voir horaires Oyambre", hRa:"Voir horaires Ramales", hHe:"Voir horaires Ruiloba",
    web:"Site web", call:"Appeler", directions:"Itinéraire", whatsapp:"WhatsApp",
    oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Tous services · Bord de mer",
    raTitle:"Camping Ramales", raHint:"Grottes · Montagne · Activités",
    heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature · Famille · Animaux admis",
    caTitle:"Appartements El Cardeo", caHint:"Appartements + Taverne",
    langTitle:"Choisir la langue", pwa:"PWA • Hors ligne"
  },
  de: {
    app:"Gruppe A Cobijo",
    subtitle:"Ihr Aufenthalt bei uns · Oyambre · Ramales · Ruiloba",
    heroTitle:"Dein Guide vor Ort",
    heroDesc:"Events, Öffnungszeiten, Anfahrt und Kontakt — alles auf deinem Handy, auch offline.",
    eventsTitle:"Veranstaltungen Grupo A Cobijo",
    schedulesTitle:"Öffnungszeiten",
    schedulesHint:"Rezeption, Restaurant, Pool... wähle deinen Campingplatz.",
    campingsTitle:"Unsere Campingplätze",
    othersTitle:"Weitere Unterkünfte der Gruppe",
    installTitle:"Als App installieren",
    installHint:"Android: ⋮ → App installieren. iOS: Teilen → Zum Home-Bildschirm.",
    offline:"Funktioniert offline",
    hOy:"Zeiten ansehen Oyambre", hRa:"Zeiten ansehen Ramales", hHe:"Zeiten ansehen Ruiloba",
    web:"Webseite", call:"Anrufen", directions:"Anfahrt", whatsapp:"WhatsApp",
    oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle Services · Am Meer",
    raTitle:"Camping Ramales", raHint:"Höhlen · Berge · Aktivitäten",
    heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natur · Familie · Haustiere",
    caTitle:"El Cardeo Apartments", caHint:"Apartments + Taverne",
    langTitle:"Sprache wählen", pwa:"PWA • Offline"
  },
  nl: {
    app:"Groep A Cobijo",
    subtitle:"Je verblijf bij ons · Oyambre · Ramales · Ruiloba",
    heroTitle:"Je gids op de camping",
    heroDesc:"Evenementen, tijden, route en contact — op je telefoon, ook offline.",
    eventsTitle:"Evenementen Grupo A Cobijo",
    schedulesTitle:"Openingstijden",
    schedulesHint:"Receptie, restaurant, zwembad... kies je camping.",
    campingsTitle:"Onze campings",
    othersTitle:"Overige accommodaties van de groep",
    installTitle:"Installeer als app",
    installHint:"Android: ⋮ → App installeren. iOS: Delen → Zet op beginscherm.",
    offline:"Werkt offline",
    hOy:"Tijden bekijken Oyambre", hRa:"Tijden bekijken Ramales", hHe:"Tijden bekijken Ruiloba",
    web:"Website", call:"Bellen", directions:"Route", whatsapp:"WhatsApp",
    oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle faciliteiten · Aan zee",
    raTitle:"Camping Ramales", raHint:"Grotten · Bergen · Activiteiten",
    heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natuur · Familie · Huisdieren",
    caTitle:"El Cardeo Apartments", caHint:"Apartments + Taverne",
    langTitle:"Taal kiezen", pwa:"PWA • Offline"
  }
};

/* Helpers I18N */
function detectLang(){
  const saved = localStorage.getItem("lang");
  if (saved) return saved;
  const n = (navigator.language || "es").slice(0,2).toLowerCase();
  return ["es","en","fr","de","nl"].includes(n) ? n : "es";
}
function setLangBadge(lang){
  const map={es:"ES",en:"EN",fr:"FR",de:"DE",nl:"NL"};
  document.getElementById("langBtn").textContent = `🌐 ${map[lang]}`;
}
function t(id,val){const el=document.getElementById(id); if(el) el.textContent=val;}
function applyLang(lang){
  const T = I18N[lang];
  t("t-app",T.app); t("t-subtitle",T.subtitle); t("t-pwa",T.pwa);
  t("t-hero-title",T.heroTitle); t("t-hero-desc",T.heroDesc);
  t("t-events-title",T.eventsTitle); t("t-schedules-title",T.schedulesTitle);
  t("t-schedules-hint",T.schedulesHint); t("t-campings-title",T.campingsTitle);
  t("t-others-title",T.othersTitle); t("t-install-title",T.installTitle);
  t("t-install-hint",T.installHint);
  t("h-oy",T.hOy); t("h-ra",T.hRa); t("h-he",T.hHe);
  t("t-oy-title",T.oyTitle); t("t-oy-hint",T.oyHint);
  t("t-ra-title",T.raTitle); t("t-ra-hint",T.raHint);
  t("t-he-title",T.heTitle); t("t-he-hint",T.heHint);
  t("t-ca-title",T.caTitle); t("t-ca-hint",T.caHint);
  document.querySelectorAll("[data-i18n-web]").forEach(e=>e.textContent=T.web);
  document.querySelectorAll("[data-i18n-call]").forEach(e=>e.textContent=T.call);
  document.querySelectorAll("[data-i18n-directions]").forEach(e=>e.textContent=T.directions);
  document.querySelectorAll("[data-i18n-whatsapp]").forEach(e=>e.textContent=T.whatsapp);
  t("langTitle",T.langTitle);
  localStorage.setItem("lang",lang);
  setLangBadge(lang);
  loadEvents(); // re-render
}

/* Eventos: mapeos por alojamiento para CTA "Cómo llegar" */
const PLACE_LINK = {
  oyambre: "https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre",
  ramales: "https://maps.google.com/?q=Camping+Ramales",
  ruiloba: "https://maps.google.com/?q=Camping+El+Helguero",
  cardeo:  "https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6"
};
const PLACE_LABEL = { oyambre:"Oyambre", ramales:"Ramales", ruiloba:"Ruiloba", cardeo:"El Cardeo" };

/* Auto-traducción básica desde ES si el campo es string */
const GLOSSARY={
  en:[[ /concierto/gi,"concert" ],[ /nochebuena/gi,"Christmas Eve" ],[ /entrada libre/gi,"free entry" ]],
  fr:[[ /concierto/gi,"concert" ],[ /nochebuena/gi,"Réveillon" ],[ /entrada libre/gi,"entrée libre" ]],
  de:[[ /concierto/gi,"Konzert" ],[ /nochebuena/gi,"Heiligabend" ],[ /entrada libre/gi,"Eintritt frei" ]],
  nl:[[ /concierto/gi,"concert" ],[ /nochebuena/gi,"Kerstavond" ],[ /entrada libre/gi,"gratis toegang" ]]
};
function currentLang(){return localStorage.getItem("lang")||detectLang();}
function autoTranslateFromEs(text,lang){
  if (!text || lang==="es") return text;
  const rules = GLOSSARY[lang]||[]; let out=text;
  for(const[r,repl] of rules) out = out.replace(r,repl);
  return out;
}
function i18nField(v,lang){return typeof v==="string"?autoTranslateFromEs(v,lang):(v?.[lang]||v?.es||"");}

function renderEvent(ev, lang){
  const campingKey = (ev.camping || "").toLowerCase(); // oyambre | ramales | ruiloba | cardeo
  const placeName = i18nField(ev.lugar, lang) || PLACE_LABEL[campingKey] || "";
  const title = i18nField(ev.titulo, lang) || "(sin título)";
  const desc  = i18nField(ev.descripcion, lang) || "";
  const when  = new Intl.DateTimeFormat(lang, {weekday:'long',day:'numeric',month:'long',hour:'2-digit',minute:'2-digit'}).format(new Date(ev.fecha));
  const maps  = PLACE_LINK[campingKey] || (placeName ? `https://www.google.com/maps?q=${encodeURIComponent(placeName)}` : "#");

  return `
    <div class="event-card">
      <div class="event-title">${title}</div>
      <div class="event-meta">${when} · ${placeName || ""}</div>
      <div class="hint" style="margin-bottom:8px">${desc}</div>
      <div class="row">
        <a class="btn" href="${maps}" target="_blank" rel="noopener" data-i18n-directions>Cómo llegar</a>
      </div>
    </div>
  `;
}

/* ====== APP: cargar eventos SIEMPRE frescos ====== */
async function loadEvents(){
  const lang = currentLang();
  try{
    const r = await fetch(`./events.json?v=${Date.now()}`, { cache: 'no-cache' });
    const data = await r.json();
    const wrap = document.getElementById('events');
    if (!Array.isArray(data) || data.length === 0){
      wrap.innerHTML = '<p class="hint">Sin eventos por ahora.</p>'; return;
    }
    data.sort((a,b)=> new Date(a.fecha) - new Date(b.fecha));
    wrap.innerHTML = data.map(ev => renderEvent(ev, lang)).join('');
  }catch(e){
    document.getElementById('events').innerHTML = '<p class="hint">Sin eventos por ahora.</p>';
  }
}

/* ====== ADMIN: activar con 5 toques en el logo ====== */
(function adminActivator(){
  const logo = document.querySelector('.logo-img');
  let taps = 0, timer = null;
  logo?.addEventListener('click', ()=>{
    taps++; clearTimeout(timer);
    timer = setTimeout(()=>{ taps=0; }, 1000);
    if (taps >= 5){
      taps = 0;
      const isOn = localStorage.getItem('admin') === '1';
      localStorage.setItem('admin', isOn ? '0' : '1');
      document.body.classList.toggle('admin-on', !isOn);
      alert(!isOn ? 'Modo admin activado' : 'Modo admin desactivado');
    }
  });
  // Init
  document.body.classList.toggle('admin-on', localStorage.getItem('admin') === '1');
})();

/* ====== ADMIN: abrir/cerrar modal ====== */
const adminModal = document.getElementById('adminModal');
document.getElementById('openAdmin')?.addEventListener('click', ()=>{ adminModal.style.display='flex'; loadEventsAdmin(); });
document.getElementById('closeAdmin')?.addEventListener('click', ()=> adminModal.style.display='none');
adminModal?.addEventListener('click', (e)=>{ if(e.target===adminModal) adminModal.style.display='none'; });

/* ====== ADMIN: datos y helpers ====== */
let ADMIN_EVENTS = [];

function isoFromLocal(dtLocal){
  const d = new Date(dtLocal);
  const tz = -d.getTimezoneOffset();
  const sign = tz >= 0 ? '+' : '-';
  const hh = String(Math.floor(Math.abs(tz)/60)).padStart(2,'0');
  const mm = String(Math.abs(tz)%60).padStart(2,'0');
  return d.toISOString().slice(0,19) + sign + hh + ':' + mm;
}
function slugify(s){
  return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'')
          .replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'').slice(0,60);
}

/* ====== ADMIN: render tabla con edición en línea ====== */
function renderAdminTable(){
  const tbody = document.querySelector('#eventsTable tbody');
  const rows = ADMIN_EVENTS
    .sort((a,b)=> new Date(a.fecha) - new Date(b.fecha))
    .map(ev => {
      const titleES = (typeof ev.titulo==='string'?ev.titulo:(ev.titulo?.es||'')) || '';
      const lugarES = (typeof ev.lugar==='string'?ev.lugar:(ev.lugar?.es||'')) || '';
      const descES  = (typeof ev.descripcion==='string'?ev.descripcion:(ev.descripcion?.es||'')) || '';
      const dtLocal = new Date(ev.fecha);
      const dtVal   = `${dtLocal.getFullYear()}-${String(dtLocal.getMonth()+1).padStart(2,'0')}-${String(dtLocal.getDate()).padStart(2,'0')}T${String(dtLocal.getHours()).padStart(2,'0')}:${String(dtLocal.getMinutes()).padStart(2,'0')}`;

      return `
      <tr data-id="${ev.id}">
        <td class="muted">${ev.id}</td>
        <td>
          <input class="input" type="datetime-local" value="${dtVal}">
          <div class="muted">${new Date(ev.fecha).toLocaleString(detectLang(), {day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'})}</div>
        </td>
        <td>
          <select class="select">
            <option value="oyambre" ${ev.camping==='oyambre'?'selected':''}>oyambre</option>
            <option value="ramales" ${ev.camping==='ramales'?'selected':''}>ramales</option>
            <option value="ruiloba" ${ev.camping==='ruiloba'?'selected':''}>ruiloba</option>
            <option value="cardeo"  ${ev.camping==='cardeo' ?'selected':''}>cardeo</option>
          </select>
          <input class="input" style="margin-top:6px" placeholder="Lugar (ES)" value="${lugarES.replace(/"/g,'&quot;')}">
        </td>
        <td>
          <input class="input" placeholder="Título (ES)" value="${titleES.replace(/"/g,'&quot;')}">
          <textarea class="textarea" rows="2" placeholder="Descripción (ES)" style="margin-top:6px">${descES.replace(/</g,'&lt;')}</textarea>
        </td>
        <td style="min-width:240px">
          <div class="row" style="gap:6px">
            <button class="btn small" data-action="save">Guardar</button>
            <button class="btn small" data-action="dup">Duplicar</button>
            <button class="btn small" data-action="del">Borrar</button>
          </div>
        </td>
      </tr>`;
    }).join('');
  tbody.innerHTML = rows;

  // Acciones por fila
  tbody.querySelectorAll('tr').forEach(tr=>{
    const id = tr.getAttribute('data-id');
    tr.querySelector('[data-action="save"]').addEventListener('click', ()=> saveRow(tr, id));
    tr.querySelector('[data-action="dup"]').addEventListener('click',  ()=> duplicateRow(id));
    tr.querySelector('[data-action="del"]').addEventListener('click',  ()=> deleteRow(id));
  });
}

function getRowValues(tr){
  const inputs = tr.querySelectorAll('input, select, textarea');
  const [dtInput, campingSel, lugarInput, titleInput, descTextarea] = inputs;
  return {
    dateLocal: dtInput.value,
    camping:   campingSel.value,
    lugar:     (lugarInput.value||'').trim(),
    titulo:    (titleInput.value||'').trim(),
    desc:      (descTextarea.value||'').trim()
  };
}

function saveRow(tr, id){
  const v = getRowValues(tr);
  if(!v.titulo || !v.dateLocal || !v.camping){
    alert('Rellena título, fecha y alojamiento.'); return;
  }
  const idx = ADMIN_EVENTS.findIndex(e=>e.id===id);
  if(idx<0) return;
  ADMIN_EVENTS[idx].fecha = isoFromLocal(v.dateLocal);
  ADMIN_EVENTS[idx].camping = v.camping;
  ADMIN_EVENTS[idx].titulo = v.titulo;       // ES (i18n auto)
  ADMIN_EVENTS[idx].lugar = v.lugar || defaultLugar(v.camping);
  ADMIN_EVENTS[idx].descripcion = v.desc || '';
  renderAdminTable();
}

function duplicateRow(id){
  const orig = ADMIN_EVENTS.find(e=>e.id===id);
  if(!orig) return;
  const titleES = (typeof orig.titulo==='string'?orig.titulo:(orig.titulo?.es||'')) || '';
  const newId = `ev-${slugify(titleES)}-${orig.camping}-${Date.now().toString().slice(-8)}`;
  const copy = JSON.parse(JSON.stringify(orig));
  copy.id = newId;
  ADMIN_EVENTS.push(copy);
  renderAdminTable();
}

function deleteRow(id){
  if(!confirm('¿Borrar este evento?')) return;
  ADMIN_EVENTS = ADMIN_EVENTS.filter(e=>e.id!==id);
  renderAdminTable();
}

function defaultLugar(place){
  if(place==='oyambre') return 'Camping Caravaning Playa de Oyambre';
  if(place==='ramales') return 'Camping Ramales';
  if(place==='ruiloba') return 'Camping El Helguero';
  if(place==='cardeo')  return 'Apartamentos El Cardeo';
  return '';
}

/* ADMIN: cargar / añadir / exportar / importar */
async function loadEventsAdmin(){
  try{
    const r = await fetch(`./events.json?v=${Date.now()}`, {cache:'no-cache'});
    const data = await r.json();
    ADMIN_EVENTS = Array.isArray(data) ? data : [];
  }catch(e){
    ADMIN_EVENTS = [];
  }
  renderAdminTable();
}

document.getElementById('addEventBtn')?.addEventListener('click', ()=>{
  const title = document.getElementById('evTitle').value.trim();
  const date  = document.getElementById('evDate').value;
  const place = document.getElementById('evPlace').value;
  const lugar = (document.getElementById('evLugar').value.trim()) || defaultLugar(place);
  const desc  = document.getElementById('evDesc').value.trim();
  if (!title || !date || !place){ alert('Rellena título, fecha y alojamiento.'); return; }
  const id = `ev-${slugify(title)}-${place}-${date.replace(/[:T]/g,'').slice(0,12)}`;
  ADMIN_EVENTS.push({ id, fecha: isoFromLocal(date), camping: place, titulo: title, descripcion: desc, lugar });
  renderAdminTable();
  // limpia
  document.getElementById('evTitle').value='';
  document.getElementById('evDate').value='';
  document.getElementById('evLugar').value='';
  document.getElementById('evDesc').value='';
});

document.getElementById('exportEventsBtn')?.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(ADMIN_EVENTS, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'events.json';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
  alert('Descargado events.json. Sube este archivo a GitHub para publicar los cambios.');
});

document.getElementById('importFile')?.addEventListener('change', async (e)=>{
  const file = e.target.files?.[0]; if (!file) return;
  try{
    const text = await file.text();
    const data = JSON.parse(text);
    if (!Array.isArray(data)) throw new Error('El JSON debe ser un array');
    ADMIN_EVENTS = data;
    renderAdminTable();
  }catch(err){
    alert('No se pudo leer el JSON: ' + err.message);
  }finally{
    e.target.value = '';
  }
});

/* LANG modal */
const langModal=document.getElementById("langModal");
document.getElementById("langBtn").onclick=()=>langModal.style.display="flex";
document.getElementById("closeLang").onclick=()=>langModal.style.display="none";
langModal.onclick=(e)=>{if(e.target===langModal)langModal.style.display="none"};
document.querySelectorAll(".lang-option").forEach(b=>b.onclick=()=>applyLang(b.dataset.lang));

/* Init */
document.getElementById("year").textContent = new Date().getFullYear();
const initialLang = detectLang();
applyLang(initialLang);

/* Ocultar splash */
window.addEventListener("load",()=>setTimeout(()=>document.getElementById("appSplash")?.remove(),500));

/* PWA install */
let deferredPrompt;
const installBtn=document.getElementById("installBtn");
window.addEventListener("beforeinstallprompt",(e)=>{e.preventDefault();deferredPrompt=e;installBtn.style.display="inline-flex"});
installBtn?.addEventListener("click",()=>{deferredPrompt?.prompt();deferredPrompt=null});

/* Service Worker */
if("serviceWorker" in navigator) navigator.serviceWorker.register("./service-worker.js");
</script>

</body>
</html>
