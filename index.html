<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Grupo A Cobijo</title>
<meta name="description" content="App de experiencia del cliente: eventos, horarios y accesos del Grupo A Cobijo.">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0ea5e9">
<link rel="icon" href="assets/icons/icon-192.png">
<link rel="apple-touch-icon" href="assets/icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
:root{
  --bg:#ffffff; --ink:#0a1a2a; --muted:#6b7280; --line:#e6eef7;
  --brand:#0ea5e9; --brand-ink:#063e63; --card:#f7fbff; --tint:#eef7ff;
  --ok:#16a34a; --warn:#b45309; --danger:#b91c1c;
  --wx1:#e9f6ff; --wx2:#d9efff; --wx3:#cce7ff; --wx4:#bfe0ff;
}
body.dark{
  --bg:#0b1220; --ink:#e8eef7; --muted:#8fa2bd; --line:#1e2a40;
  --brand:#22b2ff; --brand-ink:#bfe7ff; --card:#111a2a; --tint:#0f1a2b;
  --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
  --wx1:#0f1f35; --wx2:#102640; --wx3:#0f2b4a; --wx4:#0c3156;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink);background:var(--bg);transition:background-color .15s,color .15s}
img{max-width:100%;height:auto}
.hero img{height:64px;width:auto;max-width:160px}

/* Topbar */
.topbar{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#e6f6ff,#ffffff);
  border-bottom:1px solid var(--line);display:flex;align-items:center;gap:.75rem;padding:.7rem .9rem}
body.dark .topbar{background:linear-gradient(180deg,#0e1a2c,#0b1220)}
.topbar .burger{border:none;background:#fff;border:1px solid var(--line);border-radius:10px;padding:.45rem .55rem;cursor:pointer}
body.dark .topbar .burger{background:#0f1a2b}
.topbar .brand{display:flex;align-items:center;gap:.6rem}
.topbar img{height:40px;width:auto;object-fit:contain}
.topbar h1{font-size:1rem;margin:0}
.lang-btn,.theme-btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:.35rem .6rem;cursor:pointer}
body.dark .lang-btn, body.dark .theme-btn{background:#0f1a2b}

/* Drawer */
.drawer{position:fixed;inset:0;z-index:50;display:none}
.drawer.open{display:block}
.drawer .back{position:absolute;inset:0;background:rgba(0,0,0,.35)}
.drawer .panel{position:absolute;left:0;top:0;bottom:0;width:min(86vw,320px);background:var(--bg);border-right:1px solid var(--line);padding:12px;overflow:auto}
.drawer .panel .item{padding:10px;border-radius:10px;cursor:pointer;border:1px solid transparent}
.drawer .panel .item:hover{background:var(--tint);border-color:var(--line)}
.drawer .panel .admin-btn{display:none} /* se muestra al activar admin */

/* Main, views */
main{padding:12px 12px 76px;max-width:980px;margin:0 auto}
.view{display:none;animation:fade .15s ease-out}
.view.active{display:block}
@keyframes fade{from{opacity:.6;transform:translateY(4px)}to{opacity:1;transform:none}}

/* Home */
.hero{position:relative;border:1px solid var(--line);border-radius:18px;overflow:hidden;background:
  radial-gradient(120% 80% at 100% 0%,#b7e6ff 0%,#e6f6ff 50%,#ffffff 100%)}
body.dark .hero{background:radial-gradient(120% 80% at 100% 0%,#143356 0%,#0f2239 50%,#0b1220 100%)}
.hero-inner{display:flex;align-items:center;gap:14px;padding:16px}
.hero h2{margin:0;font-size:1.3rem}
.badge{display:none}
.tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:12px}
.tile{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:6px;
  align-items:flex-start;cursor:pointer;box-shadow:0 8px 24px rgba(14,165,233,.06)}
.tile .big{font-size:1.6rem}
.tile .muted{color:var(--muted);font-size:.86rem}
.tile:active{transform:scale(.98)}

.hscroll{display:flex;gap:10px;overflow:auto;padding-bottom:6px;scrollbar-gutter:stable both-edges}
.card{min-width:260px;flex:0 0 auto;background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px}
body.dark .card{background:#0f1a2b}
.card img{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;border:1px solid var(--line);background:#f2f6fb}
.card .title{font-weight:700;margin-top:6px}
.card .meta{font-size:.85rem;color:var(--muted)}
.row{display:flex;flex-wrap:wrap;gap:6px}

/* Buttons */
.btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:10px;padding:.46rem .66rem;cursor:pointer;font-weight:600;color:var(--ink);text-decoration:none;display:inline-block}
body.dark .btn{background:#0f1a2b}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff;box-shadow:0 4px 16px rgba(14,165,233,.22)}
.btn.sm{padding:.32rem .5rem;font-size:.82rem}
.btn.ghost{background:transparent;border-color:var(--line);color:var(--muted)}
.btn.nav{border-color:var(--ok)}
.btn.tickets{border-color:var(--brand)}

/* Grids */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}

/* Chips */
.chip{border-radius:999px}

/* Pills */
.pill{display:inline-flex;gap:.35rem;align-items:center;border:1px solid var(--line);border-radius:999px;padding:.25rem .55rem;font-size:.85rem;background:#fff}
body.dark .pill{background:#0f1a2b}
.pill.distance{border-color:rgba(22,163,74,.35);}

/* Accordions */
.acc{display:flex;flex-direction:column;gap:8px}
.acc-item{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#fff}
body.dark .acc-item{background:#0f1a2b}
.acc-h{display:flex;justify-content:space-between;align-items:center;padding:.7rem .8rem;cursor:pointer;background:var(--tint);font-weight:700}
.acc-b{display:none;padding:.8rem}
.acc-item.open .acc-b{display:block}

/* Bottom nav */
.navbar{position:fixed;left:0;right:0;bottom:0;z-index:25;background:#fff;border-top:1px solid var(--line);display:grid;grid-template-columns:repeat(4,1fr)}
body.dark .navbar{background:#0f1a2b}
.navbtn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 4px;border:none;background:transparent;cursor:pointer;font-size:.8rem;color:var(--muted)}
.navbtn.active{color:var(--brand-ink);font-weight:700}
.navbtn .ico{font-size:1.1rem}

/* Modal base */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:1000}
.modal{width:min(92vw,920px);max-height:88vh;overflow:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;
  background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.2)}
body.dark .modal{background:#0f1a2b}
.close{background:transparent;border:none;color:var(--muted);font-weight:700;cursor:pointer;font-size:1.6rem;line-height:1;padding:.25rem .5rem;border-radius:10px;float:right}
.close:active{transform:scale(.95)}
body.modal-open{overflow:hidden}

/* Inputs */
.input,.select,.textarea{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff}
.textarea{min-height:96px}

/* Weather */
.wx{border:1px solid var(--line);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,var(--wx2),var(--wx1));padding:12px}
.wx-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.wx-today{display:grid;grid-template-columns:80px 1fr;gap:10px;align-items:center;background:linear-gradient(180deg,var(--wx4),var(--wx2));border:1px solid var(--line);border-radius:14px;padding:10px}
.wx-ico{font-size:2.2rem}
.wx-deg{font-size:2rem;font-weight:800}
.wx-minmax{font-size:.9rem;color:var(--muted)}
.wx-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.wx-day{border:1px solid var(--line);border-radius:12px;padding:8px;text-align:center;background:linear-gradient(180deg,var(--wx2),var(--wx1))}
.wx-day .d{font-weight:700}
.wx-day .t{font-size:.9rem}

/* Admin hints */
#drawerHint{font-size:.85rem;color:var(--muted)}
</style>
</head>
<body>

<!-- Topbar -->
<header class="topbar">
  <button id="menuBtn" class="burger" aria-label="Abrir men√∫">‚ò∞</button>
  <div class="brand">
    <img src="assets/logo.png" alt="Grupo A Cobijo" id="logoTap" title=" ">
    <h1 id="t-app">Grupo A Cobijo</h1>
  </div>
  <div style="flex:1"></div>
  <button class="theme-btn" id="themeBtn" title="Tema" aria-label="Cambiar tema">üåô</button>
  <button class="lang-btn" id="langBtn" aria-haspopup="dialog">üåê ES</button>
</header>

<!-- Drawer -->
<div class="drawer" id="drawer" aria-hidden="true">
  <div class="back" id="drawerBack" tabindex="-1" aria-label="Cerrar men√∫"></div>
  <aside class="panel" role="menu" aria-label="Navegaci√≥n">
    <div class="item" data-nav="home">üè† <strong id="d-home">Inicio</strong></div>
    <div class="item" data-nav="stay">üß≥ <strong id="d-stay">Mi estancia</strong></div>
    <div class="item" data-nav="incidents">üÜò <strong id="d-inc">Incidencias</strong></div>
    <div class="item" data-nav="events">üìÖ <strong id="d-ev">Eventos</strong></div>
    <div class="item" data-nav="places">üèïÔ∏è <strong id="d-pl">Campings</strong></div>
    <div class="item" data-nav="schedules">üïí <strong id="d-sc">Horarios</strong></div>
    <div class="item" data-nav="musts">‚≠ê <strong id="d-musts">Imprescindibles</strong></div>
    <div class="item" data-nav="food">üçΩÔ∏è <strong id="d-food">Gastronom√≠a</strong></div>
    <div class="item admin-btn" id="openAdmin">üõ†Ô∏è <strong>Admin</strong></div>
    <div class="muted" id="drawerHint">Elige secci√≥n</div>
  </aside>
</div>

<main>
  <!-- HOME -->
  <section id="view-home" class="view active">
    <div class="hero">
      <div class="hero-inner">
        <img src="assets/logo.png" alt="A Cobijo">
        <div>
          <h2 id="t-hello">¬°Bienvenido!</h2>
          <div class="badge" id="t-badge">PWA ¬∑ Offline ¬∑ Multidioma</div>
        </div>
      </div>
      <div class="tiles">
        <div class="tile" data-nav="events"><div class="big">üìÖ</div><div><strong id="t-ev">Eventos</strong><div class="muted" id="t-ev-sub">Qu√© hay hoy</div></div></div>
        <div class="tile" data-nav="stay"><div class="big">üß≥</div><div><strong id="t-stay">Mi estancia</strong><div class="muted" id="t-stay-sub">Contactos, clima, horarios</div></div></div>
        <div class="tile" data-nav="incidents"><div class="big">üÜò</div><div><strong id="t-inc">Incidencias</strong><div class="muted" id="t-inc-sub">WhatsApp/Email directos</div></div></div>
        <div class="tile" data-nav="musts"><div class="big">‚≠ê</div><div><strong id="t-musts">Imprescindibles</strong><div class="muted" id="t-musts-sub">Qu√© ver en Cantabria</div></div></div>
        <div class="tile" data-nav="food"><div class="big">üçΩÔ∏è</div><div><strong id="t-food">Gastronom√≠a</strong><div class="muted" id="t-food-sub">Sabores c√°ntabros</div></div></div>
        <div class="tile" id="installTile"><div class="big">‚¨áÔ∏è</div><div><strong id="t-inst">Instalar</strong><div class="muted" id="t-inst-sub">A√±adir a inicio</div></div></div>
      </div>
    </div>

    <h3 style="margin:14px 4px 8px" id="t-next-events">Pr√≥ximos eventos</h3>
    <div id="homeEvents" class="hscroll"></div>
  </section>

  <!-- MI ESTANCIA -->
  <section id="view-stay" class="view">
    <h2 id="t-stay-title">Mi estancia</h2>
    <p class="muted" id="t-stay-hint">Guardamos tu elecci√≥n en este dispositivo.</p>

    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(240px,1fr))">
      <div>
        <label for="stayPlace" style="font-weight:700" id="t-stay-which">Selecciona tu alojamiento</label>
        <select id="stayPlace" class="select">
          <option value="oyambre">Oyambre</option>
          <option value="ramales">Ramales</option>
          <option value="ruiloba">Ruiloba</option>
          <option value="cardeo">El Cardeo</option>
        </select>
      </div>
      <div class="row" style="align-items:flex-end">
        <button id="stayWeb" class="btn">Web</button>
        <a id="stayCall" class="btn" target="_blank" rel="noopener">Llamar</a>
        <a id="stayWA" class="btn" target="_blank" rel="noopener">WhatsApp</a>
        <a id="stayEmail" class="btn" target="_blank" rel="noopener">Email</a>
        <a id="stayDir" class="btn nav" target="_blank" rel="noopener">C√≥mo llegar</a>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3 id="t-stay-hours">Horarios del alojamiento</h3>
      <div id="stayHours"></div>
    </div>

    <div class="wx" style="margin-top:12px" id="stayWeather">
      <div class="wx-h">
        <h3 id="t-weather-title" style="margin:0">Clima</h3>
        <div class="muted" id="wxPlaceLabel">‚Äî</div>
      </div>
      <div class="wx-today">
        <div class="wx-ico" id="wxIco">‚òÄÔ∏è</div>
        <div>
          <div class="wx-deg"><span id="wxNow">--</span>¬∞</div>
          <div class="wx-minmax"><span id="t-max">M√°x</span>: <span id="wxMax">--</span>¬∞ ¬∑ <span id="t-min">M√≠n</span>: <span id="wxMin">--</span>¬∞</div>
          <div class="muted" id="wxDesc">‚Äî</div>
        </div>
      </div>
      <div class="wx-3">
        <div class="wx-day"><div class="d" id="d1">‚Äî</div><div class="i" id="i1">‚òÄÔ∏è</div><div class="t" id="t1">--/--¬∞</div></div>
        <div class="wx-day"><div class="d" id="d2">‚Äî</div><div class="i" id="i2">‚òÄÔ∏è</div><div class="t" id="t2">--/--¬∞</div></div>
        <div class="wx-day"><div class="d" id="d3">‚Äî</div><div class="i" id="i3">‚òÄÔ∏è</div><div class="t" id="t3">--/--¬∞</div></div>
      </div>
    </div>
  </section>

  <!-- INCIDENCIAS -->
  <section id="view-incidents" class="view">
    <h2 id="i-title">Incidencias</h2>
    <p class="muted" id="i-hint">Se abre WhatsApp o tu app de correo con el mensaje preparado.</p>

    <div class="card" style="background:var(--tint)">
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
        <div>
          <label style="font-weight:700" for="incPlace" id="i-where">¬øEn qu√© alojamiento est√°s?</label>
          <select id="incPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700" for="incType" id="i-type">Tipo de incidencia</label>
          <select id="incType" class="select"></select>
        </div>
      </div>
      <div style="margin-top:10px">
        <label style="font-weight:700" for="incMsg" id="i-msg">Describe brevemente el problema</label>
        <textarea id="incMsg" class="textarea" placeholder="Ej.: Sin luz en la parcela 24, desde las 21:15..."></textarea>
      </div>
      <div class="row" style="margin-top:10px">
        <a id="incWA" class="btn primary" target="_blank" rel="noopener">WhatsApp</a>
        <a id="incEmail" class="btn" target="_blank" rel="noopener">Email</a>
      </div>
    </div>
  </section>

  <!-- EVENTOS -->
  <section id="view-events" class="view">
    <h2 id="t-events-title">Eventos</h2>
    <div class="row" style="gap:8px;margin:10px 0">
      <button class="btn chip on" data-filter="all" id="f-all">Todos</button>
      <button class="btn chip" data-filter="today" id="f-today">Hoy</button>
      <button class="btn chip" data-filter="tomorrow" id="f-tomorrow">Ma√±ana</button>
      <button class="btn chip" data-filter="week" id="f-week">Esta semana</button>
      <button class="btn chip" data-filter="fav" id="f-fav">Favoritos</button>
    </div>
    <div class="row" style="gap:8px;margin:6px 0">
      <button class="btn chip on" data-camp="all" id="c-all">Todos los campings</button>
      <button class="btn chip" data-camp="oyambre" id="c-oy">Oyambre</button>
      <button class="btn chip" data-camp="ramales" id="c-ra">Ramales</button>
      <button class="btn chip" data-camp="ruiloba" id="c-he">Ruiloba</button>
      <button class="btn chip" data-camp="cardeo" id="c-ca">El Cardeo</button>
    </div>
    <div id="eventsGrid" class="grid"></div>
    <p class="muted" id="eventsEmpty" style="display:none">Sin eventos por ahora.</p>
  </section>

  <!-- CAMPINGS -->
  <section id="view-places" class="view">
    <h2 id="t-campings-title">Nuestros campings</h2>
    <div class="grid">
      <article class="card" style="min-width:unset">
        <h3 id="t-oy-title">Camping Caravaning Playa de Oyambre</h3>
        <p class="muted" id="t-oy-hint">Todos los servicios ¬∑ Frente al mar</p>
        <div class="muted" id="dist-oyambre"></div>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.oyambre.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942711461">Llamar</a>
          <a class="btn nav" id="dir-oyambre" data-i18n-directions href="https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre" target="_blank" rel="noopener">C√≥mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34675696212" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ra-title">Camping Ramales</h3>
        <p class="muted" id="t-ra-hint">Cuevas ¬∑ Monta√±a ¬∑ Actividades</p>
        <div class="muted" id="dist-ramales"></div>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingramales.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34654463133">Llamar</a>
          <a class="btn nav" id="dir-ramales" data-i18n-directions href="https://maps.google.com/?q=Camping+Ramales" target="_blank" rel="noopener">C√≥mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34654463133" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-he-title">Camping El Helguero (Ruiloba)</h3>
        <p class="muted" id="t-he-hint">Naturaleza ¬∑ Familiar ¬∑ Mascotas</p>
        <div class="muted" id="dist-ruiloba"></div>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingelhelguero.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942722124">Llamar</a>
          <a class="btn nav" id="dir-ruiloba" data-i18n-directions href="https://maps.google.com/?q=Camping+El+Helguero" target="_blank" rel="noopener">C√≥mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34652806564" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ca-title">Apartamentos / Taberna El Cardeo</h3>
        <p class="muted" id="t-ca-hint">Apartamentos + Taberna</p>
        <div class="muted" id="dist-cardeo"></div>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.elcardeo.es" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34664686158">Llamar</a>
          <a class="btn nav" id="dir-cardeo" data-i18n-directions href="https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6" target="_blank" rel="noopener">C√≥mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34664686158" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>
    </div>
  </section>

  <!-- HORARIOS -->
  <section id="view-schedules" class="view">
    <h2 id="t-schedules-title">Horarios</h2>
    <div class="acc" id="acc">
      <div class="acc-item"><div class="acc-h" data-acc="oyambre">Oyambre <span>‚ñº</span></div><div class="acc-b" id="acc-oyambre"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ramales">Ramales <span>‚ñº</span></div><div class="acc-b" id="acc-ramales"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ruiloba">Ruiloba <span>‚ñº</span></div><div class="acc-b" id="acc-ruiloba"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="cardeo">El Cardeo <span>‚ñº</span></div><div class="acc-b" id="acc-cardeo"></div></div>
    </div>
    <p class="muted" id="schedNote">Info orientativa. Pregunta en recepci√≥n para cambios de temporada. Los horarios pueden variar seg√∫n la fecha.</p>
  </section>

  <!-- IMPRESCINDIBLES -->
  <section id="view-musts" class="view">
    <h2 id="musts-title">Imprescindibles de Cantabria</h2>
    <p class="muted" id="musts-hint">Activa tu ubicaci√≥n para ver distancias aproximadas y abrir rutas en tu app de mapas.</p>
    <div class="row" style="margin:8px 0">
      <button class="btn" id="geoBtn">üìç Usar mi ubicaci√≥n</button>
      <span class="muted" id="geoStatus"></span>
    </div>
    <div id="mustsAcc" class="acc"></div>
  </section>

  <!-- GASTRONOM√çA -->
  <section id="view-food" class="view">
    <h2 id="food-title">Gastronom√≠a c√°ntabra</h2>
    <p class="muted" id="food-hint">Productos t√≠picos y platos que deber√≠as probar.</p>
    <div id="foodAcc" class="acc"></div>
  </section>
</main>

<!-- Bottom nav -->
<nav class="navbar" role="navigation" aria-label="Pesta√±as">
  <button class="navbtn active" data-nav="home"><div class="ico">üè†</div><div id="n-home">Inicio</div></button>
  <button class="navbtn" data-nav="stay"><div class="ico">üß≥</div><div id="n-stay">Mi estancia</div></button>
  <button class="navbtn" data-nav="incidents"><div class="ico">üÜò</div><div id="n-inc">Incidencias</div></button>
  <button class="navbtn" data-nav="events"><div class="ico">üìÖ</div><div id="n-ev">Eventos</div></button>
</nav>

<!-- MODAL DE IDIOMA -->
<div class="backdrop" id="langModal" role="dialog" aria-modal="true" aria-labelledby="langTitle">
  <div class="modal">
    <button id="closeLang" class="close" aria-label="Cerrar">‚úï</button>
    <h3 id="langTitle">Selecciona idioma</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px">
      <button class="btn lang-option" data-lang="es">üá™üá∏ Espa√±ol</button>
      <button class="btn lang-option" data-lang="en">üá¨üáß English</button>
      <button class="btn lang-option" data-lang="fr">üá´üá∑ Fran√ßais</button>
      <button class="btn lang-option" data-lang="de">üá©üá™ Deutsch</button>
      <button class="btn lang-option" data-lang="nl">üá≥üá± Nederlands</button>
    </div>
  </div>
</div>

<!-- MODAL DE INSTALACI√ìN PWA -->
<div class="backdrop" id="installModal" role="dialog" aria-modal="true" aria-labelledby="instTitle">
  <div class="modal">
    <button id="closeInstall" class="close" aria-label="Cerrar">‚úï</button>
    <h3 id="instTitle">Instalar app</h3>
    <div id="instBody"></div>
    <div class="row" style="margin-top:10px">
      <button id="instNow" class="btn primary">Instalar ahora</button>
    </div>
  </div>
</div>

<!-- MODAL ADMIN -->
<div class="backdrop" id="adminModal" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
  <div class="modal">
    <button id="closeAdmin" class="close" aria-label="Cerrar">‚úï</button>
    <h3 id="adminTitle">üõ†Ô∏è Admin</h3>
    <p class="muted" id="adminHint">Edici√≥n local de JSON. Tras descargar, sube los archivos a tu repositorio.</p>

    <div class="acc">
      <div class="acc-item open">
        <div class="acc-h">events.json <span>‚ñº</span></div>
        <div class="acc-b">
          <div class="row">
            <input type="file" id="evImport" accept=".json" class="input">
            <button class="btn" id="evDownload">üíæ Descargar</button>
          </div>
          <textarea id="evText" class="textarea" spellcheck="false" placeholder='[ { "id":"...", "titulo": { "es":"..." }, "fecha":"2025-11-15T20:00:00", "camping":"oyambre", "lugar": { "es":"..." }, "imagen":"..." } ]'></textarea>
        </div>
      </div>

      <div class="acc-item">
        <div class="acc-h">schedules.json <span>‚ñº</span></div>
        <div class="acc-b">
          <div class="row">
            <input type="file" id="scImport" accept=".json" class="input">
            <button class="btn" id="scDownload">üíæ Descargar</button>
          </div>
          <textarea id="scText" class="textarea" spellcheck="false" placeholder='{"oyambre":{"es":"<ul>...</ul>","en":"<ul>...</ul>"}, ... }'></textarea>
        </div>
      </div>

      <div class="acc-item">
        <div class="acc-h">Copia de seguridad <span>‚ñº</span></div>
        <div class="acc-b">
          <div class="row">
            <button class="btn primary" id="makeZip">üóÇÔ∏è Descargar ZIP (events.json + schedules.json)</button>
            <button class="btn" id="resetAdmin">Cerrar sesi√≥n admin</button>
          </div>
          <p class="muted">Nota: s√≥lo empaqueta lo que hay ahora mismo en los editores.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Librer√≠a ZIP -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function(){

  /* ===== Estado admin + PIN ===== */
  localStorage.setItem('admin', localStorage.getItem('admin')||'0');
  document.body.classList.toggle('admin-on', localStorage.getItem('admin')==='1');
  if(!localStorage.getItem('admin_pin')){ localStorage.setItem('admin_pin','311974'); }

  /* ===== Utils ===== */
  function $(sel){return document.querySelector(sel);}
  function $all(sel){return Array.prototype.slice.call(document.querySelectorAll(sel));}
  function on(el,ev,fn){ if(el) el.addEventListener(ev,fn); }
  function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
  function safeUrl(u){var s=String(u||'').trim(); return (/^https?:\/\//i.test(s) || /^\/|^\.\.?\//.test(s) || /^data:image\//i.test(s)) ? s.replace(/"/g,'%22') : ''; }
  function pad2(n){return ('0'+n).slice(-2);}
  function download(name, text, type){ var blob=new Blob([text],{type:type||'text/plain;charset=utf-8'}); var a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href), 1000); }

  /* ===== Tema ===== */
  function detectTheme(){ var s=localStorage.getItem('theme'); if(s) return s; try{ if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark'; }catch(e){} return 'light'; }
  function applyTheme(m){ document.body.classList.toggle('dark', m==='dark'); var b=$('#themeBtn'); if(b) b.textContent=m==='dark'?'‚òÄÔ∏è':'üåô'; localStorage.setItem('theme',m); var meta=document.querySelector('meta[name="theme-color"]'); if(meta) meta.setAttribute('content', m==='dark' ? '#0b1220' : '#0ea5e9');}
  var THEME=detectTheme(); applyTheme(THEME);
  on($('#themeBtn'),'click', function(){ THEME=(THEME==='dark')?'light':'dark'; applyTheme(THEME); });

  /* ===== I18N ===== */
  var I18N = {
    es:{app:"Grupo A Cobijo",hello:"¬°Bienvenido!",badge:"PWA ¬∑ Offline ¬∑ Multidioma",
        ev:"Eventos", evSub:"Qu√© hay hoy",
        pl:"Campings", plSub:"Accesos r√°pidos",
        sc:"Horarios", scSub:"Recepci√≥n ¬∑ bar",
        inst:"Instalar", instSub:"A√±adir a inicio",
        instTitle:"Instalar app", instNow:"Instalar ahora",
        instGuideIOS:"<ol><li>Abre en <b>Safari</b>.</li><li>Toca <b>Compartir</b> (icono cuadrado con flecha).</li><li>Elige <b>A√±adir a pantalla de inicio</b>.</li><li>Confirma con <b>A√±adir</b>.</li></ol>",
        instGuideAndroid:"<ol><li>Abre en <b>Chrome</b>.</li><li>Toca <b>‚ãÆ</b> &gt; <b>A√±adir a pantalla de inicio</b>.</li><li>Sigue las instrucciones.</li></ol>",
        instGuideDesktop:"<p>En el navegador de escritorio, busca <b>Instalar app</b> en la barra de direcciones o el men√∫.</p>",
        eventsTitle:"Eventos", schedulesTitle:"Horarios", campingsTitle:"Nuestros campings",
        eventsEmpty:"Sin eventos por ahora.",
        fAll:"Todos", fToday:"Hoy", fTomorrow:"Ma√±ana", fWeek:"Esta semana", fFav:"Favoritos",
        cAll:"Todos los campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Web", call:"Llamar", directions:"C√≥mo llegar", whatsapp:"WhatsApp", email:"Email",
        addCal:"A√±adir al calendario", fav:"Favorito",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Todos los servicios ¬∑ Frente al mar",
        raTitle:"Camping Ramales", raHint:"Cuevas ¬∑ Monta√±a ¬∑ Actividades",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Naturaleza ¬∑ Familiar ¬∑ Mascotas",
        caTitle:"Apartamentos / Taberna El Cardeo", caHint:"Apartamentos + Taberna",
        schedNote:"Info orientativa. Pregunta en recepci√≥n para cambios de temporada. Los horarios pueden variar seg√∫n la fecha.",
        nHome:"Inicio", nEv:"Eventos", nPl:"Campings", nSc:"Horarios",
        dHome:"Inicio", dStay:"Mi estancia", dInc:"Incidencias", dEv:"Eventos", dPl:"Campings", dSc:"Horarios", dMusts:"Imprescindibles", dFood:"Gastronom√≠a", drawerHint:"Elige secci√≥n",
        nextEvents:"Pr√≥ximos eventos",
        stay:"Mi estancia", staySub:"Contactos, clima, horarios",
        stayTitle:"Mi estancia", stayHint:"Guardamos tu elecci√≥n en este dispositivo.", stayWhich:"Selecciona tu alojamiento",
        stayHours:"Horarios del alojamiento",
        weatherTitle:"Clima", max:"M√°x", min:"M√≠n",
        incTitle:"Incidencias", incWhere:"¬øEn qu√© alojamiento est√°s?", incContact:"¬øC√≥mo quieres contactar?",
        incHint:"Se abre WhatsApp o tu app de correo con el mensaje preparado.",
        incType:"Tipo de incidencia", incMsg:"Describe brevemente el problema",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        incTypes:[
          {key:'electricity', label:"Electricidad"},
          {key:'water', label:"Agua"},
          {key:'cleaning', label:"Limpieza"},
          {key:'noise', label:"Ruido"},
          {key:'other', label:"Otros"}
        ],
        mustsTitle:"Imprescindibles de Cantabria", mustsHint:"Activa tu ubicaci√≥n para ver distancias aproximadas y abrir rutas en tu app de mapas.",
        see:"Qu√© ver", images:"Im√°genes", map:"Mapa", tickets:"Entradas", more:"M√°s info",
        foodTitle:"Gastronom√≠a c√°ntabra", foodHint:"Productos y platos t√≠picos que deber√≠as probar.",
        langTitle:"Selecciona idioma",
        enableLoc:"üìç Usar mi ubicaci√≥n",
        distLabel:"Distancia",
        openInMaps:"üß≠ Abrir en Maps"
    },
    en:{app:"Grupo A Cobijo",hello:"Welcome!",badge:"PWA ¬∑ Offline ¬∑ Multilingual",
        ev:"Events", evSub:"What's on today",
        pl:"Campsites", plSub:"Quick access",
        sc:"Schedules", scSub:"Reception ¬∑ bar",
        inst:"Install", instSub:"Add to Home",
        instTitle:"Install app", instNow:"Install now",
        instGuideIOS:"<ol><li>Open in <b>Safari</b>.</li><li>Tap <b>Share</b>.</li><li>Select <b>Add to Home Screen</b>.</li><li>Confirm with <b>Add</b>.</li></ol>",
        instGuideAndroid:"<ol><li>Open in <b>Chrome</b>.</li><li>Tap <b>‚ãÆ</b> &gt; <b>Add to Home screen</b>.</li><li>Follow the steps.</li></ol>",
        instGuideDesktop:"<p>On desktop, look for <b>Install app</b> in the address bar or browser menu.</p>",
        eventsTitle:"Events", schedulesTitle:"Schedules", campingsTitle:"Our campsites",
        eventsEmpty:"No events at the moment.",
        fAll:"All", fToday:"Today", fTomorrow:"Tomorrow", fWeek:"This week", fFav:"Favorites",
        cAll:"All campsites", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Website", call:"Call", directions:"Directions", whatsapp:"WhatsApp", email:"Email",
        addCal:"Add to calendar", fav:"Favorite",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"All services ¬∑ By the sea",
        raTitle:"Camping Ramales", raHint:"Caves ¬∑ Mountains ¬∑ Activities",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature ¬∑ Family ¬∑ Pets",
        caTitle:"El Cardeo Apartments / Tavern", caHint:"Apartments + Tavern",
        schedNote:"Indicative info. Check reception for seasonal changes. Opening hours may vary by date.",
        nHome:"Home", nEv:"Events", nPl:"Camps", nSc:"Schedules",
        dHome:"Home", dStay:"My stay", dInc:"Issues", dEv:"Events", dPl:"Camps", dSc:"Schedules", dMusts:"Essentials", dFood:"Gastronomy", drawerHint:"Choose a section",
        nextEvents:"Upcoming events",
        stay:"My stay", staySub:"Contacts, weather, schedules",
        stayTitle:"My stay", stayHint:"We store your choice on this device.", stayWhich:"Choose your accommodation",
        stayHours:"Accommodation opening hours",
        weatherTitle:"Weather", max:"Max", min:"Min",
        incTitle:"Issues", incWhere:"Which accommodation are you in?", incContact:"How would you like to contact?",
        incHint:"We open WhatsApp or your email app with a prefilled message.",
        incType:"Issue type", incMsg:"Briefly describe the problem",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        incTypes:[
          {key:'electricity', label:"Electricity"},
          {key:'water', label:"Water"},
          {key:'cleaning', label:"Cleaning"},
          {key:'noise', label:"Noise"},
          {key:'other', label:"Other"}
        ],
        mustsTitle:"Cantabria essentials", mustsHint:"Enable location to see approx distances and open routes in your maps app.",
        see:"Highlights", images:"Images", map:"Map", tickets:"Tickets", more:"More info",
        foodTitle:"Cantabrian gastronomy", foodHint:"Typical products and dishes to try.",
        langTitle:"Choose language",
        enableLoc:"üìç Use my location",
        distLabel:"Distance",
        openInMaps:"üß≠ Open in Maps"
    },
    fr:{
      app:"Groupe A Cobijo", hello:"Bienvenue !", badge:"PWA ¬∑ Hors-ligne ¬∑ Multilingue",
      ev:"√âv√©nements", evSub:"Que faire aujourd‚Äôhui",
      pl:"Campings", plSub:"Acc√®s rapide",
      sc:"Horaires", scSub:"R√©ception ¬∑ bar",
      inst:"Installer", instSub:"Ajouter √† l‚Äô√©cran d‚Äôaccueil",
      instTitle:"Installer l‚Äôapp", instNow:"Installer maintenant",
      instGuideIOS:"<ol><li>Ouvrez dans <b>Safari</b>.</li><li>Appuyez sur <b>Partager</b>.</li><li>S√©lectionnez <b>Sur l‚Äô√©cran d‚Äôaccueil</b>.</li><li>Confirmez avec <b>Ajouter</b>.</li></ol>",
      instGuideAndroid:"<ol><li>Ouvrez dans <b>Chrome</b>.</li><li>Menu <b>‚ãÆ</b> &gt; <b>Ajouter √† l‚Äô√©cran d‚Äôaccueil</b>.</li><li>Suivez les √©tapes.</li></ol>",
      instGuideDesktop:"<p>Sur ordinateur, utilisez <b>Installer l‚Äôapplication</b> dans la barre d‚Äôadresse ou le menu.</p>",
      eventsTitle:"√âv√©nements", schedulesTitle:"Horaires", campingsTitle:"Nos campings",
      eventsEmpty:"Aucun √©v√©nement pour le moment.",
      fAll:"Tous", fToday:"Aujourd‚Äôhui", fTomorrow:"Demain", fWeek:"Cette semaine", fFav:"Favoris",
      cAll:"Tous", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
      web:"Site", call:"Appeler", directions:"Itin√©raire", whatsapp:"WhatsApp", email:"Email",
      addCal:"Ajouter au calendrier", fav:"Favori",
      oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Tous services ¬∑ Face √† la mer",
      raTitle:"Camping Ramales", raHint:"Grottes ¬∑ Montagne ¬∑ Activit√©s",
      heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature ¬∑ Famille ¬∑ Animaux",
      caTitle:"Appartements / Taverne El Cardeo", caHint:"Appartements + Taverne",
      schedNote:"Infos indicatives. Consultez la r√©ception pour les horaires saisonniers.",
      nHome:"Accueil", nEv:"√âv√©n.", nPl:"Campings", nSc:"Horaires",
      dHome:"Accueil", dStay:"Mon s√©jour", dInc:"Incidents", dEv:"√âv√©nements", dPl:"Campings", dSc:"Horaires", dMusts:"Incontournables", dFood:"Gastronomie", drawerHint:"Choisissez une section",
      nextEvents:"√Ä venir",
      stay:"Mon s√©jour", staySub:"Contacts, m√©t√©o, horaires",
      stayTitle:"Mon s√©jour", stayHint:"Nous enregistrons votre choix sur cet appareil.", stayWhich:"Choisissez votre h√©bergement",
      stayHours:"Horaires de l‚Äôh√©bergement",
      weatherTitle:"M√©t√©o", max:"Max", min:"Min",
      incTitle:"Incidents", incWhere:"Dans quel h√©bergement √™tes-vous ?", incContact:"Comment contacter ?",
      incHint:"On ouvre WhatsApp ou votre app email avec le message pr√©rempli.",
      incType:"Type d‚Äôincident", incMsg:"D√©crivez bri√®vement le probl√®me",
      incBtnWA:"WhatsApp", incBtnEmail:"Email",
      incTypes:[
        {key:'electricity', label:"√âlectricit√©"},
        {key:'water', label:"Eau"},
        {key:'cleaning', label:"Nettoyage"},
        {key:'noise', label:"Bruit"},
        {key:'other', label:"Autres"}
      ],
      mustsTitle:"Incontournables de Cantabrie", mustsHint:"Activez la localisation pour voir les distances et ouvrir l‚Äôitin√©raire.",
      see:"√Ä voir", images:"Images", map:"Carte", tickets:"Billets", more:"Plus d‚Äôinfos",
      foodTitle:"Gastronomie cantabrique", foodHint:"Produits et plats typiques.",
      langTitle:"Choisir la langue",
      enableLoc:"üìç Utiliser ma position",
      distLabel:"Distance",
      openInMaps:"üß≠ Ouvrir dans Plans"
    },
    de:{
      app:"Gruppe A Cobijo", hello:"Willkommen!", badge:"PWA ¬∑ Offline ¬∑ Mehrsprachig",
      ev:"Events", evSub:"Heute", pl:"Campingpl√§tze", plSub:"Schnellzugriff",
      sc:"√ñffnungszeiten", scSub:"Rezeption ¬∑ Bar",
      inst:"Installieren", instSub:"Zum Startbildschirm",
      instTitle:"App installieren", instNow:"Jetzt installieren",
      instGuideIOS:"<ol><li>In <b>Safari</b> √∂ffnen.</li><li><b>Teilen</b> antippen.</li><li><b>Zum Home-Bildschirm</b>.</li><li>Mit <b>Hinzuf√ºgen</b> best√§tigen.</li></ol>",
      instGuideAndroid:"<ol><li>In <b>Chrome</b> √∂ffnen.</li><li><b>‚ãÆ</b> &gt; <b>Zum Startbildschirm</b>.</li><li>Schritte befolgen.</li></ol>",
      instGuideDesktop:"<p>Am Desktop √ºber die Adressleiste <b>App installieren</b>.</p>",
      eventsTitle:"Veranstaltungen", schedulesTitle:"√ñffnungszeiten", campingsTitle:"Unsere Campingpl√§tze",
      eventsEmpty:"Derzeit keine Veranstaltungen.",
      fAll:"Alle", fToday:"Heute", fTomorrow:"Morgen", fWeek:"Diese Woche", fFav:"Favoriten",
      cAll:"Alle", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
      web:"Webseite", call:"Anrufen", directions:"Route", whatsapp:"WhatsApp", email:"E-Mail",
      addCal:"Zum Kalender", fav:"Favorit",
      oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle Services ¬∑ Am Meer",
      raTitle:"Camping Ramales", raHint:"H√∂hlen ¬∑ Berge ¬∑ Aktivit√§ten",
      heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natur ¬∑ Familie ¬∑ Haustiere",
      caTitle:"Apartments / Taverne El Cardeo", caHint:"Apartments + Taverne",
      schedNote:"Unverbindliche Infos. Saisonzeiten an der Rezeption erfragen.",
      nHome:"Start", nEv:"Events", nPl:"Camping", nSc:"Zeiten",
      dHome:"Start", dStay:"Mein Aufenthalt", dInc:"St√∂rungen", dEv:"Events", dPl:"Camping", dSc:"Zeiten", dMusts:"Highlights", dFood:"Gastronomie", drawerHint:"Bereich w√§hlen",
      nextEvents:"Bevorstehende Events",
      stay:"Mein Aufenthalt", staySub:"Kontakte, Wetter, Zeiten",
      stayTitle:"Mein Aufenthalt", stayHint:"Auswahl wird lokal gespeichert.", stayWhich:"Unterkunft w√§hlen",
      stayHours:"√ñffnungszeiten der Unterkunft",
      weatherTitle:"Wetter", max:"Max", min:"Min",
      incTitle:"St√∂rungen", incWhere:"Welche Unterkunft?", incContact:"Wie kontaktieren?",
      incHint:"WhatsApp oder E-Mail-App mit vorgef√ºllter Nachricht.",
      incType:"Art der St√∂rung", incMsg:"Problem kurz beschreiben",
      incBtnWA:"WhatsApp", incBtnEmail:"E-Mail",
      incTypes:[
        {key:'electricity', label:"Strom"},
        {key:'water', label:"Wasser"},
        {key:'cleaning', label:"Reinigung"},
        {key:'noise', label:"L√§rm"},
        {key:'other', label:"Sonstiges"}
      ],
      mustsTitle:"Kantabriens Highlights", mustsHint:"Standort aktivieren f√ºr Distanzen und Routen.",
      see:"Sehenswert", images:"Bilder", map:"Karte", tickets:"Tickets", more:"Mehr Infos",
      foodTitle:"Kantabrische K√ºche", foodHint:"Typische Produkte und Gerichte.",
      langTitle:"Sprache w√§hlen",
      enableLoc:"üìç Meinen Standort nutzen",
      distLabel:"Entfernung",
      openInMaps:"üß≠ In Karten √∂ffnen"
    },
    nl:{
      app:"Groep A Cobijo", hello:"Welkom!", badge:"PWA ¬∑ Offline ¬∑ Meertalig",
      ev:"Evenementen", evSub:"Vandaag",
      pl:"Campings", plSub:"Snelle toegang",
      sc:"Openingstijden", scSub:"Receptie ¬∑ bar",
      inst:"Installeren", instSub:"Toevoegen aan beginscherm",
      instTitle:"App installeren", instNow:"Nu installeren",
      instGuideIOS:"<ol><li>Open in <b>Safari</b>.</li><li>Tik op <b>Delen</b>.</li><li>Kies <b>Zet op beginscherm</b>.</li><li>Bevestig met <b>Voeg toe</b>.</li></ol>",
      instGuideAndroid:"<ol><li>Open in <b>Chrome</b>.</li><li><b>‚ãÆ</b> &gt; <b>Toevoegen aan beginscherm</b>.</li><li>Volg de stappen.</li></ol>",
      instGuideDesktop:"<p>Op desktop: <b>App installeren</b> via de adresbalk of het menu.</p>",
      eventsTitle:"Evenementen", schedulesTitle:"Openingstijden", campingsTitle:"Onze campings",
      eventsEmpty:"Momenteel geen evenementen.",
      fAll:"Alle", fToday:"Vandaag", fTomorrow:"Morgen", fWeek:"Deze week", fFav:"Favorieten",
      cAll:"Alle", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
      web:"Website", call:"Bellen", directions:"Route", whatsapp:"WhatsApp", email:"E-mail",
      addCal:"Aan agenda toevoegen", fav:"Favoriet",
      oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle services ¬∑ Aan zee",
      raTitle:"Camping Ramales", raHint:"Grotten ¬∑ Bergen ¬∑ Activiteiten",
      heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natuur ¬∑ Familie ¬∑ Huisdieren",
      caTitle:"Appartementen / Taverne El Cardeo", caHint:"Appartementen + Taverne",
      schedNote:"Indicatieve info. Raadpleeg de receptie voor seizoenswijzigingen.",
      nHome:"Home", nEv:"Events", nPl:"Campings", nSc:"Tijden",
      dHome:"Home", dStay:"Mijn verblijf", dInc:"Incidenten", dEv:"Events", dPl:"Campings", dSc:"Tijden", dMusts:"Aanraders", dFood:"Gastronomie", drawerHint:"Kies een sectie",
      nextEvents:"Binnenkort",
      stay:"Mijn verblijf", staySub:"Contacten, weer, tijden",
      stayTitle:"Mijn verblijf", stayHint:"We slaan je keuze lokaal op.", stayWhich:"Kies je accommodatie",
      stayHours:"Openingstijden accommodatie",
      weatherTitle:"Weer", max:"Max", min:"Min",
      incTitle:"Incidenten", incWhere:"Welke accommodatie?", incContact:"Hoe contact opnemen?",
      incHint:"We openen WhatsApp of je e-mailapp met een ingevuld bericht.",
      incType:"Type incident", incMsg:"Beschrijf kort het probleem",
      incBtnWA:"WhatsApp", incBtnEmail:"E-mail",
      incTypes:[
        {key:'electricity', label:"Stroom"},
        {key:'water', label:"Water"},
        {key:'cleaning', label:"Schoonmaak"},
        {key:'noise', label:"Lawaai"},
        {key:'other', label:"Overig"}
      ],
      mustsTitle:"Onmisbaar in Cantabri√´", mustsHint:"Schakel locatie in voor afstanden en routes.",
      see:"Wat te zien", images:"Afbeeldingen", map:"Kaart", tickets:"Tickets", more:"Meer info",
      foodTitle:"Cantabrische gastronomie", foodHint:"Typische producten en gerechten.",
      langTitle:"Taal kiezen",
      enableLoc:"üìç Mijn locatie gebruiken",
      distLabel:"Afstand",
      openInMaps:"üß≠ Openen in Kaarten"
    }
  };

  function detectLang(){ var s=localStorage.getItem('lang'); if(s) return s; var n=(navigator.language||'es').slice(0,2).toLowerCase(); return I18N[n]?n:'es'; }
  var LANG = detectLang();
  function t(id,v){ var el=document.getElementById(id); if(el) el.textContent=v; }
  function html(id,v){ var el=document.getElementById(id); if(el) el.innerHTML=v; }

  function applyLang(){
    var T=I18N[LANG];
    t("t-app",T.app); t("t-hello",T.hello); t("t-badge",T.badge);
    t("t-ev",T.ev); t("t-ev-sub",T.evSub);
    t("t-pl",T.pl); t("t-pl-sub",T.plSub);
    t("t-sc",T.sc); t("t-sc-sub",T.scSub);
    t("t-inst",T.inst); t("t-inst-sub",T.instSub);
    t("t-events-title",T.eventsTitle); t("t-schedules-title",T.schedulesTitle); t("t-campings-title",T.campingsTitle);
    t("f-all",T.fAll); t("f-today",T.fToday); t("f-tomorrow",T.fTomorrow); t("f-week",T.fWeek); var ff=document.getElementById('f-fav'); if(ff) ff.textContent=T.fFav;
    t("c-all",T.cAll); t("c-oy",T.cOy); t("c-ra",T.cRa); t("c-he",T.cHe); t("c-ca",T.cCa);
    t("t-oy-title",T.oyTitle); t("t-oy-hint",T.oyHint); t("t-ra-title",T.raTitle); t("t-ra-hint",T.raHint);
    t("t-he-title",T.heTitle); t("t-he-hint",T.heHint); t("t-ca-title",T.caTitle); t("t-ca-hint",T.caHint);
    t("schedNote",T.schedNote);
    var lb=$('#langBtn'); if(lb) lb.textContent='üåê '+LANG.toUpperCase();
    t("d-home",T.dHome||"Inicio"); t("d-stay",T.dStay||"Mi estancia"); t("d-inc",T.dInc||"Incidencias"); t("d-ev",T.dEv||"Eventos"); t("d-pl",T.dPl||"Campings"); t("d-sc",T.dSc||"Horarios"); t("d-musts",T.dMusts||"Imprescindibles"); t("d-food",T.dFood||"Gastronom√≠a"); t("drawerHint",T.drawerHint||"Elige secci√≥n");
    t("t-next-events",T.nextEvents||"Pr√≥ximos eventos");
    t("t-stay",T.stay||"Mi estancia"); t("t-stay-sub",T.staySub||"Contactos, clima, horarios");
    t("t-stay-title",T.stayTitle||"Mi estancia"); t("t-stay-hint",T.stayHint||"Guardamos tu elecci√≥n en este dispositivo."); t("t-stay-which",T.stayWhich||"Selecciona tu alojamiento");
    t("t-stay-hours",T.stayHours||"Horarios del alojamiento"); t("t-weather-title",T.weatherTitle||"Clima"); t("t-max",T.max||"M√°x"); t("t-min",T.min||"M√≠n");
    t("i-title",T.incTitle||"Incidencias"); t("i-hint",T.incHint||"Se abre WhatsApp o email con el mensaje preparado."); t("i-where",T.incWhere||"¬øEn qu√© alojamiento est√°s?"); t("i-type",T.incType||"Tipo de incidencia"); t("i-msg",T.incMsg||"Describe brevemente el problema");
    var incWA=$('#incWA'), incEmail=$('#incEmail'); if(incWA) incWA.textContent=T.incBtnWA||"WhatsApp"; if(incEmail) incEmail.textContent=T.incBtnEmail||"Email";
    t("musts-title",T.mustsTitle); t("musts-hint",T.mustsHint);
    t("food-title",T.foodTitle); t("food-hint",T.foodHint);
    t("geoBtn", T.enableLoc || "üìç Usar mi ubicaci√≥n");
  }
  applyLang();

  on($('#langBtn'),'click', function(){ $('#langModal').style.display='flex'; });
  on($('#closeLang'),'click', function(e){ e.preventDefault(); $('#langModal').style.display='none'; });
  $all('.lang-option').forEach(function(b){
    on(b,'click', function(){ LANG=b.getAttribute('data-lang'); localStorage.setItem('lang',LANG); applyLang(); renderAcc(); loadEvents(); updateStayUI(); updateIncUI(); renderMusts(); renderFood(); updateDistancesUI(); $('#langModal').style.display='none'; });
  });

  /* ===== Navegaci√≥n ===== */
  function showView(id){
    $all('.view').forEach(v=>v.classList.remove('active'));
    var target=document.getElementById('view-'+id); if(target) target.classList.add('active');
    $all('.navbtn').forEach(b=>b.classList.toggle('active', b.getAttribute('data-nav')===id));
    $('#drawer').classList.remove('open');
  }
  $all('[data-nav]').forEach(el=>on(el,'click', function(){ showView(el.getAttribute('data-nav')); }));
  on($('#menuBtn'),'click', function(){ $('#drawer').classList.add('open'); $('#drawer').setAttribute('aria-hidden','false'); });
  on($('#drawerBack'),'click', function(){ $('#drawer').classList.remove('open'); $('#drawer').setAttribute('aria-hidden','true'); });

  /* ===== Datos comunes ===== */
  var PLACE_LINK={oyambre:"https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre",ramales:"https://maps.google.com/?q=Camping+Ramales",ruiloba:"https://maps.google.com/?q=Camping+El+Helguero",cardeo:"https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6"};
  var PLACE_LABEL={oyambre:"Oyambre",ramales:"Ramales",ruiloba:"Ruiloba",cardeo:"El Cardeo"};
  var WHATSAPP={oyambre:"34675696212",ramales:"34654463133",ruiloba:"34652806564",cardeo:"34664686158"};
  var PHONES={oyambre:"+34942711461",ramales:"+34654463133",ruiloba:"+34942722124",cardeo:"+34664686158"};
  var WEB={oyambre:"https://www.oyambre.com",ramales:"https://www.campingramales.com",ruiloba:"https://www.campingelhelguero.com",cardeo:"https://www.elcardeo.es"};
  var EMAILS={oyambre:"camping@oyambre.com",ramales:"info@campingramales.com",ruiloba:"info@campingelhelguero.com",cardeo:"info@elcardeo.es"};
  var COORDS = {
    oyambre:{lat:43.393, lon:-4.352},
    ramales:{lat:43.263, lon:-3.465},
    ruiloba:{lat:43.387, lon:-4.264},
    cardeo:{lat:43.391, lon:-4.274}
  };

  /* ===== GEO / Distancias ===== */
  var USER_POS = null;
  function haversineKm(lat1,lon1,lat2,lon2){
    var toRad=Math.PI/180, R=6371;
    var dLat=(lat2-lat1)*toRad, dLon=(lon2-lon1)*toRad;
    var a=Math.sin(dLat/2)**2 + Math.cos(lat1*toRad)*Math.cos(lat2*toRad)*Math.sin(dLon/2)**2;
    return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  }
  function fmtKm(km){ if(km<1) return Math.round(km*1000)+' m'; return (Math.round(km*10)/10)+' km'; }
  function navUrl(lat,lon,label){
    var ua=navigator.userAgent||'';
    if(/iP(hone|ad|od)/.test(ua)){ return 'maps://?daddr='+lat+','+lon+'&dirflg=d'; }
    if(/Android/i.test(ua)){ return 'google.navigation:q='+lat+','+lon; }
    return 'https://www.google.com/maps/dir/?api=1&destination='+lat+','+lon+(label?('&destination_place_id=&destination_name='+encodeURIComponent(label)):'');
  }
  function updateDistancesUI(){
    try{
      ['oyambre','ramales','ruiloba','cardeo'].forEach(function(k){
        var el=$('#dist-'+k);
        if(!el) return;
        if(USER_POS && COORDS[k]){
          var d=fmtKm(haversineKm(USER_POS.lat,USER_POS.lon, COORDS[k].lat, COORDS[k].lon));
          el.textContent='üìç '+(I18N[LANG].distLabel||'Distancia')+': '+d;
          var dirBtn=$('#dir-'+k);
          if(dirBtn){ dirBtn.href = navUrl(COORDS[k].lat,COORDS[k].lon, PLACE_LABEL[k]); }
        }else{
          el.textContent='';
        }
      });
      var placeLabel = PLACE_LABEL[STAY]; 
      if(USER_POS && COORDS[STAY]){
        var dist=fmtKm(haversineKm(USER_POS.lat,USER_POS.lon, COORDS[STAY].lat,COORDS[STAY].lon));
        $('#wxPlaceLabel').textContent = placeLabel+' ¬∑ '+(I18N[LANG].distLabel||'Distancia')+': '+dist;
        $('#stayDir').href = navUrl(COORDS[STAY].lat,COORDS[STAY].lon, placeLabel);
      }else{
        $('#wxPlaceLabel').textContent = placeLabel;
      }
      renderMusts();
    }catch(e){}
  }
  on($('#geoBtn'),'click', function(){
    var status=$('#geoStatus'); status.textContent='‚Ä¶';
    if(!navigator.geolocation){ status.textContent='Tu navegador no permite geolocalizaci√≥n.'; return; }
    navigator.geolocation.getCurrentPosition(function(pos){
      USER_POS = {lat:pos.coords.latitude, lon:pos.coords.longitude};
      status.textContent='Ubicaci√≥n activada ‚úî';
      updateDistancesUI();
    }, function(err){
      status.textContent='No se pudo obtener la ubicaci√≥n.';
    }, {enableHighAccuracy:true, timeout:8000, maximumAge:60000});
  });

  /* ===== Eventos (+ Favoritos + .ics) ===== */
  var EVENTS=[], DATE_FILTER='all', CAMP_FILTER='all';
  var FAV_SET = new Set(JSON.parse(localStorage.getItem('fav_events')||'[]'));
  function saveFavs(){ localStorage.setItem('fav_events', JSON.stringify(Array.from(FAV_SET))); }
  function isFav(id){ return FAV_SET.has(id); }
  function toggleFav(id){ if(FAV_SET.has(id)) FAV_SET.delete(id); else FAV_SET.add(id); saveFavs(); renderHomeSlider(); renderEventsGrid(); }
  function whenFmt(d){ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short',day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'}).format(new Date(d)); }catch(e){ return d; } }
  function categoryFor(dateStr){
    var d=new Date(dateStr), now=new Date();
    var startToday=new Date(now.getFullYear(),now.getMonth(),now.getDate());
    var startTomorrow=new Date(startToday); startTomorrow.setDate(startToday.getDate()+1);
    var endOfWeek=new Date(startToday); endOfWeek.setDate(startToday.getDate()+(7-startToday.getDay()));
    if(d>=startToday && d<startTomorrow) return 'today';
    if(d>=startTomorrow && d< new Date(startTomorrow.getFullYear(),startTomorrow.getMonth(),startTomorrow.getDate()+1)) return 'tomorrow';
    if(d>=startToday && d<endOfWeek) return 'week';
    return 'all';
  }
  function i18nField(v){return typeof v==="string"?v:((v&&v[LANG])|| (v&&v.es) || "");}
  function waLink(camping,message){var n=WHATSAPP[String(camping||'').toLowerCase()]; return n?('https://wa.me/'+n+'?text='+encodeURIComponent(message||'')):null;}

  // ICS helpers
  function dtToICS(dt){ var d=new Date(dt);
    return d.getUTCFullYear()+pad2(d.getUTCMonth()+1)+pad2(d.getUTCDate())+'T'+pad2(d.getUTCHours())+pad2(d.getUTCMinutes())+pad2(d.getUTCSeconds())+'Z'; }
  function icsEscape(s){ return String(s||'').replace(/\\/g,'\\\\').replace(/;/g,'\\;').replace(/,/g,'\\,').replace(/\n/g,'\\n'); }
  function downloadICS(ev){
    try{
      var title=i18nField(ev.titulo)||'Evento';
      var desc=i18nField(ev.descripcion)||'';
      var loc=i18nField(ev.lugar)|| (PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'');
      var start=new Date(ev.fecha);
      var end=new Date(start.getTime()+90*60000);
      var uid=(ev.id||('ev-'+Date.now()))+'@acobijo.app';
      var now=new Date();
      var ics = [
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Grupo A Cobijo//Customer App//ES','CALSCALE:GREGORIAN','METHOD:PUBLISH',
        'BEGIN:VEVENT',
        'UID:'+icsEscape(uid),'DTSTAMP:'+dtToICS(now),'DTSTART:'+dtToICS(start),'DTEND:'+dtToICS(end),
        'SUMMARY:'+icsEscape(title),'DESCRIPTION:'+icsEscape(desc),'LOCATION:'+icsEscape(loc),
        'END:VEVENT','END:VCALENDAR'
      ].join('\r\n');
      download(('evento-'+(ev.id||'acobijo')+'.ics').replace(/[^a-z0-9._-]+/gi,'_'), ics, 'text/calendar;charset=utf-8');
    }catch(e){ alert('No se pudo generar el calendario.'); }
  }

  function renderHomeSlider(){
    var wrap=$('#homeEvents'); if(!wrap) return;
    var next=EVENTS.slice().sort((a,b)=>new Date(a.fecha)-new Date(b.fecha)).slice(0,6);
    if(!next.length){ wrap.innerHTML='<div class="muted">'+I18N[LANG].eventsEmpty+'</div>'; return; }
    wrap.innerHTML = next.map(function(ev){
      var rawTitle=i18nField(ev.titulo)||'(sin t√≠tulo)';
      var rawPlace=i18nField(ev.lugar)||PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'';
      var title=esc(rawTitle), place=esc(rawPlace);
      var img=safeUrl(ev.imagen||ev.image||'');
      var wa=waLink(ev.camping,'Hola, consulta sobre ‚Äú'+rawTitle+'‚Äù en '+rawPlace+'.');
      var favStar = isFav(ev.id) ? '‚òÖ' : '‚òÜ';
      var dir = PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#';
      return '<div class="card">'
        + (img?'<img src="'+img+'" alt="'+title+'" loading="lazy" onerror="this.style.display=\'none\'">':'')
        + '<div class="title">'+title+'</div>'
        + '<div class="meta">'+whenFmt(ev.fecha)+' ¬∑ '+place+'</div>'
        + '<div class="row" style="margin-top:6px">'
          + '<button class="btn fav-btn" data-id="'+esc(ev.id)+'" title="'+esc(I18N[LANG].fav)+'">'+favStar+' '+I18N[LANG].fav+'</button>'
          + '<button class="btn ics-btn" data-id="'+esc(ev.id)+'">üìÜ '+I18N[LANG].addCal+'</button>'
          + (wa?'<a class="btn ghost sm" href="'+esc(wa)+'" target="_blank" rel="noopener">'+I18N[LANG].whatsapp+'</a>':'')
          + '<a class="btn ghost sm" href="'+esc(dir)+'" target="_blank" rel="noopener">'+I18N[LANG].directions+'</a>'
        + '</div></div>';
    }).join('');
    bindEventActionButtons(wrap);
  }

  function renderEventsGrid(){
    var grid=$('#eventsGrid'), empty=$('#eventsEmpty'); if(!grid) return;
    var filtered = EVENTS.filter(function(ev){
      var byCamp = CAMP_FILTER==='all' ? true : (String(ev.camping||'').toLowerCase()===CAMP_FILTER);
      if(DATE_FILTER==='fav'){ return byCamp && isFav(ev.id); }
      var byDate = DATE_FILTER==='all' ? true : categoryFor(ev.fecha)===DATE_FILTER;
      return byDate && byCamp;
    }).sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));
    if(!filtered.length){ grid.innerHTML=''; if(empty){ empty.textContent=I18N[LANG].eventsEmpty; empty.style.display='block'; } return; }
    if(empty) empty.style.display='none';
    grid.innerHTML = filtered.map(function(ev){
      var rawTitle=i18nField(ev.titulo)||'(sin t√≠tulo)';
      var rawPlace=i18nField(ev.lugar)||PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'';
      var title=esc(rawTitle), place=esc(rawPlace);
      var img=safeUrl(ev.imagen||ev.image||'');
      var wa=waLink(ev.camping,'Hola, consulta sobre ‚Äú'+rawTitle+'‚Äù en '+rawPlace+'.');
      var favStar = isFav(ev.id) ? '‚òÖ' : '‚òÜ';
      return '<div class="card" style="min-width:unset">'
        + (img?'<img src="'+img+'" alt="'+title+'" loading="lazy" onerror="this.style.display=\'none\'">':'')
        + '<div class="title">'+title+'</div>'
        + '<div class="meta">'+whenFmt(ev.fecha)+' ¬∑ '+place+'</div>'
        + '<div class="row see-actions">'
          + '<button class="btn fav-btn sm" data-id="'+esc(ev.id)+'" title="'+esc(I18N[LANG].fav)+'">'+favStar+' '+I18N[LANG].fav+'</button>'
          + '<button class="btn sm ics-btn" data-id="'+esc(ev.id)+'">üìÜ '+I18N[LANG].addCal+'</button>'
          + (wa?'<a class="btn sm" href="'+esc(wa)+'" target="_blank" rel="noopener">üí¨ '+I18N[LANG].whatsapp+'</a>':'')
        + '</div></div>';
    }).join('');
    bindEventActionButtons(grid);
  }

  function bindEventActionButtons(scope){
    (function(){ var _all=$all; $all=function(sel,sc){ if(sc && sc.querySelectorAll) return Array.prototype.slice.call(sc.querySelectorAll(sel)); return _all(sel); }})();
    $all('.fav-btn', scope).forEach(function(btn){
      on(btn,'click', function(){ var id=btn.getAttribute('data-id'); toggleFav(id); });
    });
    $all('.ics-btn', scope).forEach(function(btn){
      on(btn,'click', function(){ var id=btn.getAttribute('data-id'); var ev = EVENTS.find(e=>e.id===id); if(ev) downloadICS(ev); });
    });
  }

  function loadEvents(){
    fetch('./events.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>r.json()).then(data=>{ EVENTS = Array.isArray(data)?data:[]; renderHomeSlider(); renderEventsGrid(); })
      .catch(()=>{ EVENTS=[]; renderHomeSlider(); renderEventsGrid(); });
  }

  // Filtros
  $all('[data-filter]').forEach(ch=>on(ch,'click', function(){
    $all('[data-filter]').forEach(x=>x.classList.remove('on'));
    ch.classList.add('on'); DATE_FILTER=ch.getAttribute('data-filter')||'all'; renderEventsGrid();
  }));
  $all('[data-camp]').forEach(ch=>on(ch,'click', function(){
    $all('[data-camp]').forEach(x=>x.classList.remove('on'));
    ch.classList.add('on'); CAMP_FILTER=ch.getAttribute('data-camp')||'all'; renderEventsGrid();
  }));

  /* ===== Horarios (fallback completo multidioma) ===== */
  var SCHEDULES_DEFAULT={
    oyambre:{
      es:`<ul>
        <li><b>Recepci√≥n:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li>
        <li><b>Check-in parcelas:</b> desde 12:00 ¬∑ <b>Check-out:</b> hasta 12:00</li>
        <li><b>Check-in bungalows:</b> 16:00‚Äì20:00 ¬∑ <b>Check-out:</b> 11:00</li>
        <li><b>Restaurante/Bar:</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li>
        <li><b>Supermercado:</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li>
        <li><b>Piscina (temporada):</b> 11:00‚Äì20:00</li>
        <li><b>Silencio:</b> 23:00‚Äì08:00</li>
      </ul>`,
      en:`<ul>
        <li><b>Reception:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li>
        <li><b>Pitches check-in:</b> from 12:00 ¬∑ <b>Check-out:</b> until 12:00</li>
        <li><b>Bungalows check-in:</b> 16:00‚Äì20:00 ¬∑ <b>Check-out:</b> 11:00</li>
        <li><b>Restaurant/Bar:</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li>
        <li><b>Supermarket:</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li>
        <li><b>Pool (seasonal):</b> 11:00‚Äì20:00</li>
        <li><b>Quiet hours:</b> 23:00‚Äì08:00</li>
      </ul>`,
      fr:`<ul>
        <li><b>R√©ception :</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li>
        <li><b>Emplacements check-in :</b> d√®s 12:00 ¬∑ <b>Check-out :</b> jusqu‚Äô√† 12:00</li>
        <li><b>Bungalows check-in :</b> 16:00‚Äì20:00 ¬∑ <b>Check-out :</b> 11:00</li>
        <li><b>Restaurant/Bar :</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li>
        <li><b>Supermarch√© :</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li>
        <li><b>Piscine (saison) :</b> 11:00‚Äì20:00</li>
        <li><b>Silence :</b> 23:00‚Äì08:00</li>
      </ul>`,
      de:`<ul>
        <li><b>Rezeption:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li>
        <li><b>Stellpl√§tze Check-in:</b> ab 12:00 ¬∑ <b>Check-out:</b> bis 12:00</li>
        <li><b>Bungalows Check-in:</b> 16:00‚Äì20:00 ¬∑ <b>Check-out:</b> 11:00</li>
        <li><b>Restaurant/Bar:</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li>
        <li><b>Supermarkt:</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li>
        <li><b>Pool (Saison):</b> 11:00‚Äì20:00</li>
        <li><b>Nachtruhe:</b> 23:00‚Äì08:00</li>
      </ul>`,
      nl:`<ul>
        <li><b>Receptie:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li>
        <li><b>Plaatsen check-in:</b> vanaf 12:00 ¬∑ <b>Check-out:</b> tot 12:00</li>
        <li><b>Bungalows check-in:</b> 16:00‚Äì20:00 ¬∑ <b>Check-out:</b> 11:00</li>
        <li><b>Restaurant/Bar:</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li>
        <li><b>Supermarkt:</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li>
        <li><b>Zwembad (seizoen):</b> 11:00‚Äì20:00</li>
        <li><b>Stilte:</b> 23:00‚Äì08:00</li>
      </ul>`
    },
    ramales:{
      es:`<ul>
        <li><b>Recepci√≥n:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li>
        <li><b>Actividades:</b> consulta en recepci√≥n</li>
        <li><b>Bar:</b> 09:00‚Äì23:00</li>
        <li><b>Piscina (temporada):</b> 11:00‚Äì20:00</li>
        <li><b>Silencio:</b> 23:00‚Äì08:00</li>
      </ul>`,
      en:`<ul><li><b>Reception:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li><li><b>Activities:</b> ask at reception</li><li><b>Bar:</b> 09:00‚Äì23:00</li><li><b>Pool (seasonal):</b> 11:00‚Äì20:00</li><li><b>Quiet hours:</b> 23:00‚Äì08:00</li></ul>`,
      fr:`<ul><li><b>R√©ception :</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li><li><b>Activit√©s :</b> renseignez-vous √† la r√©ception</li><li><b>Bar :</b> 09:00‚Äì23:00</li><li><b>Piscine (saison) :</b> 11:00‚Äì20:00</li><li><b>Silence :</b> 23:00‚Äì08:00</li></ul>`,
      de:`<ul><li><b>Rezeption:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li><li><b>Aktivit√§ten:</b> an der Rezeption</li><li><b>Bar:</b> 09:00‚Äì23:00</li><li><b>Pool (Saison):</b> 11:00‚Äì20:00</li><li><b>Nachtruhe:</b> 23:00‚Äì08:00</li></ul>`,
      nl:`<ul><li><b>Receptie:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li><li><b>Activiteiten:</b> vraag bij de receptie</li><li><b>Bar:</b> 09:00‚Äì23:00</li><li><b>Zwembad (seizoen):</b> 11:00‚Äì20:00</li><li><b>Stilte:</b> 23:00‚Äì08:00</li></ul>`
    },
    ruiloba:{
      es:`<ul>
        <li><b>Recepci√≥n:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li>
        <li><b>Restaurante/Bar:</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li>
        <li><b>Supermercado:</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li>
        <li><b>Silencio:</b> 23:00‚Äì08:00</li>
      </ul>`,
      en:`<ul><li><b>Reception:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li><li><b>Restaurant/Bar:</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li><li><b>Supermarket:</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li><li><b>Quiet hours:</b> 23:00‚Äì08:00</li></ul>`,
      fr:`<ul><li><b>R√©ception :</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li><li><b>Restaurant/Bar :</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li><li><b>Supermarch√© :</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li><li><b>Silence :</b> 23:00‚Äì08:00</li></ul>`,
      de:`<ul><li><b>Rezeption:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li><li><b>Restaurant/Bar:</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li><li><b>Supermarkt:</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li><li><b>Nachtruhe:</b> 23:00‚Äì08:00</li></ul>`,
      nl:`<ul><li><b>Receptie:</b> 09:00‚Äì14:00 ¬∑ 16:00‚Äì20:00</li><li><b>Restaurant/Bar:</b> 12:30‚Äì16:00 ¬∑ 19:30‚Äì23:00</li><li><b>Supermarkt:</b> 09:00‚Äì14:00 ¬∑ 17:00‚Äì20:00</li><li><b>Stilte:</b> 23:00‚Äì08:00</li></ul>`
    },
    cardeo:{
      es:`<ul>
        <li><b>Taberna:</b> 12:30‚Äì16:00 ¬∑ 20:00‚Äì23:00</li>
        <li><b>Apartamentos (check-in):</b> 16:00‚Äì20:00 ¬∑ <b>Check-out:</b> 11:00</li>
        <li><b>Descanso:</b> 23:00‚Äì08:00</li>
      </ul>`,
      en:`<ul><li><b>Tavern:</b> 12:30‚Äì16:00 ¬∑ 20:00‚Äì23:00</li><li><b>Apartments check-in:</b> 16:00‚Äì20:00 ¬∑ <b>Check-out:</b> 11:00</li><li><b>Quiet hours:</b> 23:00‚Äì08:00</li></ul>`,
      fr:`<ul><li><b>Taverne :</b> 12:30‚Äì16:00 ¬∑ 20:00‚Äì23:00</li><li><b>Appartements check-in :</b> 16:00‚Äì20:00 ¬∑ <b>Check-out :</b> 11:00</li><li><b>Silence :</b> 23:00‚Äì08:00</li></ul>`,
      de:`<ul><li><b>Taverne:</b> 12:30‚Äì16:00 ¬∑ 20:00‚Äì23:00</li><li><b>Apartments Check-in:</b> 16:00‚Äì20:00 ¬∑ <b>Check-out:</b> 11:00</li><li><b>Nachtruhe:</b> 23:00‚Äì08:00</li></ul>`,
      nl:`<ul><li><b>Taverne:</b> 12:30‚Äì16:00 ¬∑ 20:00‚Äì23:00</li><li><b>App. check-in:</b> 16:00‚Äì20:00 ¬∑ <b>Check-out:</b> 11:00</li><li><b>Stilte:</b> 23:00‚Äì08:00</li></ul>`
    }
  };
  var SCHEDULES = JSON.parse(JSON.stringify(SCHEDULES_DEFAULT));
  function renderAcc(){ ['oyambre','ramales','ruiloba','cardeo'].forEach(function(k){ var el=document.getElementById('acc-'+k); if(!el) return; var item=SCHEDULES[k]||SCHEDULES_DEFAULT[k]||{}; el.innerHTML = item[LANG] || item.es || ''; }); }
  function loadSchedules(){
    fetch('./schedules.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>{ if(!r.ok) throw 0; return r.json(); })
      .then(json=>{ if(json && typeof json==='object'){ SCHEDULES=json; renderAcc(); renderStayHours(); }})
      .catch(()=>{ SCHEDULES=JSON.parse(JSON.stringify(SCHEDULES_DEFAULT)); renderAcc(); renderStayHours(); });
  }
  $all('.acc-h').forEach(h=>on(h,'click', function(){ h.parentElement.classList.toggle('open'); }));

  /* ===== Mi estancia ===== */
  var STAY = localStorage.getItem('stay_place') || 'oyambre';
  function setStayPlace(v){ STAY=String(v||'oyambre').toLowerCase(); localStorage.setItem('stay_place',STAY); updateStayUI(); updateIncUI(); updateDistancesUI(); }
  function renderStayContacts(){
    var T=I18N[LANG], place=STAY;
    $('#stayPlace').value=place;
    var web=WEB[place], tel=PHONES[place], wa=WHATSAPP[place], mail=EMAILS[place];
    $('#stayWeb').textContent=T.web; $('#stayWeb').onclick=function(){ location.href=web; };
    var call=$('#stayCall'); call.textContent=T.call; call.href='tel:'+tel;
    var waBtn=$('#stayWA'); waBtn.textContent=T.whatsapp; waBtn.href='https://wa.me/'+wa+'?text='+encodeURIComponent('Hola, soy cliente alojado en '+PLACE_LABEL[place]+'.');
    var em=$('#stayEmail'); em.textContent=T.email; em.href='mailto:'+mail+'?subject='+encodeURIComponent('Consulta - '+PLACE_LABEL[place])+'&body='+encodeURIComponent('Hola,\n\nSoy cliente alojado en '+PLACE_LABEL[place]+'.\n\nGracias.');
    $('#stayDir').textContent=T.directions||'C√≥mo llegar';
  }
  function renderStayHours(){
    var cont=$('#stayHours'); if(!cont) return;
    var item=(SCHEDULES[STAY]||SCHEDULES_DEFAULT[STAY]||{});
    cont.innerHTML = item[LANG] || item.es || '';
  }

  // Weather
  function codeToEmoji(code){ if([0].includes(code)) return '‚òÄÔ∏è'; if([1,2].includes(code)) return 'üå§Ô∏è'; if([3].includes(code)) return '‚òÅÔ∏è'; if([45,48].includes(code)) return 'üå´Ô∏è'; if([51,53,55,56,57].includes(code)) return 'üå¶Ô∏è'; if([61,63,65,80,81,82].includes(code)) return 'üåßÔ∏è'; if([66,67,71,73,75,77,85,86].includes(code)) return '‚ùÑÔ∏è'; if([95,96,99].includes(code)) return '‚õàÔ∏è'; return 'üå°Ô∏è'; }
  function wd(d){ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short'}).format(new Date(d)); }catch(e){ return d; } }
  function renderWeather(data){
    if(!data) return;
    $('#wxIco').textContent = codeToEmoji(data.current.weather_code);
    $('#wxNow').textContent = Math.round(data.current.temperature_2m);
    $('#wxMax').textContent = Math.round(data.daily.temperature_2m_max[0]);
    $('#wxMin').textContent = Math.round(data.daily.temperature_2m_min[0]);
    $('#wxDesc').textContent = wd(data.daily.time[0]);
    for(var i=1;i<=3;i++){
      $('#d'+i).textContent = wd(data.daily.time[i]);
      $('#i'+i).textContent = codeToEmoji(data.daily.weather_code[i]);
      $('#t'+i).textContent = Math.round(data.daily.temperature_2m_max[i])+'/'+Math.round(data.daily.temperature_2m_min[i])+'¬∞';
    }
  }
  function fetchWeather(place){
    var c=COORDS[place]||COORDS.oyambre;
    var url = 'https://api.open-meteo.com/v1/forecast?latitude='+c.lat+'&longitude='+c.lon+'&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=4';
    fetch(url).then(r=>r.json()).then(renderWeather).catch(function(){});
  }
  function updateStayUI(){ renderStayContacts(); renderStayHours(); fetchWeather(STAY); }
  on($('#stayPlace'),'change', function(e){ setStayPlace(e.target.value); });

  /* ===== Incidencias ===== */
  function fillIncTypes(){ var sel=$('#incType'); if(!sel) return; var opts=I18N[LANG].incTypes||I18N.es.incTypes; sel.innerHTML = opts.map(function(o){ return '<option value="'+o.key+'">'+esc(o.label)+'</option>'; }).join(''); }
  function buildIncMsg(){
    var T=I18N[LANG], typeOpt=$('#incType'); var typeTxt = typeOpt && typeOpt.options[typeOpt.selectedIndex]? typeOpt.options[typeOpt.selectedIndex].textContent : 'Otros';
    var msg=$('#incMsg').value||'';
    var now=new Date(); var stamp = now.toLocaleString();
    var header = '['+T.incTitle+'] '+typeTxt+' ¬∑ '+PLACE_LABEL[STAY];
    var body = 'Hola,\n\nTengo una incidencia: '+typeTxt+'.\n\nDetalle: '+msg+'\n\nAlojamiento: '+PLACE_LABEL[STAY]+'\nFecha/hora: '+stamp+'\n\nGracias.';
    return {subject:header, body:body};
  }
  function updateIncUI(){
    $('#incPlace').value=STAY;
    var mail=EMAILS[STAY], wa=WHATSAPP[STAY];
    var m=buildIncMsg();
    $('#incWA').href='https://wa.me/'+wa+'?text='+encodeURIComponent(m.body);
    $('#incEmail').href='mailto:'+mail+'?subject='+encodeURIComponent(m.subject)+'&body='+encodeURIComponent(m.body);
  }
  on($('#incPlace'),'change', function(e){ setStayPlace(e.target.value); });
  on($('#incType'),'change', updateIncUI);
  on($('#incMsg'),'input', updateIncUI);

  /* ===== Helpers enlaces ===== */
  function gglImages(q){ return 'https://www.google.com/search?tbm=isch&q='+encodeURIComponent(q); }
  function gglMaps(q){ return 'https://www.google.com/maps/search/'+encodeURIComponent(q); }

  /* ===== MUSTS (con coords, distancias y Entradas) ===== */
  function P(lat,lon){ return {lat:lat, lon:lon}; }
  var MUSTS=[
    { slug:'santander', name:{es:'Santander'},
      desc:{es:'Capital elegante y mar√≠tima con una de las bah√≠as m√°s bonitas del mundo. Pasea por el frente mar√≠timo, descansa en las playas del Sardinero y descubre su oferta cultural (Ca√±ad√≠o, Mercado del Este, Palacio de Festivales, Diques de Gamazo).'},
      see:[
        { name:{es:'Centro Bot√≠n y Jardines de Pereda'}, coords:P(43.4629,-3.8077), desc:{es:'Icono cultural junto a la bah√≠a; mirador y exposiciones.'}, map: gglMaps('Centro Bot√≠n'), images: gglImages('Centro Bot√≠n Santander') },
        { name:{es:'Catedral y Plaza del Ayuntamiento'}, coords:P(43.4619,-3.8073), desc:{es:'Casco hist√≥rico y galer√≠as subterr√°neas.'}, map: gglMaps('Catedral de Santander'), images: gglImages('Catedral de Santander') },
        { name:{es:'Playa del Sardinero'}, coords:P(43.4709,-3.7760), desc:{es:'Cl√°sico arenal urbano con paseo.'}, map: gglMaps('Playa del Sardinero'), images: gglImages('Playa del Sardinero') },
        { name:{es:'Pen√≠nsula y Palacio de la Magdalena'}, coords:P(43.4698,-3.7662), desc:{es:'Jardines, playas y vistas.'}, map: gglMaps('Palacio de la Magdalena'), images: gglImages('Palacio de la Magdalena') },
        { name:{es:'Faro de Cabo Mayor'}, coords:P(43.4855,-3.7766), desc:{es:'Acantilados y panor√°micas.'}, map: gglMaps('Faro de Cabo Mayor'), images: gglImages('Faro de Cabo Mayor') },
        { name:{es:'Senda de Matale√±as'}, coords:P(43.4805,-3.7797), desc:{es:'Ruta litoral con vistas.'}, map: gglMaps('Senda de Matale√±as Santander'), images: gglImages('Senda de Matale√±as') },
        { name:{es:'Diques de Gamazo'}, coords:P(43.4576,-3.7900), desc:{es:'Grader√≠o junto al mar.'}, map: gglMaps('Diques de Gamazo Santander'), images: gglImages('Diques de Gamazo') },
        { name:{es:'Palacio de Festivales'}, coords:P(43.4571,-3.7928), desc:{es:'Arquitectura singular y programaci√≥n.'}, map: gglMaps('Palacio de Festivales de Cantabria'), images: gglImages('Palacio de Festivales Santander') },
        { name:{es:'Parque de Las Llamas'}, coords:P(43.4758,-3.7945), desc:{es:'Pulm√≥n verde urbano con laguna.'}, map: gglMaps('Parque de Las Llamas Santander'), images: gglImages('Parque de Las Llamas Santander') },
        { name:{es:'Mercado del Este'}, coords:P(43.4626,-3.8072), desc:{es:'Galer√≠a hist√≥rica, tiendas y gastro.'}, map: gglMaps('Mercado del Este Santander'), images: gglImages('Mercado del Este Santander') },
        { name:{es:'Plaza de Ca√±ad√≠o'}, coords:P(43.4620,-3.8061), desc:{es:'Ambiente y terrazas, vida nocturna.'}, map: gglMaps('Plaza de Ca√±ad√≠o Santander'), images: gglImages('Plaza de Ca√±ad√≠o Santander') }
      ]
    },
    { slug:'san-vicente', name:{es:'San Vicente de la Barquera'},
      desc:{es:'Villa marinera con vistas a Picos de Europa. Puentes hist√≥ricos, iglesia g√≥tica, casco medieval y playas abiertas del Parque Natural de Oyambre.'},
      see:[
        { name:{es:'Puente de La Maza'}, coords:P(43.3861,-4.3929), desc:{es:'Hist√≥rico acceso a la villa.'}, map: gglMaps('Puente de La Maza San Vicente de la Barquera'), images: gglImages('Puente de La Maza') },
        { name:{es:'Iglesia de Santa Mar√≠a de los √Ångeles'}, coords:P(43.3876,-4.3972), desc:{es:'Templo g√≥tico en lo alto.'}, map: gglMaps('Iglesia Santa Mar√≠a de los √Ångeles San Vicente de la Barquera'), images: gglImages('Iglesia Santa Mar√≠a de los √Ångeles San Vicente') },
        { name:{es:'Castillo del Rey'}, coords:P(43.3890,-4.3981), desc:{es:'Fortaleza medieval con mirador.'}, map: gglMaps('Castillo del Rey San Vicente de la Barquera'), images: gglImages('Castillo del Rey San Vicente') },
        { name:{es:'Playa de Mer√≥n y PN Oyambre'}, coords:P(43.3920,-4.4200), desc:{es:'Dunas, mar abierto y entorno protegido.'}, map: gglMaps('Playa de Mer√≥n'), images: gglImages('Playa de Mer√≥n') }
      ]
    },
    { slug:'santillana', name:{es:'Santillana del Mar'},
      desc:{es:'Pueblo de piedra entre blasones y la cueva de Altamira. Calles empedradas, casonas y un patrimonio rom√°nico excepcional.'},
      see:[
        { name:{es:'Colegiata de Santa Juliana'}, coords:P(43.3902,-4.1090), desc:{es:'Rom√°nico y claustro imprescindible.'}, map: gglMaps('Colegiata Santa Juliana Santillana del Mar'), images: gglImages('Colegiata Santillana del Mar') },
        { name:{es:'Museo y Neocueva de Altamira'}, coords:P(43.3776,-4.1228), desc:{es:'Arte rupestre Patrimonio Mundial.'}, map: gglMaps('Museo de Altamira'), images: gglImages('Altamira Neocueva'), tickets:'https://www.cultura.gob.es/mnaltamira/visita/compra-entradas.html' },
        { name:{es:'Casco hist√≥rico y torres'}, coords:P(43.3898,-4.1088), desc:{es:'Casonas y escudos en cada esquina.'}, map: gglMaps('Santillana del Mar casco hist√≥rico'), images: gglImages('Santillana del Mar casco') }
      ]
    },
    { slug:'suances', name:{es:'Suances'},
      desc:{es:'Destino surfero y familiar: Los Locos, La Concha y faro en Punta del Dichoso. Atardeceres potentes y rutas costeras.'},
      see:[
        { name:{es:'Playa de Los Locos'}, coords:P(43.4290,-4.0538), desc:{es:'Meca del surf y puestas de sol.'}, map: gglMaps('Playa de Los Locos Suances'), images: gglImages('Playa de Los Locos Suances') },
        { name:{es:'Playa de La Concha'}, coords:P(43.4292,-4.0393), desc:{es:'Gran arenal urbano.'}, map: gglMaps('Playa de La Concha Suances'), images: gglImages('Playa de La Concha Suances') },
        { name:{es:'Faro (Punta del Dichoso)'}, coords:P(43.4322,-4.0625), desc:{es:'Miradores sobre costa y r√≠a.'}, map: gglMaps('Faro de Suances Punta del Dichoso'), images: gglImages('Faro de Suances Punta del Dichoso') }
      ]
    },
    { slug:'potes-liebana', name:{es:'Potes y Li√©bana'},
      desc:{es:'Valle entre Picos: Potes medieval, monasterios con historia, orujo tradicional y el telef√©rico de Fuente D√© para subir a la alta monta√±a.'},
      see:[
        { name:{es:'Potes y Torre del Infantado'}, coords:P(43.1543,-4.6215), desc:{es:'Centro medieval con puentes.'}, map: gglMaps('Potes Torre del Infantado'), images: gglImages('Potes Cantabria') },
        { name:{es:'Monasterio de Santo Toribio'}, coords:P(43.1581,-4.6039), desc:{es:'Lugar jubilar con el Lignum Crucis.'}, map: gglMaps('Monasterio de Santo Toribio de Li√©bana'), images: gglImages('Santo Toribio Li√©bana') },
        { name:{es:'Telef√©rico de Fuente D√©'}, coords:P(43.1441,-4.8151), desc:{es:'Acceso directo a cumbres y rutas.'}, map: gglMaps('Telef√©rico de Fuente D√©'), images: gglImages('Telef√©rico Fuente D√©') }
      ]
    },
    { slug:'alto-ason', name:{es:'Comarca del Alto As√≥n'},
      desc:{es:'Paisaje k√°rstico, cuevas y cascadas con epicentro en Ramales. Ideal para espeleolog√≠a y senderismo entre bosques.'},
      see:[
        { name:{es:'Cueva de Cullalvera (Ramales)'}, coords:P(43.2624,-3.4682), desc:{es:'Gran boca y visita accesible.'}, map: gglMaps('Cueva de Cullalvera Ramales'), images: gglImages('Cueva de Cullalvera') },
        { name:{es:'Cueva Coventosa'}, coords:P(43.2580,-3.5830), desc:{es:'Espeleolog√≠a para expertos.'}, map: gglMaps('Cueva Coventosa'), images: gglImages('Cueva Coventosa') },
        { name:{es:'Nacimiento del r√≠o As√≥n'}, coords:P(43.2585,-3.5931), desc:{es:'Imponente cascada desde el farall√≥n.'}, map: gglMaps('Cascada del As√≥n'), images: gglImages('Cascada del As√≥n') }
      ]
    },
    { slug:'cabuerniga', name:{es:'Valle de Cabu√©rniga'},
      desc:{es:'Bosques, r√≠os y arquitectura tradicional. Naturaleza tranquila y excelente gastronom√≠a local.'},
      see:[
        { name:{es:'Ruente y la Fuentona'}, coords:P(43.2617,-4.3041), desc:{es:'Manantial k√°rstico y pasarelas.'}, map: gglMaps('La Fuentona de Ruente'), images: gglImages('Fuentona de Ruente') },
        { name:{es:'Cascadas de Lami√±a'}, coords:P(43.2850,-4.2560), desc:{es:'Ruta f√°cil entre robledales.'}, map: gglMaps('Cascadas de Lami√±a'), images: gglImages('Cascadas de Lami√±a') },
        { name:{es:'Los Tojos'}, coords:P(43.1575,-4.2260), desc:{es:'Arquitectura y miradores.'}, map: gglMaps('Los Tojos Cantabria'), images: gglImages('Los Tojos Cantabria') },
        { name:{es:'B√°rcena Mayor'}, coords:P(43.1520,-4.2840), desc:{es:'Pueblo de piedra y madera.'}, map: gglMaps('B√°rcena Mayor'), images: gglImages('B√°rcena Mayor') }
      ]
    },
    { slug:'hermida', name:{es:'Desfiladero de La Hermida'},
      desc:{es:'Ca√±√≥n fluvial que conduce a Li√©bana. Carretera esc√©nica, miradores como Santa Catalina y balneario de aguas termales.'},
      see:[
        { name:{es:'Mirador de Santa Catalina'}, coords:P(43.2515,-4.5457), desc:{es:'Vistas a√©reas del desfiladero.'}, map: gglMaps('Mirador de Santa Catalina Cantabria'), images: gglImages('Mirador de Santa Catalina Desfiladero de la Hermida') },
        { name:{es:'Balneario de La Hermida'}, coords:P(43.2587,-4.5986), desc:{es:'Aguas termales en pleno ca√±√≥n.'}, map: gglMaps('Balneario de La Hermida'), images: gglImages('Balneario de La Hermida') }
      ]
    },
    { slug:'soplao', name:{es:'Cueva El Soplao'},
      desc:{es:'Caverna √∫nica de formaciones exc√©ntricas y patrimonio minero. Ofrece visita cl√°sica, aventura y geominera, adem√°s de un mirador cercano.'},
      see:[
        { name:{es:'Visita tur√≠stica (cl√°sica)'}, coords:P(43.3110,-4.3900), desc:{es:'Recorrido guiado accesible.'}, map: gglMaps('Cueva El Soplao visitas'), images: gglImages('Cueva El Soplao interior') },
        { name:{es:'Visita aventura'}, coords:P(43.3110,-4.3900), desc:{es:'Experiencia espeleol√≥gica con mono y casco.'}, map: gglMaps('Cueva El Soplao aventura'), images: gglImages('Cueva El Soplao aventura') },
        { name:{es:'Visita geominera'}, coords:P(43.3110,-4.3900), desc:{es:'Historia minera y geolog√≠a.'}, map: gglMaps('El Soplao geominera'), images: gglImages('El Soplao minas') },
        { name:{es:'Mirador de El Soplao'}, coords:P(43.3080,-4.3760), desc:{es:'Vistas a costa y Picos.'}, map: gglMaps('Mirador El Soplao'), images: gglImages('Mirador El Soplao') }
      ]
    },
    { slug:'isla-noja-santona', name:{es:'Isla ¬∑ Noja ¬∑ Santo√±a'},
      desc:{es:'Playas familiares, marismas y rutas costeras. Desde Trengand√≠n y Joyel hasta el exigente ascenso al Faro del Caballo.'},
      see:[
        { name:{es:'Playa de Trengand√≠n (Noja)'}, coords:P(43.4790,-3.5190), desc:{es:'Arena fina y rocas.'}, map: gglMaps('Playa de Trengand√≠n Noja'), images: gglImages('Playa de Trengand√≠n') },
        { name:{es:'Playa del Joyel'}, coords:P(43.4760,-3.5260), desc:{es:'Espacio protegido.'}, map: gglMaps('Playa del Joyel'), images: gglImages('Playa del Joyel') },
        { name:{es:'Playas de Isla'}, coords:P(43.4860,-3.5580), desc:{es:'Arenales y marismas.'}, map: gglMaps('Playas de Isla Cantabria'), images: gglImages('Playa de Isla Cantabria') },
        { name:{es:'Santo√±a, Monte Buciero y Faro del Caballo'}, coords:P(43.4507,-3.4140), desc:{es:'Ruta con cientos de pelda√±os y vistas soberbias.'}, map: gglMaps('Faro del Caballo Santo√±a'), images: gglImages('Faro del Caballo') }
      ]
    },
    { slug:'comillas', name:{es:'Comillas'},
      desc:{es:'Modernismo, playa y ambiente se√±orial: El Capricho de Gaud√≠, palacio de Sobrellano y Universidad Pontificia en di√°logo con el mar.'},
      see:[
        { name:{es:'El Capricho de Gaud√≠'}, coords:P(43.3861,-4.2924), desc:{es:'Pabell√≥n modernista con girasoles.'}, map: gglMaps('El Capricho de Gaud√≠ Comillas'), images: gglImages('El Capricho de Gaud√≠ Comillas') },
        { name:{es:'Palacio de Sobrellano y Capilla-Pante√≥n'}, coords:P(43.3835,-4.2942), desc:{es:'Neog√≥tico monumental.'}, map: gglMaps('Palacio de Sobrellano Comillas'), images: gglImages('Palacio de Sobrellano') },
        { name:{es:'Universidad Pontificia'}, coords:P(43.3839,-4.2870), desc:{es:'Imponente edificio en lo alto.'}, map: gglMaps('Universidad Pontificia de Comillas'), images: gglImages('Universidad Pontificia Comillas') },
        { name:{es:'Puerto y Playa de Comillas'}, coords:P(43.3851,-4.2952), desc:{es:'Ambiente marinero y ba√±o.'}, map: gglMaps('Playa de Comillas'), images: gglImages('Playa de Comillas') }
      ]
    },
    { slug:'cabarceno', name:{es:'Parque de la Naturaleza de Cab√°rceno'},
      desc:{es:'Fauna en semilibertad en una antigua mina. Recorridos panor√°micos en coche y telecabina incluido en la entrada.'},
      see:[
        { name:{es:'Recorridos panor√°micos'}, coords:P(43.3430,-3.8820), desc:{es:'Itinerarios con miradores.'}, map: gglMaps('Parque de la Naturaleza de Cab√°rceno'), images: gglImages('Cab√°rceno vistas') },
        { name:{es:'Telecabina'}, coords:P(43.3350,-3.8790), desc:{es:'Sobrevuela recintos y lagos.'}, map: gglMaps('Telecabina Cab√°rceno'), images: gglImages('Telecabina Cab√°rceno') },
        { name:{es:'Entradas online'}, coords:P(43.3430,-3.8820), desc:{es:'Compra anticipada recomendada.'}, tickets:'https://entradas.parquedecabarceno.com/' }
      ]
    }
  ];

  /* ===== GASTRONOM√çA ===== */
  var FOOD=[
    { name:{es:'Anchoas de Santo√±a'}, desc:{es:'Filetes artesanos en aceite de oliva.'} },
    { name:{es:'Cocido monta√±√©s'}, desc:{es:'Alubia blanca y berza, con compango.'} },
    { name:{es:'Rabas'}, desc:{es:'Tiras de calamar rebozadas.'} },
    { name:{es:'Almejas a la marinera'}, desc:{es:'Vino blanco, ajo y perejil.'} },
    { name:{es:'Bonito con tomate'}, desc:{es:'De temporada (verano).'} },
    { name:{es:'Queso Pic√≥n Bejes-Tresviso'}, desc:{es:'Azul, intenso y cremoso.'} },
    { name:{es:'Sobaos y Quesadas'}, desc:{es:'Reposter√≠a de Valles Pasiegos.'} },
    { name:{es:'Leche frita'}, desc:{es:'Postre tradicional con canela.'} },
    { name:{es:'Orujo de Li√©bana'}, desc:{es:'Destilado t√≠pico.'} },
    { name:{es:'Corbatas de Unquera / San Vicente'}, desc:{es:'Hojaldre glaseado.'} },
    { name:{es:'Pastel de cabracho'}, desc:{es:'Pastel fr√≠o de pescado.'} }
  ];

  /* ===== Render MUSTS & FOOD ===== */
  function i18nTxt(obj){ return (obj && (obj[LANG]||obj.es||''))||''; }
  function renderMusts(){
    var wrap=$('#mustsAcc'); if(!wrap) return;
    var T=I18N[LANG];
    wrap.innerHTML = (MUSTS||[]).map(function(m){
      var head = esc(i18nTxt(m.name));
      var desc = esc(i18nTxt(m.desc));
      var body = '<p class="muted">'+desc+'</p>';
      if(m.see && m.see.length){
        body+='<div class="pill">‚≠ê '+esc(T.see||'Qu√© ver')+'</div>';
        body+='<div class="acc" style="margin-top:8px">'+ m.see.map(function(s){
          var sName=esc(i18nTxt(s.name)); var sDesc=esc(i18nTxt(s.desc||{es:''}));
          var map = s.map?('<a class="btn sm" href="'+esc(typeof s.map==='string'?s.map:gglMaps(sName))+'" target="_blank" rel="noopener">üó∫Ô∏è '+esc(T.map)+'</a>'):'';
          var imgs= s.images?('<a class="btn sm" href="'+esc(typeof s.images==='string'?s.images:gglImages(sName))+'" target="_blank" rel="noopener">üñºÔ∏è '+esc(T.images)+'</a>'):'';
          var tix = s.tickets?('<a class="btn sm primary tickets" href="'+esc(s.tickets)+'" target="_blank" rel="noopener">üéüÔ∏è '+esc(T.tickets)+'</a>'):'';
          var distChip=''; var nav='';
          if(USER_POS && s.coords && typeof s.coords.lat==='number'){
            var km = fmtKm(haversineKm(USER_POS.lat,USER_POS.lon, s.coords.lat, s.coords.lon));
            distChip = '<span class="pill distance">üìç '+esc(T.distLabel||'Distancia')+': '+km+'</span>';
            nav = '<a class="btn sm nav" href="'+esc(navUrl(s.coords.lat,s.coords.lon,sName))+'" target="_blank" rel="noopener">'+esc(T.openInMaps||'üß≠ Abrir en Maps')+'</a>';
          }else if(s.coords){
            nav = '<a class="btn sm nav" href="'+esc(navUrl(s.coords.lat,s.coords.lon,sName))+'" target="_blank" rel="noopener">üß≠ '+esc(T.openInMaps||'Abrir en Maps')+'</a>';
          }
          return '<div class="acc-item"><div class="acc-h">'+sName+' <span>‚ñº</span></div><div class="acc-b">'
                 + '<p>'+sDesc+'</p><div class="row">'+distChip+'</div><div class="see-actions">'+nav+map+imgs+tix+'</div></div></div>';
        }).join('') + '</div>';
      }
      return '<div class="acc-item"><div class="acc-h" data-m="'+esc(m.slug)+'">'+head+' <span>‚ñº</span></div><div class="acc-b">'+body+'</div></div>';
    }).join('');
    $all('#mustsAcc .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });
  }

  function renderFood(){
    var wrap=$('#foodAcc'); if(!wrap) return;
    wrap.innerHTML = (FOOD||[]).map(function(f){
      var name=esc(i18nTxt(f.name)); var desc=esc(i18nTxt(f.desc));
      var imgLink=gglImages(name+' Cantabria');
      return '<div class="acc-item"><div class="acc-h">'+name+' <span>‚ñº</span></div>'
        + '<div class="acc-b"><p>'+desc+'</p><div class="see-actions">'
        + '<a class="btn sm" href="'+esc(imgLink)+'" target="_blank" rel="noopener">üñºÔ∏è '+esc(I18N[LANG].images)+'</a>'
        + '</div></div></div>';
    }).join('');
    $all('#foodAcc .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });
  }

  /* ===== Admin oculto por 5 toques (PIN 311974) ===== */
  var tapCount=0, tapTimer=null;
  on($('#logoTap'),'click', function(){
    tapCount++; clearTimeout(tapTimer);
    tapTimer=setTimeout(function(){ tapCount=0; }, 1500);
    if(tapCount>=5){
      tapCount=0;
      var pin = prompt('Introduce PIN admin');
      if(pin===localStorage.getItem('admin_pin')){
        localStorage.setItem('admin','1');
        document.body.classList.add('admin-on');
        $('#openAdmin').style.display='block';
        openAdminModal();
      }else{
        alert('PIN incorrecto');
      }
    }
  });
  // Bot√≥n Admin (oculto hasta activar)
  if(localStorage.getItem('admin')==='1'){ $('#openAdmin').style.display='block'; }
  on($('#openAdmin'),'click', function(){ if(localStorage.getItem('admin')==='1'){ openAdminModal(); } });

  function openAdminModal(){ $('#adminModal').style.display='flex'; document.body.classList.add('modal-open'); }
  on($('#closeAdmin'),'click', function(e){ e.preventDefault(); $('#adminModal').style.display='none'; document.body.classList.remove('modal-open'); });

  // Admin: acordeones
  $all('#adminModal .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });

  // Admin: importar/exportar JSON
  on($('#evImport'),'change', function(e){
    var f=e.target.files[0]; if(!f) return;
    var r=new FileReader(); r.onload=function(){ $('#evText').value=r.result; }; r.readAsText(f);
  });
  on($('#scImport'),'change', function(e){
    var f=e.target.files[0]; if(!f) return;
    var r=new FileReader(); r.onload=function(){ $('#scText').value=r.result; }; r.readAsText(f);
  });
  on($('#evDownload'),'click', function(){
    var txt=$('#evText').value.trim(); if(!txt){ txt='[]'; }
    download('events.json', txt, 'application/json;charset=utf-8');
  });
  on($('#scDownload'),'click', function(){
    var txt=$('#scText').value.trim(); if(!txt){ txt=JSON.stringify(SCHEDULES_DEFAULT,null,2); }
    download('schedules.json', txt, 'application/json;charset=utf-8');
  });
  on($('#makeZip'),'click', function(){
    try{
      var zip=new JSZip();
      var evTxt=$('#evText').value.trim()||'[]';
      var scTxt=$('#scText').value.trim()||JSON.stringify(SCHEDULES_DEFAULT,null,2);
      zip.file('events.json', evTxt);
      zip.file('schedules.json', scTxt);
      zip.generateAsync({type:'blob'}).then(function(content){
        var a=document.createElement('a');
        a.href=URL.createObjectURL(content); a.download='backup_acobijo.zip'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),1000);
      });
    }catch(e){ alert('No se pudo crear el ZIP'); }
  });
  on($('#resetAdmin'),'click', function(){
    localStorage.setItem('admin','0'); document.body.classList.remove('admin-on'); $('#openAdmin').style.display='none'; alert('Admin cerrado.');
    $('#adminModal').style.display='none'; document.body.classList.remove('modal-open');
  });

  /* ===== PWA install ===== */
  var deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); deferredPrompt=e; });
  function platformGuide(){
    var ua=navigator.userAgent||''; var isIOS=/iP(ad|hone|od)/.test(ua); var isAndroid=/Android/i.test(ua);
    var T=I18N[LANG];
    if(isIOS) return T.instGuideIOS;
    if(isAndroid) return T.instGuideAndroid;
    return T.instGuideDesktop;
  }
  function openInstallModal(){
    html('instBody', platformGuide());
    $('#installModal').style.display='flex'; document.body.classList.add('modal-open');
  }
  on($('#installTile'),'click', openInstallModal);
  on($('#closeInstall'),'click', function(e){ e.preventDefault(); $('#installModal').style.display='none'; document.body.classList.remove('modal-open'); });
  on($('#instNow'),'click', function(){
    if(deferredPrompt){ try{ deferredPrompt.prompt(); deferredPrompt.userChoice && deferredPrompt.userChoice.then(function(){}); }catch(e){} deferredPrompt=null; }
    else alert('Si no aparece el di√°logo, usa los pasos indicados arriba.');
  });

  /* ===== Init ===== */
  function initIncTypesAndUI(){ fillIncTypes(); $('#incPlace').value=STAY; updateIncUI(); }
  $('#stayPlace').value=STAY; $('#incPlace').value=STAY;

  loadSchedules();
  loadEvents();
  renderAcc();
  updateStayUI();
  initIncTypesAndUI();
  renderMusts();
  renderFood();
  updateDistancesUI();

  /* ===== Service Worker ===== */
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('./service-worker.js');
    navigator.serviceWorker.addEventListener('message', (e) => {
      if (e.data && e.data.type === 'SW_ACTIVE') {
        console.log('PWA actualizada a', e.data.version);
      }
    });
  }

}); // DOMContentLoaded
</script>
</body>
</html>
