<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Grupo A Cobijo</title>
<meta name="description" content="App de experiencia del cliente: eventos, horarios y accesos del Grupo A Cobijo.">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0ea5e9">
<link rel="icon" href="assets/icons/icon-192.png">
<link rel="apple-touch-icon" href="assets/icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
:root{
  --bg:#ffffff; --ink:#0a1a2a; --muted:#6b7280; --line:#e6eef7;
  --brand:#0ea5e9; --brand-ink:#063e63; --card:#f7fbff; --tint:#eef7ff;
  --wx1:#e9f6ff; --wx2:#d9efff; --wx3:#cce7ff; --wx4:#bfe0ff;
  --ok:#10b981; --warn:#f59e0b; --danger:#ef4444;
}
body.dark{
  --bg:#0b1220; --ink:#e8eef7; --muted:#8fa2bd; --line:#1e2a40;
  --brand:#22b2ff; --brand-ink:#bfe7ff; --card:#111a2a; --tint:#0f1a2b;
  --wx1:#0f1f35; --wx2:#102640; --wx3:#0f2b4a; --wx4:#0c3156;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink);background:var(--bg);transition:background-color .15s,color .15s}
img{max-width:100%;height:auto}
.hero img{height:64px;width:auto;max-width:160px}

/* Topbar */
.topbar{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#e6f6ff,#ffffff);
  border-bottom:1px solid var(--line);display:flex;align-items:center;gap:.75rem;padding:.7rem .9rem}
body.dark .topbar{background:linear-gradient(180deg,#0e1a2c,#0b1220)}
.topbar .burger{border:none;background:#fff;border:1px solid var(--line);border-radius:10px;padding:.45rem .55rem;cursor:pointer}
body.dark .topbar .burger{background:#0f1a2b}
.topbar .brand{display:flex;align-items:center;gap:.6rem}
.topbar img{height:40px;width:auto;object-fit:contain}
.topbar h1{font-size:1rem;margin:0}
.lang-btn,.theme-btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:.35rem .6rem;cursor:pointer}
body.dark .lang-btn, body.dark .theme-btn{background:#0f1a2b}

/* Drawer */
.drawer{position:fixed;inset:0;z-index:30;display:none}
.drawer.open{display:block}
.drawer .back{position:absolute;inset:0;background:rgba(0,0,0,.35)}
.drawer .panel{position:absolute;inset:0 auto 0 0;width:min(86vw,360px);background:#fff;border-right:1px solid var(--line);
  padding:14px;display:flex;flex-direction:column;gap:10px}
body.dark .drawer .panel{background:#0f1a2b}
.drawer .item{display:flex;gap:.6rem;align-items:center;border:1px solid var(--line);border-radius:12px;padding:.6rem .7rem;background:var(--tint);cursor:pointer}
.drawer .muted{color:var(--muted);font-size:.85rem}
.drawer .item.admin-btn{display:none !important;}
.admin-on .drawer .item.admin-btn{display:flex !important;}

/* Main, views */
main{padding:12px 12px 84px;max-width:980px;margin:0 auto}
.view{display:none;animation:fade .15s ease-out}
.view.active{display:block}
@keyframes fade{from{opacity:.6;transform:translateY(4px)}to{opacity:1;transform:none}}

/* Home */
.hero{position:relative;border:1px solid var(--line);border-radius:18px;overflow:hidden;background:
  radial-gradient(120% 80% at 100% 0%,#b7e6ff 0%,#e6f6ff 50%,#ffffff 100%)}
body.dark .hero{background:radial-gradient(120% 80% at 100% 0%,#143356 0%,#0f2239 50%,#0b1220 100%)}
.hero-inner{display:flex;align-items:center;gap:14px;padding:16px}
.hero h2{margin:0;font-size:1.3rem}
.badge{display:none} /* oculto */
.tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:12px}
.tile{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:6px;
  align-items:flex-start;cursor:pointer;box-shadow:0 8px 24px rgba(14,165,233,.06)}
.tile .big{font-size:1.6rem}
.tile .muted{color:var(--muted);font-size:.86rem}
.tile:active{transform:scale(.98)}

.hscroll{display:flex;gap:10px;overflow:auto;padding-bottom:6px;scrollbar-gutter:stable both-edges}
.card{min-width:260px;flex:0 0 auto;background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px}
body.dark .card{background:#0f1a2b}
.card img{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;border:1px solid var(--line);background:#f2f6fb}
.card .title{font-weight:700;margin-top:6px}
.card .meta{font-size:.85rem;color:var(--muted)}
.row{display:flex;flex-wrap:wrap;gap:6px}

/* Buttons */
.btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:10px;padding:.46rem .66rem;cursor:pointer;font-weight:600;color:var(--ink)}
body.dark .btn{background:#0f1a2b}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
.btn.sm{padding:.28rem .5rem;font-size:.82rem}
.btn.ghost{background:transparent;border-color:var(--line);color:var(--muted)}
.badge-pill{display:inline-flex;gap:.35rem;align-items:center;border:1px solid var(--line);border-radius:999px;padding:.12rem .48rem;font-size:.76rem;background:#fff}
body.dark .btn.ghost{background:transparent}

/* Grids */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}

/* Chips */
.chip{border-radius:999px}

/* Accordions */
.acc{display:flex;flex-direction:column;gap:8px}
.acc-item{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#fff}
body.dark .acc-item{background:#0f1a2b}
.acc-h{display:flex;justify-content:space-between;align-items:center;padding:.7rem .8rem;cursor:pointer;background:var(--tint)}
.acc-b{display:none;padding:.8rem}
.acc-item.open .acc-b{display:block}
.acc-h .right{display:flex;gap:.35rem;align-items:center}

/* Bottom nav (4) */
.navbar{position:fixed;left:0;right:0;bottom:0;z-index:25;background:#fff;border-top:1px solid var(--line);display:grid;grid-template-columns:repeat(4,1fr)}
body.dark .navbar{background:#0f1a2b}
.navbtn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 4px;border:none;background:transparent;cursor:pointer;font-size:.8rem;color:var(--muted)}
.navbtn.active{color:var(--brand-ink);font-weight:700}
.navbtn .ico{font-size:1.1rem}

/* Modal base */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:1000}
.modal{width:min(92vw,920px);max-height:88vh;overflow:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;
  background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.2)}
body.dark .modal{background:#0f1a2b}
.close{background:transparent;border:none;color:var(--muted);font-weight:700;cursor:pointer;font-size:1.6rem;line-height:1;padding:.25rem .5rem;border-radius:10px;float:right}
.close:active{transform:scale(.95)}
body.modal-open{overflow:hidden}

/* Inputs */
.input,.select,.textarea{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff}
.textarea{min-height:96px}

/* Weather (Mi estancia) */
.wx{border:1px solid var(--line);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,var(--wx2),var(--wx1));padding:12px}
.wx-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.wx-today{display:grid;grid-template-columns:80px 1fr;gap:10px;align-items:center;background:linear-gradient(180deg,var(--wx4),var(--wx2));border:1px solid var(--line);border-radius:14px;padding:10px}
.wx-ico{font-size:2.2rem}
.wx-deg{font-size:2rem;font-weight:800}
.wx-minmax{font-size:.9rem;color:var(--muted)}
.wx-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.wx-day{border:1px solid var(--line);border-radius:12px;padding:8px;text-align:center;background:linear-gradient(180deg,var(--wx2),var(--wx1))}
.wx-day .d{font-weight:700}
.wx-day .t{font-size:.9rem}

/* Pills */
.pill{display:inline-flex;gap:.35rem;align-items:center;border:1px solid var(--line);border-radius:999px;padding:.25rem .55rem;font-size:.85rem;background:#fff}
body.dark .pill{background:#0f1a2b}

/* Helper */
.muted{color:var(--muted)}
.small{font-size:.85rem}
.note{border-left:4px solid var(--warn);background:#fff7e6;padding:.6rem .8rem;border-radius:8px}
body.dark .note{background:#1f1a10}
.emph{font-weight:700}
</style>
</head>
<body>

<!-- Topbar -->
<header class="topbar">
  <button id="menuBtn" class="burger" aria-label="Abrir menÃº">â˜°</button>
  <div class="brand">
    <img src="assets/logo.png" alt="Grupo A Cobijo" id="logoTap">
    <h1 id="t-app">Grupo A Cobijo</h1>
  </div>
  <div style="flex:1"></div>
  <button class="theme-btn" id="themeBtn" title="Tema" aria-label="Cambiar tema">ğŸŒ™</button>
  <button class="lang-btn" id="langBtn" aria-haspopup="dialog">ğŸŒ ES</button>
</header>

<!-- Drawer -->
<div class="drawer" id="drawer">
  <div class="back" id="drawerBack"></div>
  <aside class="panel" role="menu" aria-label="NavegaciÃ³n">
    <div class="item" data-nav="home">ğŸ  <strong id="d-home">Inicio</strong></div>
    <div class="item" data-nav="stay">ğŸ§³ <strong id="d-stay">Mi estancia</strong></div>
    <div class="item" data-nav="incidents">ğŸ†˜ <strong id="d-inc">Incidencias</strong></div>
    <div class="item" data-nav="events">ğŸ“… <strong id="d-ev">Eventos</strong></div>
    <div class="item" data-nav="places">ğŸ•ï¸ <strong id="d-pl">Campings</strong></div>
    <div class="item" data-nav="schedules">ğŸ•’ <strong id="d-sc">Horarios</strong></div>
    <div class="item" data-nav="musts">â­ <strong id="d-musts">Imprescindibles</strong></div>
    <div class="item" data-nav="food">ğŸ½ï¸ <strong id="d-food">GastronomÃ­a</strong></div>
    <div class="item" data-nav="favorites">ğŸ’š <strong id="d-favs">Favoritos del equipo</strong></div>
    <div class="item" data-nav="precheck">ğŸ“ <strong id="d-pre">Pre-checkin</strong></div>
    <div class="item" data-nav="suggest">ğŸ’¬ <strong id="d-sug">Sugerencias</strong></div>
    <div class="item admin-btn" id="openAdmin">ğŸ› ï¸ <strong>Admin</strong></div>
    <div class="muted" id="drawerHint">Elige secciÃ³n</div>
  </aside>
</div>

<main>
  <!-- HOME -->
  <section id="view-home" class="view active">
    <div class="hero">
      <div class="hero-inner">
        <img src="assets/logo.png" alt="A Cobijo">
        <div>
          <h2 id="t-hello">Â¡Bienvenido!</h2>
          <div class="badge" id="t-badge">PWA Â· Offline Â· Multidioma</div><!-- oculto por CSS -->
        </div>
      </div>
      <div class="tiles">
        <div class="tile" data-nav="events"><div class="big">ğŸ“…</div><div><strong id="t-ev">Eventos</strong><div class="muted" id="t-ev-sub">QuÃ© hay hoy</div></div></div>
        <div class="tile" data-nav="stay"><div class="big">ğŸ§³</div><div><strong id="t-stay">Mi estancia</strong><div class="muted" id="t-stay-sub">Contactos, clima, horarios</div></div></div>
        <div class="tile" data-nav="incidents"><div class="big">ğŸ†˜</div><div><strong id="t-inc">Incidencias</strong><div class="muted" id="t-inc-sub">WhatsApp/Email directos</div></div></div>
        <div class="tile" data-nav="musts"><div class="big">â­</div><div><strong id="t-musts">Imprescindibles</strong><div class="muted" id="t-musts-sub">QuÃ© ver en Cantabria</div></div></div>
        <div class="tile" data-nav="food"><div class="big">ğŸ½ï¸</div><div><strong id="t-food">GastronomÃ­a</strong><div class="muted" id="t-food-sub">Sabores cÃ¡ntabros</div></div></div>
        <div class="tile" data-nav="favorites"><div class="big">ğŸ’š</div><div><strong id="t-favs">Favoritos del equipo</strong><div class="muted" id="t-favs-sub">Recomendaciones reales</div></div></div>
        <div class="tile" data-nav="suggest"><div class="big">ğŸ’¬</div><div><strong id="t-sug">Sugerencias</strong><div class="muted" id="t-sug-sub">AyÃºdanos a mejorar</div></div></div>
        <div class="tile" data-nav="precheck"><div class="big">ğŸ“</div><div><strong id="t-pre">Pre-checkin</strong><div class="muted" id="t-pre-sub">Ahorra tiempo al llegar</div></div></div>
        <div class="tile" id="installTile"><div class="big">â¬‡ï¸</div><div><strong id="t-inst">Instalar</strong><div class="muted" id="t-inst-sub">AÃ±adir a inicio</div></div></div>
      </div>
    </div>

    <h3 style="margin:14px 4px 8px" id="t-next-events">PrÃ³ximos eventos</h3>
    <div id="homeEvents" class="hscroll"></div>
  </section>

  <!-- MI ESTANCIA -->
  <section id="view-stay" class="view">
    <h2 id="t-stay-title">Mi estancia</h2>
    <p class="muted" id="t-stay-hint">Guardamos tu elecciÃ³n en este dispositivo.</p>

    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(240px,1fr))">
      <div>
        <label for="stayPlace" style="font-weight:700" id="t-stay-which">Selecciona tu alojamiento</label>
        <select id="stayPlace" class="select">
          <option value="oyambre">Oyambre</option>
          <option value="ramales">Ramales</option>
          <option value="ruiloba">Ruiloba</option>
          <option value="cardeo">El Cardeo</option>
        </select>
      </div>
      <div class="row" style="align-items:flex-end">
        <button id="stayWeb" class="btn">Web</button>
        <a id="stayCall" class="btn" target="_blank" rel="noopener">Llamar</a>
        <a id="stayWA" class="btn" target="_blank" rel="noopener">WhatsApp</a>
        <a id="stayEmail" class="btn" target="_blank" rel="noopener">Email</a>
        <a id="stayDir" class="btn" target="_blank" rel="noopener">CÃ³mo llegar</a>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3 id="t-stay-hours">Horarios del alojamiento</h3>
      <div id="stayHours"></div>
    </div>

    <div class="wx" style="margin-top:12px" id="stayWeather">
      <div class="wx-h">
        <h3 id="t-weather-title" style="margin:0">Clima</h3>
        <div class="muted" id="wxPlaceLabel">â€”</div>
      </div>
      <div class="wx-today">
        <div class="wx-ico" id="wxIco">â˜€ï¸</div>
        <div>
          <div class="wx-deg"><span id="wxNow">--</span>Â°</div>
          <div class="wx-minmax"><span id="t-max">MÃ¡x</span>: <span id="wxMax">--</span>Â° Â· <span id="t-min">MÃ­n</span>: <span id="wxMin">--</span>Â°</div>
          <div class="muted" id="wxDesc">â€”</div>
        </div>
      </div>
      <div class="wx-3">
        <div class="wx-day"><div class="d" id="d1">â€”</div><div class="i" id="i1">â˜€ï¸</div><div class="t" id="t1">--/--Â°</div></div>
        <div class="wx-day"><div class="d" id="d2">â€”</div><div class="i" id="i2">â˜€ï¸</div><div class="t" id="t2">--/--Â°</div></div>
        <div class="wx-day"><div class="d" id="d3">â€”</div><div class="i" id="i3">â˜€ï¸</div><div class="t" id="t3">--/--Â°</div></div>
      </div>
    </div>
  </section>

  <!-- INCIDENCIAS -->
  <section id="view-incidents" class="view">
    <h2 id="i-title">Incidencias</h2>
    <p class="muted" id="i-hint">Se abre WhatsApp o tu app de correo con el mensaje preparado.</p>

    <div class="card" style="background:var(--tint)">
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
        <div>
          <label style="font-weight:700" for="incPlace" id="i-where">Â¿En quÃ© alojamiento estÃ¡s?</label>
          <select id="incPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700" for="incType" id="i-type">Tipo de incidencia</label>
          <select id="incType" class="select"></select>
        </div>
      </div>
      <div style="margin-top:10px">
        <label style="font-weight:700" for="incMsg" id="i-msg">Describe brevemente el problema</label>
        <textarea id="incMsg" class="textarea" placeholder="Ej.: Sin luz en la parcela 24, desde las 21:15..."></textarea>
      </div>
      <div class="row" style="margin-top:10px">
        <a id="incWA" class="btn primary" target="_blank" rel="noopener">WhatsApp</a>
        <a id="incEmail" class="btn" target="_blank" rel="noopener">Email</a>
      </div>
    </div>
  </section>

  <!-- EVENTOS -->
  <section id="view-events" class="view">
    <h2 id="t-events-title">Eventos</h2>
    <div class="row" style="gap:8px;margin:10px 0">
      <button class="btn chip on" data-filter="all" id="f-all">Todos</button>
      <button class="btn chip" data-filter="today" id="f-today">Hoy</button>
      <button class="btn chip" data-filter="tomorrow" id="f-tomorrow">MaÃ±ana</button>
      <button class="btn chip" data-filter="week" id="f-week">Esta semana</button>
      <button class="btn chip" data-filter="fav" id="f-fav">Favoritos</button>
    </div>
    <div class="row" style="gap:8px;margin:6px 0">
      <button class="btn chip on" data-camp="all" id="c-all">Todos los campings</button>
      <button class="btn chip" data-camp="oyambre" id="c-oy">Oyambre</button>
      <button class="btn chip" data-camp="ramales" id="c-ra">Ramales</button>
      <button class="btn chip" data-camp="ruiloba" id="c-he">Ruiloba</button>
      <button class="btn chip" data-camp="cardeo" id="c-ca">El Cardeo</button>
    </div>
    <div id="eventsGrid" class="grid"></div>
    <p class="muted" id="eventsEmpty" style="display:none">Sin eventos por ahora.</p>
  </section>

  <!-- CAMPINGS -->
  <section id="view-places" class="view">
    <h2 id="t-campings-title">Nuestros campings</h2>
    <div class="grid">
      <article class="card" style="min-width:unset">
        <h3 id="t-oy-title">Camping Caravaning Playa de Oyambre</h3>
        <p class="muted" id="t-oy-hint">Todos los servicios Â· Frente al mar</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.oyambre.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942711461">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34675696212" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ra-title">Camping Ramales</h3>
        <p class="muted" id="t-ra-hint">Cuevas Â· MontaÃ±a Â· Actividades</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingramales.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34654463133">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Ramales" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34654463133" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-he-title">Camping El Helguero (Ruiloba)</h3>
        <p class="muted" id="t-he-hint">Naturaleza Â· Familiar Â· Mascotas</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingelhelguero.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942722124">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+El+Helguero" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34652806564" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ca-title">Apartamentos / Taberna El Cardeo</h3>
        <p class="muted" id="t-ca-hint">Apartamentos + Taberna</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.elcardeo.es" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34664686158">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34664686158" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>
    </div>
  </section>

  <!-- HORARIOS -->
  <section id="view-schedules" class="view">
    <h2 id="t-schedules-title">Horarios</h2>
    <div class="acc" id="acc">
      <div class="acc-item"><div class="acc-h" data-acc="oyambre">Oyambre <span>â–¼</span></div><div class="acc-b" id="acc-oyambre"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ramales">Ramales <span>â–¼</span></div><div class="acc-b" id="acc-ramales"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ruiloba">Ruiloba <span>â–¼</span></div><div class="acc-b" id="acc-ruiloba"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="cardeo">El Cardeo <span>â–¼</span></div><div class="acc-b" id="acc-cardeo"></div></div>
    </div>
    <p class="muted" id="schedNote">Info orientativa. Pregunta en recepciÃ³n para cambios de temporada. Los horarios pueden variar segÃºn la fecha.</p>
  </section>

  <!-- IMPRESCINDIBLES -->
  <section id="view-musts" class="view">
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px">
      <h2 id="musts-title">Imprescindibles de Cantabria</h2>
      <button id="geoBtn1" class="btn sm">ğŸ“ <span id="geoTxt1">Calcular distancias</span></button>
    </div>
    <p class="muted" id="musts-hint">Abre cada apartado para ver descripciÃ³n, quÃ© ver, mapa, imÃ¡genes, entradas y distancia desde tu ubicaciÃ³n.</p>
    <div id="mustsAcc" class="acc"></div>
  </section>

  <!-- GASTRONOMÃA -->
  <section id="view-food" class="view">
    <h2 id="food-title">GastronomÃ­a cÃ¡ntabra</h2>
    <p class="muted" id="food-hint">Productos tÃ­picos y platos que deberÃ­as probar.</p>
    <div id="foodAcc" class="acc"></div>
  </section>

  <!-- FAVORITOS DEL EQUIPO -->
  <section id="view-favorites" class="view">
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px">
      <h2 id="fav-title">Los favoritos de nuestro equipo</h2>
      <button id="geoBtn2" class="btn sm">ğŸ“ <span id="geoTxt2">Calcular distancias</span></button>
    </div>
    <p class="muted" id="fav-hint">SelecciÃ³n personal de nuestro equipo: pueblos, actividades, playas, restaurantes y miradores.</p>
    <div id="favTabs" class="row" style="margin-bottom:8px">
      <button class="btn chip on" data-favcat="pueblos" id="fav-pueblos">ğŸ˜ï¸ Pueblos</button>
      <button class="btn chip" data-favcat="actividades" id="fav-acts">ğŸ’ Actividades</button>
      <button class="btn chip" data-favcat="playas" id="fav-playas">ğŸ–ï¸ Playas</button>
      <button class="btn chip" data-favcat="restaurantes" id="fav-rest">ğŸ½ï¸ Restaurantes</button>
      <button class="btn chip" data-favcat="miradores" id="fav-mira">ğŸ”­ Miradores</button>
    </div>
    <div id="favAcc" class="acc"></div>
  </section>

  <!-- SUGERENCIAS -->
  <section id="view-suggest" class="view">
    <h2 id="sug-title">BuzÃ³n de sugerencias</h2>
    <p class="muted" id="sug-hint">CuÃ©ntanos quÃ© mejorarÃ­as para tu prÃ³xima estancia. El mensaje se envÃ­a al alojamiento que elijas.</p>

    <div class="card" style="background:var(--tint)">
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
        <div>
          <label style="font-weight:700" for="sugPlace" id="sug-where">Â¿En quÃ© alojamiento has estado?</label>
          <select id="sugPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700" for="sugType" id="sug-type-label">Tipo de comentario</label>
          <select id="sugType" class="select"></select>
        </div>
        <div>
          <label style="font-weight:700" for="sugRate" id="sug-rate-label">ValoraciÃ³n global (1â€“5)</label>
          <input id="sugRate" class="input" type="number" min="1" max="5" step="1" placeholder="5">
        </div>
      </div>

      <div style="margin-top:10px">
        <label style="font-weight:700" for="sugMsg" id="sug-msg-label">Tu mensaje</label>
        <textarea id="sugMsg" class="textarea" placeholder="Ej.: MejorarÃ­a la zona de juegos infantiles, aÃ±adirÃ­a mÃ¡s sombra en la piscina..."></textarea>
      </div>

      <p class="small muted" style="margin-top:8px" id="sug-privacy">
        No se guarda nada en servidores de la app: tu mensaje se envÃ­a por WhatsApp o email directamente al alojamiento.
      </p>

      <div class="row" style="margin-top:10px">
        <a id="sugWA" class="btn primary" target="_blank" rel="noopener">Enviar por WhatsApp</a>
        <a id="sugEmail" class="btn" target="_blank" rel="noopener">Enviar por email</a>
      </div>
    </div>
  </section>

  <!-- PRE-CHECKIN -->
  <section id="view-precheck" class="view">
    <h2 id="pre-title">Pre-checkin</h2>
    <p class="note">âš ï¸ <strong>Importante</strong>: SegÃºn la ley de viajeros espaÃ±ola, le solicitaremos en recepciÃ³n a la llegada: <strong>Documento Nacional de Identidad o Pasaporte vÃ¡lido</strong> de <strong>todos los viajeros mayores de 14 aÃ±os</strong>. ğŸ‡ªğŸ‡¸ğŸ›‚</p>
    <div class="card" style="background:var(--tint)">
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
        <div>
          <label style="font-weight:700" for="prePlace" id="pre-where">Â¿En quÃ© alojamiento tiene la reserva?</label>
          <select id="prePlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div>
          <label>Nombre</label>
          <input id="preName" class="input" placeholder="Nombre">
        </div>
        <div>
          <label>Apellidos</label>
          <input id="preSurname" class="input" placeholder="Apellidos">
        </div>
        <div>
          <label>DNI / Pasaporte</label>
          <input id="preId" class="input" placeholder="DNI o Pasaporte">
        </div>
        <div>
          <label>Fecha de nacimiento</label>
          <input id="preBirth" type="date" class="input">
        </div>
        <div>
          <label>MatrÃ­cula del vehÃ­culo</label>
          <input id="prePlate" class="input" placeholder="0000-XXX">
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>ğŸ‘¥ AcompaÃ±antes</h3>
        <div id="companions"></div>
        <button id="addComp" class="btn sm" type="button">â• AÃ±adir acompaÃ±ante</button>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="sendPreBtn" class="btn primary">âœ‰ï¸ Enviar pre-checkin</button>
      </div>
    </div>
  </section>
</main>

<!-- Bottom nav -->
<nav class="navbar" role="navigation" aria-label="PestaÃ±as">
  <button class="navbtn active" data-nav="home"><div class="ico">ğŸ </div><div id="n-home">Inicio</div></button>
  <button class="navbtn" data-nav="stay"><div class="ico">ğŸ§³</div><div id="n-stay">Mi estancia</div></button>
  <button class="navbtn" data-nav="incidents"><div class="ico">ğŸ†˜</div><div id="n-inc">Incidencias</div></button>
  <button class="navbtn" data-nav="events"><div class="ico">ğŸ“…</div><div id="n-ev">Eventos</div></button>
</nav>

<!-- Admin modal -->
<div class="backdrop" id="adminModal" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
  <div class="modal">
    <button class="close" id="closeAdmin" aria-label="Cerrar">âœ•</button>
    <h3 id="adminTitle">GestiÃ³n de eventos</h3>

    <div class="card" style="margin-top:8px">
      <h4 style="margin:0 0 8px">AÃ±adir evento</h4>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
        <div><label>TÃ­tulo (ES)</label><input id="evTitle" class="input" placeholder="Ej: Concierto acÃºstico"></div>
        <div><label>Fecha y hora</label><input id="evDate" type="datetime-local" class="input"></div>
        <div><label>Alojamiento</label>
          <select id="evPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div><label>Lugar (ES)</label><input id="evLugar" class="input" placeholder="Ej: Camping Ramales"></div>
        <div><label>Imagen (URL)</label><input id="evImg" class="input" placeholder="https://..."></div>
        <div style="grid-column:1/-1"><label>DescripciÃ³n (ES)</label><textarea id="evDesc" class="textarea" rows="3" placeholder="Ej: MÃºsica en directo."></textarea></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="addEventBtn" class="btn">Agregar</button>
        <button id="exportEventsBtn" class="btn">Descargar events.json</button>
        <label class="btn" for="importFile" style="cursor:pointer">Importar JSON</label>
        <input id="importFile" type="file" accept="application/json" style="display:none">
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4 style="margin:0 0 8px">Eventos actuales</h4>
      <div style="overflow:auto">
        <table class="table" id="eventsTable" style="width:100%;border-collapse:collapse">
          <thead><tr><th>ID</th><th>Fecha</th><th>Alojamiento</th><th>TÃ­tulo</th><th>Acciones</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4>GestiÃ³n de horarios (schedules.json)</h4>
      <textarea id="schedJsonArea" class="textarea" rows="8" placeholder='Pegue aquÃ­ su schedules.json'></textarea>
      <div class="row" style="margin-top:10px">
        <button id="schedApplyBtn" class="btn">Aplicar</button>
        <button id="exportSchedBtn" class="btn">Descargar schedules.json</button>
        <label class="btn" for="importSchedFile" style="cursor:pointer">Importar JSON</label>
        <input id="importSchedFile" type="file" accept="application/json" style="display:none">
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h4>Config GitHub</h4>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px">
        <div><label>Repositorio</label><input id="ghRepo" class="input" placeholder="owner/repo"></div>
        <div><label>Branch</label><input id="ghBranch" class="input" placeholder="main" value="main"></div>
        <div style="grid-column:1/-1"><label>Token (se guarda en este dispositivo)</label><input id="ghToken" class="input" placeholder="github_pat_..." autocomplete="off"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="saveGhCfg" class="btn">Guardar configuraciÃ³n</button>
        <button id="pushEventsBtn" class="btn">ğŸ’¾ Subir events.json</button>
        <button id="pushSchedBtn" class="btn">ğŸ’¾ Subir schedules.json</button>
      </div>
    </div>
  </div>
</div>

<!-- Idiomas -->
<div class="backdrop" id="langModal">
  <div class="modal">
    <button id="closeLang" class="close" aria-label="Cerrar">âœ•</button>
    <h3 id="langTitle">Selecciona idioma</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px">
      <button class="btn lang-option" data-lang="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
      <button class="btn lang-option" data-lang="en">ğŸ‡¬ğŸ‡§ English</button>
      <button class="btn lang-option" data-lang="fr">ğŸ‡«ğŸ‡· FranÃ§ais</button>
      <button class="btn lang-option" data-lang="de">ğŸ‡©ğŸ‡ª Deutsch</button>
      <button class="btn lang-option" data-lang="nl">ğŸ‡³ğŸ‡± Nederlands</button>
    </div>
  </div>
</div>

<!-- Modal instalar -->
<div class="backdrop" id="installModal">
  <div class="modal">
    <button id="closeInstall" class="close" aria-label="Cerrar">âœ•</button>
    <h3 id="instTitle">Instalar app</h3>
    <div id="instBody"></div>
    <div class="row" style="margin-top:10px">
      <button id="instNow" class="btn primary">Instalar ahora</button>
    </div>
  </div>
</div>

<!-- JSZip (opcional) -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function(){

  /* ===== Estado admin + PIN ===== */
  localStorage.setItem('admin','0');
  document.body.classList.remove('admin-on');
  if(!localStorage.getItem('admin_pin')){ localStorage.setItem('admin_pin','311974'); }

  /* ===== Utils ===== */
  function $(sel){return document.querySelector(sel);}
  function $all(sel){return Array.prototype.slice.call(document.querySelectorAll(sel));}
  function on(el,ev,fn){ if(el) el.addEventListener(ev,fn); }
  function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
  function safeUrl(u){var s=String(u||'').trim(); return (/^https?:\/\//i.test(s) || /^\/|^\.\.?\//.test(s) || /^data:image\//i.test(s)) ? s.replace(/"/g,'%22') : ''; }
  function pad2(n){return ('0'+n).slice(-2);}
  function km(v){ return (Math.round(v*10)/10).toFixed(1); }

  /* ===== Tema ===== */
  function detectTheme(){ var s=localStorage.getItem('theme'); if(s) return s; try{ if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark'; }catch(e){} return 'light'; }
  function applyTheme(m){ document.body.classList.toggle('dark', m==='dark'); var b=$('#themeBtn'); if(b) b.textContent=m==='dark'?'â˜€ï¸':'ğŸŒ™'; localStorage.setItem('theme',m); var meta=document.querySelector('meta[name="theme-color"]'); if(meta) meta.setAttribute('content', m==='dark' ? '#0b1220' : '#0ea5e9');}
  var THEME=detectTheme(); applyTheme(THEME);
  on($('#themeBtn'),'click', function(){ THEME=(THEME==='dark')?'light':'dark'; applyTheme(THEME); });

  /* ===== I18N ===== */
  var I18N = {
    es:{app:"Grupo A Cobijo",hello:"Â¡Bienvenido!",badge:"PWA Â· Offline Â· Multidioma",
        ev:"Eventos", evSub:"QuÃ© hay hoy",
        pl:"Campings", plSub:"Accesos rÃ¡pidos",
        sc:"Horarios", scSub:"RecepciÃ³n Â· bar",
        inst:"Instalar", instSub:"AÃ±adir a inicio",
        eventsTitle:"Eventos", schedulesTitle:"Horarios", campingsTitle:"Nuestros campings",
        fAll:"Todos", fToday:"Hoy", fTomorrow:"MaÃ±ana", fWeek:"Esta semana", fFav:"Favoritos",
        cAll:"Todos los campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Web", call:"Llamar", directions:"CÃ³mo llegar", whatsapp:"WhatsApp", email:"Email",
        addCal:"AÃ±adir al calendario", fav:"Favorito",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Todos los servicios Â· Frente al mar",
        raTitle:"Camping Ramales", raHint:"Cuevas Â· MontaÃ±a Â· Actividades",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Naturaleza Â· Familiar Â· Mascotas",
        caTitle:"Apartamentos / Taberna El Cardeo", caHint:"Apartamentos + Taberna",
        schedNote:"Info orientativa. Pregunta en recepciÃ³n para cambios de temporada. Los horarios pueden variar segÃºn la fecha.",
        nHome:"Inicio", nEv:"Eventos", nPl:"Campings", nSc:"Horarios",
        dHome:"Inicio", dStay:"Mi estancia", dInc:"Incidencias", dEv:"Eventos", dPl:"Campings", dSc:"Horarios",
        dMusts:"Imprescindibles", dFood:"GastronomÃ­a", dFavs:"Favoritos del equipo", dPre:"Pre-checkin", dSug:"Sugerencias", drawerHint:"Elige secciÃ³n",
        nextEvents:"PrÃ³ximos eventos",
        stay:"Mi estancia", staySub:"Contactos, clima, horarios",
        stayTitle:"Mi estancia", stayHint:"Guardamos tu elecciÃ³n en este dispositivo.", stayWhich:"Selecciona tu alojamiento",
        stayHours:"Horarios del alojamiento",
        weatherTitle:"Clima", max:"MÃ¡x", min:"MÃ­n",
        incTitle:"Incidencias", incWhere:"Â¿En quÃ© alojamiento estÃ¡s?", incContact:"Â¿CÃ³mo quieres contactar?",
        incHint:"Se abre WhatsApp o tu app de correo con el mensaje preparado.",
        incType:"Tipo de incidencia", incMsg:"Describe brevemente el problema",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        incTypes:[
          {key:'electricity', label:"Electricidad"},
          {key:'water', label:"Agua"},
          {key:'cleaning', label:"Limpieza"},
          {key:'noise', label:"Ruido"},
          {key:'other', label:"Otros"}
        ],
        mustsTitle:"Imprescindibles de Cantabria", mustsHint:"Abre cada apartado para ver descripciÃ³n, quÃ© ver, mapa, imÃ¡genes, entradas y distancia.",
        see:"QuÃ© ver", images:"ImÃ¡genes", map:"Mapa", tickets:"Entradas", more:"MÃ¡s info", distance:"a {X} km",
        foodTitle:"GastronomÃ­a cÃ¡ntabra", foodHint:"Productos y platos tÃ­picos que deberÃ­as probar.",
        favTitle:"Los favoritos de nuestro equipo", favHint:"SelecciÃ³n personal por categorÃ­a.",
        preTitle:"Pre-checkin", preWhere:"Â¿En quÃ© alojamiento tiene la reserva?",
        preSend:"Enviar pre-checkin", preAdded:"AcompaÃ±ante aÃ±adido", preDel:"Eliminar", geo:"Calcular distancias",
        suggestTitle:"BuzÃ³n de sugerencias",
        suggestHint:"CuÃ©ntanos quÃ© mejorarÃ­as para tu prÃ³xima estancia. El mensaje se envÃ­a al alojamiento que elijas.",
        suggestTypeLabel:"Tipo de comentario",
        suggestMsgLabel:"Tu mensaje",
        suggestRateLabel:"ValoraciÃ³n global (1â€“5)",
        suggestBtnWA:"Enviar por WhatsApp",
        suggestBtnEmail:"Enviar por email",
        suggestTile:"Sugerencias",
        suggestTileSub:"AyÃºdanos a mejorar",
        suggestWhere:"Â¿En quÃ© alojamiento has estado?",
        suggestTypes:[
          {key:'general', label:"Sugerencia general"},
          {key:'app', label:"Sobre esta app"},
          {key:'cleaning', label:"Limpieza"},
          {key:'installations', label:"Instalaciones / servicios"},
          {key:'staff', label:"AtenciÃ³n del personal"},
          {key:'activities', label:"Actividades / animaciÃ³n"},
          {key:'other', label:"Otros"}
        ]
    },
    en:{app:"Grupo A Cobijo",hello:"Welcome!",badge:"PWA Â· Offline Â· Multilingual",
        ev:"Events", evSub:"What's on today",
        pl:"Campsites", plSub:"Quick access",
        sc:"Schedules", scSub:"Reception Â· bar",
        inst:"Install", instSub:"Add to Home",
        eventsTitle:"Events", schedulesTitle:"Schedules", campingsTitle:"Our campsites",
        fAll:"All", fToday:"Today", fTomorrow:"Tomorrow", fWeek:"This week", fFav:"Favorites",
        cAll:"All campsites", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Website", call:"Call", directions:"Directions", whatsapp:"WhatsApp", email:"Email",
        addCal:"Add to calendar", fav:"Favorite",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"All services Â· By the sea",
        raTitle:"Camping Ramales", raHint:"Caves Â· Mountains Â· Activities",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature Â· Family Â· Pets",
        caTitle:"El Cardeo Apartments / Tavern", caHint:"Apartments + Tavern",
        schedNote:"Indicative info. Check reception for seasonal changes. Opening hours may vary by date.",
        nHome:"Home", nEv:"Events", nPl:"Camps", nSc:"Schedules",
        dHome:"Home", dStay:"My stay", dInc:"Issues", dEv:"Events", dPl:"Camps", dSc:"Schedules",
        dMusts:"Essentials", dFood:"Gastronomy", dFavs:"Teamâ€™s favorites", dPre:"Pre-checkin", dSug:"Feedback", drawerHint:"Choose a section",
        nextEvents:"Upcoming events",
        stay:"My stay", staySub:"Contacts, weather, schedules",
        stayTitle:"My stay", stayHint:"We store your choice on this device.", stayWhich:"Choose your accommodation",
        stayHours:"Accommodation opening hours",
        weatherTitle:"Weather", max:"Max", min:"Min",
        incTitle:"Issues", incWhere:"Which accommodation are you in?", incContact:"How would you like to contact?",
        incHint:"We open WhatsApp or your email app with a prefilled message.",
        incType:"Issue type", incMsg:"Briefly describe the problem",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        incTypes:[
          {key:'electricity', label:"Electricity"},
          {key:'water', label:"Water"},
          {key:'cleaning', label:"Cleaning"},
          {key:'noise', label:"Noise"},
          {key:'other', label:"Other"}
        ],
        mustsTitle:"Cantabria essentials", mustsHint:"Open each to see description, highlights, map, images, tickets and distance.",
        see:"Highlights", images:"Images", map:"Map", tickets:"Tickets", more:"More info", distance:"{X} km away",
        foodTitle:"Cantabrian gastronomy", foodHint:"Typical products and dishes to try.",
        favTitle:"Our teamâ€™s favorites", favHint:"Personal picks by category.",
        preTitle:"Pre-checkin", preWhere:"Which accommodation is your booking for?",
        preSend:"Send pre-checkin", preAdded:"Companion added", preDel:"Remove", geo:"Get distances",
        suggestTitle:"Feedback box",
        suggestHint:"Tell us how we can improve your next stay. Your message is sent directly to the accommodation you choose.",
        suggestTypeLabel:"Type of feedback",
        suggestMsgLabel:"Your message",
        suggestRateLabel:"Overall rating (1â€“5)",
        suggestBtnWA:"Send via WhatsApp",
        suggestBtnEmail:"Send via email",
        suggestTile:"Feedback",
        suggestTileSub:"Help us improve",
        suggestWhere:"Which accommodation have you stayed at?",
        suggestTypes:[
          {key:'general', label:"General suggestion"},
          {key:'app', label:"About this app"},
          {key:'cleaning', label:"Cleaning"},
          {key:'installations', label:"Facilities / services"},
          {key:'staff', label:"Staff attention"},
          {key:'activities', label:"Activities / entertainment"},
          {key:'other', label:"Other"}
        ]
    },
    fr:{app:"Grupo A Cobijo",hello:"Bienvenue !",badge:"PWA Â· Hors ligne Â· Multilingue",
        ev:"Ã‰vÃ©nements", evSub:"Aujourdâ€™hui",
        pl:"Campings", plSub:"AccÃ¨s rapide",
        sc:"Horaires", scSub:"RÃ©ception Â· bar",
        inst:"Installer", instSub:"Ajouter Ã  lâ€™Ã©cran dâ€™accueil",
        eventsTitle:"Ã‰vÃ©nements", schedulesTitle:"Horaires", campingsTitle:"Nos campings",
        fAll:"Tous", fToday:"Aujourdâ€™hui", fTomorrow:"Demain", fWeek:"Cette semaine", fFav:"Favoris",
        cAll:"Tous les campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Site web", call:"Appeler", directions:"ItinÃ©raire", whatsapp:"WhatsApp", email:"Email",
        addCal:"Ajouter au calendrier", fav:"Favori",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Tous les services Â· Face Ã  la mer",
        raTitle:"Camping Ramales", raHint:"Grottes Â· Montagne Â· ActivitÃ©s",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Nature Â· Familial Â· Animaux",
        caTitle:"Appartements / Taverne El Cardeo", caHint:"Appartements + Taverne",
        schedNote:"Infos indicatives. VÃ©rifiez Ã  la rÃ©ception. Les horaires peuvent varier selon la date.",
        nHome:"Accueil", nEv:"Ã‰vÃ©n.", nPl:"Campings", nSc:"Horaires",
        dHome:"Accueil", dStay:"Mon sÃ©jour", dInc:"Incidents", dEv:"Ã‰vÃ©nements", dPl:"Campings", dSc:"Horaires",
        dMusts:"Incontournables", dFood:"Gastronomie", dFavs:"Coups de cÅ“ur", dPre:"Pre-checkin", dSug:"Suggestions", drawerHint:"Choisissez une section",
        nextEvents:"Ã‰vÃ©nements Ã  venir",
        stay:"Mon sÃ©jour", staySub:"Contacts, mÃ©tÃ©o, horaires",
        stayTitle:"Mon sÃ©jour", stayHint:"Nous enregistrons votre choix sur cet appareil.", stayWhich:"Choisissez votre hÃ©bergement",
        stayHours:"Horaires de lâ€™hÃ©bergement",
        weatherTitle:"MÃ©tÃ©o", max:"Max", min:"Min",
        incTitle:"Incidents", incWhere:"Dans quel Ã©tablissement Ãªtes-vous ?", incContact:"Comment souhaitez-vous contacter ?",
        incHint:"On ouvre WhatsApp ou votre app email avec un message prÃ©rempli.",
        incType:"Type de problÃ¨me", incMsg:"DÃ©crivez briÃ¨vement le problÃ¨me",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        incTypes:[
          {key:'electricity', label:"Ã‰lectricitÃ©"},
          {key:'water', label:"Eau"},
          {key:'cleaning', label:"Nettoyage"},
          {key:'noise', label:"Bruit"},
          {key:'other', label:"Autres"}
        ],
        mustsTitle:"Incontournables de Cantabrie", mustsHint:"Ouvrez chaque section: description, lieux, carte, images, billets et distance.",
        see:"Ã€ voir", images:"Images", map:"Carte", tickets:"Billets", more:"Plus dâ€™infos", distance:"Ã  {X} km",
        foodTitle:"Gastronomie cantabrique", foodHint:"Produits et plats typiques Ã  goÃ»ter.",
        favTitle:"Nos coups de cÅ“ur", favHint:"SÃ©lection par catÃ©gorie.",
        preTitle:"Pre-checkin", preWhere:"Quel hÃ©bergement avez-vous rÃ©servÃ© ?",
        preSend:"Envoyer le pre-checkin", preAdded:"Accompagnant ajoutÃ©", preDel:"Supprimer", geo:"Calculer distances",
        suggestTitle:"BoÃ®te Ã  suggestions",
        suggestHint:"Dites-nous ce que nous pourrions amÃ©liorer pour un prochain sÃ©jour. Le message est envoyÃ© directement Ã  lâ€™Ã©tablissement choisi.",
        suggestTypeLabel:"Type de commentaire",
        suggestMsgLabel:"Votre message",
        suggestRateLabel:"ApprÃ©ciation globale (1â€“5)",
        suggestBtnWA:"Envoyer par WhatsApp",
        suggestBtnEmail:"Envoyer par email",
        suggestTile:"Suggestions",
        suggestTileSub:"Aidez-nous Ã  nous amÃ©liorer",
        suggestWhere:"Dans quel Ã©tablissement avez-vous sÃ©journÃ© ?",
        suggestTypes:[
          {key:'general', label:"Suggestion gÃ©nÃ©rale"},
          {key:'app', label:"Ã€ propos de cette app"},
          {key:'cleaning', label:"PropretÃ©"},
          {key:'installations', label:"Installations / services"},
          {key:'staff', label:"Accueil du personnel"},
          {key:'activities', label:"ActivitÃ©s / animation"},
          {key:'other', label:"Autres"}
        ]
    },
    de:{app:"Grupo A Cobijo",hello:"Willkommen!",badge:"PWA Â· Offline Â· Mehrsprachig",
        ev:"Events", evSub:"Heute",
        pl:"CampingplÃ¤tze", plSub:"Schnellzugriff",
        sc:"Zeiten", scSub:"Rezeption Â· Bar",
        inst:"Installieren", instSub:"Zum Startbildschirm",
        eventsTitle:"Veranstaltungen", schedulesTitle:"Ã–ffnungszeiten", campingsTitle:"Unsere CampingplÃ¤tze",
        fAll:"Alle", fToday:"Heute", fTomorrow:"Morgen", fWeek:"Diese Woche", fFav:"Favoriten",
        cAll:"Alle CampingplÃ¤tze", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Website", call:"Anrufen", directions:"Route", whatsapp:"WhatsApp", email:"E-Mail",
        addCal:"Zum Kalender hinzufÃ¼gen", fav:"Favorit",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle Services Â· Am Meer",
        raTitle:"Camping Ramales", raHint:"HÃ¶hlen Â· Berge Â· AktivitÃ¤ten",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natur Â· Familie Â· Haustiere",
        caTitle:"Apartments / Taverne El Cardeo", caHint:"Apartments + Taverne",
        schedNote:"Unverbindliche Infos. Ã„nderungen mÃ¶glich â€“ bitte an der Rezeption nachfragen.",
        nHome:"Start", nEv:"Events", nPl:"Camping", nSc:"Zeiten",
        dHome:"Start", dStay:"Mein Aufenthalt", dInc:"StÃ¶rungen", dEv:"Events", dPl:"Camping", dSc:"Zeiten",
        dMusts:"Highlights", dFood:"Gastronomie", dFavs:"Team-Favoriten", dPre:"Pre-checkin", dSug:"Feedback", drawerHint:"Bereich wÃ¤hlen",
        nextEvents:"Kommende Events",
        stay:"Mein Aufenthalt", staySub:"Kontakte, Wetter, Zeiten",
        stayTitle:"Mein Aufenthalt", stayHint:"Wir speichern die Auswahl lokal.", stayWhich:"Unterkunft wÃ¤hlen",
        stayHours:"Ã–ffnungszeiten der Unterkunft",
        weatherTitle:"Wetter", max:"Max", min:"Min",
        incTitle:"StÃ¶rungen", incWhere:"Welche Unterkunft?", incContact:"Wie mÃ¶chtest du Kontakt aufnehmen?",
        incHint:"Wir Ã¶ffnen WhatsApp oder deine E-Mail-App mit vorbefÃ¼llter Nachricht.",
        incType:"StÃ¶rungstyp", incMsg:"Problem kurz beschreiben",
        incBtnWA:"WhatsApp", incBtnEmail:"E-Mail",
        incTypes:[
          {key:'electricity', label:"Strom"},
          {key:'water', label:"Wasser"},
          {key:'cleaning', label:"Reinigung"},
          {key:'noise', label:"LÃ¤rm"},
          {key:'other', label:"Sonstiges"}
        ],
        mustsTitle:"Cantabria-Highlights", mustsHint:"Bereiche Ã¶ffnen: Beschreibung, Highlights, Karte, Bilder, Tickets und Distanz.",
        see:"Sehenswert", images:"Bilder", map:"Karte", tickets:"Tickets", more:"Mehr Infos", distance:"{X} km entfernt",
        foodTitle:"Kantabrische KÃ¼che", foodHint:"Typische Produkte und Gerichte.",
        favTitle:"Favoriten unseres Teams", favHint:"Auswahl nach Kategorie.",
        preTitle:"Pre-checkin", preWhere:"FÃ¼r welche Unterkunft ist die Buchung?",
        preSend:"Pre-checkin senden", preAdded:"Begleitperson hinzugefÃ¼gt", preDel:"Entfernen", geo:"Distanzen berechnen",
        suggestTitle:"Feedback-Box",
        suggestHint:"Sag uns, was wir fÃ¼r deinen nÃ¤chsten Aufenthalt verbessern kÃ¶nnen. Die Nachricht geht direkt an die gewÃ¤hlte Unterkunft.",
        suggestTypeLabel:"Art des Feedbacks",
        suggestMsgLabel:"Deine Nachricht",
        suggestRateLabel:"Gesamtbewertung (1â€“5)",
        suggestBtnWA:"Per WhatsApp senden",
        suggestBtnEmail:"Per E-Mail senden",
        suggestTile:"Feedback",
        suggestTileSub:"Hilf uns, besser zu werden",
        suggestWhere:"In welcher Unterkunft warst du?",
        suggestTypes:[
          {key:'general', label:"Allgemeine Anregung"},
          {key:'app', label:"Zur App"},
          {key:'cleaning', label:"Reinigung"},
          {key:'installations', label:"Anlagen / Service"},
          {key:'staff', label:"Personal"},
          {key:'activities', label:"AktivitÃ¤ten / Animation"},
          {key:'other', label:"Sonstiges"}
        ]
    },
    nl:{app:"Grupo A Cobijo",hello:"Welkom!",badge:"PWA Â· Offline Â· Meertalig",
        ev:"Evenementen", evSub:"Vandaag",
        pl:"Campings", plSub:"Snelle toegang",
        sc:"Openingstijden", scSub:"Receptie Â· bar",
        inst:"Installeren", instSub:"Toevoegen aan beginscherm",
        eventsTitle:"Evenementen", schedulesTitle:"Openingstijden", campingsTitle:"Onze campings",
        fAll:"Alles", fToday:"Vandaag", fTomorrow:"Morgen", fWeek:"Deze week", fFav:"Favorieten",
        cAll:"Alle campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Website", call:"Bellen", directions:"Route", whatsapp:"WhatsApp", email:"E-mail",
        addCal:"Aan agenda toevoegen", fav:"Favoriet",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Alle services Â· Aan zee",
        raTitle:"Camping Ramales", raHint:"Grotten Â· Bergen Â· Activiteiten",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Natuur Â· Familie Â· Huisdieren",
        caTitle:"El Cardeo Appartementen / Taverne", caHint:"Appartementen + Taverne",
        schedNote:"Indicatieve info. Tijden kunnen per datum verschillen.",
        nHome:"Start", nEv:"Even.", nPl:"Campings", nSc:"Tijden",
        dHome:"Start", dStay:"Mijn verblijf", dInc:"Incidenten", dEv:"Evenementen", dPl:"Campings", dSc:"Tijden",
        dMusts:"Must-sees", dFood:"Gastronomie", dFavs:"Favorieten van het team", dPre:"Pre-checkin", dSug:"Suggesties", drawerHint:"Kies een sectie",
        nextEvents:"Aankomende evenementen",
        stay:"Mijn verblijf", staySub:"Contacten, weer, tijden",
        stayTitle:"Mijn verblijf", stayHint:"We slaan je keuze lokaal op.", stayWhich:"Kies je accommodatie",
        stayHours:"Openingstijden van de accommodatie",
        weatherTitle:"Weer", max:"Max", min:"Min",
        incTitle:"Incidenten", incWhere:"In welke accommodatie ben je?", incContact:"Hoe wil je contact opnemen?",
        incHint:"We openen WhatsApp of je e-mailapp met een bericht.",
        incType:"Type incident", incMsg:"Beschrijf kort het probleem",
        incBtnWA:"WhatsApp", incBtnEmail:"E-mail",
        incTypes:[
          {key:'electricity', label:"Elektriciteit"},
          {key:'water', label:"Water"},
          {key:'cleaning', label:"Schoonmaak"},
          {key:'noise', label:"Lawaai"},
          {key:'other', label:"Overig"}
        ],
        mustsTitle:"CantabriÃ« essentials", mustsHint:"Open: beschrijving, wat te zien, kaart, beelden, tickets en afstand.",
        see:"Wat te zien", images:"Beelden", map:"Kaart", tickets:"Tickets", more:"Meer info", distance:"op {X} km",
        foodTitle:"Cantabrische gastronomie", foodHint:"Typische producten en gerechten.",
        favTitle:"Favorieten van ons team", favHint:"Selectie per categorie.",
        preTitle:"Pre-checkin", preWhere:"Voor welke accommodatie is de boeking?",
        preSend:"Pre-checkin verzenden", preAdded:"Metgezel toegevoegd", preDel:"Verwijderen", geo:"Afstanden berekenen",
        suggestTitle:"Suggestiebox",
        suggestHint:"Vertel ons wat we kunnen verbeteren voor je volgende verblijf. Het bericht gaat rechtstreeks naar de gekozen accommodatie.",
        suggestTypeLabel:"Type opmerking",
        suggestMsgLabel:"Je bericht",
        suggestRateLabel:"Algemene beoordeling (1â€“5)",
        suggestBtnWA:"Verstuur via WhatsApp",
        suggestBtnEmail:"Verstuur via e-mail",
        suggestTile:"Suggesties",
        suggestTileSub:"Help ons verbeteren",
        suggestWhere:"In welke accommodatie verbleef je?",
        suggestTypes:[
          {key:'general', label:"Algemene suggestie"},
          {key:'app', label:"Over deze app"},
          {key:'cleaning', label:"Schoonmaak"},
          {key:'installations', label:"Voorzieningen / service"},
          {key:'staff', label:"Personeel"},
          {key:'activities', label:"Activiteiten / animatie"},
          {key:'other', label:"Overig"}
        ]
    }
  };

  function detectLang(){ var s=localStorage.getItem('lang'); if(s) return s; var n=(navigator.language||'es').slice(0,2).toLowerCase(); return I18N[n]?n:'es'; }
  var LANG = detectLang();
  function t(id,v){ var el=document.getElementById(id); if(el) el.textContent=v; }

  function applyLang(){
    var T=I18N[LANG];
    t("t-app",T.app); t("t-hello",T.hello); t("t-badge",T.badge);
    t("t-ev",T.ev); t("t-ev-sub",T.evSub);
    t("t-pl",T.pl); t("t-pl-sub",T.plSub);
    t("t-sc",T.sc); t("t-sc-sub",T.scSub);
    t("t-inst",T.inst); t("t-inst-sub",T.instSub);
    t("t-events-title",T.eventsTitle); t("t-schedules-title",T.schedulesTitle); t("t-campings-title",T.campingsTitle);
    t("f-all",T.fAll); t("f-today",T.fToday); t("f-tomorrow",T.fTomorrow); t("f-week",T.fWeek); var ff=document.getElementById('f-fav'); if(ff) ff.textContent=T.fFav;
    t("c-all",T.cAll); t("c-oy",T.cOy); t("c-ra",T.cRa); t("c-he",T.cHe); t("c-ca",T.cCa);
    t("t-oy-title",T.oyTitle); t("t-oy-hint",T.oyHint); t("t-ra-title",T.raTitle); t("t-ra-hint",T.raHint);
    t("t-he-title",T.heTitle); t("t-he-hint",T.heHint); t("t-ca-title",T.caTitle); t("t-ca-hint",T.caHint);
    t("schedNote",T.schedNote); t("n-home",T.nHome); t("n-ev",T.nEv);
    var lb=$('#langBtn'); if(lb) lb.textContent='ğŸŒ '+LANG.toUpperCase();
    t("d-home",T.dHome); t("d-stay",T.dStay); t("d-inc",T.dInc); t("d-ev",T.dEv); t("d-pl",T.dPl); t("d-sc",T.dSc);
    t("d-musts", T.dMusts); t("d-food", T.dFood); t("d-favs", T.dFavs); t("d-pre", T.dPre); t("d-sug", T.dSug);
    t("drawerHint",T.drawerHint); t("t-next-events",T.nextEvents);
    t("t-stay",T.stay); t("t-stay-sub",T.staySub);
    t("t-stay-title",T.stayTitle); t("t-stay-hint",T.stayHint); t("t-stay-which",T.stayWhich);
    t("t-stay-hours",T.stayHours); t("t-weather-title",T.weatherTitle); t("t-max",T.max); t("t-min",T.min);
    t("i-title",T.incTitle); t("i-hint",T.incHint); t("i-where",T.incWhere); t("i-type",T.incType); t("i-msg",T.incMsg);
    var incWA=$('#incWA'), incEmail=$('#incEmail'); if(incWA) incWA.textContent=T.incBtnWA; if(incEmail) incEmail.textContent=T.incBtnEmail;
    t("musts-title",T.mustsTitle); t("musts-hint",T.mustsHint);
    t("food-title",T.foodTitle); t("food-hint",T.foodHint);
    t("fav-title",T.favTitle); t("fav-hint",T.favHint);
    t("pre-title",T.preTitle); t("pre-where",T.preWhere);
    $('#geoTxt1').textContent=T.geo; $('#geoTxt2').textContent=T.geo;
    // Home tiles labels extra
    t("t-musts", T.mustsTitle || "Imprescindibles");
    t("t-musts-sub", T.mustsHint || "QuÃ© ver");
    t("t-food", T.foodTitle || "GastronomÃ­a");
    t("t-food-sub", T.foodHint || "Productos tÃ­picos");
    t("t-favs", T.favTitle || "Favoritos");
    t("t-favs-sub", T.favHint || "SelecciÃ³n personal");
    t("t-pre", T.preTitle || "Pre-checkin");
    t("t-pre-sub", T.preWhere || "Alojamiento");
    t("t-sug", T.suggestTile || "Sugerencias");
    t("t-sug-sub", T.suggestTileSub || "AyÃºdanos a mejorar");
    // Sugerencias
    t("sug-title", T.suggestTitle);
    t("sug-hint", T.suggestHint);
    t("sug-where", T.suggestWhere || T.suggestTypeLabel);
    t("sug-type-label", T.suggestTypeLabel);
    t("sug-msg-label", T.suggestMsgLabel);
    t("sug-rate-label", T.suggestRateLabel);
    var sugWA=$('#sugWA'), sugEmail=$('#sugEmail');
    if(sugWA) sugWA.textContent=T.suggestBtnWA;
    if(sugEmail) sugEmail.textContent=T.suggestBtnEmail;
    // Re-generar opciones de incidencia y sugerencias traducidas
    fillIncTypes();
    fillSugTypes();
  }
  applyLang();

  on($('#langBtn'),'click', function(){ $('#langModal').style.display='flex'; });
  on($('#closeLang'),'click', function(e){ e.preventDefault(); $('#langModal').style.display='none'; });
  $all('.lang-option').forEach(function(b){
    on(b,'click', function(){ LANG=b.getAttribute('data-lang'); localStorage.setItem('lang',LANG); applyLang(); renderAcc(); loadEvents(); updateStayUI(); updateIncUI(); renderMusts(); renderFood(); renderFavs(); updateSugUI(); $('#langModal').style.display='none'; });
  });

  /* ===== NavegaciÃ³n ===== */
  function showView(id){
    $all('.view').forEach(v=>v.classList.remove('active'));
    var target=document.getElementById('view-'+id); if(target) target.classList.add('active');
    $all('.navbtn').forEach(b=>b.classList.toggle('active', b.getAttribute('data-nav')===id));
    $('#drawer').classList.remove('open');
  }
  $all('[data-nav]').forEach(el=>on(el,'click', function(){ showView(el.getAttribute('data-nav')); }));
  on($('#menuBtn'),'click', function(){ $('#drawer').classList.add('open'); });
  on($('#drawerBack'),'click', function(){ $('#drawer').classList.remove('open'); });

  /* ===== Datos comunes ===== */
  var PLACE_LINK={oyambre:"https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre",ramales:"https://maps.google.com/?q=Camping+Ramales",ruiloba:"https://maps.google.com/?q=Camping+El+Helguero",cardeo:"https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6"};
  var PLACE_LABEL={oyambre:"Oyambre",ramales:"Ramales",ruiloba:"Ruiloba",cardeo:"El Cardeo"};
  var WHATSAPP={oyambre:"34675696212",ramales:"34654463133",ruiloba:"34652806564",cardeo:"34664686158"};
  var PHONES={oyambre:"+34942711461",ramales:"+34654463133",ruiloba:"+34942722124",cardeo:"+34664686158"};
  var WEB={oyambre:"https://www.oyambre.com",ramales:"https://www.campingramales.com",ruiloba:"https://www.campingelhelguero.com",cardeo:"https://www.elcardeo.es"};
  var EMAILS={oyambre:"camping@oyambre.com",ramales:"info@campingramales.com",ruiloba:"info@campingelhelguero.com",cardeo:"info@elcardeo.es"};

  /* ===== Eventos (+ Favoritos + .ics) ===== */
  var EVENTS=[], DATE_FILTER='all', CAMP_FILTER='all';
  var FAV_SET = new Set(JSON.parse(localStorage.getItem('fav_events')||'[]'));

  function saveFavs(){ localStorage.setItem('fav_events', JSON.stringify(Array.from(FAV_SET))); }
  function isFav(id){ return FAV_SET.has(id); }
  function toggleFav(id){ if(FAV_SET.has(id)) FAV_SET.delete(id); else FAV_SET.add(id); saveFavs(); renderHomeSlider(); renderEventsGrid(); }

  function whenFmt(d){ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short',day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'}).format(new Date(d)); }catch(e){ return d; } }
  function categoryFor(dateStr){
    var d=new Date(dateStr), now=new Date();
    var startToday=new Date(now.getFullYear(),now.getMonth(),now.getDate());
    var startTomorrow=new Date(startToday); startTomorrow.setDate(startToday.getDate()+1);
    var endOfWeek=new Date(startToday); endOfWeek.setDate(startToday.getDate()+(7-startToday.getDay()));
    if(d>=startToday && d<startTomorrow) return 'today';
    if(d>=startTomorrow && d< new Date(startTomorrow.getFullYear(),startTomorrow.getMonth(),startTomorrow.getDate()+1)) return 'tomorrow';
    if(d>=startToday && d<endOfWeek) return 'week';
    return 'all';
  }
  function i18nField(v){return typeof v==="string"?v:((v&&v[LANG])|| (v&&v.es) || "");}
  function waLink(camping,message){var n=WHATSAPP[String(camping||'').toLowerCase()]; return n?('https://wa.me/'+n+'?text='+encodeURIComponent(message||'')):null;}

  // ICS helpers
  function dtToICS(dt){ // UTC Zulu
    var d=new Date(dt);
    return d.getUTCFullYear()
      + pad2(d.getUTCMonth()+1)
      + pad2(d.getUTCDate())+'T'
      + pad2(d.getUTCHours())
      + pad2(d.getUTCMinutes())
      + pad2(d.getUTCSeconds())+'Z';
  }
  function icsEscape(s){ return String(s||'').replace(/\\/g,'\\\\').replace(/;/g,'\\;').replace(/,/g,'\\,').replace(/\n/g,'\\n'); }
  function downloadICS(ev){
    try{
      var title=i18nField(ev.titulo)||'Evento';
      var desc=i18nField(ev.descripcion)||'';
      var loc=i18nField(ev.lugar)|| (PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'');
      var start=new Date(ev.fecha);
      var end=new Date(start.getTime()+90*60000); // 90 min
      var uid=(ev.id||('ev-'+Date.now()))+'@acobijo.app';
      var now=new Date();
      var ics = [
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Grupo A Cobijo//Customer App//ES','CALSCALE:GREGORIAN','METHOD:PUBLISH',
        'BEGIN:VEVENT',
        'UID:'+icsEscape(uid),
        'DTSTAMP:'+dtToICS(now),
        'DTSTART:'+dtToICS(start),
        'DTEND:'+dtToICS(end),
        'SUMMARY:'+icsEscape(title),
        'DESCRIPTION:'+icsEscape(desc),
        'LOCATION:'+icsEscape(loc),
        'END:VEVENT',
        'END:VCALENDAR'
      ].join('\r\n');
      var blob=new Blob([ics],{type:'text/calendar;charset=utf-8'});
      var a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      var fname=('evento-'+(ev.id||'acobijo')+'.ics').replace(/[^a-z0-9._-]+/gi,'_');
      a.download=fname;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
    }catch(e){ alert('No se pudo generar el calendario.'); }
  }

  // HOME slider
  function renderHomeSlider(){
    var wrap=$('#homeEvents'); if(!wrap) return;
    var next=EVENTS.slice().sort((a,b)=>new Date(a.fecha)-new Date(b.fecha)).slice(0,6);
    if(!next.length){ wrap.innerHTML='<div class="muted">'+I18N[LANG].nextEvents+': â€”</div>'; return; }
    wrap.innerHTML = next.map(function(ev){
      var rawTitle=i18nField(ev.titulo)||'(sin tÃ­tulo)';
      var rawPlace=i18nField(ev.lugar)||PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'';
      var title=esc(rawTitle), place=esc(rawPlace);
      var img=safeUrl(ev.imagen||ev.image||'');
      var wa=waLink(ev.camping,'Hola, consulta sobre â€œ'+rawTitle+'â€ en '+rawPlace+'.');
      var favStar = isFav(ev.id) ? 'â˜…' : 'â˜†';
      var dir = PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#';
      return '<div class="card">'
        + (img?'<img src="'+img+'" alt="'+title+'" loading="lazy" onerror="this.style.display=\'none\'">':'')
        + '<div class="title">'+title+'</div>'
        + '<div class="meta">'+whenFmt(ev.fecha)+' Â· '+place+'</div>'
        + '<div class="row" style="margin-top:6px">'
          + '<button class="btn fav-btn" data-id="'+esc(ev.id)+'" title="'+esc(I18N[LANG].fav)+'">'+favStar+' '+I18N[LANG].fav+'</button>'
          + '<button class="btn ics-btn" data-id="'+esc(ev.id)+'">ğŸ“† '+I18N[LANG].addCal+'</button>'
          + (wa?'<a class="btn ghost sm" href="'+esc(wa)+'" target="_blank" rel="noopener">'+I18N[LANG].whatsapp+'</a>':'')
          + '<a class="btn ghost sm" href="'+esc(dir)+'" target="_blank" rel="noopener">'+I18N[LANG].directions+'</a>'
        + '</div></div>';
    }).join('');
    bindEventActionButtons(wrap);
  }

  function renderEventsGrid(){
    var grid=$('#eventsGrid'), empty=$('#eventsEmpty'); if(!grid) return;
    var filtered = EVENTS.filter(function(ev){
      var byCamp = CAMP_FILTER==='all' ? true : (String(ev.camping||'').toLowerCase()===CAMP_FILTER);
      if(DATE_FILTER==='fav'){ return byCamp && isFav(ev.id); }
      var byDate = DATE_FILTER==='all' ? true : categoryFor(ev.fecha)===DATE_FILTER;
      return byDate && byCamp;
    }).sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));
    if(!filtered.length){ grid.innerHTML=''; if(empty) empty.style.display='block'; return; }
    if(empty) empty.style.display='none';
    grid.innerHTML = filtered.map(function(ev){
      var rawTitle=i18nField(ev.titulo)||'(sin tÃ­tulo)';
      var rawPlace=i18nField(ev.lugar)||PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'';
      var title=esc(rawTitle), place=esc(rawPlace);
      var img=safeUrl(ev.imagen||ev.image||'');
      var wa=waLink(ev.camping,'Hola, consulta sobre â€œ'+rawTitle+'â€ en '+rawPlace+'.');
      var favStar = isFav(ev.id) ? 'â˜…' : 'â˜†';
      return '<div class="card" style="min-width:unset">'
        + (img?'<img src="'+img+'" alt="'+title+'" loading="lazy" onerror="this.style.display=\'none\'">':'')
        + '<div class="title">'+title+'</div>'
        + '<div class="meta">'+whenFmt(ev.fecha)+' Â· '+place+'</div>'
        + '<div class="row" style="margin-top:6px">'
          + '<button class="btn fav-btn" data-id="'+esc(ev.id)+'" title="'+esc(I18N[LANG].fav)+'">'+favStar+' '+I18N[LANG].fav+'</button>'
          + '<button class="btn ics-btn" data-id="'+esc(ev.id)+'">ğŸ“† '+I18N[LANG].addCal+'</button>'
          + (wa?'<a class="btn" href="'+esc(wa)+'" target="_blank" rel="noopener">'+I18N[LANG].whatsapp+'</a>':'')
          + '<a class="btn" href="'+esc(PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#')+'" target="_blank" rel="noopener">'+I18N[LANG].directions+'</a>'
        + '</div></div>';
    }).join('');
    bindEventActionButtons(grid);
  }

  function bindEventActionButtons(scope){
    (function(){ var _all=$all; $all=function(sel,sc){ if(sc && sc.querySelectorAll) return Array.prototype.slice.call(sc.querySelectorAll(sel)); return _all(sel); }})();
    $all('.fav-btn', scope).forEach(function(btn){
      on(btn,'click', function(){ var id=btn.getAttribute('data-id'); toggleFav(id); });
    });
    $all('.ics-btn', scope).forEach(function(btn){
      on(btn,'click', function(){ var id=btn.getAttribute('data-id'); var ev = EVENTS.find(e=>e.id===id); if(ev) downloadICS(ev); });
    });
  }

  function loadEvents(){
    fetch('./events.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>r.json()).then(data=>{ EVENTS = Array.isArray(data)?data:[]; renderHomeSlider(); renderEventsGrid(); })
      .catch(()=>{ EVENTS=[]; renderHomeSlider(); renderEventsGrid(); });
  }

  // Filtros
  $all('[data-filter]').forEach(ch=>on(ch,'click', function(){
    $all('[data-filter]').forEach(x=>x.classList.remove('on'));
    ch.classList.add('on'); DATE_FILTER=ch.getAttribute('data-filter')||'all'; renderEventsGrid();
  }));
  $all('[data-camp]').forEach(ch=>on(ch,'click', function(){
    $all('[data-camp]').forEach(x=>x.classList.remove('on'));
    ch.classList.add('on'); CAMP_FILTER=ch.getAttribute('data-camp')||'all'; renderEventsGrid();
  }));

  /* ===== Horarios ===== */
  var SCHEDULES_DEFAULT={
    oyambre:{
      es:"<b>RecepciÃ³n</b>: 8:30â€“22:00<br><b>Bar</b>: 8:30â€“23:00<br><b>Restaurante</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Piscinas (toda la temporada)</b>: 9:00â€“21:00<br><b>Gimnasio</b>: 9:00â€“21:00<br><b>LavanderÃ­a</b>: 24 horas<br><b>Tienda</b>: 8:30â€“13:00 / 17:00â€“20:00<br><b>Barrera de entrada</b>: 8:00â€“23:59 (circulaciÃ³n prohibida 00:00â€“8:00)<br><b>Check-in parcelas</b>: 13:00 Â· <b>Check-in alojamientos</b>: 17:00 Â· <b>Check-out</b>: 12:00<br><i>Los horarios pueden variar segÃºn la fecha.</i>",
      en:"<b>Reception</b>: 08:30â€“22:00<br><b>Bar</b>: 08:30â€“23:00<br><b>Restaurant</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Pools (all season)</b>: 09:00â€“21:00<br><b>Gym</b>: 09:00â€“21:00<br><b>Laundry</b>: 24h<br><b>Shop</b>: 08:30â€“13:00 / 17:00â€“20:00<br><b>Entry gate</b>: 08:00â€“23:59 (no driving 00:00â€“08:00)<br><b>Pitch check-in</b>: 13:00 Â· <b>Lodging check-in</b>: 17:00 Â· <b>Check-out</b>: 12:00<br><i>Hours may vary by date.</i>",
      fr:"<b>RÃ©ception</b> : 8:30â€“22:00<br><b>Bar</b> : 8:30â€“23:00<br><b>Restaurant</b> : 13:30â€“15:00 / 19:00â€“22:00<br><b>Piscines (toute la saison)</b> : 9:00â€“21:00<br><b>Gym</b> : 9:00â€“21:00<br><b>Blanchisserie</b> : 24h<br><b>BarriÃ¨re dâ€™entrÃ©e</b> : 8:00â€“23:59 (circulation interdite 00:00â€“8:00)<br><b>ArrivÃ©e emplacements</b> : 13:00 Â· <b>ArrivÃ©e logements</b> : 17:00 Â· <b>DÃ©part</b> : 12:00<br><i>Horaires susceptibles de varier.</i>",
      de:"<b>Rezeption</b>: 8:30â€“22:00<br><b>Bar</b>: 8:30â€“23:00<br><b>Restaurant</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>SchwimmbÃ¤der (Saison)</b>: 9:00â€“21:00<br><b>Fitness</b>: 9:00â€“21:00<br><b>Waschsalon</b>: 24h<br><b>Schranke</b>: 8:00â€“23:59 (keine Fahrten 00:00â€“8:00)<br><b>Check-in StellplÃ¤tze</b>: 13:00 Â· <b>Check-in UnterkÃ¼nfte</b>: 17:00 Â· <b>Check-out</b>: 12:00<br><i>Zeiten kÃ¶nnen variieren.</i>",
      nl:"<b>Receptie</b>: 8:30â€“22:00<br><b>Bar</b>: 8:30â€“23:00<br><b>Restaurant</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Zwembaden (seizoen)</b>: 9:00â€“21:00<br><b>Gym</b>: 9:00â€“21:00<br><b>Wasserette</b>: 24 u<br><b>Toegangshek</b>: 8:00â€“23:59 (geen verkeer 00:00â€“8:00)<br><b>Inchecken plaatsen</b>: 13:00 Â· <b>Inchecken logies</b>: 17:00 Â· <b>Uitchecken</b>: 12:00<br><i>Tijden kunnen variÃ«ren.</i>"
    },
    ramales:{
      es:"<b>RecepciÃ³n</b>: 9:00â€“21:00<br><b>CafeterÃ­a</b>: Lâ€“V 17:00â€“22:00 Â· Sâ€“D 8:30â€“22:00<br><b>Restaurante</b>: Lâ€“V 19:00â€“22:00 Â· Sâ€“D 13:30â€“15:00 / 19:00â€“22:00<br><b>Piscina</b>: 9:30â€“20:30<br><b>Check-in parcelas</b>: 12:00 Â· <b>Check-in alojamientos</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Barrera</b>: 8:00â€“23:59 (prohibida circulaciÃ³n 00:00â€“8:00)<br><i>Los horarios pueden variar segÃºn la fecha.</i>",
      en:"<b>Reception</b>: 09:00â€“21:00<br><b>CafÃ©</b>: Monâ€“Fri 17:00â€“22:00 Â· Satâ€“Sun 08:30â€“22:00<br><b>Restaurant</b>: Monâ€“Fri 19:00â€“22:00 Â· Satâ€“Sun 13:30â€“15:00 / 19:00â€“22:00<br><b>Pool</b>: 09:30â€“20:30<br><b>Pitches check-in</b>: 12:00 Â· <b>Lodgings check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Gate</b>: 08:00â€“23:59 (no driving 00:00â€“08:00)<br><i>Hours may vary by date.</i>",
      fr:"<b>RÃ©ception</b> : 9:00â€“21:00<br><b>CafÃ©tÃ©ria</b> : Lâ€“V 17:00â€“22:00 Â· Sâ€“D 8:30â€“22:00<br><b>Restaurant</b> : Lâ€“V 19:00â€“22:00 Â· Sâ€“D 13:30â€“15:00 / 19:00â€“22:00<br><b>Piscine</b> : 9:30â€“20:30<br><b>ArrivÃ©e emplacements</b> : 12:00 Â· <b>ArrivÃ©e logements</b> : 16:00 Â· <b>DÃ©part</b> : 12:00<br><b>BarriÃ¨re</b> : 8:00â€“23:59 (circulation interdite 00:00â€“8:00)<br><i>Horaires susceptibles de varier.</i>",
      de:"<b>Rezeption</b>: 9:00â€“21:00<br><b>CafÃ©</b>: Moâ€“Fr 17:00â€“22:00 Â· Saâ€“So 8:30â€“22:00<br><b>Restaurant</b>: Moâ€“Fr 19:00â€“22:00 Â· Saâ€“So 13:30â€“15:00 / 19:00â€“22:00<br><b>Pool</b>: 9:30â€“20:30<br><b>StellplÃ¤tze Check-in</b>: 12:00 Â· <b>UnterkÃ¼nfte Check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Schranke</b>: 8:00â€“23:59 (keine Fahrten 00:00â€“8:00)<br><i>Zeiten kÃ¶nnen variieren.</i>",
      nl:"<b>Receptie</b>: 9:00â€“21:00<br><b>Cafetaria</b>: Maâ€“Vr 17:00â€“22:00 Â· Zaâ€“Zo 8:30â€“22:00<br><b>Restaurant</b>: Maâ€“Vr 19:00â€“22:00 Â· Zaâ€“Zo 13:30â€“15:00 / 19:00â€“22:00<br><b>Zwembad</b>: 9:30â€“20:30<br><b>Inchecken plaatsen</b>: 12:00 Â· <b>Inchecken logies</b>: 16:00 Â· <b>Uitchecken</b>: 12:00<br><b>Slagboom</b>: 8:00â€“23:59 (geen verkeer 00:00â€“8:00)<br><i>Tijden kunnen variÃ«ren.</i>"
    },
    ruiloba:{
      es:"<b>RecepciÃ³n</b>: 8:30â€“22:00<br><b>Piscinas (toda la temporada)</b>: 9:00â€“21:00<br><b>CafeterÃ­a</b>: 8:30â€“23:00<br><b>Restaurante</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>LavanderÃ­a</b>: 24 h<br><b>Barrera</b>: 8:00â€“23:59 (prohibida circulaciÃ³n 00:00â€“8:00)<br><b>Tienda</b>: consultar en CafeterÃ­a<br><b>Check-in parcelas</b>: 13:00 Â· <b>Check-in alojamientos</b>: 17:00 Â· <b>Check-out</b>: 12:00<br><i>Los horarios pueden variar segÃºn la fecha.</i>",
      en:"<b>Reception</b>: 08:30â€“22:00<br><b>Pools (all season)</b>: 09:00â€“21:00<br><b>CafÃ©</b>: 08:30â€“23:00<br><b>Restaurant</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Laundry</b>: 24 h<br><b>Gate</b>: 08:00â€“23:59 (no driving 00:00â€“08:00)<br><b>Shop</b>: ask at CafÃ©<br><b>Pitches check-in</b>: 13:00 Â· <b>Lodgings check-in</b>: 17:00 Â· <b>Check-out</b>: 12:00<br><i>Hours may vary by date.</i>",
      fr:"<b>RÃ©ception</b> : 8:30â€“22:00<br><b>Piscines (toute la saison)</b> : 9:00â€“21:00<br><b>CafÃ©tÃ©ria</b> : 8:30â€“23:00<br><b>Restaurant</b> : 13:30â€“15:00 / 19:00â€“22:00<br><b>Blanchisserie</b> : 24 h<br><b>BarriÃ¨re</b> : 8:00â€“23:59 (circulation interdite 00:00â€“8:00)<br><b>Boutique</b> : Ã  demander au CafÃ©<br><b>ArrivÃ©e emplacements</b> : 13:00 Â· <b>ArrivÃ©e logements</b> : 17:00 Â· <b>DÃ©part</b> : 12:00<br><i>Horaires susceptibles de varier.</i>",
      de:"<b>Rezeption</b>: 8:30â€“22:00<br><b>SchwimmbÃ¤der (Saison)</b>: 9:00â€“21:00<br><b>CafÃ©</b>: 8:30â€“23:00<br><b>Restaurant</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Waschsalon</b>: 24 h<br><b>Schranke</b>: 8:00â€“23:59 (keine Fahrten 00:00â€“8:00)<br><b>Laden</b>: im CafÃ© nachfragen<br><b>StellplÃ¤tze Check-in</b>: 13:00 Â· <b>UnterkÃ¼nfte Check-in</b>: 17:00 Â· <b>Check-out</b>: 12:00<br><i>Zeiten kÃ¶nnen variieren.</i>",
      nl:"<b>Receptie</b>: 8:30â€“22:00<br><b>Zwembaden (seizoen)</b>: 9:00â€“21:00<br><b>Cafetaria</b>: 8:30â€“23:00<br><b>Restaurant</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Wasserette</b>: 24 u<br><b>Toegangshek</b>: 8:00â€“23:59 (geen verkeer 00:00â€“8:00)<br><b>Winkel</b>: vraag bij de cafetaria<br><b>Inchecken plaatsen</b>: 13:00 Â· <b>Inchecken logies</b>: 17:00 Â· <b>Uitchecken</b>: 12:00<br><i>Tijden kunnen variÃ«ren.</i>"
    },
    cardeo:{
      es:"<b>Check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Taberna</b>: 8:30â€“23:00<br><b>Restaurante (fines de semana)</b>: 13:30â€“15:30 / 20:00â€“22:30<br><i>Los horarios pueden variar segÃºn la fecha.</i>",
      en:"<b>Check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Tavern</b>: 08:30â€“23:00<br><b>Restaurant (weekends)</b>: 13:30â€“15:30 / 20:00â€“22:30<br><i>Hours may vary by date.</i>",
      fr:"<b>ArrivÃ©e</b> : 16:00 Â· <b>DÃ©part</b> : 12:00<br><b>Taverne</b> : 8:30â€“23:00<br><b>Restaurant (week-end)</b> : 13:30â€“15:30 / 20:00â€“22:30<br><i>Horaires susceptibles de varier.</i>",
      de:"<b>Check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Taverne</b>: 8:30â€“23:00<br><b>Restaurant (Wochenende)</b>: 13:30â€“15:30 / 20:00â€“22:30<br><i>Zeiten kÃ¶nnen variieren.</i>",
      nl:"<b>Check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Taverne</b>: 8:30â€“23:00<br><b>Restaurant (weekend)</b>: 13:30â€“15:30 / 20:00â€“22:30<br><i>Tijden kunnen variÃ«ren.</i>"
    }
  };
  var SCHEDULES = JSON.parse(JSON.stringify(SCHEDULES_DEFAULT));
  function renderAcc(){
    ['oyambre','ramales','ruiloba','cardeo'].forEach(function(k){
      var el=document.getElementById('acc-'+k);
      if(!el) return;
      var item=SCHEDULES[k]||SCHEDULES_DEFAULT[k]||{};
      el.innerHTML = item[LANG] || item.es || '';
    });
  }
  function loadSchedules(){
    fetch('./schedules.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>{ if(!r.ok) throw 0; return r.json(); })
      .then(json=>{ if(json && typeof json==='object'){ SCHEDULES=json; renderAcc(); renderStayHours(); }})
      .catch(()=>{ SCHEDULES=JSON.parse(JSON.stringify(SCHEDULES_DEFAULT)); renderAcc(); renderStayHours(); });
  }
  $all('.acc-h').forEach(h=>on(h,'click', function(){ h.parentElement.classList.toggle('open'); }));

  /* ===== Mi estancia (contactos + horarios + clima) ===== */
  var STAY = localStorage.getItem('stay_place') || 'oyambre';
  var COORDS = {
    oyambre:{lat:43.393, lon:-4.352},
    ramales:{lat:43.263, lon:-3.465},
    ruiloba:{lat:43.387, lon:-4.264},
    cardeo:{lat:43.391, lon:-4.274}
  };
  function setStayPlace(v){ STAY=String(v||'oyambre').toLowerCase(); localStorage.setItem('stay_place',STAY); updateStayUI(); updateIncUI(); updateSugUI(); }
  function renderStayContacts(){
    var T=I18N[LANG], place=STAY;
    $('#stayPlace').value=place;
    var web=WEB[place], tel=PHONES[place], wa=WHATSAPP[place], mail=EMAILS[place], dir=PLACE_LINK[place];
    $('#stayWeb').textContent=T.web; $('#stayWeb').onclick=function(){ location.href=web; };
    var call=$('#stayCall'); call.textContent=T.call; call.href='tel:'+tel;
    var waBtn=$('#stayWA'); waBtn.textContent=T.whatsapp; waBtn.href='https://wa.me/'+wa+'?text='+encodeURIComponent('Hola, soy cliente alojado en '+PLACE_LABEL[place]+'.');
    var em=$('#stayEmail'); em.textContent=T.email; em.href='mailto:'+mail+'?subject='+encodeURIComponent('Consulta - '+PLACE_LABEL[place])+'&body='+encodeURIComponent('Hola,\n\nSoy cliente alojado en '+PLACE_LABEL[place]+'.\n\nGracias.');
    var dr=$('#stayDir'); dr.textContent=T.directions; dr.href=dir;
    $('#wxPlaceLabel').textContent=PLACE_LABEL[place];
  }
  function renderStayHours(){
    var cont=$('#stayHours'); if(!cont) return;
    var item=(SCHEDULES[STAY]||SCHEDULES_DEFAULT[STAY]||{});
    cont.innerHTML = item[LANG] || item.es || '';
  }

  // Weather
  function codeToEmoji(code){
    if([0].includes(code)) return 'â˜€ï¸';
    if([1,2].includes(code)) return 'ğŸŒ¤ï¸';
    if([3].includes(code)) return 'â˜ï¸';
    if([45,48].includes(code)) return 'ğŸŒ«ï¸';
    if([51,53,55,56,57].includes(code)) return 'ğŸŒ¦ï¸';
    if([61,63,65,80,81,82].includes(code)) return 'ğŸŒ§ï¸';
    if([66,67,71,73,75,77,85,86].includes(code)) return 'â„ï¸';
    if([95,96,99].includes(code)) return 'â›ˆï¸';
    return 'ğŸŒ¡ï¸';
  }
  function wd(d){ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short'}).format(new Date(d)); }catch(e){ return d; } }
  function renderWeather(data){
    if(!data) return;
    $('#wxIco').textContent = codeToEmoji(data.current.weather_code);
    $('#wxNow').textContent = Math.round(data.current.temperature_2m);
    $('#wxMax').textContent = Math.round(data.daily.temperature_2m_max[0]);
    $('#wxMin').textContent = Math.round(data.daily.temperature_2m_min[0]);
    $('#wxDesc').textContent = wd(data.daily.time[0]);
    for(var i=1;i<=3;i++){
      $('#d'+i).textContent = wd(data.daily.time[i]);
      $('#i'+i).textContent = codeToEmoji(data.daily.weather_code[i]);
      $('#t'+i).textContent = Math.round(data.daily.temperature_2m_max[i])+'/'+Math.round(data.daily.temperature_2m_min[i])+'Â°';
    }
  }
  function fetchWeather(place){
    var c=COORDS[place]||COORDS.oyambre;
    var url = 'https://api.open-meteo.com/v1/forecast?latitude='+c.lat+'&longitude='+c.lon+'&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=4';
    fetch(url).then(r=>r.json()).then(renderWeather).catch(function(){});
  }
  function updateStayUI(){ renderStayContacts(); renderStayHours(); fetchWeather(STAY); }

  on($('#stayPlace'),'change', function(e){ setStayPlace(e.target.value); });

  /* ===== Incidencias ===== */
  function fillIncTypes(){
    var sel=$('#incType'); if(!sel) return;
    var opts=I18N[LANG].incTypes||I18N.es.incTypes;
    sel.innerHTML = opts.map(function(o){ return '<option value="'+o.key+'">'+esc(o.label)+'</option>'; }).join('');
  }
  function buildIncMsg(){
    var T=I18N[LANG], typeOpt=$('#incType'); var typeTxt = typeOpt && typeOpt.options[typeOpt.selectedIndex]? typeOpt.options[typeOpt.selectedIndex].textContent : 'Otros';
    var msg=$('#incMsg').value||'';
    var now=new Date(); var stamp = now.toLocaleString();
    var header = '['+T.incTitle+'] '+typeTxt+' Â· '+PLACE_LABEL[STAY];
    var body = 'Hola,\n\nTengo una incidencia: '+typeTxt+'.\n\nDetalle: '+msg+'\n\nAlojamiento: '+PLACE_LABEL[STAY]+'\nFecha/hora: '+stamp+'\n\nGracias.';
    if(LANG!=='es'){
      body = 'Hello,\n\nI would like to report an issue: '+typeTxt+'.\n\nDetails: '+msg+'\n\nAccommodation: '+PLACE_LABEL[STAY]+'\nDate/time: '+stamp+'\n\nThank you.';
    }
    return {subject:header, body:body};
  }
  function updateIncUI(){
    $('#incPlace').value=STAY;
    var mail=EMAILS[STAY], wa=WHATSAPP[STAY];
    var m=buildIncMsg();
    $('#incWA').href='https://wa.me/'+wa+'?text='+encodeURIComponent(m.body);
    $('#incEmail').href='mailto:'+mail+'?subject='+encodeURIComponent(m.subject)+'&body='+encodeURIComponent(m.body);
  }
  on($('#incPlace'),'change', function(e){ setStayPlace(e.target.value); });
  on($('#incType'),'change', updateIncUI);
  on($('#incMsg'),'input', updateIncUI);

  /* ===== Sugerencias ===== */
  function fillSugTypes(){
    var sel=$('#sugType'); if(!sel) return;
    var opts=I18N[LANG].suggestTypes||I18N.es.suggestTypes;
    sel.innerHTML = opts.map(function(o){ return '<option value="'+o.key+'">'+esc(o.label)+'</option>'; }).join('');
  }
  function buildSugMsg(){
    var T=I18N[LANG];
    var sel=$('#sugType');
    var typeTxt = sel && sel.options[sel.selectedIndex]? sel.options[sel.selectedIndex].textContent : '';
    var msg=$('#sugMsg').value||'';
    var rate=$('#sugRate').value||'';
    var place=$('#sugPlace').value||STAY;
    var placeLabel=PLACE_LABEL[place]||place;
    var now=new Date(); var stamp=now.toLocaleString();
    var title=T.suggestTitle||'Feedback box';
    var header='['+title+'] '+placeLabel;
    var body;
    if(LANG==='es'){
      body='Hola,\n\nMe gustarÃ­a dejar la siguiente sugerencia en '+placeLabel+':\n\nTipo: '+typeTxt+'\nValoraciÃ³n global: '+(rate?rate+'/5':'(sin valorar)')+'\n\nDetalle:\n'+msg+'\n\nFecha/hora: '+stamp+'\n\nGracias.';
    }else{
      body='Hello,\n\nI would like to share the following feedback for '+placeLabel+':\n\nType: '+typeTxt+'\nOverall rating: '+(rate?rate+'/5':'(no rating)')+'\n\nDetails:\n'+msg+'\n\nDate/time: '+stamp+'\n\nThank you.';
    }
    return {subject:header, body:body, place:place};
  }
  function updateSugUI(){
    var placeEl=$('#sugPlace'); if(!placeEl) return;
    var place=placeEl.value||STAY;
    var mail=EMAILS[place], wa=WHATSAPP[place];
    var m=buildSugMsg();
    var waA=$('#sugWA'), emA=$('#sugEmail');
    if(waA) waA.href='https://wa.me/'+wa+'?text='+encodeURIComponent(m.body);
    if(emA) emA.href='mailto:'+mail+'?subject='+encodeURIComponent(m.subject)+'&body='+encodeURIComponent(m.body);
  }
  on($('#sugPlace'),'change', function(e){ setStayPlace(e.target.value); updateSugUI(); });
  on($('#sugType'),'change', updateSugUI);
  on($('#sugMsg'),'input', updateSugUI);
  on($('#sugRate'),'input', updateSugUI);

  /* ===== Distancias / GeolocalizaciÃ³n ===== */
  var myPos=null;
  function toRad(deg){return deg*Math.PI/180;}
  function haversine(lat1,lon1,lat2,lon2){
    var R=6371, dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
    var a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
    return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  }
  function distPill(lat,lon){
    if(!myPos) return '';
    var d=haversine(myPos.lat,myPos.lon,lat,lon);
    var label=(I18N[LANG].distance||'a {X} km').replace('{X}', km(d));
    return '<span class="badge-pill">ğŸ“ '+esc(label)+'</span>';
  }
  function askGeo(btnId){
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(function(p){
        myPos={lat:p.coords.latitude,lon:p.coords.longitude};
        $('#geoTxt1').textContent='OK'; $('#geoTxt2').textContent='OK';
        renderMusts(); renderFavs();
      }, function(){ alert('No fue posible obtener tu ubicaciÃ³n.'); });
    }else{ alert('GeolocalizaciÃ³n no soportada.'); }
  }
  on($('#geoBtn1'),'click', function(){ askGeo('#geoBtn1'); });
  on($('#geoBtn2'),'click', function(){ askGeo('#geoBtn2'); });

  /* ===== Imprescindibles, GastronomÃ­a, Favoritos (datos) ===== */
  function gglImages(q){ return 'https://www.google.com/search?tbm=isch&q='+encodeURIComponent(q); }
  function gglMaps(q){ return 'https://www.google.com/maps/search/'+encodeURIComponent(q); }

  /* ==== IMPRESCINDIBLES (mega ampliado) ==== */
  var MUSTS=[{
      slug:'comillas',
      name:{es:'Comillas', en:'Comillas', fr:'Comillas', de:'Comillas', nl:'Comillas'},
      center:{lat:43.3857, lon:-4.2922},
      desc:{
        es:'Villa seÃ±orial con joyas modernistas, universidad monumental, puerto y playa. Patrimonio + mar en un paseo.',
        en:'Elegant seaside town with Modernista gems, grand university, harbor and beach.',
        fr:'Bourg Ã©lÃ©gant au bord de mer, architecture moderniste, universitÃ© et plage.',
        de:'Elegante KÃ¼stenstadt mit modernistischer Architektur, groÃŸer UniversitÃ¤t und Strand.',
        nl:'Elegante kustplaats met modernistische juweeltjes, universiteit, haven en strand.'
      },
      see:[
        {name:{es:'El Capricho de GaudÃ­',en:'GaudÃ­â€™s El Capricho',fr:'El Capricho de GaudÃ­',de:'El Capricho von GaudÃ­',nl:'El Capricho van GaudÃ­'},
         desc:{es:'PabellÃ³n modernista icÃ³nico.',en:'Town icon by GaudÃ­.'},
         lat:43.38397, lon:-4.29404, map:gglMaps('El Capricho de GaudÃ­ Comillas'), images:gglImages('El Capricho de GaudÃ­')},
        {name:{es:'Universidad Pontificia',en:'Pontifical University',fr:'UniversitÃ© pontificale',de:'PÃ¤pstliche UniversitÃ¤t',nl:'Pauselijke Universiteit'},
         desc:{es:'Conjunto neogÃ³tico con vistas.',en:'Neo-Gothic complex with views.'},
         lat:43.3828, lon:-4.2913, map:gglMaps('Universidad Pontificia Comillas'), images:gglImages('Universidad Pontificia Comillas')},
        {name:{es:'Palacio de Sobrellano y Capilla',en:'Sobrellano Palace & Chapel',fr:'Palais de Sobrellano',de:'Palast Sobrellano',nl:'Paleis Sobrellano'},
         desc:{es:'Residencia marquesal y capilla modernista.',en:'Marquisâ€™ residence and chapel.'},
         lat:43.3833, lon:-4.2929, map:gglMaps('Palacio de Sobrellano Comillas'), images:gglImages('Palacio de Sobrellano Comillas')},
        {name:{es:'Playa de Comillas y Puerto',en:'Beach & Harbor',fr:'Plage & Port',de:'Strand & Hafen',nl:'Strand & Haven'},
         desc:{es:'Arena fina, rompeolas y paseo marÃ­timo.',en:'Fine sand, breakwater and seafront.'},
         lat:43.3847, lon:-4.2939, map:gglMaps('Playa de Comillas'), images:gglImages('Playa de Comillas')}
      ]
    },
    { slug:'san-vicente',
      name:{es:'San Vicente de la Barquera', en:'San Vicente de la Barquera', fr:'San Vicente de la Barquera', de:'San Vicente de la Barquera', nl:'San Vicente de la Barquera'},
      center:{lat:43.3856, lon:-4.3987},
      desc:{es:'Villa marinera con puentes medievales, marismas del PN Oyambre y vistas a Picos. Casco histÃ³rico y marisco.',
            en:'Fishing town with medieval bridges, Oyambre marshes and Picos views.'},
      see:[
        {name:{es:'Puente de la Maza',en:'La Maza Bridge'}, desc:{es:'Emblema del s. XVI sobre la rÃ­a.',en:'Iconic 16th-c. bridge.'}, lat:43.3888, lon:-4.3953, map:gglMaps('Puente de la Maza San Vicente'), images:gglImages('Puente de la Maza San Vicente')},
        {name:{es:'Castillo del Rey',en:'Kingâ€™s Castle'}, desc:{es:'Fortaleza costera con miradores.',en:'Coastal fortress with views.'}, lat:43.3913, lon:-4.3982, map:gglMaps('Castillo del Rey San Vicente'), images:gglImages('Castillo del Rey San Vicente')},
        {name:{es:'Santa MarÃ­a de los Ãngeles',en:'Gothic Church'}, desc:{es:'Templo gÃ³tico en lo alto.',en:'Hilltop Gothic church.'}, lat:43.3918, lon:-4.3989, map:gglMaps('Iglesia Santa MarÃ­a de los Ãngeles San Vicente'), images:gglImages('Iglesia Santa MarÃ­a de los Ãngeles San Vicente')},
        {name:{es:'Ermita de la Virgen de la Barquera',en:'Virgen de la Barquera Hermitage'}, desc:{es:'Ermita junto al puerto.',en:'Seaside hermitage.'}, lat:43.3925, lon:-4.4026, map:gglMaps('Ermita de la Virgen de la Barquera'), images:gglImages('Ermita de la Virgen de la Barquera')},
        {name:{es:'Ruta de los Acantilados (Punta de la Silla)',en:'Cliffs Trail (Punta de la Silla)'}, desc:{es:'Senda litoral con vistas abiertas.',en:'Coastal path with open views.'}, lat:43.3926, lon:-4.3979, map:gglMaps('Faro Punta de la Silla San Vicente de la Barquera'), images:gglImages('Acantilados San Vicente de la Barquera')}
      ]
    },
    { slug:'santander',
      name:{es:'Santander', en:'Santander', fr:'Santander', de:'Santander', nl:'Santander'},
      center:{lat:43.4623, lon:-3.80998},
      desc:{es:'Capital abierta a la bahÃ­a: playas urbanas, paseo marÃ­timo y cultura contemporÃ¡nea.',
            en:'Bayfront capital: urban beaches, waterfront and contemporary culture.'},
      see:[
        {name:{es:'Palacio de la Magdalena',en:'Magdalena Palace'}, desc:{es:'Residencia real y parque.',en:'Royal residence & park.'}, lat:43.4697, lon:-3.7667, map:gglMaps('Palacio de la Magdalena Santander'), images:gglImages('Palacio de la Magdalena Santander')},
        {name:{es:'Centro BotÃ­n',en:'Centro BotÃ­n'}, desc:{es:'Arte junto al muelle (Renzo Piano).',en:'Harborfront art by Renzo Piano.'}, lat:43.4621, lon:-3.8078, map:gglMaps('Centro BotÃ­n'), images:gglImages('Centro BotÃ­n')},
        {name:{es:'Plaza de CaÃ±adÃ­o',en:'CaÃ±adÃ­o Square'}, desc:{es:'Ambiente de tarde-noche.',en:'Lively late-evening hub.'}, lat:43.4629, lon:-3.8072, map:gglMaps('Plaza de CaÃ±adÃ­o Santander'), images:gglImages('Plaza de CaÃ±adÃ­o Santander')},
        {name:{es:'Diques de Gamazo',en:'Gamazo Docks'}, desc:{es:'Paseo recuperado junto a la bahÃ­a.',en:'Restored dock promenade.'}, lat:43.4637, lon:-3.7864, map:gglMaps('Dique de Gamazo Santander'), images:gglImages('Diques de Gamazo Santander')},
        {name:{es:'Palacio de Festivales',en:'Festival Palace'}, desc:{es:'Auditorio frente al mar.',en:'Seafront auditorium.'}, lat:43.4629, lon:-3.7877, map:gglMaps('Palacio de Festivales de Cantabria'), images:gglImages('Palacio de Festivales Santander')},
        {name:{es:'Parque de las Llamas',en:'Las Llamas Park'}, desc:{es:'Humedal urbano con pasarelas.',en:'Urban wetland & boardwalks.'}, lat:43.4746, lon:-3.7963, map:gglMaps('Parque de las Llamas'), images:gglImages('Parque de las Llamas Santander')},
        {name:{es:'Senda de MataleÃ±as',en:'MataleÃ±as Path'}, desc:{es:'Ruta de acantilados y faros.',en:'Clifftop path & lighthouses.'}, lat:43.4865, lon:-3.7834, map:gglMaps('Senda de MataleÃ±as'), images:gglImages('Senda de MataleÃ±as')},
        {name:{es:'Museo MarÃ­timo del CantÃ¡brico',en:'Maritime Museum'}, desc:{es:'Acuarios y patrimonio marinero.',en:'Aquariums & maritime heritage.'}, lat:43.4604, lon:-3.7946, map:gglMaps('Museo MarÃ­timo del CantÃ¡brico'), images:gglImages('Museo MarÃ­timo del CantÃ¡brico')},
        {name:{es:'Faro de Cabo Mayor',en:'Cabo Mayor Lighthouse'}, desc:{es:'Miradores sobre El Sardinero.',en:'Viewpoints over El Sardinero.'}, lat:43.4931, lon:-3.7821, map:gglMaps('Faro de Cabo Mayor'), images:gglImages('Faro de Cabo Mayor')},
        {name:{es:'Playas de El Sardinero',en:'El Sardinero Beaches'}, desc:{es:'Las playas urbanas por excelencia.',en:'Santanderâ€™s emblematic beaches.'}, lat:43.4767, lon:-3.7836, map:gglMaps('El Sardinero'), images:gglImages('El Sardinero')}
      ]
    },
    { slug:'santillana',
      name:{es:'Santillana del Mar', en:'Santillana del Mar', fr:'Santillana del Mar', de:'Santillana del Mar', nl:'Santillana del Mar'},
      center:{lat:43.3904, lon:-4.1097},
      desc:{es:'Conjunto medieval impecable a un paso de Altamira. Casonas y arte romÃ¡nico.',
            en:'Immaculate medieval town near Altamira.'},
      see:[
        {name:{es:'Colegiata de Santa Juliana',en:'Collegiate Church'}, desc:{es:'RomÃ¡nico con claustro.',en:'Romanesque with cloister.'}, lat:43.3906, lon:-4.1089, map:gglMaps('Colegiata Santa Juliana'), images:gglImages('Colegiata Santa Juliana')},
        {name:{es:'Museo / Neocueva de Altamira',en:'Altamira Museum'}, desc:{es:'RÃ©plica de las pinturas paleolÃ­ticas.',en:'Replica of Paleolithic art.'}, lat:43.3777, lon:-4.1211, map:gglMaps('Museo de Altamira'), images:gglImages('Museo de Altamira'), tickets:'https://www.cultura.gob.es/mnaltamira/visita/compra-entradas.html'},
        {name:{es:'Torre de Don Borja',en:'Don Borja Tower'}, desc:{es:'Arquitectura civil medieval.',en:'Medieval civil architecture.'}, lat:43.3904, lon:-4.108, map:gglMaps('Torre de Don Borja Santillana'), images:gglImages('Torre de Don Borja')}
      ]
    },
    { slug:'suances',
      name:{es:'Suances', en:'Suances', fr:'Suances', de:'Suances', nl:'Suances'},
      center:{lat:43.4275, lon:-4.0424},
      desc:{es:'Playas abiertas al CantÃ¡brico, surf y atardeceres desde los acantilados.',
            en:'Open Atlantic beaches, surf and cliff-top sunsets.'},
      see:[
        {name:{es:'Playa de Los Locos',en:'Los Locos Beach'}, desc:{es:'Surf de fama internacional.',en:'Renowned surf spot.'}, lat:43.4359, lon:-4.0530, map:gglMaps('Playa de Los Locos Suances'), images:gglImages('Playa de Los Locos Suances')},
        {name:{es:'Punta del Dichoso y Faro',en:'Punta del Dichoso & Lighthouse'}, desc:{es:'Acantilados sobre el Abra del Pas.',en:'Cliffs over the Pas estuary.'}, lat:43.4416, lon:-4.0489, map:gglMaps('Punta del Dichoso Suances'), images:gglImages('Punta del Dichoso')},
        {name:{es:'La Riberuca y La Concha',en:'Riberuca & La Concha'}, desc:{es:'Playas familiares y paseo.',en:'Family beaches & promenade.'}, lat:43.4301, lon:-4.0393, map:gglMaps('Playa de la Concha Suances'), images:gglImages('Playa de la Concha Suances')}
      ]
    },
    { slug:'potes-liebana',
      name:{es:'Potes & LiÃ©bana', en:'Potes & LiÃ©bana', fr:'Potes & LiÃ©bana', de:'Potes & LiÃ©bana', nl:'Potes & LiÃ©bana'},
      center:{lat:43.1533, lon:-4.6227},
      desc:{es:'Puerta a los Picos de Europa: torres medievales, vinos de altura y orujo. Base perfecta para rutas.',
            en:'Gateway to Picos: medieval towers, valley wines and â€œorujoâ€.'},
      see:[
        {name:{es:'TelefÃ©rico de Fuente DÃ©',en:'Fuente DÃ© Cable Car'}, desc:{es:'Vistas a 1.823 m; rutas alpinas.',en:'1,823 m views; alpine trails.'}, lat:43.1440, lon:-4.8127, map:gglMaps('TelefÃ©rico Fuente DÃ©'), images:gglImages('TelefÃ©rico Fuente DÃ©'), tickets:'https://www.cantur.com/'},
        {name:{es:'Torre del Infantado',en:'Infantado Tower'}, desc:{es:'Emblema de Potes.',en:'Potes emblem.'}, lat:43.1538, lon:-4.6221, map:gglMaps('Torre del Infantado'), images:gglImages('Torre del Infantado')},
        {name:{es:'Monasterio de Santo Toribio',en:'Santo Toribio Monastery'}, desc:{es:'Lignum Crucis; AÃ±o Jubilar.',en:'Lignum Crucis; Jubilee site.'}, lat:43.1595, lon:-4.6501, map:gglMaps('Monasterio de Santo Toribio de LiÃ©bana'), images:gglImages('Monasterio de Santo Toribio')},
        {name:{es:'Mogrovejo',en:'Mogrovejo'}, desc:{es:'Pueblo de montaÃ±a con torre y vistas.',en:'Mountain village with tower & views.'}, lat:43.1547, lon:-4.7062, map:gglMaps('Mogrovejo Cantabria'), images:gglImages('Mogrovejo Cantabria')},
        {name:{es:'Mirador del Corzo (San Glorio)',en:'El Corzo Viewpoint'}, desc:{es:'Mirador clÃ¡sico del puerto.',en:'Classic pass viewpoint.'}, lat:43.0567, lon:-4.7267, map:gglMaps('Mirador del Corzo San Glorio'), images:gglImages('Mirador del Corzo')}
      ]
    },
    { slug:'alto-ason',
      name:{es:'Comarca del Alto AsÃ³n', en:'Alto AsÃ³n Area', fr:'RÃ©gion de lâ€™AsÃ³n', de:'Region Alto AsÃ³n', nl:'Regio Alto AsÃ³n'},
      center:{lat:43.2577, lon:-3.6026},
      desc:{es:'Karst, cascadas y cuevas prehistÃ³ricas en Soba, Arredondo y Ramales.',
            en:'Karst, waterfalls and prehistoric caves.'},
      see:[
        {name:{es:'Nacimiento del rÃ­o AsÃ³n (cascada)',en:'AsÃ³n Waterfall'}, desc:{es:'Gran â€œcola de caballoâ€.',en:'Iconic horsetail fall.'}, lat:43.2581, lon:-3.6276, map:gglMaps('Nacimiento del rÃ­o AsÃ³n'), images:gglImages('Cascada AsÃ³n')},
        {name:{es:'Cascadas del GÃ¡ndara',en:'GÃ¡ndara Falls'}, desc:{es:'Cascadas en caÃ±Ã³n kÃ¡rstico.',en:'Falls in a karst canyon.'}, lat:43.1753, lon:-3.6387, map:gglMaps('Cascadas del rÃ­o GÃ¡ndara'), images:gglImages('Cascadas del GÃ¡ndara')},
        {name:{es:'Cueva de Covalanas',en:'Covalanas Cave'}, desc:{es:'Arte rupestre en rojo.',en:'Red Paleolithic art.'}, lat:43.2639, lon:-3.5005, map:gglMaps('Cueva Covalanas'), images:gglImages('Cueva Covalanas')},
        {name:{es:'Cueva Cullalvera',en:'Cullalvera Cave'}, desc:{es:'Entrada monumental; visita guiada.',en:'Monumental entrance; guided tour.'}, lat:43.2618, lon:-3.4629, map:gglMaps('Cueva Cullalvera'), images:gglImages('Cueva Cullalvera')}
      ]
    },
    { slug:'valle-cabuerniga',
      name:{es:'Valle de CabuÃ©rniga', en:'CabuÃ©rniga Valley', fr:'VallÃ©e de CabuÃ©rniga', de:'Tal CabuÃ©rniga', nl:'Vallei CabuÃ©rniga'},
      center:{lat:43.2339, lon:-4.2644},
      desc:{es:'Valles pasiegos occidentales: pueblos tradicionales y robledales de Ucieda.',
            en:'Western Pasiego-style valleys with traditional villages and oak woods.'},
      see:[
        {name:{es:'BÃ¡rcena Mayor',en:'BÃ¡rcena Mayor'}, desc:{es:'Conjunto histÃ³rico serrano.',en:'Listed mountain village.'}, lat:43.1513, lon:-4.2646, map:gglMaps('BÃ¡rcena Mayor'), images:gglImages('BÃ¡rcena Mayor')},
        {name:{es:'Ruente y La Fuentona',en:'Ruente & Fuentona'}, desc:{es:'Surgencia kÃ¡rstica junto al puente.',en:'Karst spring by the bridge.'}, lat:43.2922, lon:-4.2465, map:gglMaps('La Fuentona Ruente'), images:gglImages('Fuentona Ruente')},
        {name:{es:'Cascadas de LamiÃ±a',en:'LamiÃ±a Waterfalls'}, desc:{es:'Paseo boscoso fÃ¡cil y fotogÃ©nico.',en:'Easy forest walk to falls.'}, lat:43.2648, lon:-4.2289, map:gglMaps('Cascadas de LamiÃ±a'), images:gglImages('Cascadas de LamiÃ±a')},
        {name:{es:'Los Tojos',en:'Los Tojos'}, desc:{es:'Arquitectura serrana tradicional.',en:'Traditional mountain village.'}, lat:43.1425, lon:-4.2968, map:gglMaps('Los Tojos Cantabria'), images:gglImages('Los Tojos Cantabria')}
      ]
    },
    { slug:'hermida',
      name:{es:'Desfiladero de la Hermida', en:'Hermida Gorge', fr:'DÃ©filÃ© de la Hermida', de:'Hermida-Schlucht', nl:'Hermida-kloof'},
      center:{lat:43.2553, lon:-4.5661},
      desc:{es:'Gran caÃ±Ã³n fluvial camino de LiÃ©bana; pozas termales y ermitas cercanas.',
            en:'Spectacular river gorge to LiÃ©bana; hot pools and Romanesque sites.'},
      see:[
        {name:{es:'Mirador de Santa Catalina',en:'Santa Catalina Viewpoint'}, desc:{es:'BalcÃ³n sobre el Deva.',en:'Balcony over the Deva valley.'}, lat:43.2753, lon:-4.5654, map:gglMaps('Mirador de Santa Catalina'), images:gglImages('Mirador de Santa Catalina')},
        {name:{es:'Santa MarÃ­a de LebeÃ±a',en:'Santa MarÃ­a de LebeÃ±a'}, desc:{es:'Joya prerromÃ¡nica (s. X).',en:'10th-c. pre-Romanesque gem.'}, lat:43.2272, lon:-4.5975, map:gglMaps('Iglesia de Santa MarÃ­a de LebeÃ±a'), images:gglImages('Santa MarÃ­a de LebeÃ±a')}
      ]
    },
    { slug:'soplao',
      name:{es:'Cueva El Soplao', en:'El Soplao Cave', fr:'Grotte El Soplao', de:'HÃ¶hle El Soplao', nl:'Grot El Soplao'},
      center:{lat:43.3154, lon:-4.3985},
      desc:{es:'Cueva Ãºnica por sus excÃ©ntricas (helictitas) y galerÃ­as mineras.',
            en:'Famed for helictites and mining galleries.'},
      see:[
        {name:{es:'Visita turÃ­stica',en:'Tour visit'}, desc:{es:'Recorrido acondicionado (~1 h).',en:'Standard 1-hour route.'}, lat:43.3154, lon:-4.3985, map:gglMaps('Cueva El Soplao'), images:gglImages('Cueva El Soplao'), tickets:'https://www.elsoplao.es/'},
        {name:{es:'Visita aventura',en:'Adventure tour'}, desc:{es:'Tramo espeleolÃ³gico con equipaciÃ³n.',en:'Spelunking-style section.'}, lat:43.3154, lon:-4.3985, map:gglMaps('Cueva El Soplao aventura'), images:gglImages('El Soplao aventura')},
        {name:{es:'Mirador exterior',en:'Scenic viewpoint'}, desc:{es:'Vistas al valle y costa occidental.',en:'Views over the valley & coast.'}, lat:43.3141, lon:-4.4003, map:gglMaps('Mirador El Soplao'), images:gglImages('Mirador El Soplao')}
      ]
    },
    { slug:'isla-noja-santona',
      name:{es:'Isla Â· Noja Â· SantoÃ±a', en:'Isla Â· Noja Â· SantoÃ±a', fr:'Isla Â· Noja Â· SantoÃ±a', de:'Isla Â· Noja Â· SantoÃ±a', nl:'Isla Â· Noja Â· SantoÃ±a'},
      center:{lat:43.4884, lon:-3.5270},
      desc:{es:'Playas infinitas, marismas protegidas y anchoas con sello propio.',
            en:'Endless beaches, protected marshes and famed anchovies.'},
      see:[
        {name:{es:'Marismas de SantoÃ±a',en:'SantoÃ±a Marshes'}, desc:{es:'Reserva natural y aves.',en:'Nature reserve & birding.'}, lat:43.4556, lon:-3.4742, map:gglMaps('Marismas de SantoÃ±a'), images:gglImages('Marismas de SantoÃ±a')},
        {name:{es:'Playa del Joyel (Noja)',en:'Joyel Beach (Noja)'}, desc:{es:'Arenal amplio y familiar.',en:'Wide, family beach.'}, lat:43.4887, lon:-3.5186, map:gglMaps('Playa del Joyel Noja'), images:gglImages('Playa del Joyel')},
        {name:{es:'Playa de Isla',en:'Isla Beach'}, desc:{es:'Calas junto al Hotel Astuy.',en:'Coves by Hotel Astuy.'}, lat:43.4866, lon:-3.5178, map:gglMaps('Playa de Isla Cantabria'), images:gglImages('Playa de Isla Cantabria')},
        {name:{es:'Playa de Berria (SantoÃ±a)',en:'Berria Beach'}, desc:{es:'Gran lengua de arena entre marismas.',en:'Long sandbar between marshes.'}, lat:43.4609, lon:-3.4596, map:gglMaps('Playa de Berria'), images:gglImages('Playa de Berria SantoÃ±a')},
        {name:{es:'Monte Buciero (SantoÃ±a)',en:'Buciero Loop'}, desc:{es:'Ruta de faros y acantilados.',en:'Lighthouse & cliffs loop.'}, lat:43.4587, lon:-3.4413, map:gglMaps('Monte Buciero ruta'), images:gglImages('Monte Buciero')}
      ]
    },
    { slug:'cabarceno',
      name:{es:'Parque de la Naturaleza de CabÃ¡rceno', en:'CabÃ¡rceno Nature Park', fr:'Parc de CabÃ¡rceno', de:'Naturpark CabÃ¡rceno', nl:'Natuurpark CabÃ¡rceno'},
      center:{lat:43.3479, lon:-3.8313},
      desc:{es:'Fauna en semilibertad en antigua mina a cielo abierto. Telecabinas incluidas.',
            en:'Semi-free wildlife in a former open-pit mine. Cable cars included.'},
      see:[
        {name:{es:'Telecabina y recintos',en:'Cable car & enclosures'}, desc:{es:'Vistas, rutas y Ã¡reas temÃ¡ticas.',en:'Views, routes and themed areas.'}, lat:43.3479, lon:-3.8313, map:gglMaps('Parque de CabÃ¡rceno'), images:gglImages('CabÃ¡rceno telecabina'), tickets:'https://entradas.parquedecabarceno.com/'}
      ]
    },
    { slug:'costa-quebrada',
      name:{es:'Costa Quebrada (Liencresâ€“ArnÃ­a)', en:'Costa Quebrada', fr:'Costa Quebrada', de:'Costa Quebrada', nl:'Costa Quebrada'},
      center:{lat:43.442, lon:-3.966},
      desc:{es:'Paisaje litoral de acantilados, islotes y pliegues. GeologÃ­a espectacular.',
            en:'Dramatic coastal cliffs, stacks and folded strata.'},
      see:[
        {name:{es:'Parque Natural Dunas de Liencres',en:'Liencres Dunes NP'}, desc:{es:'Bocas del Pas y pinar.',en:'River mouth & dunes.'}, lat:43.4415, lon:-3.9678, map:gglMaps('Parque Natural Dunas de Liencres'), images:gglImages('Dunas de Liencres')},
        {name:{es:'Playa de La ArnÃ­a',en:'ArnÃ­a Beach'}, desc:{es:'Arcos e islotes fotogÃ©nicos.',en:'Iconic arches and stacks.'}, lat:43.4578, lon:-3.8828, map:gglMaps('Playa de La ArnÃ­a'), images:gglImages('Playa de La ArnÃ­a')},
        {name:{es:'Playa de Covachos',en:'Covachos Beach'}, desc:{es:'TÃ³mbolo visible con marea baja.',en:'Tombolo at low tide.'}, lat:43.4547, lon:-3.8741, map:gglMaps('Playa de Covachos'), images:gglImages('Playa de Covachos')},
        {name:{es:'Virgen del Mar',en:'Virgen del Mar'}, desc:{es:'Ermita y pedreros costeros.',en:'Hermitage and rocky shore.'}, lat:43.4791, lon:-3.8407, map:gglMaps('Playa Virgen del Mar Santander'), images:gglImages('Virgen del Mar Santander')}
      ]
    },
    { slug:'puente-viesgo',
      name:{es:'Puente Viesgo (Cuevas del Monte Castillo)', en:'Puente Viesgo (Monte Castillo Caves)'},
      center:{lat:43.298, lon:-3.964},
      desc:{es:'Conjunto rupestre Patrimonio Mundial (El Castillo, Las Monedas, etc.).',
            en:'UNESCO rock-art caves (El Castillo, Las Monedasâ€¦).'},
      see:[
        {name:{es:'Cueva de El Castillo',en:'El Castillo Cave'}, desc:{es:'Manos y signos paleolÃ­ticos.',en:'Paleolithic hand stencils.'}, lat:43.2989, lon:-3.9639, map:gglMaps('Cueva de El Castillo Puente Viesgo'), images:gglImages('Cueva de El Castillo')},
        {name:{es:'Cueva de Las Monedas',en:'Las Monedas Cave'}, desc:{es:'GalerÃ­as y arte rupestre.',en:'Galleries & rock art.'}, lat:43.2997, lon:-3.9648, map:gglMaps('Cueva de Las Monedas Puente Viesgo'), images:gglImages('Cueva de Las Monedas')},
        {name:{es:'Paseo fluvial del Pas',en:'Pas River Walk'}, desc:{es:'Ruta junto al rÃ­o y balneario.',en:'Riverside walk & spa town.'}, lat:43.2972, lon:-3.9646, map:gglMaps('Puente Viesgo paseo fluvial'), images:gglImages('Puente Viesgo Pas')}
      ]
    },
    { slug:'sequoias-cabezon',
      name:{es:'Bosque de Secuoyas (CabezÃ³n)', en:'CabezÃ³n Sequoia Grove'},
      center:{lat:43.3128, lon:-4.2356},
      desc:{es:'PlantaciÃ³n de secuoyas gigante con senderos suaves. Plan familiar y fotogÃ©nico.',
            en:'Giant sequoia plantation with easy trailsâ€”great family stop.'},
      see:[
        {name:{es:'Sendero circular',en:'Loop trail'}, desc:{es:'Paseo sencillo entre gigantes.',en:'Easy walk among giants.'}, lat:43.3128, lon:-4.2356, map:gglMaps('Bosque de Secuoyas de CabezÃ³n de la Sal'), images:gglImages('Bosque de Secuoyas CabezÃ³n')}
      ]
    },
    { slug:'fontibre-ebro',
      name:{es:'Nacimiento del Ebro (Fontibre)', en:'Ebro Source (Fontibre)'},
      center:{lat:43.0218, lon:-4.1568},
      desc:{es:'Manantial simbÃ³lico del Ebro con Ã¡rea de paseo. Cerca de Reinosa y Campoo.',
            en:'Symbolic Ebro spring with short walks; near Reinosa.'},
      see:[
        {name:{es:'Manantial y parque',en:'Spring & park'}, desc:{es:'Ãrea cuidada y muy accesible.',en:'Well-kept, very accessible.'}, lat:43.0218, lon:-4.1568, map:gglMaps('Nacimiento del Ebro Fontibre'), images:gglImages('Nacimiento del Ebro Fontibre')}
      ]
    },
    { slug:'lierganes',
      name:{es:'LiÃ©rganes (Hombre Pez)', en:'LiÃ©rganes'},
      center:{lat:43.3475, lon:-3.7417},
      desc:{es:'Pueblo histÃ³rico con puente â€œromanoâ€ y leyenda del Hombre Pez. Balneario clÃ¡sico.',
            en:'Historic village with â€œRomanâ€ bridge and Hombre Pez legend.'},
      see:[
        {name:{es:'Puente Romano',en:'Roman Bridge'}, desc:{es:'Icono del pueblo sobre el Miera.',en:'Village icon over the Miera river.'}, lat:43.3477, lon:-3.7423, map:gglMaps('Puente Romano LiÃ©rganes'), images:gglImages('Puente Romano LiÃ©rganes')},
        {name:{es:'Casco histÃ³rico',en:'Old quarter'}, desc:{es:'Casonas y plazuelas con encanto.',en:'Noble houses and quaint squares.'}, lat:43.3472, lon:-3.7407, map:gglMaps('LiÃ©rganes casco histÃ³rico'), images:gglImages('LiÃ©rganes Cantabria')}
      ]
    },
    { slug:'castro-urdiales',
      name:{es:'Castro Urdiales', en:'Castro Urdiales'},
      center:{lat:43.3829, lon:-3.2204},
      desc:{es:'Ciudad costera con iglesia gÃ³tica, castillo-faro y puente medieval.',
            en:'Coastal city with Gothic church, castle-lighthouse and medieval bridge.'},
      see:[
        {name:{es:'Iglesia de Santa MarÃ­a',en:'Santa MarÃ­a Church'}, desc:{es:'GÃ³tico junto al mar.',en:'Seaside Gothic church.'}, lat:43.3826, lon:-3.2173, map:gglMaps('Iglesia de Santa MarÃ­a Castro Urdiales'), images:gglImages('Santa MarÃ­a Castro Urdiales')},
        {name:{es:'Castillo-Faro',en:'Castle-Lighthouse'}, desc:{es:'Fortaleza y faro panorÃ¡mico.',en:'Fortress with lighthouse.'}, lat:43.3822, lon:-3.2162, map:gglMaps('Castillo Faro Castro Urdiales'), images:gglImages('Castillo Faro Castro Urdiales')},
        {name:{es:'Puente Medieval',en:'Medieval Bridge'}, desc:{es:'Conecta con la Ermita de Santa Ana.',en:'Link to Santa Ana hermitage.'}, lat:43.3823, lon:-3.2169, map:gglMaps('Puente Medieval Castro Urdiales'), images:gglImages('Puente Medieval Castro Urdiales')}
      ]
    },
    { slug:'laredo',
      name:{es:'Laredo', en:'Laredo'},
      center:{lat:43.4099, lon:-3.4144},
      desc:{es:'La SalvÃ©: 5 km de playa y un casco histÃ³rico con sabor a mar.',
            en:'La SalvÃ©: 5 km of beach and a historic seafaring quarter.'},
      see:[
        {name:{es:'Playa de la SalvÃ©',en:'La SalvÃ© Beach'}, desc:{es:'Amplia y familiar.',en:'Wide and family-friendly.'}, lat:43.4099, lon:-3.4144, map:gglMaps('Playa de la SalvÃ© Laredo'), images:gglImages('Playa de la SalvÃ© Laredo')},
        {name:{es:'Puebla Vieja',en:'Old Town'}, desc:{es:'Calles medievales y casas nobles.',en:'Medieval lanes and noble houses.'}, lat:43.4106, lon:-3.4165, map:gglMaps('Puebla Vieja Laredo'), images:gglImages('Puebla Vieja Laredo')}
      ]
    },
    { slug:'faro-ajo',
      name:{es:'Faro de Ajo (Bareyo)', en:'Ajo Lighthouse'},
      center:{lat:43.4878, lon:-3.6286},
      desc:{es:'Punta de Cabo de Ajo: faro y acantilados con vistas a la costa oriental.',
            en:'Headland lighthouse with sweeping coastal views.'},
      see:[
        {name:{es:'Faro y acantilados',en:'Lighthouse & cliffs'}, desc:{es:'Paseo fÃ¡cil hasta el faro.',en:'Easy walk to the lighthouse.'}, lat:43.4878, lon:-3.6286, map:gglMaps('Faro de Ajo Bareyo'), images:gglImages('Faro de Ajo')}
      ]
    },
    { slug:'val-san-vicente',
      name:{es:'Val de San Vicente (PechÃ³n â€“ BerellÃ­n)', en:'Val de San Vicente (PechÃ³n â€“ BerellÃ­n)'},
      center:{lat:43.3776, lon:-4.5118},
      desc:{es:'Costa occidental con calas espectaculares y miradores a Picos.',
            en:'Western coast with stunning coves and Picos views.'},
      see:[
        {name:{es:'Mirador de PechÃ³n',en:'PechÃ³n Viewpoint'}, desc:{es:'Vista a Tina Menor y Mayor.',en:'Views over Tina Menor & Mayor.'}, lat:43.3776, lon:-4.5118, map:gglMaps('Mirador de PechÃ³n'), images:gglImages('PechÃ³n Cantabria')},
        {name:{es:'Playa de BerellÃ­n (Prellezo)',en:'BerellÃ­n Beach'}, desc:{es:'Calas turquesa y arcos rocosos.',en:'Turquoise coves & rock arches.'}, lat:43.3821, lon:-4.4911, map:gglMaps('Playa de BerellÃ­n'), images:gglImages('Playa de BerellÃ­n')}
      ]
    }
  ];

  /* ==== GASTRONOMÃA (ampliada) ==== */
  var FOOD=[{name:{es:'Anchoas de SantoÃ±a',en:'SantoÃ±a Anchovies',fr:'Anchois de SantoÃ±a',de:'Sardellen aus SantoÃ±a',nl:'Ansjovis uit SantoÃ±a'},
     desc:{es:'Filetes en salazÃ³n y aceite, icono del litoral oriental.', en:'Salt-cured fillets in olive oil; eastern coast icon.'}},
    {name:{es:'Sobaos pasiegos',en:'Sobaos Pasiegos',fr:'Sobaos pasiegos',de:'Sobaos Pasiegos',nl:'Sobaos Pasiegos'},
     desc:{es:'Bizcocho de mantequilla con IGP de los Valles Pasiegos.', en:'Buttery sponge cake (PGI) from Pasiego valleys.'}},
    {name:{es:'Quesada pasiega',en:'Quesada Pasiega',fr:'Quesada pasiega',de:'Quesada Pasiega',nl:'Quesada Pasiega'},
     desc:{es:'Postre horneado de leche y queso fresco.', en:'Baked dessert made with milk and fresh cheese.'}},
    {name:{es:'Cocido montaÃ±Ã©s',en:'Cocido MontaÃ±Ã©s',fr:'Cocido montaÃ±Ã©s',de:'Cocido MontaÃ±Ã©s',nl:'Cocido MontaÃ±Ã©s'},
     desc:{es:'Guiso de alubia blanca y berza; contundente y tradicional.', en:'Hearty white-bean & greens stew.'}},
    {name:{es:'Cocido lebaniego',en:'LiÃ©bana Stew'},
     desc:{es:'Garbanzos, compango y relleno; potencia montaÃ±esa.', en:'Chickpeas, meats and â€œrellenoâ€ from the mountain valleys.'}},
    {name:{es:'Queso PicÃ³n Bejes-Tresviso (DOP)',en:'PicÃ³n Bejes-Tresviso (PDO)'},
     desc:{es:'Azul intenso afinado en cuevas de LiÃ©bana.', en:'Intense blue matured in LiÃ©bana caves.'}},
    {name:{es:'Queso Nata de Cantabria (DOP)',en:'Nata de Cantabria cheese (PDO)'},
     desc:{es:'Pasta prensada, sabor lÃ¡cteo suave.', en:'Pressed cheese with creamy dairy notes.'}},
    {name:{es:'Rabas',en:'Rabas (fried squid)'},
     desc:{es:'Tiras de calamar rebozadas, clÃ¡sico del aperitivo.', en:'Battered squid strips; bar classic.'}},
    {name:{es:'Bonito del Norte & marmita',en:'Albacore & â€œmarmitaâ€'},
     desc:{es:'Temporada veraniega; guiso marinero con patata.', en:'Summer albacore; sailorâ€™s potato stew.'}},
    {name:{es:'Orujo de LiÃ©bana',en:'Orujo from LiÃ©bana'},
     desc:{es:'Aguardiente tradicional de los valles.', en:'Traditional pomace brandy.'}},
    {name:{es:'Corbatas de Unquera',en:'Unquera â€œCorbatasâ€'},
     desc:{es:'Hojaldre glaseado en forma de pajarita.', en:'Glazed puff-pastry â€œbow tiesâ€.'}},
    {name:{es:'Leche frita',en:'Fried milk dessert'},
     desc:{es:'Dulce cremoso rebozado con azÃºcar y canela.', en:'Creamy dessert coated with sugar & cinnamon.'}},
    {name:{es:'Almejas a la marinera',en:'Clams â€œa la marineraâ€'},
     desc:{es:'Salsa de vino, ajo y perejil; puro CantÃ¡brico.', en:'White wine, garlic & parsley sauce.'}},
    {name:{es:'Carne de vaca Tudanca',en:'Tudanca beef'},
     desc:{es:'Raza autÃ³ctona; sabor intenso y textura firme.', en:'Local cattle breed; deep flavor.'}}];

  /* ==== Favoritos del equipo (con distancias) ==== */
  var FAVS={pueblos:[
      {name:'Santander', desc:'Capital abierta a la bahÃ­a, cultura contemporÃ¡nea y playas urbanas; ideal para combinar museo y paseo marÃ­timo en el mismo dÃ­a.', lat:43.4623, lon:-3.8099, map:gglMaps('Santander Cantabria'), images:gglImages('Santander Cantabria')},
      {name:'Comillas', desc:'Arquitectura modernista (GaudÃ­), palacios y playa coqueta; tamaÃ±o perfecto para una tarde completa.', lat:43.3857, lon:-4.2922, map:gglMaps('Comillas'), images:gglImages('Comillas')},
      {name:'San Vicente de la Barquera', desc:'Ambiente marinero, puentes medievales y vistas a Picos. Mariscos top.', lat:43.3856, lon:-4.3987, map:gglMaps('San Vicente de la Barquera'), images:gglImages('San Vicente de la Barquera')},
      {name:'Ruente', desc:'Pueblo tranquilo del valle de CabuÃ©rniga, famosa Fuentona y bosque cercano.', lat:43.2922, lon:-4.2465, map:gglMaps('Ruente Cantabria'), images:gglImages('Ruente Cantabria')},
      {name:'Isla', desc:'PequeÃ±o nÃºcleo costero con calas alrededor del Hotel Astuy y paseos fÃ¡ciles.', lat:43.4866, lon:-3.5178, map:gglMaps('Isla Cantabria'), images:gglImages('Isla Cantabria')},
      {name:'Santillana del Mar', desc:'Conjunto medieval con casonas y la colegiata; a un paso de Altamira.', lat:43.3904, lon:-4.1097, map:gglMaps('Santillana del Mar'), images:gglImages('Santillana del Mar')},
      {name:'Soba', desc:'Valle alto con cascadas y puertos de montaÃ±a; naturaleza salvaje.', lat:43.2, lon:-3.6, map:gglMaps('Soba Cantabria'), images:gglImages('Valle de Soba')},
      {name:'Arredondo', desc:'Capital del mundo espeleolÃ³gico; cuevas y paisajes kÃ¡rsticos.', lat:43.266, lon:-3.6, map:gglMaps('Arredondo Cantabria'), images:gglImages('Arredondo Cantabria')},
      {name:'Ramales de la Victoria', desc:'Puerta a Covalanas y Cullalvera; base ideal para el Alto AsÃ³n.', lat:43.263, lon:-3.465, map:gglMaps('Ramales de la Victoria'), images:gglImages('Ramales de la Victoria')},
      {name:'Castro Urdiales', desc:'Conjunto gÃ³tico junto al mar y paseo agradable todo el aÃ±o.', lat:43.3829, lon:-3.2204, map:gglMaps('Castro Urdiales'), images:gglImages('Castro Urdiales')}
    ],
    actividades:[
      {name:'Parque de la Naturaleza de CabÃ¡rceno', desc:'Fauna en semilibertad, telecabinas panorÃ¡micas y rutas seÃ±alizadas para pasar el dÃ­a.', lat:43.3479, lon:-3.8313, map:gglMaps('Parque de CabÃ¡rceno'), images:gglImages('CabÃ¡rceno'), tickets:'https://entradas.parquedecabarceno.com/'},
      {name:'Cueva El Soplao', desc:'Formaciones Ãºnicas (excÃ©ntricas) y opciÃ³n de visita aventura; combinaciÃ³n perfecta con miradores costeros.', lat:43.3154, lon:-4.3985, map:gglMaps('Cueva El Soplao'), images:gglImages('Cueva El Soplao'), tickets:'https://www.elsoplao.es/'},
      {name:'Nacimiento del rÃ­o AsÃ³n', desc:'Imponente cascada tipo â€œcola de caballoâ€; mejor en Ã©poca hÃºmeda.', lat:43.2581, lon:-3.6276, map:gglMaps('Nacimiento del rÃ­o AsÃ³n'), images:gglImages('Cascada AsÃ³n')},
      {name:'Ruta de los acantilados â€“ San Vicente', desc:'Senda litoral hasta el faro con vistas abiertas al CantÃ¡brico.', lat:43.3926, lon:-4.3979, map:gglMaps('Acantilados San Vicente de la Barquera'), images:gglImages('Acantilados San Vicente')},
      {name:'Ruta de la Dama Roja (interior)', desc:'Itinerario seÃ±alizado (R1) que arranca en Ramales y enlaza las bocas de Cullalvera, Baranda, Covalanas (visita guiada con reserva) y El MirÃ³n, donde se hallÃ³ la famosa â€œDama Rojaâ€. Subida inicial sostenida y regreso cÃ³modo por pistas y senderos entre hayedos y calizas. Ideal para entender el karst del Alto AsÃ³n. La entrada a cuevas solo es posible en visitas oficiales.', lat:43.263, lon:-3.465, map:gglMaps('Ruta de la Dama Roja Cantabria'), images:gglImages('Ruta de la Dama Roja')},
      {name:'Ruta de la Cascada de LamiÃ±a', desc:'Paseo boscoso asequible hasta pozas y pequeÃ±as cascadas.', lat:43.2648, lon:-4.2289, map:gglMaps('Cascadas de LamiÃ±a'), images:gglImages('Cascadas de LamiÃ±a')}
    ],
    playas:[
      {name:'Playa de Gerra y MerÃ³n', desc:'KilÃ³metros de arena junto a San Vicente; surf y paseos infinitos.', lat:43.3953, lon:-4.3876, map:gglMaps('Playa de Gerra'), images:gglImages('Playa de Gerra')},
      {name:'Playa de Oyambre', desc:'Dentro del Parque Natural; dunas y estuario. Postales aseguradas.', lat:43.392, lon:-4.362, map:gglMaps('Playa de Oyambre'), images:gglImages('Playa de Oyambre')},
      {name:'Playa de MataleÃ±as', desc:'Cala urbana con acceso por escaleras; agua clara y entorno verde.', lat:43.489, lon:-3.783, map:gglMaps('Playa de MataleÃ±as'), images:gglImages('Playa de MataleÃ±as')},
      {name:'Dunas de Liencres', desc:'Dos arenales y bocas del Pas; ideal para familias y atardeceres.', lat:43.4415, lon:-3.9678, map:gglMaps('Dunas de Liencres'), images:gglImages('Dunas de Liencres')},
      {name:'El Puntal de Somo', desc:'Lengua de arena frente a Santander; plan de barca + playa top.', lat:43.4523, lon:-3.7455, map:gglMaps('El Puntal Somo'), images:gglImages('El Puntal Somo')},
      {name:'Playa de la SalvÃ© (Laredo)', desc:'5 km de paseo; chiringuitos y ambiente veraniego clÃ¡sico.', lat:43.4099, lon:-3.4144, map:gglMaps('Playa de la SalvÃ© Laredo'), images:gglImages('Playa de la SalvÃ© Laredo')},
      {name:'Playa de Gulpiyuri (Asturias)', desc:'Curiosidad geolÃ³gica cercana: playa interior conectada por tÃºnel.', lat:43.4482, lon:-4.9052, map:gglMaps('Playa de Gulpiyuri'), images:gglImages('Playa de Gulpiyuri')}
    ],
    restaurantes:[
      {name:'Taberna El Cardeo â€” del equipo', team:true, desc:'Nuestra taberna en Ruiloba: desayunos completos, cocina casera y raciones generosas. Ideal para reponer fuerzas tras una ruta por la costa occidental.', lat:43.391, lon:-4.274, map:gglMaps('Taberna El Cardeo'), images:gglImages('Taberna El Cardeo')},
      {name:'Restaurante Camping Ramales â€” del equipo', team:true, desc:'Parrilla, platos de cuchara y ambiente montaÃ±Ã©s. Perfecto tras explorar Covalanas, Cullalvera o el Nacimiento del AsÃ³n.', lat:43.263, lon:-3.465, map:gglMaps('Restaurante Camping Ramales'), images:gglImages('Camping Ramales restaurante')},
      {name:'Restaurante Camping El Helguero â€” del equipo', team:true, desc:'Cocina familiar en plena naturaleza, con opciones para peques y terraza agradable.', lat:43.387, lon:-4.264, map:gglMaps('Camping El Helguero restaurante'), images:gglImages('Camping El Helguero restaurante')},
      {name:'Restaurante El Remedio', desc:'Sobre el acantilado en Ruiloba, vistas espectaculares y producto del CantÃ¡brico tratado con mimo.', lat:43.3989, lon:-4.2826, map:gglMaps('Restaurante El Remedio Ruiloba'), images:gglImages('Restaurante El Remedio Ruiloba')},
      {name:'Bodega de Miradorio', desc:'Proyecto vitivinÃ­cola local con vistas y cocina que acompaÃ±aâ€”plan redondo entre mar y viÃ±edo.', lat:43.397, lon:-4.298, map:gglMaps('Bodega de Miradorio'), images:gglImages('Bodega de Miradorio')},
      {name:'Restaurante Las Redes', desc:'ClÃ¡sico marinero en San Vicente: marisco y pescados de lonja en sala acogedora.', lat:43.3905, lon:-4.401, map:gglMaps('Restaurante Las Redes San Vicente'), images:gglImages('Restaurante Las Redes San Vicente')},
      {name:'Restaurante Boga-Boga', desc:'Asador y producto de temporada; punto de encuentro gastronÃ³mico en la zona occidental.', lat:43.386, lon:-4.4, map:gglMaps('Restaurante Boga-Boga San Vicente'), images:gglImages('Restaurante Boga-Boga San Vicente')},
      {name:'Casa CofiÃ±o', desc:'Cocina tradicional lebaniega con bodega mÃ­tica; parada obligatoria.', lat:43.3123, lon:-4.4419, map:gglMaps('Casa CofiÃ±o'), images:gglImages('Casa CofiÃ±o')},
      {name:'La OstrerÃ­a', desc:'Especialistas en marisco con temporada de ostra y preparaciones modernas que dejan hablar al producto.', lat:43.458, lon:-3.454, map:gglMaps('La OstrerÃ­a SantoÃ±a'), images:gglImages('La OstrerÃ­a SantoÃ±a')},
      {name:'Hotel-Restaurante Astuy (Isla)', desc:'Cocina marinera junto a las calas; arroces, mariscos y vistas a pie de roca.', lat:43.4867, lon:-3.5172, map:gglMaps('Hotel Restaurante Astuy Isla'), images:gglImages('Hotel Restaurante Astuy Isla')},
      {name:'Parrilla La Piscina (Isla)', desc:'Parrilla y pescados a la brasa en Isla, junto al Hotel Astuy; ambiente informal y sabroso.', lat:43.4863, lon:-3.5169, map:gglMaps('Parrilla La Piscina Isla'), images:gglImages('Parrilla La Piscina Isla')},
      {name:'La Vinoteca Santander', desc:'En el centro, con una carta dinÃ¡mica de vinos y raciones modernas.', lat:43.4627, lon:-3.8075, map:gglMaps('La Vinoteca Santander'), images:gglImages('La Vinoteca Santander')},
      {name:'El Molino de CabuÃ©rniga', desc:'Cocina creativa en un caserÃ­o de postal; producto local y tÃ©cnica contemporÃ¡nea.', lat:43.2269, lon:-4.287, map:gglMaps('El Molino de CabuÃ©rniga'), images:gglImages('El Molino de CabuÃ©rniga')},
      {name:'La Bombi (Santander)', desc:'ClÃ¡sico santanderino: pescados y mariscos con sala de toda la vida.', lat:43.4623, lon:-3.8079, map:gglMaps('La Bombi Santander'), images:gglImages('La Bombi Santander')},
      {name:'La Capitana (Santander)', desc:'Producto del mar y cocina actual en un local luminoso y cÃ©ntrico.', lat:43.4633, lon:-3.8055, map:gglMaps('Restaurante La Capitana Santander'), images:gglImages('Restaurante La Capitana Santander')},
      {name:'Restaurante Juan de la Cosa', desc:'En SantoÃ±a, recetario clÃ¡sico con pescados del CantÃ¡brico y servicio cercano.', lat:43.392, lon:-4.397, map:gglMaps('Restaurante Juan de la Cosa San Vicente'), images:gglImages('Restaurante Juan de la Cosa San Vicente')}
    ],
    miradores:[
      {name:'Mirador de la GÃ¡ndara (Soba)', desc:'Plataforma sobre el Valle del AsÃ³n; perspectiva perfecta del relieve kÃ¡rstico.', lat:43.1753, lon:-3.6387, map:gglMaps('Mirador de la GÃ¡ndara Soba'), images:gglImages('Mirador de la GÃ¡ndara Soba')},
      {name:'Mirador del rÃ­o AsÃ³n', desc:'Vistas al anfiteatro rocoso donde nace la cascada; muy fotogÃ©nico en dÃ­as claros.', lat:43.2581, lon:-3.6276, map:gglMaps('Mirador rÃ­o AsÃ³n'), images:gglImages('Mirador rÃ­o AsÃ³n')},
      {name:'La Picota (Liencres)', desc:'Colina con panorÃ¡micas a la Costa Quebrada y la rÃ­a del Pas.', lat:43.445, lon:-3.966, map:gglMaps('La Picota Liencres'), images:gglImages('La Picota Liencres')},
      {name:'Cabo de Oyambre', desc:'BalcÃ³n natural al Parque de Oyambre, con marismas y dunas.', lat:43.395, lon:-4.374, map:gglMaps('Cabo de Oyambre'), images:gglImages('Cabo de Oyambre')},
      {name:'Mirador El Remedio', desc:'PequeÃ±o mirador junto a la ermita y restaurante, sobre el CantÃ¡brico.', lat:43.3989, lon:-4.2826, map:gglMaps('Mirador El Remedio Ruiloba'), images:gglImages('Mirador El Remedio Ruiloba')},
      {name:'Santa Catalina (PeÃ±arrubia)', desc:'Pasarela espectacular sobre el Desfiladero de la Hermida.', lat:43.2753, lon:-4.5654, map:gglMaps('Mirador de Santa Catalina'), images:gglImages('Mirador de Santa Catalina')},
      {name:'EstaciÃ³n del telefÃ©rico Fuente DÃ©', desc:'EspectÃ¡culo garantizado al pie de las paredes calizas; subida imprescindible.', lat:43.144, lon:-4.8127, map:gglMaps('TelefÃ©rico Fuente DÃ©'), images:gglImages('TelefÃ©rico Fuente DÃ©')},
      {name:'Puerto de Lunada', desc:'Frontera natural con Burgos; puertos, neveros y horizontes infinitos.', lat:43.133, lon:-3.57, map:gglMaps('Puerto de Lunada'), images:gglImages('Puerto de Lunada')}]};

  function i18nTxt(obj){ return (obj && (obj[LANG]||obj.es||''))||''; }

  function renderMusts(){
    var wrap=$('#mustsAcc'); if(!wrap) return;
    var T=I18N[LANG];
    wrap.innerHTML = MUSTS.map(function(m){
      var head = esc(i18nTxt(m.name));
      var desc = esc(i18nTxt(m.desc));
      var body = '<p class="muted">'+desc+'</p>';
      if(m.see && m.see.length){
        body+='<div class="pill">ğŸ—ºï¸ '+esc(T.see||'QuÃ© ver')+'</div>';
        body+='<div class="acc" style="margin-top:8px">'+ m.see.map(function(s,i){
          var sName=esc(i18nTxt(s.name)); var sDesc=esc(i18nTxt(s.desc));
          var map = s.map?('<a class="btn sm" href="'+esc(s.map)+'" target="_blank" rel="noopener">ğŸ—ºï¸ '+esc(T.map)+'</a>'):'';
          var imgs= s.images?('<a class="btn sm" href="'+esc(s.images)+'" target="_blank" rel="noopener">ğŸ–¼ï¸ '+esc(T.images)+'</a>'):'';
          var tix = s.tickets?('<a class="btn sm" href="'+esc(s.tickets)+'" target="_blank" rel="noopener">ğŸŸï¸ <span style="font-weight:700">'+esc(T.tickets)+'</span></a>'):'';
          var dist = (s.lat&&s.lon)?distPill(s.lat,s.lon):'';
          return '<div class="acc-item"><div class="acc-h">'+sName+' <span class="right">'+dist+' <span>â–¼</span></span></div><div class="acc-b">'
                 + '<p>'+sDesc+'</p><div class="row">'+map+imgs+tix+'</div></div></div>';
        }).join('') + '</div>';
      }
      return '<div class="acc-item"><div class="acc-h" data-m="'+esc(m.slug)+'">'+head+' <span>â–¼</span></div><div class="acc-b">'+body+'</div></div>';
    }).join('');
    $all('#mustsAcc .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });
  }

  function renderFood(){
    var wrap=$('#foodAcc'); if(!wrap) return;
    wrap.innerHTML = FOOD.map(function(f){
      var name=esc(i18nTxt(f.name)||f.name||''); var desc=esc(i18nTxt(f.desc)||'');
      var imgLink=gglImages((i18nTxt(f.name)||'Cantabria')+' gastronomÃ­a');
      return '<div class="acc-item"><div class="acc-h">ğŸ´ '+name+' <span>â–¼</span></div>'
        + '<div class="acc-b"><p>'+desc+'</p><div class="row">'
        + '<a class="btn sm" href="'+esc(imgLink)+'" target="_blank" rel="noopener">ğŸ–¼ï¸ '+esc(I18N[LANG].images)+'</a>'
        + '</div></div></div>';
    }).join('');
    $all('#foodAcc .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });
  }

  function renderFavs(){
    var wrap=$('#favAcc'); if(!wrap) return;
    var cat = document.querySelector('[data-favcat].on')?.getAttribute('data-favcat') || 'pueblos';
    var list = FAVS[cat]||[];
    wrap.innerHTML = list.map(function(it){
      var dist = (it.lat&&it.lon)?distPill(it.lat,it.lon):'';
      var badge = it.team?'<span class="badge-pill" style="border-color:var(--ok)">ğŸŸ¢ del equipo</span>':'';
      var map = it.map?('<a class="btn sm" href="'+esc(it.map)+'" target="_blank" rel="noopener">ğŸ—ºï¸ '+esc(I18N[LANG].map)+'</a>'):'';
      var imgs= it.images?('<a class="btn sm" href="'+esc(it.images)+'" target="_blank" rel="noopener">ğŸ–¼ï¸ '+esc(I18N[LANG].images)+'</a>'):'';
      var tix = it.tickets?('<a class="btn sm" href="'+esc(it.tickets)+'" target="_blank" rel="noopener">ğŸŸï¸ <span style="font-weight:700">'+esc(I18N[LANG].tickets)+'</span></a>'):'';
      return '<div class="acc-item"><div class="acc-h">'+esc(it.name)+' <span class="right">'+badge+' '+dist+' <span>â–¼</span></span></div>'
           + '<div class="acc-b"><p>'+esc(it.desc)+'</p><div class="row">'+map+imgs+tix+'</div></div></div>';
    }).join('');
    $all('#favAcc .acc-h').forEach(function(h){ on(h,'click', function(){ h.parentElement.classList.toggle('open'); }); });
  }

  $all('#favTabs .btn').forEach(function(b){
    on(b,'click', function(){
      $all('#favTabs .btn').forEach(x=>x.classList.remove('on'));
      b.classList.add('on');
      renderFavs();
    });
  });

  /* ===== Admin (activar con 5 toques en el logo) ===== */
  (function adminActivator(){
    var logo=$('#logoTap'); var taps=0,timer=null;
    function askForPin(){
      var stored = localStorage.getItem('admin_pin') || '311974';
      var entered = window.prompt('Introduce la contraseÃ±a de admin:','');
      if(entered===null) return false;
      if(entered===stored) return true;
      alert('ContraseÃ±a incorrecta'); return false;
    }
    on(logo,'click', function(){
      taps++; clearTimeout(timer); timer=setTimeout(function(){taps=0},1000);
      if(taps>=5){
        taps=0;
        if(document.body.classList.contains('admin-on')){
          localStorage.setItem('admin','0'); document.body.classList.remove('admin-on'); alert('Modo admin desactivado');
        }else{
          if(!askForPin()) return;
          localStorage.setItem('admin','1'); document.body.classList.add('admin-on');
          openAdminModal(); loadEventsAdmin(); loadSchedulesAdmin(); alert('Modo admin activado');
        }
      }
    });
  })();

  function openAdminModal(){ var m=$('#adminModal'); if(m){ m.style.display='flex'; document.body.classList.add('modal-open'); } }
  function closeAdminModal(){ var m=$('#adminModal'); if(m){ m.style.display='none'; document.body.classList.remove('modal-open'); } }
  on($('#closeAdmin'),'click', function(e){ e.preventDefault(); closeAdminModal(); });
  on($('#adminModal'),'click', function(e){ if(e.target && e.target.id==='adminModal'){ closeAdminModal(); } });
  document.addEventListener('keydown', function(e){ if(e.key==='Escape'){ closeAdminModal(); } });
  on($('#openAdmin'),'click', function(){ if(!document.body.classList.contains('admin-on')) return; openAdminModal(); loadEventsAdmin(); loadSchedulesAdmin(); });

  var ADMIN_EVENTS=[];
  function slug(s){return String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'').slice(0,60);}
  function isoFromLocal(dt){ var d=new Date(dt); if(isNaN(d.getTime())) return dt; var tz=-d.getTimezoneOffset(),sign=tz>=0?'+':'-'; function p(n){return ('0'+n).slice(-2);} return d.getFullYear()+'-'+p(d.getMonth()+1)+'-'+p(d.getDate())+'T'+p(d.getHours())+':'+p(d.getMinutes())+':'+p(d.getSeconds())+sign+p(Math.floor(Math.abs(tz)/60))+':'+p(Math.abs(tz)%60); }

  function loadEventsAdmin(){
    fetch('./events.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>r.json()).then(data=>{ ADMIN_EVENTS = Array.isArray(data)?data:[]; renderAdminTable(); })
      .catch(()=>{ ADMIN_EVENTS=[]; renderAdminTable(); });
    loadGhCfgToForm();
  }
  function renderAdminTable(){
    var tbody = $('#eventsTable tbody'); if(!tbody) return;
    tbody.innerHTML = ADMIN_EVENTS.slice().sort((a,b)=>new Date(a.fecha)-new Date(b.fecha)).map(function(ev){
      var titleES=(typeof ev.titulo==='string'?ev.titulo:((ev.titulo&&ev.titulo.es)||''))||'';
      var lugarES=(typeof ev.lugar==='string'?ev.lugar:((ev.lugar&&ev.lugar.es)||''))||'';
      var dt=new Date(ev.fecha);
      var val = dt.getFullYear()+'-'+pad2(dt.getMonth()+1)+'-'+pad2(dt.getDate())+'T'+pad2(dt.getHours())+':'+pad2(dt.getMinutes());
      return '<tr data-id="'+ev.id+'">'
        + '<td class="muted" style="white-space:nowrap">'+esc(ev.id)+'</td>'
        + '<td><input class="input dt" type="datetime-local" value="'+val+'"><div class="muted">'+esc(dt.toLocaleString())+'</div></td>'
        + '<td><select class="select camp"><option value="oyambre" '+(ev.camping==='oyambre'?'selected':'')+'>oyambre</option><option value="ramales" '+(ev.camping==='ramales'?'selected':'')+'>ramales</option><option value="ruiloba" '+(ev.camping==='ruiloba'?'selected':'')+'>ruiloba</option><option value="cardeo" '+(ev.camping==='cardeo'?'selected':'')+'>cardeo</option></select>'
        + '<input class="input lugar" style="margin-top:6px" placeholder="Lugar (ES)" value="'+esc(lugarES)+'"></td>'
        + '<td><input class="input titulo" placeholder="TÃ­tulo (ES)" value="'+esc(titleES)+'">'
        + '<textarea class="textarea desc" rows="2" placeholder="DescripciÃ³n (ES)" style="margin-top:6px">'+esc(((ev.descripcion&&ev.descripcion.es)||''))+'</textarea>'
        + '<input class="input img" placeholder="Imagen (URL)" value="'+esc((ev.imagen||ev.image||''))+'" style="margin-top:6px"></td>'
        + '<td style="min-width:220px"><button class="btn act-save">Guardar</button> <button class="btn act-dup">Duplicar</button> <button class="btn act-del">Borrar</button></td>'
      + '</tr>';
    }).join('');
    $all('#eventsTable tbody tr').forEach(function(tr){
      var id = tr.getAttribute('data-id');
      on(tr.querySelector('.act-save'),'click', function(){ saveRow(tr,id); });
      on(tr.querySelector('.act-dup'),'click', function(){ duplicateRow(id); });
      on(tr.querySelector('.act-del'),'click', function(){ deleteRow(id); });
    });
  }
  function getRowValues(tr){
    return {
      dateLocal: tr.querySelector('.dt').value,
      camping: tr.querySelector('.camp').value,
      lugar: (tr.querySelector('.lugar').value||'').trim(),
      titulo: (tr.querySelector('.titulo').value||'').trim(),
      desc: (tr.querySelector('.desc').value||'').trim(),
      img: (tr.querySelector('.img').value||'').trim()
    };
  }
  function defaultLugar(p){ if(p==='oyambre')return 'Camping Caravaning Playa de Oyambre'; if(p==='ramales')return 'Camping Ramales'; if(p==='ruiloba')return 'Camping El Helguero'; if(p==='cardeo')return 'Apartamentos El Cardeo'; return ''; }
  function saveRow(tr,id){
    var v=getRowValues(tr); if(!v.titulo||!v.dateLocal||!v.camping){alert('Rellena tÃ­tulo, fecha y alojamiento.');return;}
    var idx=ADMIN_EVENTS.findIndex(e=>e.id===id); if(idx<0) return;
    ADMIN_EVENTS[idx].fecha=isoFromLocal(v.dateLocal);
    ADMIN_EVENTS[idx].camping=v.camping;
    ADMIN_EVENTS[idx].titulo={es:v.titulo};
    ADMIN_EVENTS[idx].lugar={es:v.lugar||defaultLugar(v.camping)};
    ADMIN_EVENTS[idx].descripcion={es:v.desc||''};
    if(v.img) ADMIN_EVENTS[idx].imagen=v.img; else delete ADMIN_EVENTS[idx].imagen;
    renderAdminTable();
  }
  function duplicateRow(id){
    var o=ADMIN_EVENTS.find(e=>e.id===id); if(!o) return;
    var titleES=(o.titulo&&o.titulo.es)||''; var newId='ev-'+slug(titleES)+'-'+o.camping+'-'+Date.now().toString().slice(-8);
    var copy=JSON.parse(JSON.stringify(o)); copy.id=newId; ADMIN_EVENTS.push(copy); renderAdminTable();
  }
  function deleteRow(id){ if(!confirm('Â¿Borrar este evento?')) return; ADMIN_EVENTS = ADMIN_EVENTS.filter(e=>e.id!==id); renderAdminTable(); }

  /* Schedules admin */
  function loadSchedulesAdmin(){ var a=$('#schedJsonArea'); if(!a) return; try{ a.value=JSON.stringify(SCHEDULES,null,2); }catch(e){ a.value='{}'; } }
  on($('#schedApplyBtn'),'click', function(){ var a=$('#schedJsonArea'); try{ var obj=JSON.parse(a.value); if(!obj||typeof obj!=='object') throw 0; SCHEDULES=obj; renderAcc(); renderStayHours(); alert('Horarios aplicados.'); }catch(e){ alert('JSON invÃ¡lido.'); } });
  on($('#exportSchedBtn'),'click', function(){ var blob=new Blob([JSON.stringify(SCHEDULES,null,2)],{type:'application/json'}); var url=URL.createObjectURL(blob); var a=document.createElement('a'); a.href=url; a.download='schedules.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
  on($('#importSchedFile'),'change', function(e){ var f=e.target.files && e.target.files[0]; if(!f) return; f.text().then(function(txt){ var data=JSON.parse(txt); if(!data||typeof data!=='object') throw 0; SCHEDULES=data; renderAcc(); loadSchedulesAdmin(); renderStayHours(); }).catch(function(){ alert('No se pudo leer schedules.json'); }).finally(function(){ e.target.value=''; }); });

  /* GitHub minimal (manual) */
  var GH_KEYS={repo:'ghRepo',branch:'ghBranch',token:'ghToken'};
  function loadGhCfgToForm(){ $('#ghRepo').value=localStorage.getItem(GH_KEYS.repo)||''; $('#ghBranch').value=localStorage.getItem(GH_KEYS.branch)||'main'; $('#ghToken').value=localStorage.getItem(GH_KEYS.token)||''; }
  function saveGhCfgFromForm(){ localStorage.setItem(GH_KEYS.repo,($('#ghRepo').value||'').trim()); localStorage.setItem(GH_KEYS.branch,($('#ghBranch').value||'').trim()||'main'); var t=($('#ghToken').value||'').trim(); if(t) localStorage.setItem(GH_KEYS.token,t); alert('ConfiguraciÃ³n guardada.'); }
  function ghGet(path, token){ var repo=localStorage.getItem(GH_KEYS.repo), branch=localStorage.getItem(GH_KEYS.branch)||'main'; var url='https://api.github.com/repos/'+repo+'/contents/'+encodeURIComponent(path)+'?ref='+encodeURIComponent(branch); return fetch(url,{headers:{'Authorization':'token '+(token||'').trim(),'Accept':'application/vnd.github+json','X-GitHub-Api-Version':'2022-11-28','User-Agent':'acobijo-app'}}); }
  function ghPut(path, contentBase64, message, sha, token){ var repo=localStorage.getItem(GH_KEYS.repo), branch=localStorage.getItem(GH_KEYS.branch)||'main'; var url='https://api.github.com/repos/'+repo+'/contents/'+encodeURIComponent(path); var body={message:message,content:contentBase64,branch:branch}; if(sha) body.sha=sha; return fetch(url,{method:'PUT',headers:{'Authorization':'token '+(token||'').trim(),'Accept':'application/vnd.github+json','X-GitHub-Api-Version':'2022-11-28','Content-Type':'application/json','User-Agent':'acobijo-app'},body:JSON.stringify(body)}); }
  function toB64(str){ return btoa(unescape(encodeURIComponent(str))); }
  on($('#saveGhCfg'),'click', saveGhCfgFromForm);
  on($('#pushEventsBtn'),'click', function(){
    try{
      if(!ADMIN_EVENTS.length){ alert('No hay eventos.'); return; }
      var token=(localStorage.getItem(GH_KEYS.token)||'').trim(); if(!token){alert('Configura el token.');return;}
      var sha=null;
      ghGet('events.json', token).then(function(res){ if(res.status===200){ return res.json().then(d=>{sha=d.sha;}); } });
      var jsonStr=JSON.stringify(ADMIN_EVENTS,null,2);
      var content64=toB64(jsonStr);
      var now=new Date().toISOString().slice(0,19).replace('T',' ');
      ghPut('events.json',content64,'Update events.json via in-app admin ('+now+')',sha,token).then(function(res){ if(res.ok){ alert('âœ… events.json subido.'); } else { res.text().then(txt=>alert('âŒ Error '+res.status+'\n'+txt)); }});
    }catch(err){ alert('âŒ '+err.message); }
  });
  on($('#pushSchedBtn'),'click', function(){
    try{
      var token=(localStorage.getItem(GH_KEYS.token)||'').trim(); if(!token){alert('Configura el token.');return;}
      var sha=null;
      ghGet('schedules.json', token).then(function(res){ if(res.status===200){ return res.json().then(d=>{sha=d.sha;}); } });
      var jsonStr=JSON.stringify(SCHEDULES,null,2);
      var content64=toB64(jsonStr);
      var now=new Date().toISOString().slice(0,19).replace('T',' ');
      ghPut('schedules.json',content64,'Update schedules.json via in-app admin ('+now+')',sha,token).then(function(res){ if(res.ok){ alert('âœ… schedules.json subido.'); } else { res.text().then(txt=>alert('âŒ Error '+res.status+'\n'+txt)); }});
    }catch(err){ alert('âŒ '+err.message); }
  });

  /* ===== PWA install: modal con guÃ­a ===== */
  var deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); deferredPrompt=e; });
  function platformGuide(){
    var ua=navigator.userAgent||''; var isIOS=/iP(ad|hone|od)/.test(ua); var isSafari=isIOS || (/Safari/.test(ua)&&!/Chrome/.test(ua));
    var isAndroid=/Android/i.test(ua);
    if(isIOS){
      return '<ol><li>Abre en <b>Safari</b>.</li><li>Toca <b>Compartir</b> (icono cuadrado con flecha).</li><li>Elige <b>AÃ±adir a pantalla de inicio</b>.</li><li>Confirma con <b>AÃ±adir</b>.</li></ol>';
    }else if(isAndroid){
      return '<ol><li>Abre en <b>Chrome</b>.</li><li>Toca <b>â‹®</b> > <b>AÃ±adir a pantalla de inicio</b>.</li><li>Sigue las instrucciones.</li></ol>';
    }else{
      return '<p>En el navegador de escritorio, busca <b>Instalar app</b> en la barra de direcciones o el menÃº.</p>';
    }
  }
  function openInstallModal(){
    $('#instBody').innerHTML = platformGuide();
    $('#installModal').style.display='flex'; document.body.classList.add('modal-open');
  }
  on($('#installTile'),'click', openInstallModal);
  on($('#closeInstall'),'click', function(e){ e.preventDefault(); $('#installModal').style.display='none'; document.body.classList.remove('modal-open'); });
  on($('#instNow'),'click', function(){
    if(deferredPrompt){ try{ deferredPrompt.prompt(); deferredPrompt.userChoice && deferredPrompt.userChoice.then(function(){}); }catch(e){} deferredPrompt=null; }
    else alert('Si no aparece el diÃ¡logo, usa los pasos indicados arriba.');
  });

  /* ===== Pre-checkin ===== */
  function compTpl(i){
    return '<div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px;margin-top:6px" data-cidx="'+i+'">'
      +'<div><label>Nombre</label><input class="input c-name" placeholder="Nombre"></div>'
      +'<div><label>Apellidos</label><input class="input c-surname" placeholder="Apellidos"></div>'
      +'<div><label>DNI / Pasaporte</label><input class="input c-id" placeholder="DNI o Pasaporte"></div>'
      +'<div><label>Fecha de nacimiento</label><input class="input c-birth" type="date"></div>'
      +'<div><button type="button" class="btn sm c-del">ğŸ—‘ï¸ Eliminar</button></div>'
      +'</div>';
  }
  var compIdx=0;
  function wireCompRow(row){
    var btn=row.querySelector('.c-del');
    if(btn){
      on(btn,'click',function(){
        row.parentElement.removeChild(row);
      });
    }
  }
  on($('#addComp'),'click', function(){
    compIdx++;
    var cont=$('#companions');
    var wrapper=document.createElement('div');
    wrapper.innerHTML=compTpl(compIdx);
    var row=wrapper.firstChild;
    cont.appendChild(row);
    wireCompRow(row);
    alert(I18N[LANG].preAdded || 'AcompaÃ±ante aÃ±adido');
  });

  function buildPreMsg(){
    var place=$('#prePlace').value||STAY;
    var placeLabel=PLACE_LABEL[place]||place;
    var name=$('#preName').value||'';
    var surname=$('#preSurname').value||'';
    var id=$('#preId').value||'';
    var birth=$('#preBirth').value||'';
    var plate=$('#prePlate').value||'';
    var comps=[];
    $all('#companions [data-cidx]').forEach(function(row){
      comps.push({
        name:row.querySelector('.c-name').value||'',
        surname:row.querySelector('.c-surname').value||'',
        id:row.querySelector('.c-id').value||'',
        birth:row.querySelector('.c-birth').value||''
      });
    });
    var T=I18N[LANG];
    var subject='[Pre-checkin] '+placeLabel;
    var body='Datos de pre-checkin para '+placeLabel+':\n\nTitular:\nNombre: '+name+'\nApellidos: '+surname+'\nDocumento: '+id+'\nFecha de nacimiento: '+birth+'\nMatrÃ­cula: '+plate+'\n\nAcompaÃ±antes:\n';
    if(!comps.length){ body+='(sin acompaÃ±antes indicados)\n'; }
    else{
      comps.forEach(function(c,i){
        body+='-'+(i+1)+': '+c.name+' '+c.surname+' Â· '+c.id+' Â· '+c.birth+'\n';
      });
    }
    body+='\n\nEnviado desde la app de '+T.app+'.';
    return {place:place, subject:subject, body:body};
  }
  on($('#sendPreBtn'),'click', function(){
    var data=buildPreMsg();
    var mail=EMAILS[data.place];
    var url='mailto:'+mail+'?subject='+encodeURIComponent(data.subject)+'&body='+encodeURIComponent(data.body);
    location.href=url;
  });

  /* ===== Inicializar ===== */
  renderAcc();
  loadSchedules();
  loadEvents();
  renderMusts();
  renderFood();
  renderFavs();
  updateStayUI();
  updateIncUI();
  updateSugUI();

});
</script>
</body>
</html>
