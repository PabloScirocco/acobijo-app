<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Grupo A Cobijo</title>
<meta name="description" content="App de experiencia del cliente: eventos, horarios y accesos del Grupo A Cobijo.">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0ea5e9">
<link rel="icon" href="assets/icons/icon-192.png">
<link rel="apple-touch-icon" href="assets/icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
:root{
  --bg:#ffffff; --ink:#0a1a2a; --muted:#6b7280; --line:#e6eef7;
  --brand:#0ea5e9; --brand-ink:#063e63; --card:#f7fbff; --tint:#eef7ff;
  --wx1:#e9f6ff; --wx2:#d9efff; --wx3:#cce7ff; --wx4:#bfe0ff;
}
body.dark{
  --bg:#0b1220; --ink:#e8eef7; --muted:#8fa2bd; --line:#1e2a40;
  --brand:#22b2ff; --brand-ink:#bfe7ff; --card:#111a2a; --tint:#0f1a2b;
  --wx1:#0f1f35; --wx2:#102640; --wx3:#0f2b4a; --wx4:#0c3156;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink);background:var(--bg);transition:background-color .15s,color .15s}
img{max-width:100%;height:auto}
.hero img{height:64px;width:auto;max-width:160px}

/* Topbar */
.topbar{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#e6f6ff,#ffffff);
  border-bottom:1px solid var(--line);display:flex;align-items:center;gap:.75rem;padding:.7rem .9rem}
body.dark .topbar{background:linear-gradient(180deg,#0e1a2c,#0b1220)}
.topbar .burger{border:none;background:#fff;border:1px solid var(--line);border-radius:10px;padding:.45rem .55rem;cursor:pointer}
body.dark .topbar .burger{background:#0f1a2b}
.topbar .brand{display:flex;align-items:center;gap:.6rem}
.topbar img{height:40px;width:auto;object-fit:contain}
.topbar h1{font-size:1rem;margin:0}
.lang-btn,.theme-btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:.35rem .6rem;cursor:pointer}
body.dark .lang-btn, body.dark .theme-btn{background:#0f1a2b}

/* Drawer */
.drawer{position:fixed;inset:0;z-index:30;display:none}
.drawer.open{display:block}
.drawer .back{position:absolute;inset:0;background:rgba(0,0,0,.35)}
.drawer .panel{position:absolute;inset:0 auto 0 0;width:min(86vw,320px);background:#fff;border-right:1px solid var(--line);
  padding:14px;display:flex;flex-direction:column;gap:8px}
body.dark .drawer .panel{background:#0f1a2b}
.drawer .item{display:flex;gap:.6rem;align-items:center;border:1px solid var(--line);border-radius:12px;padding:.6rem .7rem;background:var(--tint);cursor:pointer}
.drawer .muted{color:var(--muted);font-size:.85rem}
.drawer .item.admin-btn{display:none !important;}
.admin-on .drawer .item.admin-btn{display:flex !important;}

/* Main, views */
main{padding:12px 12px 76px;max-width:980px;margin:0 auto}
.view{display:none;animation:fade .15s ease-out}
.view.active{display:block}
@keyframes fade{from{opacity:.6; transform:translateY(4px);}to{opacity:1; transform:none;}}

/* Home */
.hero{position:relative;border:1px solid var(--line);border-radius:18px;overflow:hidden;background:
  radial-gradient(120% 80% at 100% 0%,#b7e6ff 0%,#e6f6ff 50%,#ffffff 100%)}
body.dark .hero{background:radial-gradient(120% 80% at 100% 0%,#143356 0%,#0f2239 50%,#0b1220 100%)}
.hero-inner{display:flex;align-items:center;gap:14px;padding:16px}
.hero h2{margin:0;font-size:1.3rem}

/* Tiles */
.tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:12px}
.tile{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:6px;
  align-items:flex-start;cursor:pointer;box-shadow:0 8px 24px rgba(14,165,233,.06)}
.tile .big{font-size:1.6rem}
.tile .muted{color:var(--muted);font-size:.86rem}
.tile:active{transform:scale(.98)}

.hscroll{display:flex;gap:10px;overflow:auto;padding-bottom:6px;scrollbar-gutter:stable both-edges}
.card{min-width:260px;flex:0 0 auto;background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px}
body.dark .card{background:#0f1a2b}
.card img{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;border:1px solid var(--line);background:#f2f6fb}
.card .title{font-weight:700;margin-top:6px}
.card .meta{font-size:.85rem;color:var(--muted)}
.row{display:flex;flex-wrap:wrap;gap:6px}

/* Buttons */
.btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:10px;padding:.46rem .66rem;cursor:pointer;font-weight:600;color:var(--ink)}
body.dark .btn{background:#0f1a2b}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
.btn.sm{padding:.32rem .5rem;font-size:.82rem}
.btn.ghost{background:transparent;border-color:var(--line);color:var(--muted)}
body.dark .btn.ghost{background:transparent}

/* Grids */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}

/* Chips */
.chip{border-radius:999px}

/* Accordeon horarios */
.acc{display:flex;flex-direction:column;gap:8px}
.acc-item{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#fff}
body.dark .acc-item{background:#0f1a2b}
.acc-h{display:flex;justify-content:space-between;align-items:center;padding:.7rem .8rem;cursor:pointer;background:var(--tint)}
.acc-b{display:none;padding:.8rem}
.acc-item.open .acc-b{display:block}

/* Bottom nav */
.navbar{position:fixed;left:0;right:0;bottom:0;z-index:25;background:#fff;border-top:1px solid var(--line);display:grid;grid-template-columns:repeat(5,1fr)}
body.dark .navbar{background:#0f1a2b}
.navbtn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 4px;border:none;background:transparent;cursor:pointer;font-size:.8rem;color:var(--muted)}
.navbtn.active{color:var(--brand-ink);font-weight:700}
.navbtn .ico{font-size:1.1rem}

/* Modal base */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:1000}
.modal{width:min(92vw,920px);max-height:88vh;overflow:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;
  background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.2)}
body.dark .modal{background:#0f1a2b}
.close{background:transparent;border:none;color:var(--muted);font-weight:700;cursor:pointer;font-size:1.6rem;line-height:1;padding:.25rem .5rem;border-radius:10px;float:right}
.close:active{transform:scale(.95)}
body.modal-open{overflow:hidden}

/* Inputs */
.input,.select,. .textarea{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff}
.textarea{min-height:96px}

/* Weather */
.wx{border:1px solid var(--line);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,var(--wx2),var(--wx1));padding:12px}
.wx-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.wx-today{display:grid;grid-template-columns:80px 1fr;gap:10px;align-items:center;background:linear-gradient(180deg,var(--wx4),var(--wx2));border:1px solid var(--line);border-radius:14px;padding:10px}
.wx-ico{font-size:2.2rem}
.wx-deg{font-size:2rem;font-weight:800}
.wx-minmax{font-size:.9rem;color:var(--muted)}
.wx-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.wx-day{border:1px solid var(--line);border-radius:12px;padding:8px;text-align:center;background:linear-gradient(180deg,var(--wx2),var(--wx1))}
.wx-day .d{font-weight:700}
.wx-day .t{font-size:.9rem}

/* Musts */
.must-card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px}
body.dark .must-card{background:#0f1a2b}
.must-card img{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;border:1px solid var(--line)}
.must-title{font-weight:800;margin:6px 0 2px}
.must-summary{color:var(--muted);font-size:.92rem}
.must-list li{margin:.2rem 0}
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px;margin-top:10px}
.gallery img{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:10px;border:1px solid var(--line)}

/* Placeholder cuando no hay foto */
.ph{width:100%;aspect-ratio:16/9;border-radius:10px;border:1px solid var(--line);
  display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,#f0f7ff,#e7f1ff);}
body.dark .ph{background:linear-gradient(135deg,#0e1a2c,#0b1220)}
.ph span{font-size:2rem;opacity:.9}
.ph.sm{aspect-ratio:4/3;margin:6px 0}
</style>
</head>
<body>

<!-- Topbar -->
<header class="topbar">
  <button id="menuBtn" class="burger" aria-label="Abrir menÃº">â˜°</button>
  <div class="brand">
    <img src="assets/logo.png" alt="Grupo A Cobijo" id="logoTap">
    <h1 id="t-app">Grupo A Cobijo</h1>
  </div>
  <div style="flex:1"></div>
  <button class="theme-btn" id="themeBtn" title="Tema" aria-label="Cambiar tema">ğŸŒ™</button>
  <button class="lang-btn" id="langBtn" aria-haspopup="dialog">ğŸŒ ES</button>
</header>

<!-- Drawer -->
<div class="drawer" id="drawer">
  <div class="back" id="drawerBack"></div>
  <aside class="panel" role="menu" aria-label="NavegaciÃ³n">
    <div class="item" data-nav="home">ğŸ  <strong id="d-home">Inicio</strong></div>
    <div class="item" data-nav="stay">ğŸ§³ <strong id="d-stay">Mi estancia</strong></div>
    <div class="item" data-nav="incidents">ğŸ†˜ <strong id="d-inc">Incidencias</strong></div>
    <div class="item" data-nav="events">ğŸ“… <strong id="d-ev">Eventos</strong></div>
    <div class="item" data-nav="musts">â­ <strong id="d-musts">Imprescindibles</strong></div>
    <div class="item" data-nav="places">ğŸ•ï¸ <strong id="d-pl">Campings</strong></div>
    <div class="item" data-nav="schedules">ğŸ•’ <strong id="d-sc">Horarios</strong></div>
    <div class="item admin-btn" id="openAdmin">ğŸ› ï¸ <strong>Admin</strong></div>
    <div class="muted" id="drawerHint">Elige secciÃ³n</div>
  </aside>
</div>

<main>
  <!-- HOME -->
  <section id="view-home" class="view active">
    <div class="hero">
      <div class="hero-inner">
        <img src="assets/logo.png" alt="A Cobijo">
        <div>
          <h2 id="t-hello">Â¡Bienvenido!</h2>
        </div>
      </div>
      <div class="tiles">
        <div class="tile" data-nav="events"><div class="big">ğŸ“…</div><div><strong id="t-ev">Eventos</strong><div class="muted" id="t-ev-sub">QuÃ© hay hoy</div></div></div>
        <div class="tile" data-nav="stay"><div class="big">ğŸ§³</div><div><strong id="t-stay">Mi estancia</strong><div class="muted" id="t-stay-sub">Contactos, clima, horarios</div></div></div>
        <div class="tile" data-nav="incidents"><div class="big">ğŸ†˜</div><div><strong id="t-inc">Incidencias</strong><div class="muted" id="t-inc-sub">WhatsApp/Email directos</div></div></div>
        <div class="tile" data-nav="musts"><div class="big">â­</div><div><strong id="t-musts">Imprescindibles</strong><div class="muted" id="t-musts-sub">QuÃ© ver en Cantabria</div></div></div>
        <div class="tile" data-nav="places"><div class="big">ğŸ•ï¸</div><div><strong id="t-pl">Campings</strong><div class="muted" id="t-pl-sub">Accesos rÃ¡pidos</div></div></div>
        <div class="tile" id="installTile"><div class="big">â¬‡ï¸</div><div><strong id="t-inst">Instalar</strong><div class="muted" id="t-inst-sub">AÃ±adir a inicio</div></div></div>
      </div>
    </div>

    <h3 style="margin:14px 4px 8px" id="t-next-events">PrÃ³ximos eventos</h3>
    <div id="homeEvents" class="hscroll"></div>
  </section>

  <!-- MI ESTANCIA -->
  <section id="view-stay" class="view">
    <h2 id="t-stay-title">Mi estancia</h2>
    <p class="muted" id="t-stay-hint">Guardamos tu elecciÃ³n en este dispositivo.</p>

    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(240px,1fr))">
      <div>
        <label for="stayPlace" style="font-weight:700" id="t-stay-which">Selecciona tu alojamiento</label>
        <select id="stayPlace" class="select">
          <option value="oyambre">Oyambre</option>
          <option value="ramales">Ramales</option>
          <option value="ruiloba">Ruiloba</option>
          <option value="cardeo">El Cardeo</option>
        </select>
      </div>
      <div class="row" style="align-items:flex-end">
        <button id="stayWeb" class="btn">Web</button>
        <a id="stayCall" class="btn" target="_blank" rel="noopener">Llamar</a>
        <a id="stayWA" class="btn" target="_blank" rel="noopener">WhatsApp</a>
        <a id="stayEmail" class="btn" target="_blank" rel="noopener">Email</a>
        <a id="stayDir" class="btn" target="_blank" rel="noopener">CÃ³mo llegar</a>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3 id="t-stay-hours">Horarios del alojamiento</h3>
      <div id="stayHours"></div>
    </div>

    <div class="wx" style="margin-top:12px" id="stayWeather">
      <div class="wx-h">
        <h3 id="t-weather-title" style="margin:0">Clima</h3>
        <div class="muted" id="wxPlaceLabel">â€”</div>
      </div>
      <div class="wx-today">
        <div class="wx-ico" id="wxIco">â˜€ï¸</div>
        <div>
          <div class="wx-deg"><span id="wxNow">--</span>Â°</div>
          <div class="wx-minmax"><span id="t-max">MÃ¡x</span>: <span id="wxMax">--</span>Â° Â· <span id="t-min">MÃ­n</span>: <span id="wxMin">--</span>Â°</div>
          <div class="muted" id="wxDesc">â€”</div>
        </div>
      </div>
      <div class="wx-3">
        <div class="wx-day"><div class="d" id="d1">â€”</div><div class="i" id="i1">â˜€ï¸</div><div class="t" id="t1">--/--Â°</div></div>
        <div class="wx-day"><div class="d" id="d2">â€”</div><div class="i" id="i2">â˜€ï¸</div><div class="t" id="t2">--/--Â°</div></div>
        <div class="wx-day"><div class="d" id="d3">â€”</div><div class="i" id="i3">â˜€ï¸</div><div class="t" id="t3">--/--Â°</div></div>
      </div>
    </div>
  </section>

  <!-- INCIDENCIAS -->
  <section id="view-incidents" class="view">
    <h2 id="i-title">Incidencias</h2>
    <p class="muted" id="i-hint">Se abre WhatsApp o tu app de correo con el mensaje preparado.</p>

    <div class="card" style="background:var(--tint)">
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
        <div>
          <label style="font-weight:700" for="incPlace" id="i-where">Â¿En quÃ© alojamiento estÃ¡s?</label>
          <select id="incPlace" class="select">
            <option value="oyambre">Oyambre</option>
            <option value="ramales">Ramales</option>
            <option value="ruiloba">Ruiloba</option>
            <option value="cardeo">El Cardeo</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700" for="incType" id="i-type">Tipo de incidencia</label>
          <select id="incType" class="select">
            <option value="Electricidad">Electricidad</option>
            <option value="Agua">Agua</option>
            <option value="Limpieza">Limpieza</option>
            <option value="Ruido">Ruido</option>
            <option value="Otros">Otros</option>
          </select>
        </div>
      </div>
      <div style="margin-top:10px">
        <label style="font-weight:700" for="incMsg" id="i-msg">Describe brevemente el problema</label>
        <textarea id="incMsg" class="textarea" placeholder="Ej.: Sin luz en la parcela 24, desde las 21:15..."></textarea>
      </div>
      <div class="row" style="margin-top:10px">
        <a id="incWA" class="btn primary" target="_blank" rel="noopener">WhatsApp</a>
        <a id="incEmail" class="btn" target="_blank" rel="noopener">Email</a>
      </div>
    </div>
  </section>

  <!-- EVENTOS -->
  <section id="view-events" class="view">
    <h2 id="t-events-title">Eventos</h2>
    <div class="row" style="gap:8px;margin:10px 0">
      <button class="btn chip on" data-filter="all" id="f-all">Todos</button>
      <button class="btn chip" data-filter="today" id="f-today">Hoy</button>
      <button class="btn chip" data-filter="tomorrow" id="f-tomorrow">MaÃ±ana</button>
      <button class="btn chip" data-filter="week" id="f-week">Esta semana</button>
      <button class="btn chip" data-filter="fav" id="f-fav">Favoritos</button>
    </div>
    <div class="row" style="gap:8px;margin:6px 0">
      <button class="btn chip on" data-camp="all" id="c-all">Todos los campings</button>
      <button class="btn chip" data-camp="oyambre" id="c-oy">Oyambre</button>
      <button class="btn chip" data-camp="ramales" id="c-ra">Ramales</button>
      <button class="btn chip" data-camp="ruiloba" id="c-he">Ruiloba</button>
      <button class="btn chip" data-camp="cardeo" id="c-ca">El Cardeo</button>
    </div>
    <div id="eventsGrid" class="grid"></div>
    <p class="muted" id="eventsEmpty" style="display:none">Sin eventos por ahora.</p>
  </section>

  <!-- IMPRESCINDIBLES -->
  <section id="view-musts" class="view">
    <h2 id="t-musts-title">Imprescindibles de Cantabria</h2>
    <div id="mustsGrid" class="grid"></div>
  </section>

  <!-- CAMPINGS -->
  <section id="view-places" class="view">
    <h2 id="t-campings-title">Nuestros campings</h2>
    <div class="grid">
      <article class="card" style="min-width:unset">
        <h3 id="t-oy-title">Camping Caravaning Playa de Oyambre</h3>
        <p class="muted" id="t-oy-hint">Todos los servicios Â· Frente al mar</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.oyambre.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942711461">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34675696212" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ra-title">Camping Ramales</h3>
        <p class="muted" id="t-ra-hint">Cuevas Â· MontaÃ±a Â· Actividades</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingramales.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34654463133">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+Ramales" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34654463133" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-he-title">Camping El Helguero (Ruiloba)</h3>
        <p class="muted" id="t-he-hint">Naturaleza Â· Familiar Â· Mascotas</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.campingelhelguero.com" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34942722124">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.google.com/?q=Camping+El+Helguero" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34652806564" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>

      <article class="card" style="min-width:unset">
        <h3 id="t-ca-title">Apartamentos / Taberna El Cardeo</h3>
        <p class="muted" id="t-ca-hint">Apartamentos + Taberna</p>
        <div class="row">
          <a class="btn" data-i18n-web href="https://www.elcardeo.es" target="_blank" rel="noopener">Web</a>
          <a class="btn" data-i18n-call href="tel:+34664686158">Llamar</a>
          <a class="btn" data-i18n-directions href="https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6" target="_blank" rel="noopener">CÃ³mo llegar</a>
          <a class="btn primary" data-i18n-whatsapp href="https://wa.me/34664686158" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </article>
    </div>
  </section>

  <!-- HORARIOS -->
  <section id="view-schedules" class="view">
    <h2 id="t-schedules-title">Horarios</h2>
    <div class="acc" id="acc">
      <div class="acc-item"><div class="acc-h" data-acc="oyambre">Oyambre <span>â–¼</span></div><div class="acc-b" id="acc-oyambre"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ramales">Ramales <span>â–¼</span></div><div class="acc-b" id="acc-ramales"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="ruiloba">Ruiloba <span>â–¼</span></div><div class="acc-b" id="acc-ruiloba"></div></div>
      <div class="acc-item"><div class="acc-h" data-acc="cardeo">El Cardeo <span>â–¼</span></div><div class="acc-b" id="acc-cardeo"></div></div>
    </div>
    <p class="muted" id="schedNote">Info orientativa. Pregunta en recepciÃ³n para cambios de temporada.</p>
  </section>
</main>

<!-- Bottom nav -->
<nav class="navbar" role="navigation" aria-label="PestaÃ±as">
  <button class="navbtn active" data-nav="home"><div class="ico">ğŸ </div><div id="n-home">Inicio</div></button>
  <button class="navbtn" data-nav="stay"><div class="ico">ğŸ§³</div><div id="n-stay">Mi estancia</div></button>
  <button class="navbtn" data-nav="incidents"><div class="ico">ğŸ†˜</div><div id="n-inc">Incidencias</div></button>
  <button class="navbtn" data-nav="events"><div class="ico">ğŸ“…</div><div id="n-ev">Eventos</div></button>
  <button class="navbtn" data-nav="musts"><div class="ico">â­</div><div id="n-musts">Imprescindibles</div></button>
</nav>

<!-- Admin modal (igual que versiÃ³n anterior, intacto) -->
<div class="backdrop" id="adminModal" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
  <!-- ... (se mantiene completo sin cambios funcionales) ... -->
</div>

<!-- Idiomas -->
<div class="backdrop" id="langModal">
  <div class="modal">
    <button id="closeLang" class="close" aria-label="Cerrar">âœ•</button>
    <h3 id="langTitle">Selecciona idioma</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px">
      <button class="btn lang-option" data-lang="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
      <button class="btn lang-option" data-lang="en">ğŸ‡¬ğŸ‡§ English</button>
      <button class="btn lang-option" data-lang="fr">ğŸ‡«ğŸ‡· FranÃ§ais</button>
      <button class="btn lang-option" data-lang="de">ğŸ‡©ğŸ‡ª Deutsch</button>
      <button class="btn lang-option" data-lang="nl">ğŸ‡³ğŸ‡± Nederlands</button>
    </div>
  </div>
</div>

<!-- CÃ³mo instalar -->
<div class="backdrop" id="installModal">
  <div class="modal">
    <button id="closeInstall" class="close" aria-label="Cerrar">âœ•</button>
    <h3>CÃ³mo instalar la app</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
      <div class="card" style="min-width:unset">
        <h4>iPhone / iPad (Safari)</h4>
        <ol>
          <li>Pulsa el botÃ³n <b>Compartir</b> (cuadrado con flecha).</li>
          <li>Selecciona <b>AÃ±adir a pantalla de inicio</b>.</li>
          <li>Confirma con <b>AÃ±adir</b>.</li>
        </ol>
      </div>
      <div class="card" style="min-width:unset">
        <h4>Android (Chrome)</h4>
        <ol>
          <li>Abre el menÃº â‹® del navegador.</li>
          <li>Toca <b>AÃ±adir a pantalla de inicio</b> (o <b>Instalar app</b>).</li>
          <li>Confirma y se crearÃ¡ el icono.</li>
        </ol>
      </div>
      <div class="card" style="min-width:unset">
        <h4>Escritorio (Chrome/Edge)</h4>
        <ol>
          <li>En la barra de direcciones, pulsa el icono de <b>instalar</b> o menÃº â‹® &rarr; <b>Instalar</b>.</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Modal Musts detalle -->
<div class="backdrop" id="mustModal" role="dialog" aria-modal="true" aria-labelledby="mustTitle">
  <div class="modal">
    <button class="close" id="closeMust" aria-label="Cerrar">âœ•</button>
    <h3 id="mustTitle">Detalle</h3>
    <p class="muted" id="mustIntro"></p>
    <h4 style="margin:8px 0 6px" id="mustSeeTitle">QuÃ© ver</h4>
    <ul id="mustList" class="must-list"></ul>
    <div id="mustGallery" class="gallery"></div>
  </div>
</div>

<!-- JSZip (admin ZIP) -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function(){

  /* ===== Admin flags ===== */
  localStorage.setItem('admin','0'); document.body.classList.remove('admin-on');
  if(!localStorage.getItem('admin_pin')) localStorage.setItem('admin_pin','311974');

  /* ===== Utils ===== */
  function $(s){return document.querySelector(s);} function $all(s){return Array.prototype.slice.call(document.querySelectorAll(s));}
  function on(el,ev,fn){ if(el) el.addEventListener(ev,fn); }
  function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
  function safeUrl(u){var s=String(u||'').trim(); return (/^https?:\/\//i.test(s) || /^\/|^\.\.?\//.test(s) || /^data:image\//i.test(s)) ? s.replace(/"/g,'%22') : ''; }
  function pad2(n){return ('0'+n).slice(-2);}

  /* ===== Theme ===== */
  function detectTheme(){ var s=localStorage.getItem('theme'); if(s) return s; try{ if(window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark'; }catch(e){} return 'light';}
  function applyTheme(m){ document.body.classList.toggle('dark', m==='dark'); $('#themeBtn').textContent=m==='dark'?'â˜€ï¸':'ğŸŒ™';
    var meta=document.querySelector('meta[name="theme-color"]'); if(meta) meta.setAttribute('content', m==='dark' ? '#0b1220' : '#0ea5e9');}
  var THEME=detectTheme(); applyTheme(THEME);
  on($('#themeBtn'),'click', ()=>{ THEME=(THEME==='dark')?'light':'dark'; applyTheme(THEME); });

  /* ===== I18N (resumen, igual que antes) ===== */
  var I18N = {/* (â€¦ mismo bloque de traducciones que la versiÃ³n anterior â€¦) */};
  // Para ahorrar espacio aquÃ­, reutiliza el mismo objeto I18N completo de la versiÃ³n anterior.
  // --- Si pegas este index como sustituto, mantÃ©n el I18N completo que ya tenÃ­as ---
  // â†“ Para que funcione al pegar directamente, inserto un mÃ­nimo imprescindible:
  I18N = Object.assign({
    es:{app:"Grupo A Cobijo",hello:"Â¡Bienvenido!", ev:"Eventos", evSub:"QuÃ© hay hoy", pl:"Campings", plSub:"Accesos rÃ¡pidos",
        sc:"Horarios", scSub:"RecepciÃ³n Â· bar", inst:"Instalar", instSub:"AÃ±adir a inicio",
        eventsTitle:"Eventos", schedulesTitle:"Horarios", campingsTitle:"Nuestros campings",
        fAll:"Todos", fToday:"Hoy", fTomorrow:"MaÃ±ana", fWeek:"Esta semana", fFav:"Favoritos",
        cAll:"Todos los campings", cOy:"Oyambre", cRa:"Ramales", cHe:"Ruiloba", cCa:"El Cardeo",
        web:"Web", call:"Llamar", directions:"CÃ³mo llegar", whatsapp:"WhatsApp", email:"Email",
        addCal:"AÃ±adir al calendario", fav:"Favorito",
        oyTitle:"Camping Caravaning Playa de Oyambre", oyHint:"Todos los servicios Â· Frente al mar",
        raTitle:"Camping Ramales", raHint:"Cuevas Â· MontaÃ±a Â· Actividades",
        heTitle:"Camping El Helguero (Ruiloba)", heHint:"Naturaleza Â· Familiar Â· Mascotas",
        caTitle:"Apartamentos / Taberna El Cardeo", caHint:"Apartamentos + Taverna",
        schedNote:"Info orientativa. Pregunta en recepciÃ³n para cambios de temporada.",
        nHome:"Inicio", nEv:"Eventos", nPl:"Campings", nSc:"Horarios", nMusts:"Imprescindibles",
        dHome:"Inicio", dStay:"Mi estancia", dInc:"Incidencias", dEv:"Eventos", dPl:"Campings", dSc:"Horarios", dMusts:"Imprescindibles", drawerHint:"Elige secciÃ³n",
        nextEvents:"PrÃ³ximos eventos",
        stay:"Mi estancia", staySub:"Contactos, clima, horarios",
        stayTitle:"Mi estancia", stayHint:"Guardamos tu elecciÃ³n en este dispositivo.", stayWhich:"Selecciona tu alojamiento",
        stayHours:"Horarios del alojamiento",
        weatherTitle:"Clima", max:"MÃ¡x", min:"MÃ­n",
        incTitle:"Incidencias", incWhere:"Â¿En quÃ© alojamiento estÃ¡s?",
        incHint:"Se abre WhatsApp o tu app de correo con el mensaje preparado.",
        incType:"Tipo de incidencia", incMsg:"Describe brevemente el problema",
        incBtnWA:"WhatsApp", incBtnEmail:"Email",
        musts:"Imprescindibles", mustsSub:"QuÃ© ver en Cantabria", mustsTitle:"Imprescindibles de Cantabria",
        mustRead:"Ver mÃ¡s", mustWhatSee:"QuÃ© ver"
    }
  }, I18N||{});

  function detectLang(){ var s=localStorage.getItem('lang'); if(s) return s; var n=(navigator.language||'es').slice(0,2).toLowerCase(); return I18N[n]?n:'es'; }
  var LANG = detectLang();
  function t(id,v){ var el=document.getElementById(id); if(el) el.textContent=v; }
  function applyLang(){
    var T=I18N[LANG];
    t("t-app",T.app); t("t-hello",T.hello);
    t("t-ev",T.ev); t("t-ev-sub",T.evSub);
    t("t-pl",T.pl); t("t-pl-sub",T.plSub);
    t("t-sc",T.sc); t("t-sc-sub",T.scSub);
    t("t-inst",T.inst); t("t-inst-sub",T.instSub);
    t("t-events-title",T.eventsTitle); t("t-schedules-title",T.schedulesTitle); t("t-campings-title",T.campingsTitle);
    t("f-all",T.fAll); t("f-today",T.fToday); t("f-tomorrow",T.fTomorrow); t("f-week",T.fWeek); var ff=document.getElementById('f-fav'); if(ff) ff.textContent=T.fFav;
    t("c-all",T.cAll); t("c-oy",T.cOy); t("c-ra",T.cRa); t("c-he",T.cHe); t("c-ca",T.cCa);
    t("schedNote",T.schedNote);
    t("d-home",T.dHome); t("d-stay",T.dStay); t("d-inc",T.dInc); t("d-ev",T.dEv); t("d-pl",T.dPl); t("d-sc",T.dSc); t("d-musts",T.dMusts); t("drawerHint",T.drawerHint);
    t("t-next-events",T.nextEvents);
    t("t-stay",T.stay); t("t-stay-sub",T.staySub);
    t("t-stay-title",T.stayTitle); t("t-stay-hint",T.stayHint); t("t-stay-which",T.stayWhich);
    t("t-stay-hours",T.stayHours); t("t-weather-title",T.weatherTitle); t("t-max",T.max); t("t-min",T.min);
    t("i-title",T.incTitle); t("i-hint",T.incHint); t("i-where",T.incWhere); t("i-type",T.incType); t("i-msg",T.incMsg);
    var incWA=$('#incWA'), incEmail=$('#incEmail'); if(incWA) incWA.textContent=T.incBtnWA; if(incEmail) incEmail.textContent=T.incBtnEmail;
    t("t-musts",T.musts); t("t-musts-sub",T.mustsSub); t("t-musts-title",T.mustsTitle);
  }
  applyLang();

  on($('#langBtn'),'click', ()=> $('#langModal').style.display='flex');
  on($('#closeLang'),'click', (e)=>{ e.preventDefault(); $('#langModal').style.display='none'; });
  $all('.lang-option').forEach(b=> on(b,'click', function(){ LANG=b.getAttribute('data-lang'); localStorage.setItem('lang',LANG); applyLang(); renderAcc(); loadEvents(); updateStayUI(); updateIncUI(); renderMusts(); $('#langModal').style.display='none'; }));

  /* ===== NavegaciÃ³n ===== */
  function showView(id){
    $all('.view').forEach(v=>v.classList.remove('active'));
    var target=$('#view-'+id); if(target) target.classList.add('active');
    $all('.navbtn').forEach(b=>b.classList.toggle('active', b.getAttribute('data-nav')===id));
    $('#drawer').classList.remove('open'); window.scrollTo({top:0,behavior:'instant'});
  }
  $all('[data-nav]').forEach(el=> on(el,'click', ()=> showView(el.getAttribute('data-nav'))));
  on($('#menuBtn'),'click', ()=> $('#drawer').classList.add('open'));
  on($('#drawerBack'),'click', ()=> $('#drawer').classList.remove('open'));

  /* ===== Datos comunes ===== */
  var PLACE_LINK={oyambre:"https://maps.google.com/?q=Camping+Caravaning+Playa+de+Oyambre",ramales:"https://maps.google.com/?q=Camping+Ramales",ruiloba:"https://maps.google.com/?q=Camping+El+Helguero",cardeo:"https://maps.app.goo.gl/XCzaYGDDLk2CQ8VK6"};
  var PLACE_LABEL={oyambre:"Oyambre",ramales:"Ramales",ruiloba:"Ruiloba",cardeo:"El Cardeo"};
  var WHATSAPP={oyambre:"34675696212",ramales:"34654463133",ruiloba:"34652806564",cardeo:"34664686158"};
  var PHONES={oyambre:"+34942711461",ramales:"+34654463133",ruiloba:"+34942722124",cardeo:"+34664686158"};
  var WEB={oyambre:"https://www.oyambre.com",ramales:"https://www.campingramales.com",ruiloba:"https://www.campingelhelguero.com",cardeo:"https://www.elcardeo.es"};
  var EMAILS={oyambre:"camping@oyambre.com",ramales:"info@campingramales.com",ruiloba:"info@campingelhelguero.com",cardeo:"info@elcardeo.es"};

  /* ===== Eventos (favoritos + .ics) ===== */
  var EVENTS=[], DATE_FILTER='all', CAMP_FILTER='all';
  var FAV_SET = new Set(JSON.parse(localStorage.getItem('fav_events')||'[]'));
  function saveFavs(){ localStorage.setItem('fav_events', JSON.stringify(Array.from(FAV_SET))); }
  function isFav(id){ return FAV_SET.has(id); }
  function toggleFav(id){ if(FAV_SET.has(id)) FAV_SET.delete(id); else FAV_SET.add(id); saveFavs(); renderHomeSlider(); renderEventsGrid(); }

  function whenFmt(d){ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short',day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'}).format(new Date(d)); }catch(e){ return d; } }
  function categoryFor(dateStr){
    var d=new Date(dateStr), now=new Date();
    var startToday=new Date(now.getFullYear(),now.getMonth(),now.getDate());
    var startTomorrow=new Date(startToday); startTomorrow.setDate(startToday.getDate()+1);
    var endOfWeek=new Date(startToday); endOfWeek.setDate(startToday.getDate()+(7-startToday.getDay()));
    if(d>=startToday && d<startTomorrow) return 'today';
    if(d>=startTomorrow && d< new Date(startTomorrow.getFullYear(),startTomorrow.getMonth(),startTomorrow.getDate()+1)) return 'tomorrow';
    if(d>=startToday && d<endOfWeek) return 'week';
    return 'all';
  }
  function i18nField(v){return typeof v==="string"?v:((v&&v[LANG])|| (v&&v.es) || "");}
  function waLink(camping,message){var n=WHATSAPP[String(camping||'').toLowerCase()]; return n?('https://wa.me/'+n+'?text='+encodeURIComponent(message||'')):null;}

  function dtToICS(dt){ var d=new Date(dt);
    function p(n){return('0'+n).slice(-2);}
    return d.getUTCFullYear()+p(d.getUTCMonth()+1)+p(d.getUTCDate())+'T'+p(d.getUTCHours())+p(d.getUTCMinutes())+p(d.getUTCSeconds())+'Z'; }
  function icsEscape(s){ return String(s||'').replace(/\\/g,'\\\\').replace(/;/g,'\\;').replace(/,/g,'\\,').replace(/\n/g,'\\n'); }
  function downloadICS(ev){
    try{
      var title=i18nField(ev.titulo)||'Evento';
      var desc=i18nField(ev.descripcion)||'';
      var loc=i18nField(ev.lugar)|| (PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'');
      var start=new Date(ev.fecha);
      var end=new Date(start.getTime()+90*60000);
      var uid=(ev.id||('ev-'+Date.now()))+'@acobijo.app';
      var now=new Date();
      var ics = [
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Grupo A Cobijo//Customer App//ES','CALSCALE:GREGORIAN','METHOD:PUBLISH',
        'BEGIN:VEVENT',
        'UID:'+icsEscape(uid),
        'DTSTAMP:'+dtToICS(now),
        'DTSTART:'+dtToICS(start),
        'DTEND:'+dtToICS(end),
        'SUMMARY:'+icsEscape(title),
        'DESCRIPTION:'+icsEscape(desc),
        'LOCATION:'+icsEscape(loc),
        'END:VEVENT','END:VCALENDAR'].join('\r\n');
      var blob=new Blob([ics],{type:'text/calendar;charset=utf-8'});
      var a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download=('evento-'+(ev.id||'acobijo')+'.ics').replace(/[^a-z0-9._-]+/gi,'_');
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
    }catch(e){ alert('No se pudo generar el calendario.'); }
  }

  function bindEventActionButtons(scope){
    var _all=$all; $all=function(sel,sc){ if(sc&&sc.querySelectorAll) return Array.prototype.slice.call(sc.querySelectorAll(sel)); return _all(sel); };
    $all('.fav-btn', scope).forEach(btn=> on(btn,'click', function(){ toggleFav(btn.getAttribute('data-id')); }));
    $all('.ics-btn', scope).forEach(btn=> on(btn,'click', function(){ var ev=EVENTS.find(e=>e.id===btn.getAttribute('data-id')); if(ev) downloadICS(ev); }));
  }

  function renderHomeSlider(){
    var wrap=$('#homeEvents'); if(!wrap) return;
    var next=EVENTS.slice().sort((a,b)=>new Date(a.fecha)-new Date(b.fecha)).slice(0,6);
    if(!next.length){ wrap.innerHTML='<div class="muted">'+esc(I18N[LANG].nextEvents)+': â€”</div>'; return; }
    wrap.innerHTML = next.map(function(ev){
      var rawTitle=i18nField(ev.titulo)||'(sin tÃ­tulo)';
      var rawPlace=i18nField(ev.lugar)||PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'';
      var title=esc(rawTitle), place=esc(rawPlace);
      var img=safeUrl(ev.imagen||ev.image||'');
      var wa=waLink(ev.camping,'Hola, consulta sobre â€œ'+rawTitle+'â€ en '+rawPlace+'.');
      var favStar = isFav(ev.id) ? 'â˜…' : 'â˜†';
      var dir = PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#';
      return '<div class="card">'
        + (img?'<img src="'+img+'" alt="'+title+'" loading="lazy" onerror="this.style.display=\'none\'">':'<div class="ph"><span>ğŸ“…</span></div>')
        + '<div class="title">'+title+'</div>'
        + '<div class="meta">'+whenFmt(ev.fecha)+' Â· '+place+'</div>'
        + '<div class="row" style="margin-top:6px">'
          + '<button class="btn fav-btn" data-id="'+esc(ev.id)+'">'+favStar+' '+I18N[LANG].fav+'</button>'
          + '<button class="btn ics-btn" data-id="'+esc(ev.id)+'">ğŸ“† '+I18N[LANG].addCal+'</button>'
          + (wa?'<a class="btn ghost sm" href="'+esc(wa)+'" target="_blank" rel="noopener">'+I18N[LANG].whatsapp+'</a>':'')
          + '<a class="btn ghost sm" href="'+esc(dir)+'" target="_blank" rel="noopener">'+I18N[LANG].directions+'</a>'
        + '</div></div>';
    }).join('');
    bindEventActionButtons(wrap);
  }

  function renderEventsGrid(){
    var grid=$('#eventsGrid'), empty=$('#eventsEmpty'); if(!grid) return;
    var filtered = EVENTS.filter(function(ev){
      var byCamp = CAMP_FILTER==='all' ? true : (String(ev.camping||'').toLowerCase()===CAMP_FILTER);
      if(DATE_FILTER==='fav'){ return byCamp && isFav(ev.id); }
      var byDate = DATE_FILTER==='all' ? true : categoryFor(ev.fecha)===DATE_FILTER;
      return byDate && byCamp;
    }).sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));
    if(!filtered.length){ grid.innerHTML=''; if(empty) empty.style.display='block'; return; }
    if(empty) empty.style.display='none';
    grid.innerHTML = filtered.map(function(ev){
      var rawTitle=i18nField(ev.titulo)||'(sin tÃ­tulo)';
      var rawPlace=i18nField(ev.lugar)||PLACE_LABEL[String(ev.camping||'').toLowerCase()]||'';
      var title=esc(rawTitle), place=esc(rawPlace);
      var img=safeUrl(ev.imagen||ev.image||'');
      var wa=waLink(ev.camping,'Hola, consulta sobre â€œ'+rawTitle+'â€ en '+rawPlace+'.');
      var favStar = isFav(ev.id) ? 'â˜…' : 'â˜†';
      return '<div class="card" style="min-width:unset">'
        + (img?'<img src="'+img+'" alt="'+title+'" loading="lazy" onerror="this.style.display=\'none\'">':'<div class="ph"><span>ğŸŸï¸</span></div>')
        + '<div class="title">'+title+'</div>'
        + '<div class="meta">'+whenFmt(ev.fecha)+' Â· '+place+'</div>'
        + '<div class="row" style="margin-top:6px">'
          + '<button class="btn fav-btn" data-id="'+esc(ev.id)+'">'+favStar+' '+I18N[LANG].fav+'</button>'
          + '<button class="btn ics-btn" data-id="'+esc(ev.id)+'">ğŸ“† '+I18N[LANG].addCal+'</button>'
          + (wa?'<a class="btn" href="'+esc(wa)+'" target="_blank" rel="noopener">'+I18N[LANG].whatsapp+'</a>':'')
          + '<a class="btn" href="'+esc(PLACE_LINK[String(ev.camping||'').toLowerCase()]||'#')+'" target="_blank" rel="noopener">'+I18N[LANG].directions+'</a>'
        + '</div></div>';
    }).join('');
    bindEventActionButtons(grid);
  }

  function loadEvents(){
    fetch('./events.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>r.json()).then(data=>{ EVENTS = Array.isArray(data)?data:[]; renderHomeSlider(); renderEventsGrid(); })
      .catch(()=>{ EVENTS=[]; renderHomeSlider(); renderEventsGrid(); });
  }

  $all('[data-filter]').forEach(ch=> on(ch,'click', function(){ $all('[data-filter]').forEach(x=>x.classList.remove('on')); ch.classList.add('on'); DATE_FILTER=ch.getAttribute('data-filter')||'all'; renderEventsGrid(); }));
  $all('[data-camp]').forEach(ch=> on(ch,'click', function(){ $all('[data-camp]').forEach(x=>x.classList.remove('on')); ch.classList.add('on'); CAMP_FILTER=ch.getAttribute('data-camp')||'all'; renderEventsGrid(); }));

  /* ===== Horarios ===== */
  var SCHEDULES_DEFAULT={
    oyambre:{es:"<b>RecepciÃ³n</b>: 8:30â€“22:00<br><b>Bar</b>: 8:30â€“23:00<br><b>Restaurante</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Piscinas (toda la temporada)</b>: 9:00â€“21:00<br><b>Gimnasio</b>: 9:00â€“21:00<br><b>LavanderÃ­a</b>: 24 horas<br><b>Tienda</b>: 8:30â€“13:00 / 17:00â€“20:00<br><b>Barrera de entrada</b>: 8:00â€“23:59 (circulaciÃ³n prohibida 00:00â€“8:00)<br><b>Check-in parcelas</b>: 13:00<br><b>Check-in alojamientos</b>: 17:00<br><b>Check-out</b>: 12:00<br><i>Los horarios pueden variar segÃºn fechas.</i>",
             en:"<b>Reception</b>: 08:30â€“22:00<br><b>Bar</b>: 08:30â€“23:00<br><b>Restaurant</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Pools (all season)</b>: 09:00â€“21:00<br><b>Gym</b>: 09:00â€“21:00<br><b>Laundry</b>: 24h<br><b>Shop</b>: 08:30â€“13:00 / 17:00â€“20:00<br><b>Entry gate</b>: 08:00â€“23:59 (no driving 00:00â€“08:00)<br><b>Pitch check-in</b>: 13:00<br><b>Lodging check-in</b>: 17:00<br><b>Check-out</b>: 12:00<br><i>Times may vary by date.</i>"},
    ramales:{es:"<b>RecepciÃ³n</b>: 9:00â€“21:00<br><b>CafeterÃ­a</b>: lunâ€“vie 17:00â€“22:00 Â· sÃ¡bâ€“dom 8:30â€“22:00<br><b>Restaurante</b>: lunâ€“vie 19:00â€“22:00 Â· sÃ¡bâ€“dom 13:30â€“15:00 / 19:00â€“22:00<br><b>Piscina</b>: 9:30â€“20:30<br><b>Check-in parcelas</b>: 12:00<br><b>Check-in alojamientos</b>: 16:00<br><b>Check-out</b>: 12:00<br><b>Barrera</b>: 8:00â€“23:59 (prohibida circulaciÃ³n 00:00â€“8:00)<br><i>Los horarios pueden variar segÃºn fechas.</i>",
             en:"<b>Reception</b>: 09:00â€“21:00<br><b>CafÃ©</b>: Monâ€“Fri 17:00â€“22:00 Â· Satâ€“Sun 08:30â€“22:00<br><b>Restaurant</b>: Monâ€“Fri 19:00â€“22:00 Â· Satâ€“Sun 13:30â€“15:00 / 19:00â€“22:00<br><b>Pool</b>: 09:30â€“20:30<br><b>Pitch check-in</b>: 12:00<br><b>Lodging check-in</b>: 16:00<br><b>Check-out</b>: 12:00<br><b>Gate</b>: 08:00â€“23:59 (no driving 00:00â€“08:00)<br><i>Times may vary by date.</i>"},
    ruiloba:{es:"<b>RecepciÃ³n</b>: 8:30â€“22:00<br><b>Piscinas (toda la temporada)</b>: 9:00â€“21:00<br><b>CafeterÃ­a</b>: 8:30â€“23:00<br><b>Restaurante</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>LavanderÃ­a</b>: 24 horas<br><b>Barrera</b>: 8:00â€“23:59 (prohibida circulaciÃ³n 00:00â€“8:00)<br><b>Tienda</b>: consultar en cafeterÃ­a<br><b>Check-in parcelas</b>: 13:00<br><b>Check-in alojamientos</b>: 17:00<br><b>Check-out</b>: 12:00<br><i>Los horarios pueden variar segÃºn fechas.</i>",
             en:"<b>Reception</b>: 08:30â€“22:00<br><b>Pools (all season)</b>: 09:00â€“21:00<br><b>CafÃ©</b>: 08:30â€“23:00<br><b>Restaurant</b>: 13:30â€“15:00 / 19:00â€“22:00<br><b>Laundry</b>: 24h<br><b>Gate</b>: 08:00â€“23:59 (no driving 00:00â€“08:00)<br><b>Shop</b>: ask at the cafÃ©<br><b>Pitch check-in</b>: 13:00<br><b>Lodging check-in</b>: 17:00<br><b>Check-out</b>: 12:00<br><i>Times may vary by date.</i>"},
    cardeo:{es:"<b>Check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Taberna</b>: 8:30â€“23:00<br><b>Restaurante (fines de semana)</b>: 13:30â€“15:30 / 20:00â€“22:30<br><i>Los horarios pueden variar segÃºn fechas.</i>",
            en:"<b>Check-in</b>: 16:00 Â· <b>Check-out</b>: 12:00<br><b>Tavern</b>: 08:30â€“23:00<br><b>Restaurant (weekends)</b>: 13:30â€“15:30 / 20:00â€“22:30<br><i>Times may vary by date.</i>"}
  };
  var SCHEDULES = JSON.parse(JSON.stringify(SCHEDULES_DEFAULT));
  function renderAcc(){ ['oyambre','ramales','ruiloba','cardeo'].forEach(function(k){
      var el=$('#acc-'+k), item=SCHEDULES[k]||SCHEDULES_DEFAULT[k]||{}; if(el) el.innerHTML = item[LANG] || item.es || '';
  }); }
  function loadSchedules(){
    fetch('./schedules.json?v='+(Date.now()),{cache:'no-store'})
      .then(r=>{ if(!r.ok) throw 0; return r.json(); })
      .then(json=>{ if(json && typeof json==='object'){ SCHEDULES=json; renderAcc(); renderStayHours(); }})
      .catch(()=>{ SCHEDULES=JSON.parse(JSON.stringify(SCHEDULES_DEFAULT)); renderAcc(); renderStayHours(); });
  }
  $all('.acc-h').forEach(h=> on(h,'click', ()=> h.parentElement.classList.toggle('open')));

  /* ===== Mi estancia ===== */
  var STAY = localStorage.getItem('stay_place') || 'oyambre';
  var COORDS = { oyambre:{lat:43.393, lon:-4.352}, ramales:{lat:43.263, lon:-3.465}, ruiloba:{lat:43.387, lon:-4.264}, cardeo:{lat:43.391, lon:-4.274} };
  function setStayPlace(v){ STAY=String(v||'oyambre').toLowerCase(); localStorage.setItem('stay_place',STAY); updateStayUI(); updateIncUI(); }
  function renderStayContacts(){
    var T=I18N[LANG], place=STAY;
    $('#stayPlace').value=place;
    var web=WEB[place], tel=PHONES[place], wa=WHATSAPP[place], mail=EMAILS[place], dir=PLACE_LINK[place];
    $('#stayWeb').textContent=T.web; $('#stayWeb').onclick=function(){ location.href=web; };
    $('#stayCall').textContent=T.call; $('#stayCall').href='tel:'+tel;
    $('#stayWA').textContent=T.whatsapp; $('#stayWA').href='https://wa.me/'+wa+'?text='+encodeURIComponent('Hola, soy cliente alojado en '+PLACE_LABEL[place]+'.');
    $('#stayEmail').textContent=T.email; $('#stayEmail').href='mailto:'+mail+'?subject='+encodeURIComponent('Consulta - '+PLACE_LABEL[place])+'&body='+encodeURIComponent('Hola,\n\nSoy cliente alojado en '+PLACE_LABEL[place]+'.\n\nGracias.');
    $('#stayDir').textContent=T.directions; $('#stayDir').href=dir;
    $('#wxPlaceLabel').textContent=PLACE_LABEL[place];
  }
  function renderStayHours(){ var item=(SCHEDULES[STAY]||SCHEDULES_DEFAULT[STAY]||{}); $('#stayHours').innerHTML = item[LANG] || item.es || ''; }

  function codeToEmoji(code){
    if([0].includes(code)) return 'â˜€ï¸'; if([1,2].includes(code)) return 'ğŸŒ¤ï¸'; if([3].includes(code)) return 'â˜ï¸';
    if([45,48].includes(code)) return 'ğŸŒ«ï¸'; if([51,53,55,56,57].includes(code)) return 'ğŸŒ¦ï¸';
    if([61,63,65,80,81,82].includes(code)) return 'ğŸŒ§ï¸'; if([66,67,71,73,75,77,85,86].includes(code)) return 'â„ï¸';
    if([95,96,99].includes(code)) return 'â›ˆï¸'; return 'ğŸŒ¡ï¸';
  }
  function wd(d){ try{ return new Intl.DateTimeFormat(LANG,{weekday:'short'}).format(new Date(d)); }catch(e){ return d; } }
  function renderWeather(data){
    if(!data) return;
    $('#wxIco').textContent = codeToEmoji(data.current.weather_code);
    $('#wxNow').textContent = Math.round(data.current.temperature_2m);
    $('#wxMax').textContent = Math.round(data.daily.temperature_2m_max[0]);
    $('#wxMin').textContent = Math.round(data.daily.temperature_2m_min[0]);
    $('#wxDesc').textContent = wd(data.daily.time[0]);
    for(var i=1;i<=3;i++){
      $('#d'+i).textContent = wd(data.daily.time[i]);
      $('#i'+i).textContent = codeToEmoji(data.daily.weather_code[i]);
      $('#t'+i).textContent = Math.round(data.daily.temperature_2m_max[i])+'/'+Math.round(data.daily.temperature_2m_min[i])+'Â°';
    }
  }
  function fetchWeather(place){
    var c=COORDS[place]||COORDS.oyambre;
    var url = 'https://api.open-meteo.com/v1/forecast?latitude='+c.lat+'&longitude='+c.lon+'&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=4';
    fetch(url).then(r=>r.json()).then(renderWeather).catch(function(){});
  }
  function updateStayUI(){ renderStayContacts(); renderStayHours(); fetchWeather(STAY); }
  on($('#stayPlace'),'change', (e)=> setStayPlace(e.target.value));

  /* ===== Incidencias ===== */
  function buildIncMsg(){
    var T=I18N[LANG], type=$('#incType').value||'Otros', msg=$('#incMsg').value||'';
    var now=new Date(); var stamp = now.toLocaleString();
    var header = '['+T.incTitle+'] '+type+' Â· '+PLACE_LABEL[STAY];
    var body = 'Hola,\n\nTengo una incidencia: '+type+'.\n\nDetalle: '+msg+'\n\nAlojamiento: '+PLACE_LABEL[STAY]+'\nFecha/hora: '+stamp+'\n\nGracias.';
    return {subject:header, body:body};
  }
  function updateIncUI(){
    $('#incPlace').value=STAY;
    var mail=EMAILS[STAY], wa=WHATSAPP[STAY];
    var m=buildIncMsg();
    $('#incWA').href='https://wa.me/'+wa+'?text='+encodeURIComponent(m.body);
    $('#incEmail').href='mailto:'+mail+'?subject='+encodeURIComponent(m.subject)+'&body='+encodeURIComponent(m.body);
  }
  on($('#incPlace'),'change', (e)=> setStayPlace(e.target.value));
  on($('#incType'),'change', updateIncUI);
  on($('#incMsg'),'input', updateIncUI);

  /* ===== Admin activaciÃ³n (5 toques) â€“ omitido por brevedad, igual que antes ===== */
  // (Si lo necesitas aquÃ­, pega el bloque admin completo de la versiÃ³n anterior; funcionalidad sin cambios.)

  /* ===== PWA install (nota) ===== */
  var deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); deferredPrompt=e; });
  on($('#installTile'),'click', function(){ $('#installModal').style.display='flex'; document.body.classList.add('modal-open'); try{ if(deferredPrompt){ deferredPrompt.prompt(); deferredPrompt=null; } }catch(e){} });
  on($('#closeInstall'),'click', function(){ $('#installModal').style.display='none'; document.body.classList.remove('modal-open'); });

  /* ===== IMPRESCINDIBLES ===== */
  var MUSTS = [
    /* 1) COMILLAS (general con subpuntos, como pediste) */
    {
      id:'comillas',
      emoji:'ğŸ›ï¸',
      title:{es:'Comillas'},
      cover:'', /* si pones assets/musts/comillas.jpg, se mostrarÃ¡ automÃ¡ticamente */
      summary:{es:'Villa modernista junto al mar, con patrimonio Ãºnico, buenas playas y ambiente seÃ±orial.'},
      intro:{es:'Comillas concentra joyas del modernismo y edificios emblemÃ¡ticos en un entorno costero precioso.'},
      items:[
        { title:{es:'El Capricho de GaudÃ­'},
          desc:{es:'Obra temprana (1883â€“85). CerÃ¡mica y hierro con girasoles; detalles orgÃ¡nicos y luz natural.'},
          img:'' /* assets/musts/capricho.jpg */
        },
        { title:{es:'Palacio de Sobrellano y Capilla-PanteÃ³n'},
          desc:{es:'Residencia neogÃ³tica del MarquÃ©s de Comillas y capilla anexa. Artesonados y mobiliario de Ã©poca.'},
          img:'' /* assets/musts/sobrellano.jpg */
        },
        { title:{es:'Universidad Pontificia'},
          desc:{es:'Conjunto monumental en la colina con influencias neogÃ³ticas y neomudÃ©jares; panorÃ¡micas de la villa.'},
          img:'' /* assets/musts/pontificia.jpg */
        },
        { title:{es:'Casco histÃ³rico y Puerto'},
          desc:{es:'Casonas indianas, plaza de la ConstituciÃ³n y barrio marinero; paseo hasta el espigÃ³n.'},
          img:'' /* assets/musts/casco_comillas.jpg */
        },
        { title:{es:'Playas y miradores de Oyambre'},
          desc:{es:'Arenales (Comillas, Oyambre) y miradores con vistas a Picos de Europa cuando despeja.'},
          img:'' /* assets/musts/oyambre.jpg */
        }
      ],
      gallery:[/* 'assets/musts/comillas_1.jpg','assets/musts/comillas_2.jpg' */]
    },

    /* 2) PARQUE DE LA NATURALEZA DE CABÃRCENO */
    {
      id:'cabarceno',
      emoji:'ğŸ˜',
      title:{es:'Parque de la Naturaleza de CabÃ¡rceno'},
      cover:'',
      summary:{es:'Fauna en semilibertad en una antigua mina de hierro. Ideal en familia.'},
      intro:{es:'Recorridos en coche con paradas para ver elefantes, jirafas, osos, hipopÃ³tamosâ€¦ con grandes recintos y miradores.'},
      items:[
        {title:{es:'Itinerario norte/sur en coche'}, desc:{es:'Planifica 3â€“5 h con paradas. SeÃ±alizaciÃ³n clara y Ã¡reas de descanso.'}, img:''},
        {title:{es:'Telecabina y miradores'}, desc:{es:'Vistas aÃ©reas del parque y del karst; perfectas para fotos.'}, img:''},
        {title:{es:'Exhibiciones'}, desc:{es:'Rapaces (segÃºn temporada) y focas. Consulta horarios a la entrada.'}, img:''}
      ],
      gallery:[]
    },

    /* 3) PICOS DE EUROPA & FUENTE DÃ‰ */
    {
      id:'picos',
      emoji:'ğŸ”ï¸',
      title:{es:'Picos de Europa â€“ Fuente DÃ©'},
      cover:'',
      summary:{es:'Alta montaÃ±a accesible con telefÃ©rico. Paisajes espectaculares.'},
      intro:{es:'Desde Fuente DÃ©, el telefÃ©rico sube al macizo de Ãndaraâ€“Central. Arriba, rutas y miradores con vistas a LiÃ©bana.'},
      items:[
        {title:{es:'TelefÃ©rico de Fuente DÃ©'}, desc:{es:'Desnivel de ~750 m en 4 min. Mejor a primera hora o Ãºltima para evitar colas.'}, img:''},
        {title:{es:'Ruta a los Horcados Rojos (avanzada)'}, desc:{es:'Itinerario de alta montaÃ±a con desnivel y tramos pedregosos; solo con buen tiempo y equipo.'}, img:''},
        {title:{es:'Paseo por Ãliva (fÃ¡cil)'}, desc:{es:'Pistas suaves con praderas y ganado; opciÃ³n de ida y vuelta o combinaciones con 4x4.'}, img:''}
      ],
      gallery:[]
    },

    /* 4) COSTA QUEBRADA */
    {
      id:'costa-quebrada',
      emoji:'ğŸŒŠ',
      title:{es:'Costa Quebrada (Liencres, ArnÃ­a, Covachos)'},
      cover:'',
      summary:{es:'Acantilados, playas salvajes y formaciones rocosas Ãºnicas.'},
      intro:{es:'Tramo litoral con flysch y rocas emergentes. Espectacular al atardecer y con mareas vivas.'},
      items:[
        {title:{es:'Parque Natural de las Dunas de Liencres'}, desc:{es:'Sistema dunar y pinares con grandes playas (Canallave, Valdearenas).'}, img:''},
        {title:{es:'Playa de ArnÃ­a'}, desc:{es:'Icono fotogrÃ¡fico por sus lajas de roca y olas rompiendo.'}, img:''},
        {title:{es:'Covachos y La Virgencita'}, desc:{es:'Calas con islote (ojo con las mareas).'}, img:''}
      ],
      gallery:[]
    },

    /* 5) CASTRO URDIALES */
    {
      id:'castro',
      emoji:'ğŸ°',
      title:{es:'Castro Urdiales'},
      cover:'',
      summary:{es:'Villa marinera con conjunto monumental junto al mar.'},
      intro:{es:'Iglesia gÃ³tica de Santa MarÃ­a, castillo-faro y el puente medieval dominan la bahÃ­a y el paseo.'},
      items:[
        {title:{es:'Iglesia de Santa MarÃ­a'}, desc:{es:'GÃ³tico puro, de gran altura y vidrieras. Monumento clave en el CantÃ¡brico.'}, img:''},
        {title:{es:'Castilloâ€“Faro y Puente Medieval'}, desc:{es:'Recorrido fotogÃ©nico por el promontorio con vistas a la costa.'}, img:''},
        {title:{es:'Paseo marÃ­timo y puerto'}, desc:{es:'Ambiente animado, bares y marisquerÃ­as.'}, img:''}
      ],
      gallery:[]
    },

    /* 6) LIÃ‰BANA & SANTO TORIBIO */
    {
      id:'liebana',
      emoji:'â›ª',
      title:{es:'LiÃ©bana & Monasterio de Santo Toribio'},
      cover:'',
      summary:{es:'Valle al pie de Picos, clima suave y patrimonio religioso.'},
      intro:{es:'Potes como base, desfiladero de La Hermida y el monasterio (AÃ±o Jubilar Lebaniego) con el Lignum Crucis.'},
      items:[
        {title:{es:'Monasterio de Santo Toribio'}, desc:{es:'Centro de peregrinaciÃ³n; Puerta del PerdÃ³n y reliquia del Lignum Crucis.'}, img:''},
        {title:{es:'Potes y su casco'}, desc:{es:'Torre del Infantado y calles de piedra con gastronomÃ­a lebaniega.'}, img:''},
        {title:{es:'Miradores de la comarca'}, desc:{es:'Vistas a Picos desde mÃºltiples puntos del valle.'}, img:''}
      ],
      gallery:[]
    }
  ];

  function mTitle(obj){ return (obj.title&& (obj.title[LANG]||obj.title.es)) || ''; }
  function mText(obj, key){ return (obj[key] && (obj[key][LANG]||obj[key].es)) || ''; }
  function phBlock(emoji, small){ return '<div class="ph'+(small?' sm':'')+'"><span>'+esc(emoji||'â­')+'</span></div>'; }

  function renderMusts(){
    var grid=$('#mustsGrid'); if(!grid) return;
    var list = MUSTS.slice().sort(function(a,b){ return a.id==='comillas'?-1: b.id==='comillas'?1:0; });
    grid.innerHTML = list.map(function(cat){
      var img = safeUrl(cat.cover||'');
      var emoji = cat.emoji || 'â­';
      return '<article class="must-card">'
        + (img?'<img src="'+img+'" alt="'+esc(mTitle(cat))+'" loading="lazy" onerror="this.replaceWith(document.createRange().createContextualFragment(`'+phBlock(emoji).replace(/`/g,'\\`')+'`))">': phBlock(emoji))
        + '<div class="must-title">'+esc(mTitle(cat))+'</div>'
        + '<div class="must-summary">'+esc(mText(cat,'summary'))+'</div>'
        + '<div class="row" style="margin-top:6px">'
          + '<button class="btn" data-must="'+esc(cat.id)+'">ğŸ” '+esc(I18N[LANG].mustRead)+'</button>'
        + '</div>'
      + '</article>';
    }).join('');
    $all('button[data-must]').forEach(b=> on(b,'click', ()=> openMust(b.getAttribute('data-must'))));
  }

  function openMust(id){
    var cat = MUSTS.find(x=>x.id===id); if(!cat) return;
    $('#mustTitle').textContent = mTitle(cat);
    $('#mustIntro').textContent = mText(cat,'intro') || mText(cat,'summary');
    $('#mustSeeTitle').textContent = I18N[LANG].mustWhatSee;

    var list = (cat.items||[]).map(function(it){
      var t = (it.title && (it.title[LANG]||it.title.es)) || '';
      var d = (it.desc && (it.desc[LANG]||it.desc.es)) || '';
      var img = safeUrl(it.img||''); var emoji = cat.emoji || 'â­';
      var media = img?('<img src="'+img+'" alt="'+esc(t)+'" loading="lazy" style="width:100%;max-height:180px;object-fit:cover;border-radius:10px;border:1px solid var(--line);margin:6px 0" onerror="this.replaceWith(document.createRange().createContextualFragment(`'+phBlock(emoji,true).replace(/`/g,'\\`')+'`))">')
                     : phBlock(emoji,true);
      return '<li>'+ media + '<b>'+esc(t)+'</b>: '+esc(d)+'</li>';
    }).join('');
    $('#mustList').innerHTML = list || '<li>â€”</li>';

    var gal = (cat.gallery||[]).map(function(src){
      var s = safeUrl(src||''), emoji = cat.emoji || 'â­';
      return s?('<img src="'+s+'" loading="lazy" onerror="this.replaceWith(document.createRange().createContextualFragment(`'+phBlock(emoji,true).replace(/`/g,'\\`')+'`))">')
              : phBlock(emoji,true);
    }).join('');
    $('#mustGallery').innerHTML = gal || phBlock(cat.emoji,true);

    $('#mustModal').style.display='flex'; document.body.classList.add('modal-open');
  }
  on($('#closeMust'),'click', function(){ $('#mustModal').style.display='none'; document.body.classList.remove('modal-open'); });
  on($('#mustModal'),'click', function(e){ if(e.target && e.target.id==='mustModal'){ $('#mustModal').style.display='none'; document.body.classList.remove('modal-open'); } });

  /* ===== Init ===== */
  loadSchedules(); loadEvents(); renderAcc(); renderMusts(); updateStayUI(); updateIncUI();

  /* ===== Service Worker ===== */
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('./service-worker.js');
    navigator.serviceWorker.addEventListener('message', (e) => {
      if (e.data && e.data.type === 'SW_ACTIVE') {
        console.log('PWA actualizada a', e.data.version);
      }
    });
  }

}); // DOMContentLoaded
</script>
</body>
</html>
